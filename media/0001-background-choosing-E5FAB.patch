From 5d007e09fe4b71aede02c6edf71960bf5429f421 Mon Sep 17 00:00:00 2001
From: Szybet <53944559+Szybet@users.noreply.github.com>
Date: Wed, 28 Sep 2022 23:23:39 +0200
Subject: [PATCH] background choosing

---
 src/settings/settings.cpp |  22 ++
 src/settings/settings.h   |   2 +
 src/settings/settings.ui  | 459 ++++++++++++++++++++------------------
 3 files changed, 267 insertions(+), 216 deletions(-)

diff --git a/src/settings/settings.cpp b/src/settings/settings.cpp
index 38ba54d..85a14f8 100644
--- a/src/settings/settings.cpp
+++ b/src/settings/settings.cpp
@@ -301,6 +301,21 @@ settings::settings(QWidget *parent) :
     if(checkconfig(".config/12-lockscreen/config") == true) {
         ui->enableLockscreenCheckBox->click();
     }
+    QString backgroundPath = ".config/12-lockscreen/background";
+    if(QFile(backgroundPath).exists() == false) {
+        writeFile(backgroundPath, "blank");
+    }
+    QStringList backgroundOptions = {readFile(backgroundPath)};
+    if(backgroundOptions.contains("blank") == false) {
+        backgroundOptions.append("blank");
+    }
+    if(backgroundOptions.contains("screensaver") == false) {
+        backgroundOptions.append("screensaver");
+    }
+    if(backgroundOptions.contains("background") == false) {
+        backgroundOptions.append("background");
+    }
+    ui->LockBackComboBox->addItems(backgroundOptions);
 
     // Global reading settings
     if(checkconfig(".config/16-global_reading_settings/config") == true) {
@@ -1148,6 +1163,8 @@ void settings::on_showUSBPromptCheckBox_toggled(bool checked)
 }
 
 void settings::changePassword() {
+    setDefaultWorkDir();
+
     global::keyboard::keypadText = "";
     global::keyboard::keypadDialog = true;
     generalDialogWindow = new generalDialog();
@@ -1185,3 +1202,8 @@ void settings::changePassword() {
         saltFile.write(salt.toLocal8Bit());
     }
 }
+
+void settings::on_LockBackComboBox_activated(const QString &arg1)
+{
+    writeFile(".config/12-lockscreen/background", arg1);
+}
diff --git a/src/settings/settings.h b/src/settings/settings.h
index 0ab6230..df3e619 100644
--- a/src/settings/settings.h
+++ b/src/settings/settings.h
@@ -79,6 +79,8 @@ private slots:
     void on_updateCheckingCheckbox_toggled(bool checked);
     void on_showUSBPromptCheckBox_toggled(bool checked);
     void changePassword();
+    void on_LockBackComboBox_activated(const QString &arg1);
+
 signals:
     void showToast(QString messageToDisplay);
     void closeIndefiniteToast();
diff --git a/src/settings/settings.ui b/src/settings/settings.ui
index 529f851..e975095 100644
--- a/src/settings/settings.ui
+++ b/src/settings/settings.ui
@@ -91,7 +91,7 @@
             <number>0</number>
            </property>
            <property name="currentIndex">
-            <number>0</number>
+            <number>1</number>
            </property>
            <widget class="QWidget" name="page">
             <layout class="QVBoxLayout" name="verticalLayout_2">
@@ -693,20 +693,46 @@
                <property name="bottomMargin">
                 <number>0</number>
                </property>
-               <item row="11" column="0">
-                <layout class="QGridLayout" name="gridLayout_12">
+               <item row="24" column="0">
+                <widget class="QLabel" name="storageEncryptionLabel">
+                 <property name="font">
+                  <font>
+                   <family>Chivo</family>
+                   <italic>true</italic>
+                  </font>
+                 </property>
+                 <property name="text">
+                  <string>Storage encryption</string>
+                 </property>
+                </widget>
+               </item>
+               <item row="27" column="0">
+                <layout class="QGridLayout" name="gridLayout_17">
                  <property name="bottomMargin">
                   <number>0</number>
                  </property>
+                 <item row="0" column="1">
+                  <spacer name="horizontalSpacer_14">
+                   <property name="orientation">
+                    <enum>Qt::Horizontal</enum>
+                   </property>
+                   <property name="sizeHint" stdset="0">
+                    <size>
+                     <width>40</width>
+                     <height>20</height>
+                    </size>
+                   </property>
+                  </spacer>
+                 </item>
                  <item row="0" column="0">
-                  <widget class="QLabel" name="label_8">
+                  <widget class="QLabel" name="repackLabel">
                    <property name="text">
-                    <string>Reset this device</string>
+                    <string>Repack</string>
                    </property>
                   </widget>
                  </item>
                  <item row="0" column="2">
-                  <widget class="QPushButton" name="resetBtn">
+                  <widget class="QPushButton" name="repackBtn">
                    <property name="font">
                     <font>
                      <weight>75</weight>
@@ -714,39 +740,72 @@
                     </font>
                    </property>
                    <property name="text">
-                    <string>Reset</string>
+                    <string>Repack</string>
                    </property>
                   </widget>
                  </item>
-                 <item row="0" column="1">
-                  <spacer name="horizontalSpacer_8">
-                   <property name="orientation">
-                    <enum>Qt::Horizontal</enum>
-                   </property>
-                   <property name="sizeHint" stdset="0">
-                    <size>
-                     <width>40</width>
-                     <height>20</height>
-                    </size>
-                   </property>
-                  </spacer>
-                 </item>
                 </layout>
                </item>
-               <item row="14" column="0">
-                <layout class="QGridLayout" name="gridLayout_18">
+               <item row="28" column="0">
+                <spacer name="verticalSpacer_2">
+                 <property name="orientation">
+                  <enum>Qt::Vertical</enum>
+                 </property>
+                 <property name="sizeHint" stdset="0">
+                  <size>
+                   <width>20</width>
+                   <height>40</height>
+                  </size>
+                 </property>
+                </spacer>
+               </item>
+               <item row="26" column="0">
+                <widget class="QCheckBox" name="enableEncryptedStorageCheckBox">
+                 <property name="text">
+                  <string>Enable</string>
+                 </property>
+                </widget>
+               </item>
+               <item row="25" column="0">
+                <widget class="Line" name="line_10">
+                 <property name="frameShadow">
+                  <enum>QFrame::Plain</enum>
+                 </property>
+                 <property name="orientation">
+                  <enum>Qt::Horizontal</enum>
+                 </property>
+                </widget>
+               </item>
+               <item row="6" column="0">
+                <widget class="QLabel" name="softwareLabel">
+                 <property name="font">
+                  <font>
+                   <family>Chivo</family>
+                   <italic>true</italic>
+                  </font>
+                 </property>
+                 <property name="text">
+                  <string>System</string>
+                 </property>
+                </widget>
+               </item>
+               <item row="12" column="0">
+                <layout class="QGridLayout" name="gridLayout_7">
                  <property name="bottomMargin">
                   <number>0</number>
                  </property>
+                 <property name="verticalSpacing">
+                  <number>0</number>
+                 </property>
                  <item row="0" column="0">
-                  <widget class="QLabel" name="label_11">
+                  <widget class="QLabel" name="label_9">
                    <property name="text">
-                    <string>Timezone</string>
+                    <string>System info</string>
                    </property>
                   </widget>
                  </item>
                  <item row="0" column="1">
-                  <spacer name="horizontalSpacer_16">
+                  <spacer name="horizontalSpacer_6">
                    <property name="orientation">
                     <enum>Qt::Horizontal</enum>
                    </property>
@@ -759,22 +818,22 @@
                   </spacer>
                  </item>
                  <item row="0" column="2">
-                  <widget class="QComboBox" name="tzComboBox"/>
+                  <widget class="QPushButton" name="showSystemInfoBtn">
+                   <property name="font">
+                    <font>
+                     <weight>75</weight>
+                     <bold>true</bold>
+                    </font>
+                   </property>
+                   <property name="text">
+                    <string>Show</string>
+                   </property>
+                  </widget>
                  </item>
                 </layout>
                </item>
-               <item row="24" column="0">
-                <widget class="Line" name="line_10">
-                 <property name="frameShadow">
-                  <enum>QFrame::Plain</enum>
-                 </property>
-                 <property name="orientation">
-                  <enum>Qt::Horizontal</enum>
-                 </property>
-                </widget>
-               </item>
-               <item row="23" column="0">
-                <widget class="QLabel" name="storageEncryptionLabel">
+               <item row="19" column="0">
+                <widget class="QLabel" name="securityLabel">
                  <property name="font">
                   <font>
                    <family>Chivo</family>
@@ -782,17 +841,60 @@
                   </font>
                  </property>
                  <property name="text">
-                  <string>Storage encryption</string>
+                  <string>Security</string>
                  </property>
                 </widget>
                </item>
-               <item row="10" column="0">
-                <widget class="QCheckBox" name="darkModeCheckBox">
-                 <property name="text">
-                  <string>Enable night mode</string>
+               <item row="7" column="0">
+                <widget class="Line" name="line_9">
+                 <property name="frameShadow">
+                  <enum>QFrame::Plain</enum>
+                 </property>
+                 <property name="orientation">
+                  <enum>Qt::Horizontal</enum>
                  </property>
                 </widget>
                </item>
+               <item row="22" column="0">
+                <layout class="QGridLayout" name="gridLayout_13">
+                 <property name="bottomMargin">
+                  <number>0</number>
+                 </property>
+                 <item row="0" column="1">
+                  <spacer name="horizontalSpacer_9">
+                   <property name="orientation">
+                    <enum>Qt::Horizontal</enum>
+                   </property>
+                   <property name="sizeHint" stdset="0">
+                    <size>
+                     <width>40</width>
+                     <height>20</height>
+                    </size>
+                   </property>
+                  </spacer>
+                 </item>
+                 <item row="0" column="2">
+                  <widget class="QPushButton" name="setPasscodeBtn">
+                   <property name="font">
+                    <font>
+                     <weight>75</weight>
+                     <bold>true</bold>
+                    </font>
+                   </property>
+                   <property name="text">
+                    <string>Set</string>
+                   </property>
+                  </widget>
+                 </item>
+                 <item row="0" column="0">
+                  <widget class="QLabel" name="setPasscodeLabel">
+                   <property name="text">
+                    <string>Set a passcode</string>
+                   </property>
+                  </widget>
+                 </item>
+                </layout>
+               </item>
                <item row="15" column="0">
                 <layout class="QGridLayout" name="checkOtaUpdateGridLayout">
                  <property name="bottomMargin">
@@ -833,16 +935,67 @@
                  </item>
                 </layout>
                </item>
-               <item row="6" column="0">
-                <widget class="QLabel" name="softwareLabel">
-                 <property name="font">
-                  <font>
-                   <family>Chivo</family>
-                   <italic>true</italic>
-                  </font>
+               <item row="21" column="0">
+                <widget class="QCheckBox" name="enableLockscreenCheckBox">
+                 <property name="text">
+                  <string>Enable lock screen and passcode</string>
+                 </property>
+                </widget>
+               </item>
+               <item row="20" column="0">
+                <widget class="Line" name="line_2">
+                 <property name="frameShadow">
+                  <enum>QFrame::Plain</enum>
+                 </property>
+                 <property name="orientation">
+                  <enum>Qt::Horizontal</enum>
+                 </property>
+                </widget>
+               </item>
+               <item row="13" column="0">
+                <layout class="QGridLayout" name="gridLayout_19">
+                 <property name="bottomMargin">
+                  <number>0</number>
                  </property>
+                 <item row="0" column="2">
+                  <widget class="QPushButton" name="generateSystemReportBtn">
+                   <property name="font">
+                    <font>
+                     <weight>75</weight>
+                     <bold>true</bold>
+                    </font>
+                   </property>
+                   <property name="text">
+                    <string>Generate</string>
+                   </property>
+                  </widget>
+                 </item>
+                 <item row="0" column="1">
+                  <spacer name="horizontalSpacer_15">
+                   <property name="orientation">
+                    <enum>Qt::Horizontal</enum>
+                   </property>
+                   <property name="sizeHint" stdset="0">
+                    <size>
+                     <width>40</width>
+                     <height>20</height>
+                    </size>
+                   </property>
+                  </spacer>
+                 </item>
+                 <item row="0" column="0">
+                  <widget class="QLabel" name="label_10">
+                   <property name="text">
+                    <string>Generate system report</string>
+                   </property>
+                  </widget>
+                 </item>
+                </layout>
+               </item>
+               <item row="8" column="0">
+                <widget class="QCheckBox" name="enableUiScalingCheckBox">
                  <property name="text">
-                  <string>System</string>
+                  <string>Enable UI scaling</string>
                  </property>
                 </widget>
                </item>
@@ -898,23 +1051,20 @@
                  </item>
                 </layout>
                </item>
-               <item row="12" column="0">
-                <layout class="QGridLayout" name="gridLayout_7">
+               <item row="14" column="0">
+                <layout class="QGridLayout" name="gridLayout_18">
                  <property name="bottomMargin">
                   <number>0</number>
                  </property>
-                 <property name="verticalSpacing">
-                  <number>0</number>
-                 </property>
                  <item row="0" column="0">
-                  <widget class="QLabel" name="label_9">
+                  <widget class="QLabel" name="label_11">
                    <property name="text">
-                    <string>System info</string>
+                    <string>Timezone</string>
                    </property>
                   </widget>
                  </item>
                  <item row="0" column="1">
-                  <spacer name="horizontalSpacer_6">
+                  <spacer name="horizontalSpacer_16">
                    <property name="orientation">
                     <enum>Qt::Horizontal</enum>
                    </property>
@@ -927,67 +1077,10 @@
                   </spacer>
                  </item>
                  <item row="0" column="2">
-                  <widget class="QPushButton" name="showSystemInfoBtn">
-                   <property name="font">
-                    <font>
-                     <weight>75</weight>
-                     <bold>true</bold>
-                    </font>
-                   </property>
-                   <property name="text">
-                    <string>Show</string>
-                   </property>
-                  </widget>
-                 </item>
-                </layout>
-               </item>
-               <item row="13" column="0">
-                <layout class="QGridLayout" name="gridLayout_19">
-                 <property name="bottomMargin">
-                  <number>0</number>
-                 </property>
-                 <item row="0" column="2">
-                  <widget class="QPushButton" name="generateSystemReportBtn">
-                   <property name="font">
-                    <font>
-                     <weight>75</weight>
-                     <bold>true</bold>
-                    </font>
-                   </property>
-                   <property name="text">
-                    <string>Generate</string>
-                   </property>
-                  </widget>
-                 </item>
-                 <item row="0" column="1">
-                  <spacer name="horizontalSpacer_15">
-                   <property name="orientation">
-                    <enum>Qt::Horizontal</enum>
-                   </property>
-                   <property name="sizeHint" stdset="0">
-                    <size>
-                     <width>40</width>
-                     <height>20</height>
-                    </size>
-                   </property>
-                  </spacer>
-                 </item>
-                 <item row="0" column="0">
-                  <widget class="QLabel" name="label_10">
-                   <property name="text">
-                    <string>Generate system report</string>
-                   </property>
-                  </widget>
+                  <widget class="QComboBox" name="tzComboBox"/>
                  </item>
                 </layout>
                </item>
-               <item row="21" column="0">
-                <widget class="QCheckBox" name="enableLockscreenCheckBox">
-                 <property name="text">
-                  <string>Enable lock screen and passcode</string>
-                 </property>
-                </widget>
-               </item>
                <item row="18" column="0">
                 <layout class="QGridLayout" name="gridLayout_14">
                  <property name="bottomMargin">
@@ -1031,46 +1124,27 @@
                  </item>
                 </layout>
                </item>
-               <item row="19" column="0">
-                <widget class="QLabel" name="securityLabel">
-                 <property name="font">
-                  <font>
-                   <family>Chivo</family>
-                   <italic>true</italic>
-                  </font>
-                 </property>
+               <item row="10" column="0">
+                <widget class="QCheckBox" name="darkModeCheckBox">
                  <property name="text">
-                  <string>Security</string>
+                  <string>Enable night mode</string>
                  </property>
                 </widget>
                </item>
-               <item row="26" column="0">
-                <layout class="QGridLayout" name="gridLayout_17">
+               <item row="11" column="0">
+                <layout class="QGridLayout" name="gridLayout_12">
                  <property name="bottomMargin">
                   <number>0</number>
                  </property>
-                 <item row="0" column="1">
-                  <spacer name="horizontalSpacer_14">
-                   <property name="orientation">
-                    <enum>Qt::Horizontal</enum>
-                   </property>
-                   <property name="sizeHint" stdset="0">
-                    <size>
-                     <width>40</width>
-                     <height>20</height>
-                    </size>
-                   </property>
-                  </spacer>
-                 </item>
                  <item row="0" column="0">
-                  <widget class="QLabel" name="repackLabel">
+                  <widget class="QLabel" name="label_8">
                    <property name="text">
-                    <string>Repack</string>
+                    <string>Reset this device</string>
                    </property>
                   </widget>
                  </item>
                  <item row="0" column="2">
-                  <widget class="QPushButton" name="repackBtn">
+                  <widget class="QPushButton" name="resetBtn">
                    <property name="font">
                     <font>
                      <weight>75</weight>
@@ -1078,53 +1152,36 @@
                     </font>
                    </property>
                    <property name="text">
-                    <string>Repack</string>
+                    <string>Reset</string>
                    </property>
                   </widget>
                  </item>
+                 <item row="0" column="1">
+                  <spacer name="horizontalSpacer_8">
+                   <property name="orientation">
+                    <enum>Qt::Horizontal</enum>
+                   </property>
+                   <property name="sizeHint" stdset="0">
+                    <size>
+                     <width>40</width>
+                     <height>20</height>
+                    </size>
+                   </property>
+                  </spacer>
+                 </item>
                 </layout>
                </item>
-               <item row="8" column="0">
-                <widget class="QCheckBox" name="enableUiScalingCheckBox">
-                 <property name="text">
-                  <string>Enable UI scaling</string>
-                 </property>
-                </widget>
-               </item>
-               <item row="7" column="0">
-                <widget class="Line" name="line_9">
-                 <property name="frameShadow">
-                  <enum>QFrame::Plain</enum>
-                 </property>
-                 <property name="orientation">
-                  <enum>Qt::Horizontal</enum>
-                 </property>
-                </widget>
-               </item>
-               <item row="20" column="0">
-                <widget class="Line" name="line_2">
-                 <property name="frameShadow">
-                  <enum>QFrame::Plain</enum>
-                 </property>
-                 <property name="orientation">
-                  <enum>Qt::Horizontal</enum>
-                 </property>
-                </widget>
-               </item>
-               <item row="25" column="0">
-                <widget class="QCheckBox" name="enableEncryptedStorageCheckBox">
+               <item row="16" column="0">
+                <widget class="QCheckBox" name="updateCheckingCheckbox">
                  <property name="text">
-                  <string>Enable</string>
+                  <string>Check for updates at launch</string>
                  </property>
                 </widget>
                </item>
-               <item row="22" column="0">
-                <layout class="QGridLayout" name="gridLayout_13">
-                 <property name="bottomMargin">
-                  <number>0</number>
-                 </property>
+               <item row="23" column="0">
+                <layout class="QGridLayout" name="gridLayout_20">
                  <item row="0" column="1">
-                  <spacer name="horizontalSpacer_9">
+                  <spacer name="horizontalSpacer_18">
                    <property name="orientation">
                     <enum>Qt::Horizontal</enum>
                    </property>
@@ -1136,48 +1193,18 @@
                    </property>
                   </spacer>
                  </item>
-                 <item row="0" column="2">
-                  <widget class="QPushButton" name="setPasscodeBtn">
-                   <property name="font">
-                    <font>
-                     <weight>75</weight>
-                     <bold>true</bold>
-                    </font>
-                   </property>
-                   <property name="text">
-                    <string>Set</string>
-                   </property>
-                  </widget>
-                 </item>
                  <item row="0" column="0">
-                  <widget class="QLabel" name="setPasscodeLabel">
+                  <widget class="QLabel" name="label_15">
                    <property name="text">
-                    <string>Set a passcode</string>
+                    <string>Lockscreen background</string>
                    </property>
                   </widget>
                  </item>
+                 <item row="0" column="2">
+                  <widget class="QComboBox" name="LockBackComboBox"/>
+                 </item>
                 </layout>
                </item>
-               <item row="27" column="0">
-                <spacer name="verticalSpacer_2">
-                 <property name="orientation">
-                  <enum>Qt::Vertical</enum>
-                 </property>
-                 <property name="sizeHint" stdset="0">
-                  <size>
-                   <width>20</width>
-                   <height>40</height>
-                  </size>
-                 </property>
-                </spacer>
-               </item>
-               <item row="16" column="0">
-                <widget class="QCheckBox" name="updateCheckingCheckbox">
-                 <property name="text">
-                  <string>Check for updates at launch</string>
-                 </property>
-                </widget>
-               </item>
               </layout>
              </item>
             </layout>
-- 
2.37.3

