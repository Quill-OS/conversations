==============================================================
Guild: Quill OS
Channel: Development / porting / Kobo Clara HD (N249)
==============================================================

[1/22/2022 11:52 PM] daboone72
For Porting the Clara HD

{Reactions}
👍 

[1/22/2022 11:52 PM] daboone72
Well this is cool can run with a 256GB SD

{Attachments}
/mnt/data/projects/git/conversations/media/ClaraWith256GB-40B27.jpg


[1/22/2022 11:53 PM] tux_linux
Yeah


[1/22/2022 11:54 PM] tux_linux
I think the imx507 ones can too


[1/22/2022 11:58 PM] daboone72
Keep finding good reviews of the Clara HD https://www.pcmag.com/reviews/kobo-clara-hd

{Attachments}
/mnt/data/projects/git/conversations/media/HighResGloAndClaraAnnotated-B3950.jpg

{Embed}
https://www.pcmag.com/reviews/kobo-clara-hd
Kobo Clara HD Review
The Kobo Clara HD is the best all-around e-reader for anyone who borrows books from public libraries.
/mnt/data/projects/git/conversations/media/01hZZX08hFKlyU6kbPE0uti-9.fit_lim.size_120-BBEE5.jpg


[1/22/2022 11:58 PM] tux_linux
Yeah it's a pretty good one


[1/22/2022 11:59 PM] daboone72
300dpi is the magic number for me and probably the last of the buy with some confidence that will get   a swappable SD card


[1/22/2022 11:59 PM] tux_linux
absolutely


[1/23/2022 12:01 AM] daboone72
I think it will be great to get a variety of eink style app ideas working on it. They will look gorgeous.


[1/23/2022 12:01 AM] tux_linux
yep


[1/23/2022 12:01 AM] tux_linux
InkBox on the Libra is quite a thing compared to 200-ish DPI readers


[1/23/2022 12:02 AM] daboone72
I found a guy selling a Touch B btw which can be like a reference machine and still super cheap.

{Reactions}
👍 

[1/23/2022 12:03 AM] daboone72
I'm thinking create a bash script that builds a Dev environment with hardwired version numbers for stability

{Reactions}
👍 

[1/23/2022 12:04 AM] daboone72
Got my Qt Go environment up btw today. Going to use Spacemacs for development


[1/23/2022 12:29 AM] tux_linux
Nice


[1/23/2022 12:52 AM] daboone72
Changed the channel name: Kobo Clara HD


[1/23/2022 2:21 PM] anovella
Hi is this working on clara hd?


[1/23/2022 2:21 PM] anovella
How would be the istall? Does clara have a sd card like a raspberry for the os?


[1/23/2022 2:22 PM] daboone72
Not yet this is the porting channel with that goal though


[1/23/2022 2:22 PM] anovella
Ohh, nice


[1/23/2022 2:23 PM] daboone72
It will be an image eventually. As Clara has removable SD card


[1/23/2022 2:23 PM] anovella
So install this and revert to original would be as easy as swap an sd card?


[1/23/2022 2:24 PM] daboone72
Yes


[1/23/2022 2:24 PM] daboone72
I haven't talked with Tux yet much on the Libras multiboot os switching  is possible


[1/23/2022 2:26 PM] anovella
Ok, thanks, if sd card swapping is possible I think I could help with beta testing


[1/23/2022 2:30 PM] tux_linux
It could be possible
It's not the best idea though, since I can't publicly distribute Nickel images online


[1/23/2022 2:32 PM] daboone72
We could probably bash script it and bundle a static bash and DD for Windows users.


[1/23/2022 2:33 PM] anovella
Why the issue with nickle images?


[1/23/2022 2:35 PM] daboone72
Copyright


[1/23/2022 2:35 PM] tux_linux
Yeah


[1/23/2022 2:35 PM] daboone72
I was just going to say for the DGT centaur project there's a powershell script you pop in the SD card it extracts the original software and then proceeds to build a new image based on it


[1/23/2022 2:35 PM] tux_linux
Nice


[1/23/2022 2:35 PM] daboone72
It's all GNU so we could borrow the ideas 🙂

{Reactions}
👍 

[1/23/2022 2:36 PM] daboone72
Till you get around to rewriting to fully support epub and epub v3 🙂


[1/23/2022 2:38 PM] daboone72
What library do you use again?


[1/23/2022 2:38 PM] daboone72
Just checking out https://github.com/readium/readium-sdk

{Embed}
https://github.com/readium/readium-sdk
GitHub - readium/readium-sdk: A C++ ePub renderer SDK
A C++ ePub renderer SDK. Contribute to readium/readium-sdk development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/readium-sdk-58791


[1/23/2022 2:39 PM] tux_linux
Wrapper around mutool convert


[1/23/2022 2:41 PM] daboone72
Ahh yes


[1/23/2022 2:41 PM] daboone72
Well I'd better get lunch

{Reactions}
👍 

[1/23/2022 9:23 PM] andi15701
or maybe work without nickel...


[1/23/2022 9:23 PM] tux_linux
Hello, what do you mean exactly?


[1/23/2022 9:25 PM] andi15701
well, I am not that into inkbox yet, so nickel is just used to display something?


[1/23/2022 9:25 PM] andi15701
never hacked in the original system too much


[1/23/2022 9:25 PM] tux_linux
Nickel is the Kobo firmware, specifically, the binary which manages the default UI on a Kobo


[1/23/2022 9:26 PM] andi15701
ok, you call the whole firmware nickel and not just that binary


[1/23/2022 9:26 PM] andi15701
so inkbox depends on that UI being there?


[1/23/2022 9:27 PM] tux_linux
...yeah
It's not the best to do, but when we refer to Nickel we often refer to the Kobo firmware


[1/23/2022 9:27 PM] tux_linux
No, InkBox is completely different from Nickel


[1/23/2022 9:27 PM] tux_linux
No parts of the original firmware are there when InkBox runs on a Kobo


[1/23/2022 9:27 PM] tux_linux
It's a complete, self-managed OS


[1/23/2022 9:28 PM] andi15701
oh, I see

{Reactions}
👍 

[1/23/2022 9:28 PM] tux_linux
For example, here's the rootfs https://github.com/Kobo-InkBox/rootfs


[1/23/2022 9:30 PM] andi15701
so I could just put that rootfs on an empty partition and then manage to boot into that partition, inkbox should work?


[1/23/2022 9:30 PM] tux_linux
nope


[1/23/2022 9:30 PM] tux_linux
It's complicated


[1/23/2022 9:31 PM] tux_linux
See scripts here https://github.com/Kobo-InkBox/kernel/tree/master/initrd/common
To see how InkBox is started


[1/23/2022 9:31 PM] tux_linux
I suggest you start with rcS-std


[1/23/2022 9:41 PM] andi15701
ok, a lot of hard coded partition numbers, and the kernel area is touched for updating, so at least that script has to be modified for that task


[1/23/2022 9:43 PM] andi15701
so I need the inkbox initramfs to be loaded besides the kernel. But that just simply can live in /boot of that partition


[1/23/2022 9:47 PM] tux_linux
The initramfs usually is embedded in the kernel to make things simpler


[1/23/2022 9:56 PM] andi15701
probably a matter of taste if that is simpler or not


[1/23/2022 9:56 PM] andi15701
BTW UR=3 for the Clara HD


[1/23/2022 9:57 PM] andi15701
in that script


[1/23/2022 9:57 PM] tux_linux
Well, it was simpler for me


[1/23/2022 9:57 PM] tux_linux
Ok got it, so the screen is upright when `rotate` is set to 3?


[1/23/2022 9:57 PM] andi15701
yes


[1/23/2022 9:58 PM] tux_linux
ok, what's the Clara HD model number?


[1/23/2022 9:58 PM] tux_linux
like n705 for the Mini


[1/23/2022 9:58 PM] andi15701
i am looking it up


[1/23/2022 9:59 PM] tux_linux
should be somewhere on your serial number


[1/23/2022 10:02 PM] andi15701
n249


[1/23/2022 10:02 PM] tux_linux
ok thanks


[1/23/2022 10:04 PM] andi15701
anything else I can help with?


[1/23/2022 10:05 PM] tux_linux
Well I'm not really feeling well right now (COVID), but come back tomorrow maybe and we could start testing


[1/23/2022 10:06 PM] andi15701
I hope you could get well soon

{Reactions}
👍 

[1/23/2022 11:08 PM] andi15701
something else about rotating: Touchscreen input needs to be rotated, too, if that UR=3 is applied.


[1/23/2022 11:09 PM] andi15701
$ cat /etc/X11/xorg.conf.d/touch.conf 
Section "InputClass"
    Identifier "cyttsp5_mt"
    MatchProduct "cyttsp5_mt"
    Driver "evdev"
    Option "CalibrationMatrix" "0 -1 1 1 0 0 0 0 1"
        Option  "SwapAxes"      "1"
    Option "InvertX" "1"
EndSection
Section "InputClass"
    Identifier "cyttsp5"
    MatchProduct "cyttsp5"
    Driver "evdev"
    Option "CalibrationMatrix" "0 -1 1 1 0 0 0 0 1"
        Option  "SwapAxes"      "1"
    Option "InvertX" "1"
EndSection


[1/23/2022 11:09 PM] andi15701
I have that


[1/23/2022 11:10 PM] tux_linux
Where on Earth did you find that file?


[1/23/2022 11:11 PM] andi15701
I myself created that on my debian installation to make things work


[1/23/2022 11:11 PM] tux_linux
Oh


[1/23/2022 11:11 PM] andi15701
I am running debian+matchbox+fbpanel


[1/23/2022 11:11 PM] tux_linux
Well input usually is handled by Qt


[1/23/2022 11:12 PM] andi15701
on top of X


[1/23/2022 11:12 PM] tux_linux
There's Qt VNC viewer that connects to x11vnc and sends touch events to X


[1/23/2022 11:12 PM] andi15701
well, yes, but I guess things have to be set up there correctly, too


[1/23/2022 11:12 PM] tux_linux
Because touch input works well in Qt


[1/23/2022 11:12 PM] tux_linux
It's the koboplatformplugin


[1/23/2022 11:13 PM] tux_linux
See etc/init.d/xorg.sh script in rootfs


[1/23/2022 11:24 PM] andi15701
oh, I remember, there were some troubles with the vender 4.1.15 and using Xorg directly. But that got better with newer kernels. All I wanted to say is that touchscreen input has to be rotated the same way as the display. It is different on the Tolino Shine 2 HD, there only the framebuffer needs to be rotated, but not the input.


[1/23/2022 11:26 PM] andi15701
and that probably has to be configured somewhere.


[1/23/2022 11:28 PM] andi15701
I am not going to judge about anything in your userspace that quickly without having studied it intensively.


[1/23/2022 11:28 PM] andi15701
so, now it is time to sleep here

{Reactions}
👍 

[1/24/2022 10:54 PM] andi15701
is there any "what to do to add a new device" document?


[1/24/2022 10:55 PM] tux_linux
Unfortunately not for the moment, there are so many steps that it's hard to document


[1/24/2022 10:55 PM] tux_linux
See the Libra H2O porting thread


[1/24/2022 11:49 PM] andi15701
so that process has probably to be rationalized


[1/24/2022 11:50 PM] tux_linux
yeah
But the problem is that most of what you need to get it working is the private key for the device


[1/24/2022 11:51 PM] andi15701
btw: I found hardcoded paths to the battery status/capacity: I would think that /sys/class/power_supply/mc13892_bat/ is at least stable amoung kobo vendor kernels


[1/24/2022 11:51 PM] tux_linux
Maybe there could be an agreement between the tester and me that we don't publicly release that private key and they can use it for signing packages (I'm guessing you know about the whole security policy of InkBox?)


[1/24/2022 11:51 PM] tux_linux
Yeah, it is


[1/24/2022 11:51 PM] tux_linux
Hasn't changed between Kobo Touch and Kobo Libra


[1/24/2022 11:55 PM] andi15701
I have seen the comments here about security: https://github.com/Kobo-InkBox/inkbox

{Embed}
https://github.com/Kobo-InkBox/inkbox
GitHub - Kobo-InkBox/inkbox: (Mirror) An open-source, Qt-based eBoo...
(Mirror) An open-source, Qt-based eBook reader for Kobos. - GitHub - Kobo-InkBox/inkbox: (Mirror) An open-source, Qt-based eBook reader for Kobos.
/mnt/data/projects/git/conversations/media/inkbox-B68CE


[1/24/2022 11:55 PM] tux_linux
Oh, you're studying the C++ code?


[1/24/2022 11:55 PM] andi15701
yes


[1/24/2022 11:56 PM] tux_linux
Ok; most of the security policy is more in the initrd or rootfs


[1/24/2022 11:56 PM] andi15701
and also the scripts


[1/24/2022 11:56 PM] andi15701
there


[1/24/2022 11:56 PM] tux_linux
You may also find that my code is crappy sometimes; I pretty much learnt C++ as I was doing it ;p


[1/25/2022 12:00 AM] andi15701
well, I am doing a lot about security at my job. Preventing running unsigned software on devices, but that more on microcontroller level, maybe I have some ideas

{Reactions}
👍 

[1/25/2022 12:01 AM] andi15701
but again, it is really too late here...

{Reactions}
👍 

[1/25/2022 12:01 AM] tux_linux
You can look here for a very good example of how the security policy works: https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/update.sh


[1/25/2022 12:41 PM] andi15701
if you want to do the full fortification possible, you should read about "High Assurance Boot", but maybe Kobo then starts reading about that too intensively, too.


[1/25/2022 12:45 PM] andi15701
well, as long as the process to create packages is well defined and automatized, the developer/tester can use his/her keys, and you can then create and publish the packages with your keys,

{Reactions}
👍 

[1/25/2022 3:16 PM] tux_linux
I looked into HAB before, but it was kind of too complicated for me at the time.
Might be interesting to look into now.


[1/25/2022 3:18 PM] tux_linux
I read somewhere from a Kobo employee that they were using the KoboRoot.tgz method because they liked to see what users could do hacking their devices


[1/25/2022 6:53 PM] andi15701
yes, HAB might fortify things more than you wish,


[1/25/2022 7:35 PM] tux_linux
Changed the channel name: Kobo Clara HD (N249)


[2/5/2022 7:28 PM] phodina7501
Hi guys,
is there something I can help with? I do have Kobo Clara HD as specified in this thread https://github.com/Kobo-InkBox/inkbox/issues/4

{Embed}
https://github.com/Kobo-InkBox/inkbox/issues/4
Kobo Clara HD · Issue #4 · Kobo-InkBox/inkbox
Hi, does Inkbox run on Kobo Clara HD EInk reader?
/mnt/data/projects/git/conversations/media/4-FCC26


[2/5/2022 7:32 PM] tux_linux
Yep!
Currently busy but later today I'll provide you some test instructions


[2/5/2022 7:33 PM] phodina7501
Great!


[2/6/2022 4:33 AM] tux_linux
Ok, so first you should make a clean partition layout on your card


[2/6/2022 4:35 AM] tux_linux
Make a backup of its current state (e.g. `sudo dd if=/dev/mmcblk0 status=progress | xz > clarahd-backup.img.xz`, then apply the following partition layout:
```
Disk /dev/nbd0: 4 GiB, 4294967296 bytes, 8388608 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x25c915c4

Device      Boot   Start     End Sectors  Size Id Type
/dev/nbd0p1        40959   79871   38913   19M 83 Linux
/dev/nbd0p2       104448 1128447 1024000  500M 83 Linux
/dev/nbd0p3      1128448 1390591  262144  128M 83 Linux
/dev/nbd0p4      1390592 8388607 6998016  3.3G 83 Linux
```


[2/6/2022 4:35 AM] tux_linux
Here, `nbd0` should be replaced with your SD card's device node


[2/6/2022 4:36 AM] tux_linux
You can do this with `fdisk` on Linux


[2/6/2022 4:36 AM] tux_linux
Follow the "Start" and "End" columns closely (they're the sectors at which the partitions start & end)


[2/6/2022 4:36 AM] tux_linux
Feel free to ask if you need any help!


[2/6/2022 5:25 AM] tux_linux
Actually, before doing that, what's `fdisk -l` on your SD card?


[2/6/2022 1:48 PM] phodina7501
Hi, the partition layout of the unaltered firmware is following:
```
Disk kobo_clara_hd.image: 7.4 GiB, 7948206080 bytes, 15523840 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x3b3b90d1

Device               Boot   Start      End  Sectors  Size Id Type
kobo_clara_hd.image1        49152   573440   524289  256M 83 Linux
kobo_clara_hd.image2       573441  1097729   524289  256M 83 Linux
kobo_clara_hd.image3      1097730 15456254 14358525  6.8G  b W95 F

```


[2/6/2022 1:50 PM] phodina7501
I'll make the layout later today. Could you please label the partitions to understand their purpose?


[2/6/2022 3:51 PM] tux_linux
Yeah, I usually label them on factory images releases.
P1 is "boot", contains flags
P2 is "recoveryfs", contains recovery filesystem archive
P3 is "rootfs", contains root filesystem archive
P4 is "user", contains all user data

You can use `e2label` to label them


[2/6/2022 3:52 PM] tux_linux
Ok thanks, replace the first partition start sector with `49152` in the layout I sent.
The rest still holds up


[2/6/2022 10:03 PM] phodina7501
Ok, I've created the partition layout as you suggested
```
Disk eink.img: 5 GiB, 5368709120 bytes, 10485760 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x5547c55f

Device     Boot   Start     End Sectors  Size Id Type
eink.img1         49152   79871   30720   15M 83 Linux
eink.img2        104448 1128447 1024000  500M 83 Linux
eink.img3       1128448 1390591  262144  128M 83 Linux
eink.img4       1390592 8388607 6998016  3.3G 83 Linux
```


[2/6/2022 10:03 PM] tux_linux
Alright!


[2/6/2022 10:04 PM] tux_linux
Ok, since the test kernel I provided earlier worked, I'll add the sources to the official InkBox kernel repo and we can start working after that


[2/6/2022 10:05 PM] tux_linux
But why 5G?


[2/6/2022 10:08 PM] phodina7501
It's just a disc image currently sitting in my dir. I've got SD card of size 32GB. I've mounted the partitions over losetup.

{Reactions}
👍 

[2/6/2022 10:42 PM] phodina7501
Btw can you also provide config.gz file for the kernel?


[2/6/2022 10:43 PM] tux_linux
For what kernel?


[2/6/2022 10:43 PM] phodina7501
The test kernel to check what config options are enabled.


[2/6/2022 10:43 PM] tux_linux
Same as the stock one


[2/6/2022 10:43 PM] phodina7501
Ok


[2/6/2022 10:44 PM] tux_linux
It was just to see if it wouldn't complain about the toolchain used, wouldn't panic for no reason, etc.


[2/6/2022 10:44 PM] phodina7501
Yeah I understand, to verify we can make it ourselves


[2/12/2022 3:40 PM] tux_linux
@phodina Do you have a picture of the PCB?


[2/12/2022 3:41 PM] tux_linux
I think I'll put in kernel 5.16 from @andi instead of the vendor one. I'm curious to see if the waveform for the eInk display will work on all devices or if there are variations of the mainboard.


[2/12/2022 6:58 PM] daboone72
Well one for referne anyway

{Attachments}
/mnt/data/projects/git/conversations/media/HighResGloAndClaraAnnotated-FE56E.jpg


[2/12/2022 6:58 PM] tux_linux
Oh thanks!


[2/12/2022 6:59 PM] daboone72
I think it's enough to read chip numbers off it's high res


[2/12/2022 6:59 PM] daboone72
And handily has the Glo for comparison


[2/12/2022 6:59 PM] tux_linux
Hmm
I'll see what @phodina sends and compare with what you shared


[2/12/2022 7:00 PM] daboone72
Sure I did kind of wonder if you were looking for uncommon differences


[2/12/2022 7:31 PM] andi15701
as said, there are aparrently two waveforms in the world for kobo clara


[2/12/2022 7:31 PM] andi15701
one equals to the one on my libra


[2/12/2022 7:40 PM] andi15701
I think one of them came in in an update

{Reactions}
👍 

[2/14/2022 8:34 PM] anovella
Hi, I'm curious about how a porting is done


[2/14/2022 8:35 PM] anovella
Do you fix things in main OS to work with any kobo and then compile it with especific flags for a model?


[2/14/2022 8:36 PM] anovella
Will be a n249 xz image in repo?


[2/14/2022 9:44 PM] andi15701
just as a note: the lower right port is afaik connected to the msp430 debug/flash port with some missing 0ohm resistors


[2/14/2022 9:46 PM] andi15701
I think the rule is that these serial-port-like things with GND in the middle are not candidates for serial ports of the i.mx


[2/15/2022 3:51 PM] andi15701
https://fccid.io/NOIKBN249/Internal-Photos/Internal-Photos-3802584.pdf


[2/17/2022 10:05 AM] phodina7501
Hi @tux-linux  @Daboone72 here's the photo of Kobo Clara HD

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220217_094236-A66BD.jpg


[2/17/2022 12:15 PM] tux_linux
Thanks! I'll analyze it and get back to you


[2/17/2022 5:48 PM] andi15701
hmm, markings look the same...


[2/17/2022 5:48 PM] andi15701
what are you searching for?


[2/17/2022 5:49 PM] andi15701
37NB-E60K00+4A4


[2/17/2022 5:49 PM] andi15701
as on the boards I have seen


[2/17/2022 5:49 PM] andi15701
as marked in kernel


[2/17/2022 7:55 PM] tux_linux
See if there are hardware differences for waveform


[2/17/2022 8:25 PM] andi15701
I would not expect anything if all the boards are marked the same


[2/17/2022 8:26 PM] andi15701
And if Clara and Libra share the same waveform, why do you expect there are differences?


[2/17/2022 8:27 PM] andi15701
what about just collecting waveform hashes?


[2/17/2022 9:20 PM] andi15701
the display of Clara and Libra is quite different


[2/17/2022 9:20 PM] andi15701
but still same waveform


[2/17/2022 9:25 PM] andi15701
if there are other hw differences, there would also be different devicetrees


[2/17/2022 10:42 PM] tux_linux
That's why I wanted to see the boards
Now we know


[2/18/2022 7:16 AM] tux_linux
@phodina , please send me your SD image's first unpartitioned space:
```
dd if=/dev/mmcblk0 bs=512 count=49152 of=boot-mmc.bin
```


[2/18/2022 7:16 AM] tux_linux
We can start to build an InkBox image. I'll add the kernel sources to the repo soon


[2/18/2022 7:19 AM] tux_linux
I think I'll go with the waveform he provides in the unpartitioned space, and put it in `/lib/epdc.fw` then boot your kernel. If it is unique to each device, well there must be some similar things too. I wouldn't expect one to not work at all...
Also, I distribute my InkBox images which already contain a full SD image with waveform among other things, and it works for people, so I guess, as you said, that it should work there too.


[2/18/2022 8:53 AM] andi15701
why do you think it is unique?


[2/18/2022 8:54 AM] andi15701
d5038637176d76ae6842057cc187b2f5595b3625d3b011e016064d35d6f4c1e0


[2/18/2022 8:55 AM] andi15701
daad0e579ab252e69633af72b2a6c57066a7501b7a32eebb43c215588d7c8e9f


[2/18/2022 8:55 AM] andi15701
that are the two sha256sums I know about


[2/18/2022 8:55 AM] andi15701
of the waveforms


[2/18/2022 8:56 AM] andi15701
I think the only reason for that rumor about unique waveforms is that nobody has found a place to download them

{Reactions}
👍 

[2/18/2022 8:58 AM] andi15701
I guess you know: https://misc.andi.de1.cc/kobo/extract-waveform.pl


[2/18/2022 1:09 PM] tux_linux
Ok, alright! I'll go with an unique waveform then.


[2/18/2022 1:17 PM] andi15701
As said I do not believe in unique waveforms there.  I have three Kobo Clara mainboards, and one Kobo Libra, and I have only seen 2 different waveforms in total

{Reactions}
👍 

[2/18/2022 1:18 PM] andi15701
and Kobo Libra has the same one of the Kobo Clara backups


[2/18/2022 1:36 PM] andi15701
and btw: waveform for the Shine 3 (=Kobo Clara with i.IMX6SL instead of 6SLL) is different, and it seems not to be interchangeable at all. Perhaps some magic settings in the EPDC

{Reactions}
👍 

[2/18/2022 1:37 PM] tux_linux
The SoC change might be related too


[2/18/2022 1:37 PM] andi15701
yes, the EPDC has a different version 2.1 vs 3.0

{Reactions}
👍 

[2/18/2022 1:48 PM] tux_linux
Yes to all questions


[2/18/2022 5:46 PM] phodina7501
Here's the link to the `boot-mmc.bin` as it was too big for discord
https://drive.protonmail.com/urls/VH6PCJ8EZM#7K0Tg9lTUbmi

{Embed}
https://drive.protonmail.com/urls/VH6PCJ8EZM
Proton Drive
Proton Drive allows you to securely store and share your sensitive documents and access them anywhere.
/mnt/data/projects/git/conversations/media/social_logo-1FA67.png


[2/18/2022 5:48 PM] andi15701
6bdb88a50430cf17fe807f6611ee7cf92b4ede603a3c65fb78532d822358ea1d


[2/18/2022 5:48 PM] andi15701
hmm, interesting


[2/18/2022 5:48 PM] andi15701
maybe I try to update mine


[2/18/2022 5:50 PM] tux_linux
Thanks!
Little tip: you can do `xz boot-mmc.bin` to compress it a bit 😉


[2/18/2022 5:50 PM] tux_linux
Do you have the password?


[2/18/2022 5:51 PM] phodina7501
@tux-linux true, though ~24M isn't that bad 😄


[2/18/2022 5:52 PM] phodina7501
Password for what? The link is password free


[2/18/2022 5:52 PM] tux_linux
Sure not, but it would have allowed you to upload it to Discord directly


[2/18/2022 5:52 PM] tux_linux
Oh, Discord link integration woes


[2/18/2022 5:52 PM] tux_linux
I got it


[2/18/2022 5:53 PM] phodina7501
Haha it's 9.2M and Discord allows only 8M


[2/18/2022 5:53 PM] tux_linux
Ah...
Well on my Glo HD I got it compressed to 4M IIRC


[2/18/2022 5:55 PM] phodina7501
Maybe that was different layout and most of it was empty ... tried higher compression preset but got to 9M so I'll keep the link to ProtonDrive


[2/18/2022 6:01 PM] tux_linux
It's different, right? Strange


[2/18/2022 6:02 PM] tux_linux
Did you try to put it on your Clara to see if there was a difference?


[2/18/2022 6:04 PM] andi15701
I will check


[2/18/2022 6:04 PM] andi15701
just updating


[2/18/2022 6:04 PM] andi15701
the kobo firmware

{Reactions}
👍 (2) 

[2/18/2022 6:33 PM] andi15701
a[   16.333863] imx_epdc_v2_fb 20f4000.epdc:      Extra Waveform Data: 320_R217_AJ0801_ED060KH6C1_TC


[2/18/2022 6:33 PM] andi15701
the same


[2/18/2022 6:33 PM] tux_linux
Strange that the checksum differs


[2/18/2022 6:33 PM] andi15701
I tried the waveform


[2/18/2022 6:33 PM] andi15701
it does not feel different


[2/18/2022 6:34 PM] tux_linux
Well very nice then


[2/27/2022 5:37 AM] tux_linux
No way

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-46004.png


[2/27/2022 7:53 PM] anovella
What is this plattform? Are you trying to buy an old clara for testing?


[2/27/2022 7:59 PM] tux_linux
FB marketplace
Well, I wanted to buy one, but didn't receive a reply so I guess no luck on that side


[4/20/2022 3:23 PM] magic_rb
I got one for 140 euros, shame


[4/27/2022 3:17 AM] tux_linux
@alex(O_o) welcome to the Clara HD porting thread

{Reactions}
👍 

[4/27/2022 3:19 AM] tux_linux
Are you able to open your Kobo?


[4/27/2022 3:20 AM] cieldautomne
yep already done a couple times


[4/27/2022 3:20 AM] tux_linux
ok, so now we can connect it to serial
do you have dupont connectors?


[4/27/2022 3:20 AM] cieldautomne
i was using the original os with nickelmenu and koreader before

{Reactions}
👍 

[4/27/2022 3:20 AM] tux_linux
like that

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-391B6.png


[4/27/2022 3:22 AM] cieldautomne
nop i dont have this kind of connector on hand


[4/27/2022 3:23 AM] tux_linux
hmm
how does your rpi look like?


[4/27/2022 3:23 AM] tux_linux
does it have soldered headers?


[4/27/2022 3:23 AM] cieldautomne
i can buy some


[4/27/2022 3:23 AM] cieldautomne
it's a raspi 4b


[4/27/2022 3:24 AM] tux_linux
do you have an old computer lying around somewhere?


[4/27/2022 3:24 AM] cieldautomne
not now though, it is 03:24am here


[4/27/2022 3:24 AM] tux_linux
sorry
you can sleep if you want 😉

{Reactions}
👍 

[4/27/2022 3:25 AM] tux_linux
normally you can find them in power button connectors or something like that


[4/27/2022 3:25 AM] tux_linux
cut the wire and you get what you need


[4/27/2022 3:45 AM] cieldautomne
there are some wires for the fan of the raspi poe+ hat that i'm not using

{Attachments}
/mnt/data/projects/git/conversations/media/9109d317-1b70-4f31-b703-a836ed78e9be-D1297.jpg


[4/27/2022 3:45 AM] tux_linux
we need three


[4/27/2022 3:46 AM] cieldautomne
but the connector is not the right one


[4/27/2022 3:46 AM] tux_linux
are you able to connect wires in the holes at the left of the picture?


[4/27/2022 3:46 AM] tux_linux
are there contacts?


[4/27/2022 3:47 AM] cieldautomne
yep


[4/27/2022 3:47 AM] tux_linux
ok, so we could connect wires there


[4/27/2022 3:47 AM] tux_linux
is there enough depth?


[4/27/2022 3:49 AM] cieldautomne
maybe I could cut the wires and tie them around the raspi pins


[4/27/2022 3:50 AM] tux_linux
do you have a spare ethernet cable?


[4/27/2022 3:50 AM] tux_linux
copper wires in those are very good


[4/27/2022 3:50 AM] tux_linux
also, you get 8 wires, not one


[4/27/2022 3:51 AM] cieldautomne
i have one but i'm using it ^^


[4/27/2022 3:51 AM] cieldautomne
or i could  try to find and buy some wires with the right connector tomorrow

{Reactions}
👍 

[4/27/2022 3:52 AM] tux_linux
as you want


[4/27/2022 3:53 AM] tux_linux
if you want to have an idea of how porting is done, have a look at the Libra H2O thread
the Clara HD process will be a bit different since it's not using an eMMC (soldered microSD card), so no Nickel dual-boot, but the majority of it is pretty similar

{Reactions}
👍 

[4/27/2022 3:53 AM] cieldautomne
i'm not sure it is easy to find outside of e-shop, but i'll try


[4/27/2022 3:54 AM] tux_linux
buy an ethernet cable


[4/27/2022 3:54 AM] tux_linux
probably much easier to find ;p

{Reactions}
👍 

[4/27/2022 3:54 AM] tux_linux
even the smallest one can do


[4/27/2022 11:14 AM] artus25200
Hello, I have a clara hd too so maybe I can help


[4/27/2022 1:29 PM] tux_linux
As said in #chat :
1. do you know linux well?
2. do you have a LOT of time to spare?
3. do you like nightmares?


[4/27/2022 2:05 PM] artus25200
1 I have a mac so I know unix-like systems well (I have a linux vm if needed)
2yes
3yes


[4/27/2022 2:07 PM] tux_linux
Awesome
Can you connect your Kobo via serial?


[4/27/2022 2:08 PM] tux_linux
(busy until tonight (EDT), but you can prepare it already if you want)


[4/27/2022 2:11 PM] artus25200
I dont really know how serial work so I think not


[4/27/2022 2:16 PM] tux_linux
Do you have an rpi?


[4/27/2022 2:16 PM] artus25200
no


[4/27/2022 2:16 PM] artus25200
sadly


[4/27/2022 3:45 PM] szybet
USB to serial adapters are available for less then 3$


[4/27/2022 3:46 PM] szybet
Why not nickel dualboot on SD cards?


[4/27/2022 3:47 PM] szybet
Finally someone from europe :p

{Reactions}
👋 

[4/27/2022 5:19 PM] tux_linux
Because InkBox is intended to replace Nickel


[4/27/2022 5:19 PM] tux_linux
Also, I can't include proprietary software in my images


[4/27/2022 5:19 PM] szybet
i would want a bootloader that if something fails i dont need to open the device


[4/27/2022 5:20 PM] szybet
:(


[4/27/2022 6:19 PM] artus25200
I’m from europe too!


[4/27/2022 6:33 PM] tux_linux
Now there is usb debug mode


[4/27/2022 6:34 PM] tux_linux
If there is an error


[4/27/2022 6:34 PM] szybet
kernel and u-boot writing


[4/27/2022 6:35 PM] tux_linux
.


[4/27/2022 6:35 PM] szybet
and for kernel, if i want to write it many times ( i want to fix charger waking up the device in the future ) a bootloader would be cool for it


[4/27/2022 6:35 PM] szybet
sure, a bootloader only for inkbox


[4/27/2022 6:36 PM] tux_linux
You understand how much work that is right?


[4/27/2022 6:37 PM] szybet
you already did most of it? or don't


[4/27/2022 6:37 PM] tux_linux
That's a pseudo bootloader


[4/27/2022 6:38 PM] szybet
in the name is still a bootloader


[4/27/2022 10:39 PM] tux_linux
Well, maybe, but writing U-Boot would still need to connect serial if there was a failure


[4/27/2022 10:40 PM] szybet
you write it once. and it stays there


[4/27/2022 10:41 PM] tux_linux
kexec doesn't work on older devices
So, difficult to make


[4/27/2022 10:52 PM] szybet
oh, thats sad


[4/27/2022 10:52 PM] szybet
CPU needs to support that?


[4/27/2022 10:52 PM] szybet
or just kernel version


[4/27/2022 11:10 PM] cieldautomne
i have an ethernet cable (impossible to find dupont connector out there...)


[4/27/2022 11:13 PM] tux_linux
I just don't know


[4/27/2022 11:13 PM] tux_linux
Do you have a wire stripper?


[4/27/2022 11:16 PM] cieldautomne
a pair of nail clippers will do ^^


[4/27/2022 11:17 PM] tux_linux
Ok


[4/27/2022 11:18 PM] tux_linux
So cut the ends


[4/27/2022 11:18 PM] tux_linux
And strip about 1.5cm at the two ends


[4/27/2022 11:32 PM] cieldautomne
I left some space

{Attachments}
/mnt/data/projects/git/conversations/media/9b87c023-ea53-4b75-9544-dbb504b86111-FF03B.jpg


[4/27/2022 11:33 PM] tux_linux
very good


[4/27/2022 11:33 PM] tux_linux
now find tx, rx and gnd ports on your rpi and plug that in


[4/27/2022 11:33 PM] cieldautomne
i connect them to TX, RX and the symbol with 3 horizontal bars


[4/27/2022 11:33 PM] tux_linux
yes


[4/27/2022 11:34 PM] tux_linux
so pin 6, 8 and 10


[4/27/2022 11:35 PM] tux_linux
then connect them there (left picture)
Tx -> Rx
Rx -> Tx
GND -> GND


[4/27/2022 11:45 PM] cieldautomne
i should stop my raspi before


[4/27/2022 11:46 PM] tux_linux
Yes, also enable serial console with raspi-config


[4/27/2022 11:46 PM] tux_linux
But don't enable the login shell


[4/27/2022 11:47 PM] cieldautomne
I'm only thinking about it now, but I have a CH314 programmer


[4/27/2022 11:48 PM] tux_linux
The raspi is fine


[4/27/2022 11:48 PM] cieldautomne
can it do the same as a raspi ?


[4/27/2022 11:50 PM] tux_linux
If you know how to make it work, yes


[4/27/2022 11:50 PM] cieldautomne
not really ^^'


[4/28/2022 12:19 AM] cieldautomne
done


[4/28/2022 12:20 AM] cieldautomne
it could be cleaner with the right connectors but i think it is ok


[4/28/2022 12:21 AM] cieldautomne
I used a bit of tape to isolate each of the wires from each other


[4/28/2022 2:51 AM] tux_linux
Ok, do you get output?


[4/28/2022 2:55 AM] cieldautomne
where ?


[4/28/2022 2:56 AM] cieldautomne
i need to connect the battery first, then start, but where do i read ?


[4/28/2022 2:56 AM] tux_linux
you have to access a serial console


[4/28/2022 2:57 AM] tux_linux
i don't know how/if you can do that with your ch314


[4/28/2022 2:57 AM] cieldautomne
im remotly connected to my raspi via ssh


[4/28/2022 2:57 AM] tux_linux
oh ok


[4/28/2022 2:57 AM] tux_linux
did you enable serial console in raspi-config?


[4/28/2022 2:57 AM] cieldautomne
yep


[4/28/2022 2:57 AM] tux_linux
ok, install microcom


[4/28/2022 2:58 AM] cieldautomne
done


[4/28/2022 2:58 AM] tux_linux
```
sudo microcom
```


[4/28/2022 2:58 AM] tux_linux
then power on your Kobo


[4/28/2022 3:01 AM] cieldautomne
i've got an output


[4/28/2022 3:01 AM] tux_linux
nice


[4/28/2022 3:01 AM] tux_linux
log?


[4/28/2022 3:03 AM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/message-0EBF1.txt


[4/28/2022 3:03 AM] tux_linux
awesome


[4/28/2022 3:04 AM] cieldautomne
it's a fresh install, the kobo is not connected to an account nor the connection has been bypassed


[4/28/2022 3:04 AM] tux_linux
ok


[4/28/2022 3:05 AM] cieldautomne
(I'm not always sure of my English, feel free to correct me ^^')


[4/28/2022 3:05 AM] tux_linux
no problem
i'm adding the clara sources to the kernel repo now


[4/28/2022 3:06 AM] cieldautomne
i think it is boot-looping


[4/28/2022 3:06 AM] tux_linux
oh?


[4/28/2022 3:07 AM] tux_linux
well, the log doesn't look that good after all


[4/28/2022 3:07 AM] tux_linux
but inkbox shouldn't do that


[4/28/2022 3:08 AM] tux_linux
please reboot and mash keys on your keyboard until you're at the U-Boot prompt
then
```
ums 0 mmc 0
```
connect your Kobo via USB to your PC
it should show up as a block device


[4/28/2022 3:14 AM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/message-838BB.txt


[4/28/2022 3:14 AM] cieldautomne
okay it seems better know


[4/28/2022 3:15 AM] tux_linux
typical boot log, good


[4/28/2022 3:15 AM] tux_linux
now do that


[4/28/2022 3:16 AM] cieldautomne
i've reconnected every plugs


[4/28/2022 3:17 AM] cieldautomne
any key ?


[4/28/2022 3:18 AM] tux_linux
yes


[4/28/2022 3:18 AM] tux_linux
a, b, c, g, etc.


[4/28/2022 3:18 AM] tux_linux
maybe not shift
try letters


[4/28/2022 3:22 AM] cieldautomne
```
U-Boot 2016.03-00038-g4a92f9d (Jun 04 2018 - 14:20:13 +0800)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 34C
Reset cause: POR
Board: MX6SLL LPDDR2 NTX
I2C:   ready
DRAM:  512 MiB
__get_sd_number(),cfg23=1,cfg24=0
force_idle_bus: sda=1 scl=0 sda.gp=0x4d scl.gp=0x4c
force_idle_bus: sda=0 scl=0 sda.gp=0x4f scl.gp=0x4e
force_idle_bus: sda=1 scl=0 sda.gp=0x56 scl.gp=0x55
MMC:   board_mmc_init() : isd=1
board_mmc_init() : wifi=2
FSL_SDHC: 0, FSL_SDHC: 1
In:    serial
Out:   serial
Err:   serial
ntx_hw_early_init() 0
ram p=80000000,size=536870912
switch to partitions #0, OK
mmc0 is current device
mmc read 0x9ffffe00 0x3ff 0x1

MMC read: dev # 0, block # 1023, count 1 ... 1 blocks read: OK
mmc read 0x9ffffe00 0x400 0x1

MMC read: dev # 0, block # 1024, count 1 ... 1 blocks read: OK
ntx_hw_late_init()
mmc read 0x9ffffc00 0x1 0x1

MMC read: dev # 0, block # 1, count 1 ... 1 blocks read: OK
NTXSN not avalible !
ntx_gpio_get_value(402) : error parameter ! null ptr !
ntx_config_fastboot_layout():10 binaries partition added
ntx_config_fastboot_layout():3 mbr partition added
check_and_clean: reg 0, flag_set 0
Fastboot: Normal
Net:   CPU Net Initialization Failed
No ethernet found.
Hit any key to stop autoboot:  0
```


[4/28/2022 3:22 AM] cieldautomne
```eBR-1A # ums 0 umc 0
** Bad device specification umc � **
eBR-1A #```


[4/28/2022 3:22 AM] tux_linux
`mmc`


[4/28/2022 3:22 AM] tux_linux
not `umc`


[4/28/2022 3:22 AM] cieldautomne
bad typing...


[4/28/2022 3:22 AM] cieldautomne
T.T


[4/28/2022 3:22 AM] cieldautomne
i should just copy/past xd


[4/28/2022 3:24 AM] cieldautomne
yep it is present


[4/28/2022 3:24 AM] cieldautomne
/dev/sdb


[4/28/2022 3:24 AM] tux_linux
Ok so now use this to extract the EPDC waveform
https://misc.andi.de1.cc/kobo/extract-waveform.pl


[4/28/2022 3:25 AM] tux_linux
(run it with `perl`)


[4/28/2022 3:25 AM] tux_linux
or just `./`, it will run perl automatically
`sudo ./extract-waveform.pl /dev/sdb epdc.fw`


[4/28/2022 3:26 AM] tux_linux
please share epdc.fw with its sha256sum here


[4/28/2022 3:27 AM] cieldautomne
c465f2ab31b1c2af6b5fbb01d487297e34dc52e61973c7d161e84ce589ae2157


[4/28/2022 3:28 AM] tux_linux
and the file?


[4/28/2022 3:28 AM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/epdc-76ECF.fw


[4/28/2022 3:28 AM] tux_linux
thanks


[4/28/2022 3:29 AM] tux_linux
@andi you might be interested, we've got another `epdc.fw` to look at here


[4/28/2022 3:30 AM] tux_linux
@alex(O_o) : for info, waveform is used in the EPDC to control refresh and other parts of the display

{Reactions}
👍 

[4/28/2022 3:30 AM] tux_linux
I will include it in the kernel (andi1 ported Linux 5.16 to the Clara)


[4/28/2022 4:06 AM] tux_linux
I'm setting up the core part currently, waiting from advice from andi1 about which U-Boot to use in InkBox OS (sent him an email, easier to find info back there afterwards)
Kernel compiles fine, good thing

{Reactions}
👍 

[5/1/2022 6:38 AM] tux_linux
I'll add U-Boot 2020.10 (from andi1's tree) to the repo, will give you instructions when done


[5/1/2022 3:56 PM] tux_linux (pinned)
@alex(O_o) , please clone InkBox kernel repo:
```
sudo mkdir -p /home/build/inkbox && sudo chown -R "${USER}:${USER}" /home/build/ && cd /home/build/inkbox
git clone https://github.com/Kobo-InkBox/kernel && sync
```
Then, compile U-Boot (bootloader) and kernel with the following commands:
```
cd /home/build/inkbox/kernel
env TOOLCHAINDIR=/home/build/inkbox/kernel/toolchain/arm-kobo-linux-gnueabihf TARGET=arm-kobo-linux-gnueabihf THREADS=8 scripts/build_u-boot.sh n249
env GITDIR=/home/build/inkbox/kernel TOOLCHAINDIR=/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/ THREADS=8 TARGET=armv7l-linux-musleabihf scripts/build_kernel.sh n249 root
```
After that, you should have the two following files available:
```
bootloader/out/u-boot_inkbox.n249.imx
kernel/out/n249/zImage-root
```
Tell me when you are done


[5/1/2022 8:21 PM] cieldautomne
THREADS=8 is for 8 cpu threads ?


[5/1/2022 8:24 PM] szybet
yes


[5/1/2022 8:26 PM] cieldautomne
I only have 4 threads, so I can change it to 4


[5/1/2022 8:31 PM] tux_linux
You can keep 8, it isn't dependent on your processor cores number


[5/1/2022 8:35 PM] cieldautomne
okay


[5/1/2022 8:36 PM] cieldautomne
what does it do ?


[5/1/2022 8:37 PM] szybet
you mean the commands?


[5/1/2022 8:37 PM] cieldautomne
THREADS=8


[5/1/2022 8:37 PM] szybet
specifies how many cores are used for compiling


[5/1/2022 8:37 PM] szybet
becouse the default is 1


[5/1/2022 8:37 PM] szybet
if its above your count it will use all of them


[5/1/2022 8:38 PM] cieldautomne
okayyy


[5/1/2022 8:39 PM] tux_linux
How many jobs, not cores


[5/1/2022 8:40 PM] szybet
one job = one core?


[5/1/2022 8:40 PM] tux_linux
Not necessarily


[5/1/2022 8:40 PM] szybet
most propably


[5/1/2022 8:40 PM] cieldautomne
jobs =/= threads ?


[5/1/2022 8:41 PM] tux_linux
I have an 8core/16t cpu, I set 32 for number of jobs in Gentoo


[5/1/2022 8:41 PM] tux_linux
It works well


[5/1/2022 8:41 PM] szybet
jobs =(Not necessarily, most propably)= threads ?


[5/1/2022 8:41 PM] tux_linux
Yes


[5/1/2022 8:42 PM] szybet
whats the diffrence between when you set 16 jobs? + it may depend on per core performance


[5/1/2022 8:42 PM] cieldautomne
-j in gentoo isn't also tied to the ram ?


[5/1/2022 8:42 PM] tux_linux
If you have 4 cores you can set 4 jobs but you can also set 8


[5/1/2022 8:42 PM] szybet
then 4 jobs will have max performance, or 8 jobs will have 50% performance


[5/1/2022 8:43 PM] szybet
`it may depend on per core performance`


[5/1/2022 9:02 PM] cieldautomne
okay, I have both **u-boot_inkbox.n249.imx** and **zImage-root**


[5/2/2022 1:22 AM] tux_linux
Did you back up your SD card?


[5/2/2022 1:54 AM] cieldautomne
yes


[5/2/2022 1:58 AM] tux_linux
ok, please do
```
dd if=u-boot_inkbox.n249.imx of=/dev/mmcblk0 bs=1K seek=1
```
and post serial port boot log


[5/2/2022 2:37 AM] cieldautomne
```
U-Boot 2020.10 (May 01 2022 - 20:42:46 +0200)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 32C
Reset cause: POR
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0
switch to partitions #0, OK
mmc0 is current device
Unknown command 'load_ntxkernel' - try 'help'
```


[5/2/2022 2:38 AM] tux_linux
ok, very nice
you are in the console?


[5/2/2022 2:38 AM] cieldautomne
yep


[5/2/2022 2:38 AM] tux_linux
run this
```
kobohiddenread 0 9bfffe00 400 hwcfg_sz
kobohiddenread 0 9bd70000 3800 waveform_sz
kobohiddenread 0 9bd6da00 406 ntxfw_sz
kobohiddenread 0 ${fdt_addr} 506
mmc read ${loadaddr} 800 2400
setenv bootargs console=${console},${baudrate} rootwait rw no_console_suspend hwcfg_p=0x9bfffe00 hwcfg_sz=${hwcfg_sz} waveform_p=0x9bd70000 waveform_sz=${waveform_sz} ntxfw_p=0x9bd6da00 ntxfw_sz=${ntxfw_sz} mem=445M boot_port=1 rootfstype=ext4 root=/dev/mmcblk0p1 quiet
bootz ${loadaddr} - ${fdt_addr}
```


[5/2/2022 2:39 AM] tux_linux
(from https://github.com/akemnade/u-boot-fslc/wiki)


[5/2/2022 2:39 AM] cieldautomne
line per line ?


[5/2/2022 2:39 AM] tux_linux
yes, enter at each line


[5/2/2022 2:40 AM] tux_linux
bootz is the final command


[5/2/2022 2:40 AM] tux_linux
then nickel should boot


[5/2/2022 2:42 AM] cieldautomne
```Kernel image @ 0x80800000 [ 0x000000 - 0x44e730 ]
ERROR: Did not find a cmdline Flattened Device Tree
Could not find a valid device tree
```


[5/2/2022 2:42 AM] cieldautomne
:/


[5/2/2022 2:43 AM] cieldautomne
after *bootz*


[5/2/2022 2:43 AM] tux_linux
ok, doesn't matter anyway


[5/2/2022 2:43 AM] tux_linux
was just to see if it was capable to boot nickel


[5/2/2022 2:43 AM] tux_linux
what's `fdisk -l` on the SD?


[5/2/2022 2:46 AM] cieldautomne
```Disk /dev/sda: 7,4 GiB, 7948206080 bytes, 15523840 sectors
Disk model: SD/MMC
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xf9e82d0e

Device     Boot   Start      End  Sectors  Size Id Type
/dev/sda1         49152   573440   524289  256M 83 Linux
/dev/sda2        573441  1097729   524289  256M 83 Linux
/dev/sda3       1097730 15521793 14424064  6,9G  b W95 FAT32```


[5/2/2022 2:50 AM] tux_linux
ok
please make it look like this
```
p1 START: 49152    END: 79872
p2 START: 104448   END: 1128447
p3 START: 1128448  END: 1390591
p4 START: 1390592  END: <end of MMC>
```


[5/2/2022 2:50 AM] tux_linux
those are sectors numbers, do you know how to fdisk?

{Reactions}
👍 

[5/2/2022 2:53 AM] tux_linux
please post fdisk -l again when you are done


[5/2/2022 3:01 AM] cieldautomne
```
Disk /dev/sda: 7,4 GiB, 7948206080 bytes, 15523840 sectors
Disk model: SD/MMC
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0xf9e82d0e

Device     Boot   Start      End  Sectors  Size Id Type
/dev/sda1         49152    79872    30721   15M 83 Linux
/dev/sda2        104448  1128447  1024000  500M 83 Linux
/dev/sda3       1128448  1390591   262144  128M 83 Linux
/dev/sda4       1390592 15523839 14133248  6,7G 83 Linux
```


[5/2/2022 3:02 AM] tux_linux
ok, awesome


[5/2/2022 3:03 AM] cieldautomne
why do we need to change the partition layout ?


[5/2/2022 3:04 AM] tux_linux
there are 4 partitions instead of three
and inkbox os writes some things in the unpartitioned space between some partitions


[5/2/2022 3:05 AM] tux_linux
now, please
```
dd if=/dev/mmcblk0 bs=512 count=49151 of=bootmmc.bin
xz bootmmc.bin
```
and share bootmmc.bin.xz via PM


[5/2/2022 3:06 AM] tux_linux
if you want more privacy, you can blank out the serial number (but your clara is likely already out of warranty) by doing so
```
dd if=/dev/zero of=/dev/mmcblk0 bs=256 seek=2 count=1
```


[5/2/2022 3:07 AM] tux_linux
then do this


[5/2/2022 3:15 AM] tux_linux
now, please
```
mkfs.ext4 /dev/mmcblk0p1 -O "^metadata_csum"
```
and do the same for p2, p3 and p4


[5/2/2022 3:18 AM] cieldautomne
done


[5/2/2022 3:21 AM] tux_linux
now we will generate the public/private key pair that will be used to sign release InkBox OS packages on this device.
you have to promise me that you will never share it with anyone. only me and you will know what the private key is.
please do:
```
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -out public.pem -outform PEM -pubout
```
and send both public.pem and private.pem via PM


[5/2/2022 3:22 AM] cieldautomne
you/me + discord 😅


[5/2/2022 3:22 AM] tux_linux
well, discord probably doesn't care about this


[5/2/2022 3:23 AM] cieldautomne
sure


[5/2/2022 3:23 AM] tux_linux
otherwise you can send it via email
kobox.alpine@gmail.com


[5/2/2022 3:29 AM] cieldautomne
why do I also need to know the private key ?


[5/2/2022 3:29 AM] tux_linux
because it will be easier for you to sign packages while testing


[5/2/2022 3:29 AM] tux_linux
otherwise it can be a pain


[5/2/2022 3:30 AM] cieldautomne
okay, I'll have to compile stuff and then sign the pkg ?


[5/2/2022 3:30 AM] tux_linux
yes


[5/2/2022 3:31 AM] tux_linux
or it won't allow to run it on the device


[5/2/2022 3:32 AM] tux_linux
ok, now:
```
cd /home/build/inkbox
git clone https://github.com/Kobo-InkBox/rootfs && cd rootfs
env GITDIR="${PWD}" ./release.sh && cd ..
openssl dgst -sha256 -sign /path/to/private.pem -out rootfs.squashfs.dgst rootfs.squashfs
```
then, copy rootfs.squashfs* in p3


[5/2/2022 3:38 AM] cieldautomne
done


[5/2/2022 3:40 AM] tux_linux
ok
```
cd /home/build/inkbox
git clone https://github.com/Kobo-InkBox/imgtool && cd imgtool
openssl dgst -sha256 -sign /path/to/private.pem -out sd/overlaymount-rootfs.squashfs.dgst sd/overlaymount-rootfs.squashfs
```


[5/2/2022 3:40 AM] tux_linux
copy overlaymount-rootfs.squashfs* in p3 AND p2


[5/2/2022 3:43 AM] cieldautomne
done


[5/2/2022 3:44 AM] tux_linux
ok, I'm currently setting up the initrd and kernel modules


[5/2/2022 4:05 AM] tux_linux
please pull the kernel repo


[5/2/2022 4:05 AM] tux_linux
Pinned a message.


[5/2/2022 4:06 AM] cieldautomne
done


[5/2/2022 4:07 AM] tux_linux
sorry; pull it again


[5/2/2022 4:07 AM] tux_linux
then, recompile the kernel


[5/2/2022 4:08 AM] tux_linux
(with this command:
```
env GITDIR=/home/build/inkbox/kernel TOOLCHAINDIR=/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/ THREADS=8 TARGET=armv7l-linux-musleabihf scripts/build_kernel.sh n249 root
```)


[5/2/2022 4:14 AM] tux_linux
then, copy
```
kernel/out/n249/zImage-root # as 'zImage'
kernel/linux-5.16-n249/arch/arm/boot/dts/imx6sll-kobo-clarahd.dtb # as 'DTB'
```
to p1.
P1 should now look like this:
```
lost+found
zImage
DTB
```


[5/2/2022 4:28 AM] cieldautomne
I have imx6sll-kobo-clarahd.dt**s** not .dtb


[5/2/2022 4:31 AM] cieldautomne
should i copy it as DTS ?


[5/2/2022 4:36 AM] tux_linux
Did you repull the repo?


[5/2/2022 4:36 AM] tux_linux
.


[5/2/2022 4:36 AM] tux_linux
Recompile after that


[5/2/2022 4:54 AM] cieldautomne
yep twice


[5/2/2022 4:55 AM] cieldautomne
```(kernel) ( master ) >>> git pull
remote: Enumerating objects: 13, done.
remote: Counting objects: 100% (13/13), done.
remote: Compressing objects: 100% (2/2), done.
remote: Total 13 (delta 11), reused 13 (delta 11), pack-reused 0
Unpacking objects: 100% (13/13), 287.46 KiB | 341.00 KiB/s, done.
From https://github.com/Kobo-InkBox/kernel
   1eed06068d..a17ad4b647  master     -> origin/master
Updating 1eed06068d..a17ad4b647
Fast-forward
 initrd/busybox-1.32.1/_install-n249/opt/key.sqsh     | Bin 4096 -> 4096 bytes
 initrd/busybox-1.32.1/_install-n249/opt/modules.sqsh | Bin 479232 -> 294912 bytes
 kernel/config/config-n249                            |  12 ++++++------
 scripts/setupenv.sh                                  |  17 ++++++++++-------
 4 files changed, 16 insertions(+), 13 deletions(-)
(kernel) ( master ) >>> git pull
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Total 4 (delta 3), reused 4 (delta 3), pack-reused 0
Unpacking objects: 100% (4/4), 373 bytes | 62.00 KiB/s, done.
From https://github.com/Kobo-InkBox/kernel
   a17ad4b647..62c5532f36  master     -> origin/master
Updating a17ad4b647..62c5532f36
Fast-forward
 scripts/build_kernel.sh | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)```


[5/2/2022 4:57 AM] cieldautomne
I may have done it too quickly after your message


[5/2/2022 4:58 AM] cieldautomne
```(kernel) ( master ) >>> git pull
Already up to date.```


[5/2/2022 4:58 AM] cieldautomne
i've just tried again


[5/2/2022 5:03 AM] tux_linux
Ok it should work
Recompile


[5/2/2022 5:04 AM] cieldautomne
DTS should work ?


[5/2/2022 5:05 AM] tux_linux
Dtb


[5/2/2022 5:09 AM] cieldautomne
i should have tried a `fd imx6sll-kobo-clarahd.dtb .` before because actually it had worked T.T, the file is located at `/home/build/inkbox/kernel/bootloader/mx6sll-n249/arch/arm/dts/imx6sll-kobo-clarahd.dtb` not `/home/build/inkbox/kernel/kernel/linux-5.16-n249/arch/arm/boot/dts/`


[5/2/2022 5:10 AM] cieldautomne
or maybe it didn't ?


[5/2/2022 5:15 AM] tux_linux
No it is not that one


[5/2/2022 5:16 AM] cieldautomne
i'm recompiling


[5/2/2022 5:16 AM] tux_linux
Ok


[5/2/2022 5:20 AM] cieldautomne
it's weird, because I compiled after that last git pull and since then I always got "already up to date"


[5/2/2022 5:24 AM] tux_linux
It's normal, I didn't add new commits


[5/2/2022 5:25 AM] tux_linux
Is the dtb there?


[5/2/2022 5:26 AM] cieldautomne
yep but why the dtb file hasn't been created ? i compiled after your last commit


[5/2/2022 5:26 AM] cieldautomne
still compiling


[5/2/2022 5:26 AM] tux_linux
I don't know


[5/2/2022 5:28 AM] cieldautomne
still no .dtb file


[5/2/2022 5:29 AM] cieldautomne
```---- ROOT kernel compiled. ----
---- Output was saved in /home/build/inkbox/kernel/kernel/out/n249/zImage-root ----```


[5/2/2022 5:30 AM] tux_linux
What's the contents of build_kernel.sh?


[5/2/2022 5:30 AM] cieldautomne
i checked build_kernel.sh and there is `make ARCH=arm CROSS_COMPILE=$TARGET- zImage dtbs -j$THREADS` in it


[5/2/2022 5:31 AM] tux_linux
Yes


[5/2/2022 5:31 AM] cieldautomne
```
348    cd "${GITDIR}/kernel/linux-5.16-n249"
349    make ARCH=arm CROSS_COMPILE=$TARGET- zImage dtbs -j$THREADS
```


[5/2/2022 5:32 AM] tux_linux
So the dtb should be in kernel/linux-5.16-n249/arch/arm/boot/dts


[5/2/2022 5:32 AM] tux_linux
But it is not
Right?


[5/2/2022 5:33 AM] cieldautomne
right


[5/2/2022 5:35 AM] cieldautomne
i used the same command `env GITDIR=/home/build/inkbox/kernel TOOLCHAINDIR=/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/ THREADS=8 TARGET=armv7l-linux-musleabihf scripts/build_kernel.sh n249 root`


[5/2/2022 5:36 AM] tux_linux
ok let's just be done with it


[5/2/2022 5:36 AM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/imx6sll-kobo-clarahd-9AFFE.dtb

{Reactions}
👍 

[5/2/2022 5:39 AM] cieldautomne
okay zImage and DTB are on p1


[5/2/2022 5:42 AM] tux_linux
Very good
Time to sleep here now
I'll continue instructions tomorrow


[5/2/2022 5:43 AM] tux_linux
Thanks for porting


[5/2/2022 5:43 AM] cieldautomne
it's 5:43am here T.T


[5/2/2022 5:43 AM] cieldautomne
good night !

{Reactions}
👍 

[5/2/2022 11:43 AM] szybet
whats this magic


[5/2/2022 11:43 AM] szybet
hmm is this the 5.x kernel?


[5/2/2022 1:57 PM] tux_linux
Yes


[5/2/2022 1:57 PM] tux_linux
Magic vendor U-Boot usually does
That's a newer U-Boot


[5/2/2022 1:58 PM] tux_linux
(ported 2020.10)


[5/2/2022 8:20 PM] andi15701
kobohiddenread is needed for the 4.1.15 kernel


[5/2/2022 8:21 PM] andi15701
the 4.1.15 vendor kernel


[5/2/2022 8:21 PM] andi15701
near-mainline works without


[5/2/2022 8:25 PM] tux_linux
Yeah I know
It was only to test


[5/2/2022 8:25 PM] tux_linux
I put the kernel in p1


[5/2/2022 8:25 PM] tux_linux
And dtb


[5/2/2022 8:26 PM] andi15701
yep


[5/2/2022 10:41 PM] cieldautomne
👋


[5/2/2022 10:44 PM] tux_linux
Hello
Don't have time right now
Will get back to you tonight


[5/2/2022 10:44 PM] cieldautomne
no problem


[5/3/2022 1:30 AM] tux_linux
ok, I'm there


[5/3/2022 1:30 AM] tux_linux
can you access u-boot cmd?
please run `printenv` and post output


[5/3/2022 3:41 AM] cieldautomne
```baudrate=115200
bootcmd=mmc dev ${mmcdev};if run loadimage; then run mmcboot; fi;
bootcmd_mfg=run mfgtool_args;bootz ${loadaddr} ${initrd_addr} ${fdt_addr};
bootdelay=1
bootscript=echo Running bootscript from mmc ...; source
console=ttymxc0
epdc_waveform=epdc_splash.bin
fastboot_dev=mmc0
fdt_addr=0x83000000
fdt_file=undefined
fdt_high=0xffffffff
fdtcontroladdr=9ef9ab30
image=zImage
initrd_addr=0x83800000
initrd_high=0xffffffff
ip_dyn=yes
loadaddr=0x80800000
loadbootscript=fatload mmc ${mmcdev}:${mmcpart} ${loadaddr} ${script};
loadfdt=load_ntxdtb
loadimage=load_ntxkernel
mfgtool_args=setenv bootargs console=${console},${baudrate} rdinit=/linuxrc g_mass_storage.stall=0 g_mass_storage.removable=1 g_mass_storage.file=/fat g_mass_storage.ro=1 g_mass_storage.idVendor=0x066F g_mass_storage.idProduct=0x37FF g_mass_storage.iSerialNumber=""
mmcargs=setenv bootargs console=${console},${baudrate} rootwait rw no_console_suspend
mmcautodetect=no
mmcboot=echo Booting from mmc ...; run mmcargs; if run loadfdt; then bootz ${loadaddr} - ${fdt_addr}; else echo WARN: Cannot load the DT; fi;
mmcdev=0
mmcpart=1
script=boot.scr
stderr=serial
stdin=serial
stdout=serial

Environment size: 1169/8188 bytes```


[5/3/2022 3:46 AM] tux_linux (pinned)
Ok, very nice
Try
```
ext4load mmc 0:1 0x83000000 DTB
ext4load mmc 0:1 0x80800000 zImage
bootz 0x80800000 - 0x83000000
```
and post output


[5/3/2022 3:48 AM] cieldautomne
```=> ext4load mmc 0:1 0x83000000 DTB
28839 bytes read in 15 ms (1.8 MiB/s)
=> ext4load mmc 0:1 0x80800000 zImage
11050896 bytes read in 541 ms (19.5 MiB/s)
=> bootz 0x80800000 - 0x83000000
Kernel image @ 0x80800000 [ 0x000000 - 0xa89f90 ]
## Flattened Device Tree blob at 83000000
   Booting using the fdt blob at 0x83000000
   Using Device Tree in place at 83000000, end 8300a0a6

Starting kernel ...

[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.202804] debugfs: Directory 'dummy-iomuxc-gpr@20e4000' with parent 'regmap' already present!
[    1.612630] cyttsp5_i2c_adapter 1-0024: cyttsp5_get_hid_descriptor_: failed to get HID descriptor length and version, rc=-6
[    1.640104] cyttsp5_i2c_adapter 1-0024: cyttsp5_startup_: Error on getting HID descriptor r=-6
[    1.860669] cyttsp5_i2c_adapter 1-0024: cyttsp5_read_input: Error getting report, r=-6
[    4.038036] Warning: unable to open an initial console.
[    9.169780] reboot: Power down```


[5/3/2022 3:48 AM] tux_linux
yay!


[5/3/2022 3:48 AM] tux_linux
it works
(half-works)


[5/3/2022 3:48 AM] tux_linux
does the screen refresh?


[5/3/2022 3:50 AM] cieldautomne
no


[5/3/2022 3:53 AM] tux_linux
hmm, might need some help from andi1 here
please go into kernel repo and do this:
```
sed 's/quiet//g' kernel/config/config-n249 > kernel/config/config-n249
```
then recompile and put zImage-root in p1 as zImage


[5/3/2022 3:54 AM] tux_linux
No need to replace DTB


[5/3/2022 3:54 AM] tux_linux
Pinned a message.


[5/3/2022 3:54 AM] tux_linux
Then do this again

{Reactions}
👍 

[5/3/2022 3:58 AM] cieldautomne
```Compile also drivers which will not load (COMPILE_TEST) [N/y/?] (NEW) y
Compile the kernel with warnings as errors (WERROR) [Y/n/?] (NEW) n
Local version - append to kernel release (LOCALVERSION) [] (NEW)
Build ID Salt (BUILD_SALT) [] (NEW)
Kernel compression mode
> 1. Gzip (KERNEL_GZIP) (NEW)
  2. LZMA (KERNEL_LZMA) (NEW)
  3. XZ (KERNEL_XZ) (NEW)
  4. LZO (KERNEL_LZO) (NEW)
  5. LZ4 (KERNEL_LZ4) (NEW)
choice[1-5?]:
Default init path (DEFAULT_INIT) [] (NEW)
Default hostname (DEFAULT_HOSTNAME) [(none)] (NEW)
Support for paging of anonymous memory (swap) (SWAP) [Y/n/?] (NEW)
System V IPC (SYSVIPC) [N/y/?] (NEW)```


[5/3/2022 3:58 AM] cieldautomne
it's asking me to specify kernel options..


[5/3/2022 3:59 AM] tux_linux
huh...


[5/3/2022 4:04 AM] tux_linux
`cp config-n249 kernel/config/config-n249`

{Attachments}
/mnt/data/projects/git/conversations/media/config-n249-BDC69


[5/3/2022 4:04 AM] tux_linux
then try to recompile


[5/3/2022 4:05 AM] cieldautomne
my current config file is empty.. weird


[5/3/2022 4:05 AM] tux_linux
strange


[5/3/2022 4:05 AM] tux_linux
maybe the sed command did something I didn't expect


[5/3/2022 4:06 AM] tux_linux
anyway, copy this config file, it should work


[5/3/2022 4:06 AM] cieldautomne
could it be because i'm using fish ?


[5/3/2022 4:07 AM] tux_linux
...maybe


[5/3/2022 4:07 AM] tux_linux
i'm using fish too


[5/3/2022 4:07 AM] tux_linux
anyway


[5/3/2022 4:14 AM] cieldautomne
for the sake of curiosity i tried with `sed -i 's/quiet//g' kernel/config/config-n249'` and it worked


[5/3/2022 4:15 AM] tux_linux
ok good


[5/3/2022 4:35 AM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/message-AE0F5.txt


[5/3/2022 4:47 AM] tux_linux
ok I know how to solve one of the problems


[5/3/2022 4:47 AM] tux_linux
`env GITDIR="${PWD}" scripts/make_devicenodes.sh`


[5/3/2022 4:47 AM] tux_linux
then recompile


[5/3/2022 4:47 AM] tux_linux
and do the same thing


[5/3/2022 4:47 AM] tux_linux
As for no screen flashing this is a bit puzzling
@andi , any clues about the above boot log, why the screen isn't working?
You can find the kernel config at https://github.com/Kobo-InkBox/kernel/blob/master/kernel/config/config-n249


[5/3/2022 5:11 AM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/message-9E287.txt


[5/3/2022 5:12 AM] tux_linux
oh sorry my bad again


[5/3/2022 5:15 AM] tux_linux
really sorry
run this again
ensure that `console`, `null`, and `ttymxc0` are there (in `initrd/n249/dev`)
then, recompile (and re-post serial output)


[5/3/2022 5:15 AM] cieldautomne
no problem

{Reactions}
👍 

[5/3/2022 5:16 AM] tux_linux
`git pull` too before all of this


[5/3/2022 5:37 AM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/message-2C509.txt


[5/3/2022 5:45 AM] tux_linux
seems that fb0 device node is missing
strange
i thought I had enabled the required kernel option without modules


[5/3/2022 5:45 AM] tux_linux
good that the initrd starts


[5/4/2022 12:08 AM] tux_linux
@andi are there required kernel options to make the epdc work?
I thought I enabled all that was needed


[5/4/2022 7:21 PM] andi15701
modprobe mxc_epdc_v2_fb

{Reactions}
👍 

[5/4/2022 7:21 PM] andi15701
it loads the waveform


[5/19/2022 8:22 PM] zenlou
so what's the status?


[5/19/2022 8:24 PM] szybet
you can read through it


[5/19/2022 8:24 PM] zenlou
:Hmmmmmm:


[5/19/2022 8:24 PM] szybet
but in short andi1 is developing self made kernel on version 5.15


[5/19/2022 8:24 PM] szybet
which is awesome


[5/19/2022 8:25 PM] zenlou
pretty much did that. lemme rephrase


[5/19/2022 8:25 PM] zenlou
Does anyone have anything they wanna test, but without the hardware for testing it?


[5/19/2022 8:25 PM] szybet
he is a linux wizard


[5/19/2022 8:25 PM] zenlou
starting out as a test subject. I'll just put the offer out there :V (ping me)


[5/19/2022 8:25 PM] szybet
more tests are always better


[5/19/2022 8:26 PM] szybet
if you want to contribute in other ways you can try to compile some browser dependiecies to arm at #quill  or extend the kobo nia porting guide


[6/6/2022 4:59 PM] zenlou
@tux-linux did you ever test or implement the option? dunno if you've been working on getting the screen to work since may


[6/6/2022 5:18 PM] tux_linux
I have like 4 ongoing projects focusing on InkBox right now, so I'm slowly porting it
Sorry for not being active there lately


[6/6/2022 5:40 PM] zenlou
no worries, just checkin

{Reactions}
👍 

[6/28/2022 6:02 PM] cieldautomne
Hey! Sorry for not being active, I had a hard time with exams and completely forgot about this project T.T


[6/28/2022 6:02 PM] tux_linux
Me too hehe


[6/28/2022 6:04 PM] cieldautomne
Can the module be loaded automatically at boot time?


[6/28/2022 6:04 PM] tux_linux
No, well, I can include it in the boot script


[6/28/2022 6:04 PM] tux_linux
But we have to build it first


[6/28/2022 6:05 PM] tux_linux
Oh it's actually already compiled


[6/28/2022 6:05 PM] tux_linux
Great


[6/28/2022 6:05 PM] tux_linux
You should `git pull` the kernel repo again


[6/28/2022 6:05 PM] tux_linux
And build a new kernel


[6/28/2022 6:06 PM] cieldautomne
yep I'm going to do that

{Reactions}
👍 

[6/28/2022 6:06 PM] tux_linux
Then, boot it and hit a key at the second `stop auto-boot` prompt, we will try some things


[6/28/2022 7:19 PM] cieldautomne
```U-Boot 2020.10 (Jun 28 2022 - 18:38:58 +0200)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 38C
Reset cause: POR
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0
switch to partitions #0, OK
mmc0 is current device
Unknown command 'load_ntxkernel' - try 'help'
=>```


[6/28/2022 7:19 PM] cieldautomne
I did something wrong


[6/28/2022 7:20 PM] cieldautomne
I'm not using the same distro/environnment as before, so I started from scratch


[6/28/2022 7:21 PM] cieldautomne
at least this time I have the .dtb at /home/build/inkbox/kernel/kernel/linux-5.16-n249/arch/arm/boot/dts/


[6/28/2022 7:42 PM] tux_linux
Oh
You have both
Put them in a partition
(zImage + dtb)


[6/28/2022 7:45 PM] cieldautomne
yep zImage and DTB are in p1


[6/28/2022 7:46 PM] tux_linux
Do that again


[6/28/2022 7:49 PM] cieldautomne
okay, I was waiting for a second "Hit any key to stop autoboot: " but it's the one after loading the kernel


[6/28/2022 7:49 PM] cieldautomne
```U-Boot 2020.10 (Jun 28 2022 - 18:38:58 +0200)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 37C
Reset cause: POR
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0
=> ext4load mmc 0:1 0x83000000 DTB
28839 bytes read in 15 ms (1.8 MiB/s)
=> ext4load mmc 0:1 0x80800000 zImage
11066576 bytes read in 542 ms (19.5 MiB/s)
=> bootz 0x80800000 - 0x83000000
Kernel image @ 0x80800000 [ 0x000000 - 0xa8dcd0 ]
## Flattened Device Tree blob at 83000000
   Booting using the fdt blob at 0x83000000
   Using Device Tree in place at 83000000, end 8300a0a6

Starting kernel ...

[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.200063] debugfs: Directory 'dummy-iomuxc-gpr@20e4000' with parent 'regmap' already present!
[    1.600437] cyttsp5_i2c_adapter 1-0024: cyttsp5_get_hid_descriptor_: failed to get HID descriptor length and version, rc=-6
[    1.624876] cyttsp5_i2c_adapter 1-0024: cyttsp5_startup_: Error on getting HID descriptor r=-6
[    1.845445] cyttsp5_i2c_adapter 1-0024: cyttsp5_read_input: Error getting report, r=-6
Linux inkbox 5.16.0 #1 SMP Tue Jun 28 19:26:49 CEST 2022 armv7l GNU/Linux
InkBox OS, kernel build AGUPM7ZK, commit e306dd2
Copyright (C) 2021-2022 Nicolas Mailloux <nicolecrivain@gmail.com>

Checking filesystems ...

e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p1: clean, 14/3840 files, 13084/15360 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p2: clean, 13/128016 files, 46487/512000 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p3: clean, 15/32768 files, 92778/131072 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p4: clean, 11/442368 files, 51922/1766656 blocks

(initrd) Hit any key to stop auto-boot ...

inkbox login:```


[6/28/2022 7:51 PM] tux_linux
Great


[6/28/2022 7:51 PM] tux_linux
User is root


[6/28/2022 7:52 PM] tux_linux
then
unsquashfs -d /modules /opt/modules.sqsh


[6/28/2022 7:53 PM] cieldautomne
```Filesystem uses xz compression, this is unsupported by this version
Decompressors available:
    gzip```


[6/28/2022 8:03 PM] tux_linux
hmm ok, do
`mount /opt/modules.sqsh /mnt`


[6/28/2022 8:04 PM] cieldautomne
done


[6/28/2022 8:04 PM] tux_linux
find /mnt | grep mxc


[6/28/2022 8:04 PM] cieldautomne
```/mnt/drivers/video/fbdev/mxc
/mnt/drivers/video/fbdev/mxc/mxc_epdc_fb.ko
/mnt/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko
```


[6/28/2022 8:05 PM] tux_linux
`insmod /mnt/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko`


[6/28/2022 8:05 PM] tux_linux
look at the screen


[6/28/2022 8:06 PM] cieldautomne
`insmod: can't insert '/mnt/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko': invalid parameter`


[6/28/2022 8:06 PM] tux_linux
ok


[6/28/2022 8:06 PM] tux_linux
`dmesg`?


[6/28/2022 8:07 PM] cieldautomne
```[ 1075.046656] mxc_epdc_v2_fb: disagrees about version of symbol _dev_info
[ 1075.046739] mxc_epdc_v2_fb: Unknown symbol _dev_info (err -22)
[ 1075.046802] mxc_epdc_v2_fb: disagrees about version of symbol device_create_file
[ 1075.046821] mxc_epdc_v2_fb: Unknown symbol device_create_file (err -22)
[ 1075.046884] mxc_epdc_v2_fb: disagrees about version of symbol _dev_err
[ 1075.046902] mxc_epdc_v2_fb: Unknown symbol _dev_err (err -22)
[ 1075.047077] mxc_epdc_v2_fb: disagrees about version of symbol _dev_warn
[ 1075.047095] mxc_epdc_v2_fb: Unknown symbol _dev_warn (err -22)
[ 1075.047309] mxc_epdc_v2_fb: disagrees about version of symbol dev_err_probe
[ 1075.047327] mxc_epdc_v2_fb: Unknown symbol dev_err_probe (err -22)
[ 1098.570859] mxc_epdc_v2_fb: disagrees about version of symbol _dev_info
[ 1098.570899] mxc_epdc_v2_fb: Unknown symbol _dev_info (err -22)
[ 1098.570959] mxc_epdc_v2_fb: disagrees about version of symbol device_create_file
[ 1098.570978] mxc_epdc_v2_fb: Unknown symbol device_create_file (err -22)
[ 1098.571038] mxc_epdc_v2_fb: disagrees about version of symbol _dev_err
[ 1098.571055] mxc_epdc_v2_fb: Unknown symbol _dev_err (err -22)
[ 1098.571234] mxc_epdc_v2_fb: disagrees about version of symbol _dev_warn
[ 1098.571252] mxc_epdc_v2_fb: Unknown symbol _dev_warn (err -22)
[ 1098.571460] mxc_epdc_v2_fb: disagrees about version of symbol dev_err_probe
[ 1098.571477] mxc_epdc_v2_fb: Unknown symbol dev_err_probe (err -22)```


[6/28/2022 8:07 PM] tux_linux
Try
```
insmod /mnt/drivers/video/fbdev/mxc/mxc_epdc_fb.ko
insmod /mnt/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko
```


[6/28/2022 8:08 PM] cieldautomne
same


[6/28/2022 8:08 PM] cieldautomne
`insmod: can't insert '/mnt/drivers/video/fbdev/mxc/mxc_epdc_fb.ko': invalid parameter`


[6/28/2022 8:08 PM] tux_linux
ok
`find /mnt`


[6/28/2022 8:09 PM] cieldautomne
```/mnt # find /mnt
/mnt
/mnt/drivers
/mnt/drivers/hwmon
/mnt/drivers/hwmon/tps6518x-hwmon.ko
/mnt/drivers/input
/mnt/drivers/input/serio
/mnt/drivers/input/serio/serport.ko
/mnt/drivers/net
/mnt/drivers/net/mii.ko
/mnt/drivers/net/phy
/mnt/drivers/net/phy/ax88796b.ko
/mnt/drivers/net/tun.ko
/mnt/drivers/net/usb
/mnt/drivers/net/usb/asix.ko
/mnt/drivers/net/usb/ax88179_178a.ko
/mnt/drivers/net/usb/cdc_ether.ko
/mnt/drivers/net/usb/cdc_ncm.ko
/mnt/drivers/net/usb/cdc_subset.ko
/mnt/drivers/net/usb/net1080.ko
/mnt/drivers/net/usb/usbnet.ko
/mnt/drivers/net/usb/zaurus.ko
/mnt/drivers/net/wireless
/mnt/drivers/net/wireless/broadcom
/mnt/drivers/net/wireless/broadcom/brcm80211
/mnt/drivers/net/wireless/broadcom/brcm80211/brcmfmac
/mnt/drivers/net/wireless/broadcom/brcm80211/brcmfmac/brcmfmac.ko
/mnt/drivers/net/wireless/broadcom/brcm80211/brcmutil
/mnt/drivers/net/wireless/broadcom/brcm80211/brcmutil/brcmutil.ko
/mnt/drivers/power
/mnt/drivers/power/supply
/mnt/drivers/power/supply/rn5t618_power.ko
/mnt/drivers/regulator
/mnt/drivers/regulator/tps6518x-regulator.ko
/mnt/drivers/rtc
/mnt/drivers/rtc/rtc-rc5t619.ko
/mnt/drivers/siox
/mnt/drivers/siox/siox-bus-gpio.ko
/mnt/drivers/siox/siox-core.ko
```


[6/28/2022 8:09 PM] cieldautomne
```/mnt/drivers/usb
/mnt/drivers/usb/gadget
/mnt/drivers/usb/gadget/function
/mnt/drivers/usb/gadget/function/u_ether.ko
/mnt/drivers/usb/gadget/function/u_serial.ko
/mnt/drivers/usb/gadget/function/usb_f_acm.ko
/mnt/drivers/usb/gadget/function/usb_f_ecm.ko
/mnt/drivers/usb/gadget/function/usb_f_ecm_subset.ko
/mnt/drivers/usb/gadget/function/usb_f_mass_storage.ko
/mnt/drivers/usb/gadget/function/usb_f_obex.ko
/mnt/drivers/usb/gadget/function/usb_f_rndis.ko
/mnt/drivers/usb/gadget/function/usb_f_serial.ko
/mnt/drivers/usb/gadget/legacy
/mnt/drivers/usb/gadget/legacy/g_ether.ko
/mnt/drivers/usb/gadget/legacy/g_mass_storage.ko
/mnt/drivers/usb/gadget/legacy/g_serial.ko
/mnt/drivers/usb/gadget/libcomposite.ko
/mnt/drivers/video
/mnt/drivers/video/backlight
/mnt/drivers/video/backlight/lm3630a_bl.ko
/mnt/drivers/video/fbdev
/mnt/drivers/video/fbdev/mxc
/mnt/drivers/video/fbdev/mxc/mxc_epdc_fb.ko
/mnt/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko
/mnt/fs
/mnt/fs/configfs
/mnt/fs/configfs/configfs.ko```


[6/28/2022 8:14 PM] tux_linux
hang on
I'll make the modules squashfs again to include modprobe support


[6/28/2022 8:14 PM] cieldautomne
👍


[6/28/2022 8:17 PM] cieldautomne
I'm going to eat, I'll be back

{Reactions}
👍 

[6/28/2022 8:36 PM] tux_linux
https://github.com/Kobo-InkBox/kernel/commit/32ed944c08061d2c805ed1053548ccf64b7aa73d
So `git pull` and recompile `zImage`


[6/28/2022 10:41 PM] cieldautomne
This time I can load the module (both of them) but nothing appears on the screen.


[6/28/2022 10:53 PM] cieldautomne
It's late here and I'm tired, I'll be back tomorrow.

{Reactions}
👍 

[6/29/2022 2:46 AM] tux_linux
It should refresh
After that, it should be blank.
Try to run `/etc/init.d/inkbox-splash` after that and see if something pops up on the screen


[6/29/2022 1:29 PM] cieldautomne
```~ # /etc/init.d/inkbox-splash
/etc/init.d/inkbox-splash: line 130: can't create /sys/class/graphics/fb0/rotate: nonexistent directory
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
~ # lsmod
mxc_epdc_fb 45056 0 - Live 0xbf00e000
mxc_epdc_v2_fb 53248 0 - Live 0xbf000000```


[6/29/2022 1:29 PM] cieldautomne
nothing on the screen


[6/29/2022 1:35 PM] cieldautomne
Yesterday I tested the device with the stock OS to see if it was still working and it was


[6/29/2022 1:37 PM] cieldautomne
since then it shows this

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220629_133342_347-1F48F.jpg


[6/29/2022 1:41 PM] tux_linux
What if you only load mxc_epdc_v2_fb?


[6/29/2022 1:41 PM] cieldautomne
same


[6/29/2022 1:42 PM] tux_linux
Oh


[6/29/2022 1:42 PM] cieldautomne
I tried first with v2 and then retried with non-v2


[6/29/2022 1:42 PM] tux_linux
You ripped off the waveform from the SD card a while ago?


[6/29/2022 1:42 PM] cieldautomne
yep


[6/29/2022 1:42 PM] tux_linux
I think it needs to go in `/lib/firmware/epdc.fw`

{Reactions}
👍 

[6/29/2022 1:43 PM] tux_linux
you can transfer a file via serial with `busybox rx` and `minicom` on your host PC


[6/29/2022 1:43 PM] tux_linux
otherwise you can put it on a partition and copy it to `/lib/firmware` in the initrd for testing


[6/29/2022 1:44 PM] tux_linux
(the initrd is read-only, it's only a ram device)


[6/29/2022 1:44 PM] tux_linux
then load the mxc_epdc_fb_v2 module


[6/29/2022 1:44 PM] tux_linux
and see if something happens


[6/29/2022 1:45 PM] cieldautomne
i'm not using minicom anymore because my raspi is runing alpinlinux now, can I do the same with picocom ?


[6/29/2022 1:45 PM] tux_linux
Not exactly?
Alpine Linux doesn't include the minicom package?


[6/29/2022 1:45 PM] tux_linux
`apk add minicom`?


[6/29/2022 1:46 PM] cieldautomne
wait it does T.T


[6/29/2022 1:47 PM] cieldautomne
ok... I'm dumb I confused minicom with microcom


[6/29/2022 1:47 PM] cieldautomne
and microcom is not in alpine repos


[6/29/2022 1:48 PM] cieldautomne
`/lib/firmware` is missing, is this normal ?


[6/29/2022 1:50 PM] cieldautomne
so first I send the file from my computer to the raspi (with rsync for example) then with minicom and busybox rx from the raspi to the clarahd ?


[6/29/2022 1:51 PM] tux_linux
you just create it


[6/29/2022 1:51 PM] tux_linux
when you are in the initrd shell


[6/29/2022 1:51 PM] tux_linux
We will include it later but for now it's only for testing

{Reactions}
👍 

[6/29/2022 1:53 PM] tux_linux
1. Use `scp`, much simpler
`scp epdc.fw pi@192.168.1.x:/tmp`
2. `mkdir -p /lib/firmware; busybox rx /lib/firmware/epdc.fw` on the Kobo
3. on the rpi, Ctrl-A + S, then select `xmodem` and follow the instructions

{Reactions}
👍 

[6/29/2022 1:56 PM] cieldautomne
ok first I need to find another apk mirror cause I can't access alpine.42.fr...


[6/29/2022 2:28 PM] cieldautomne
```~ # busybox rx /lib/firmware/epdc.fw
CCCCCCCCCCrx: too many errors; giving up```


[6/29/2022 2:28 PM] cieldautomne
...


[6/29/2022 2:36 PM] tux_linux
put it in your sd card then


[6/29/2022 2:36 PM] cieldautomne
```~ # insmod /mnt/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko
~ # /etc/init.d/inkbox-splash
/etc/init.d/inkbox-splash: line 130: can't create /sys/class/graphics/fb0/rotate: nonexistent directory
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
~ # ls /lib/firmware/
epdc.fw```


[6/29/2022 2:37 PM] cieldautomne
```~ # insmod /mnt/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_fb.ko
~ # /etc/init.d/inkbox-splash
/etc/init.d/inkbox-splash: line 130: can't create /sys/class/graphics/fb0/rotate: nonexistent directory
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
~ #```


[6/29/2022 2:40 PM] tux_linux
`dmesg`?


[6/29/2022 2:42 PM] cieldautomne
```[    8.389250] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: (null). Quota mode: none.
[    8.656778] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: (null). Quota mode: none.
[   34.418417] SD3_SPWR: disabling
[   34.418768] LDO1: disabling
[   34.420988] LDO4: disabling
[   34.422404] LDO9: disabling
[   34.423911] LDO10: disabling
[   34.425829] LDORTC1: disabling
[   57.251599] EXT4-fs (mmcblk0p4): mounted filesystem with ordered data mode. Opts: (null). Quota mode: none.
[   64.501217] cfg80211: failed to load regulatory.db
[   64.504467] imx-sdma 20ec000.dma-controller: external firmware not found, using ROM firmware
[  143.909590] loop0: detected capacity change from 0 to 1072
[  179.327056] imx_epdc_v2_fb 20f4000.epdc: No qos phandle specified. Ignored.```


[6/29/2022 2:44 PM] tux_linux
@andi I think we need help


[6/30/2022 12:48 AM] andi15701
is tps65185 probed?


[6/30/2022 12:49 AM] tux_linux
Oh, we need to insmod it? It isn't a dep of `mxc_epdc_fb_v2`?


[6/30/2022 12:49 AM] andi15701
it does not use any symbols of it


[6/30/2022 12:50 AM] andi15701
so it is not that a "hard" dep


[6/30/2022 12:50 AM] tux_linux
Ok thanks


[6/30/2022 12:50 AM] andi15701
but the probe returns -EPROBE_DEFER


[6/30/2022 12:50 AM] tux_linux
/mnt/drivers/regulator/tps6518x-regulator.ko
with the hwmon too or not?


[6/30/2022 12:51 AM] andi15701
if the required regulators are not there


[6/30/2022 12:51 AM] andi15701
use the hwmon too


[6/30/2022 12:51 AM] andi15701
and mfd/tps6518x.ko


[6/30/2022 12:51 AM] andi15701
but that should be a dep

{Reactions}
👍 

[6/30/2022 12:52 AM] andi15701
so you can modprobe it

{Reactions}
👍 

[7/1/2022 6:39 PM] tux_linux
@alex(O_o), copy `epdc.fw` in `/lib`, then try
```
modprobe tps6518x-regulator
modprobe tps6518x-hwmon
modprobe mxc_epdc_v2_fb
```

{Reactions}
👍 

[7/1/2022 7:23 PM] cieldautomne
`/lib` not `/lib/firmware` ?


[7/1/2022 7:23 PM] tux_linux
oh you're right


[7/1/2022 7:24 PM] tux_linux
yeah, `/lib/firmware/epdc.fw`


[7/1/2022 7:26 PM] cieldautomne
I need to charge the kobo a bit before

{Reactions}
👍 

[7/1/2022 7:26 PM] tux_linux
np


[7/1/2022 7:26 PM] tux_linux
i'm not in any hurry


[7/1/2022 10:48 PM] cieldautomne
with mxc_epdc_v2_fb only
```~ # /etc/init.d/inkbox-splash
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!
[FBInk] [fbink_cls] Failed to refresh the screen!
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!
~ # lsmod
mxc_epdc_v2_fb 53248 3 - Live 0xbf00a000
tps6518x_regulator 16384 3 - Live 0xbf005000
tps6518x_hwmon 16384 0 - Live 0xbf000000
~ # ls /lib/firmware/
epdc.fw```


[7/1/2022 10:49 PM] cieldautomne
with mxc_epdc_fb
```~ # /etc/init.d/inkbox-splash
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!
[FBInk] [fbink_cls] Failed to refresh the screen!
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!
~ # lsmod
mxc_epdc_fb 45056 0 - Live 0xbf018000
mxc_epdc_v2_fb 53248 3 - Live 0xbf00a000
tps6518x_regulator 16384 3 - Live 0xbf005000
tps6518x_hwmon 16384 0 - Live 0xbf000000```


[7/1/2022 10:51 PM] tux_linux
`zcat /proc/config.gz | grep MFD_TPS6518X`


[7/1/2022 10:51 PM] cieldautomne
```
~ # zcat /proc/config.gz | grep MFD_TPS6518X
CONFIG_MFD_TPS6518X=y```


[7/1/2022 10:52 PM] cieldautomne
also I can't modprobe so I used insmod + the path


[7/1/2022 10:52 PM] tux_linux
I think we then have everything we should need?


[7/1/2022 10:52 PM] tux_linux
why? what's the error?


[7/1/2022 10:52 PM] cieldautomne
`modprobe: can't change directory to '/lib/modules': No such file or directory`


[7/1/2022 10:52 PM] tux_linux
you forgot the unsquashfs step


[7/1/2022 10:54 PM] tux_linux
Actually, the mount part
Do it like this
```
mkdir -p /lib/modules
mount /opt/modules.sqsh /lib/modules
```


[7/1/2022 10:55 PM] cieldautomne
weird, I tried `unsquashfs -d /modules /opt/modules.sqsh` and I think it worked


[7/1/2022 10:55 PM] cieldautomne
```~ # unsquashfs -d /modules /opt/modules.sqsh
Parallel unsquashfs: Using 1 processor
66 inodes (65 blocks) to write



created 64 files
created 32 directories
created 2 symlinks
created 0 devices
created 0 fifos
created 0 sockets```


[7/1/2022 10:56 PM] tux_linux
I repackaged it with gzip I think


[7/1/2022 10:56 PM] tux_linux
but it should be in `/lib/modules`


[7/1/2022 10:56 PM] cieldautomne
it's in /modules


[7/1/2022 10:57 PM] cieldautomne
should I move it to /lib/ ?


[7/1/2022 10:57 PM] tux_linux
busybox version of modprobe can only look in /lib/modules


[7/1/2022 10:57 PM] tux_linux
yes


[7/1/2022 10:58 PM] cieldautomne
now I can modprobe, nice

{Reactions}
👍 

[7/1/2022 10:58 PM] tux_linux
try this again


[7/1/2022 10:59 PM] cieldautomne
still the same


[7/1/2022 10:59 PM] cieldautomne
```~ # /etc/init.d/inkbox-splash
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!
[FBInk] [fbink_cls] Failed to refresh the screen!
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!```


[7/1/2022 10:59 PM] tux_linux
ok


[7/1/2022 11:00 PM] tux_linux
Unless... FBInk doesn't like that kernel very much @NiLuJe ?


[7/1/2022 11:01 PM] cieldautomne
Could it be due to a bad epdc.fw?


[7/1/2022 11:02 PM] tux_linux
~~maybe~~ probably not
but it's unlikely as you ripped yours from your own SD card


[7/1/2022 11:03 PM] cieldautomne
I may have done it wrong ^^'


[7/1/2022 11:11 PM] tux_linux
does the screen blank when you modprobe the mxc_epdc_v2_fb module?


[7/1/2022 11:13 PM] cieldautomne
nop


[7/1/2022 11:16 PM] tux_linux
On Kindle it does that
Not sure if it's the same thing here


[7/1/2022 11:37 PM] cieldautomne
dmesg output


[7/1/2022 11:37 PM] cieldautomne
```[   25.552465] loop0: detected capacity change from 0 to 1072
[   34.418336] SD3_SPWR: disabling
[   34.418685] LDO1: disabling
[   34.420929] LDO4: disabling
[   34.422346] LDO9: disabling
[   34.425643] LDO10: disabling
[   34.431517] LDORTC1: disabling
[   64.501278] cfg80211: failed to load regulatory.db
[   64.504360] imx-sdma 20ec000.dma-controller: external firmware not found, using ROM firmware
[   96.115749] EXT4-fs (mmcblk0p4): mounted filesystem with ordered data mode. Opts: (null). Quota mode: no.
[  201.493491] tps6518x-regulator tps6518x-regulator: tps6518x_regulator_probe(622): revID=102,6518x@32fc381
[  201.499184] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[  201.503063] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[  201.503097] VCOM: Bringing 2790000uV into 2750000-2750000uV
[  201.506595] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[  201.508759] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[  201.541838] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[  201.546138] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[  201.556485] tps6518x_setup_timings():upseq=>0xe1,0x0,dwnseq=>0x1e,0xe0
```


[7/1/2022 11:38 PM] cieldautomne
```[  211.787337] imx_epdc_v2_fb 20f4000.epdc: No qos phandle specified. Ignored.
[  211.789527] imx_epdc_v2_fb 20f4000.epdc: resolution 1448x1072, bpp 16
[  211.803260] imx_epdc_v2_fb 20f4000.epdc: EPDC version = 30
[  211.880293] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[  211.889040] Console: switching to colour frame buffer device 181x67
[  211.905113] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with 2
[  211.905153] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc_PENG060D.fw
[  274.419145] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc.fw failed with error -2
[  274.419224] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc.fw
[  335.577023] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with 2
[  335.577106] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc_PENG060D.fw
[  335.858456] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc.fw failed with error -2
[  335.858537] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc.fw
[  902.024508] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with 2
[  902.024543] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc_PENG060D.fw
```


[7/1/2022 11:38 PM] cieldautomne
```[  965.618427] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc.fw failed with error -2
[  965.618504] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc.fw
[  980.265396] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with 2
[  980.265432] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc_PENG060D.fw
[ 1027.058508] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc.fw failed with error -2
[ 1027.058585] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc.fw
[ 1118.765801] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with 2
[ 1118.765838] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc_PENG060D.fw
[ 1180.659738] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc.fw failed with error -2
[ 1180.659886] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc.fw```


[7/1/2022 11:38 PM] tux_linux
hmm hmm


[7/1/2022 11:38 PM] tux_linux
Try `/lib/epdc.fw`?


[7/1/2022 11:42 PM] cieldautomne
same


[7/1/2022 11:42 PM] cieldautomne
```[ 3379.442450] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with 2
[ 3379.442484] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc_PENG060D.fw
[ 3443.698679] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc.fw failed with error -2
[ 3443.698757] imx_epdc_v2_fb 20f4000.epdc: Falling back to sysfs fallback for: imx/epdc/epdc.fw```


[7/2/2022 2:20 AM] ninuje
FBInk was only ever tested on stock kernels, so, you're kind of on your own ;o).

{Reactions}
👍 

[7/2/2022 2:20 AM] ninuje
(and the stock kernels would be using the _v2 driver)


[7/2/2022 2:20 AM] tux_linux
Any way to test if the FB works otherwise?


[7/2/2022 2:21 AM] ninuje
Not really? Then again, matching the ioctls if a change is necessary is fairly trivial

{Reactions}
👍 

[7/2/2022 2:21 AM] ninuje
But EPERM usually means a lower level fuckup 😉

{Reactions}
👍 

[7/2/2022 2:25 AM] tux_linux
I'll wait for andi1's input


[7/2/2022 12:28 PM] cieldautomne
I'll be unavailable until the 5th of July

{Reactions}
👍 

[7/3/2022 3:28 PM] andi15701
screen should flash after sucessfully probing and initializing of epdc module


[7/3/2022 3:28 PM] andi15701
regulators seem to be found


[7/3/2022 3:28 PM] andi15701
so it is only the firmware


[7/3/2022 3:29 PM] andi15701
is the waveform available when the module is loaded


[7/3/2022 3:29 PM] andi15701
so in /lib/firmware/imx/epdc/epdc_PENG060D.fw or /lib/firmware/imx/epdc/epdc.fw


[7/3/2022 5:02 PM] andi15701
EPERM shows also up when the display is blanked


[7/3/2022 5:03 PM] andi15701
struct mxcfb_update_data upd_region;
       memset(&upd_region, 0, sizeof(upd_region));
        upd_region.update_region.left = x;
        upd_region.update_region.top = y;
        upd_region.update_region.width = w;
        upd_region.update_region.height = h;
        upd_region.waveform_mode = WAVEFORM_MODE_AUTO;
        upd_region.temp = TEMP_USE_AMBIENT;
        upd_region.update_mode = UPDATE_MODE_PARTIAL;
        upd_region.flags = 0;
        ret = ioctl(fd, MXCFB_SEND_UPDATE, &upd_region);


[7/3/2022 5:04 PM] andi15701
that works here


[7/3/2022 5:11 PM] andi15701
look at


[7/3/2022 5:12 PM] andi15701
https://github.com/akemnade/linux/blob/kobo/merged-5.16/include/uapi/linux/mxcfb.h

{Embed}
https://github.com/akemnade/linux/blob/kobo/merged-5.16/include/uapi/linux/mxcfb.h
linux/mxcfb.h at kobo/merged-5.16 · akemnade/linux
Linux kernel source tree. Contribute to akemnade/linux development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/linux-14C52


[7/3/2022 5:12 PM] andi15701
for what is supported


[7/3/2022 5:13 PM] andi15701
kobo kernels have some more ioctls there


[7/3/2022 5:13 PM] andi15701
I limited things to what is available with freescale/nxp kernels


[7/3/2022 7:34 PM] ninuje
At a very quick glance that should be compatible w/ FBInk, as long as the Mk.7 detection kicks in (which it appeared to)

{Reactions}
👍 

[7/3/2022 7:35 PM] ninuje
(IIRC, a broken struct layout yields EINVAL anyway)


[7/3/2022 9:38 PM] andi15701
yep, eperm should be unusual in that case


[7/3/2022 10:54 PM] tux_linux
Oh ok I thought it was at `/lib/firmware/epdc.fw`
Thanks


[7/9/2022 5:37 PM] cieldautomne
```[   34.418391] SD3_SPWR: disabling
[   34.418743] LDO1: disabling
[   34.420983] LDO4: disabling
[   34.422382] LDO9: disabling
[   34.425926] LDO10: disabling
[   34.431777] LDORTC1: disabling
[   64.501201] cfg80211: failed to load regulatory.db
[   64.504426] imx-sdma 20ec000.dma-controller: external firmware not found, using ROM firmware
[   77.920630] tps6518x-regulator tps6518x-regulator: tps6518x_regulator_probe(622): revID=102,6518x@ec37f3a0 wake1
[   77.923884] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   77.928169] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   77.928203] VCOM: Bringing 2790000uV into 2750000-2750000uV
[   77.930837] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   77.932783] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   77.969091] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   77.980279] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   77.987066] tps6518x_setup_timings():upseq=>0xe1,0x0,dwnseq=>0x1e,0xe0
[   91.198042] imx_epdc_v2_fb 20f4000.epdc: No qos phandle specified. Ignored.
[   91.200234] imx_epdc_v2_fb 20f4000.epdc: resolution 1448x1072, bpp 16
[   91.214424] imx_epdc_v2_fb 20f4000.epdc: EPDC version = 30
[   91.291780] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   91.297574] Console: switching to colour frame buffer device 181x67
[   91.318666] imx_epdc_v2_fb 20f4000.epdc:  --- Extra Waveform Data length: 40 bytes---
[   91.318753] imx_epdc_v2_fb 20f4000.epdc:      Extra Waveform Data: 320_R280_AJ2201_ED060KH6C5_VB3300-FOE_TC
[   91.339810] imx_epdc_v2_fb 20f4000.epdc: Unable to get an accurate EPDC pix clkdesired = 80000000, actual = 7262
[   91.408149] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   91.451518] tps6518x 1-0068: TPS6518X intr occured !!,INT1=0x4,INT2=0x1
[   93.606462] tps6518x 1-0068: tps6518x_wait_power_good():waiting(72) for PG(0) timeout
[   93.615263] imx_epdc_v2_fb 20f4000.epdc: Unable to enable DISPLAY regulator.err = 0xffffff92```


[7/9/2022 5:37 PM] cieldautomne
with `/lib/firmware/imx/epdc/epdc_PENG060D.fw`


[7/9/2022 5:38 PM] cieldautomne
no error while executing `/etc/init.d/inkbox-splash` but it does nothing


[7/9/2022 10:54 PM] tux_linux
Is that after you execute inkbox-splash?


[7/10/2022 10:21 AM] cieldautomne
I tried again


[7/10/2022 10:21 AM] cieldautomne
```[   58.270433] tps6518x-regulator tps6518x-regulator: tps6518x_regulator_probe(622): revID=102,6518x@42b2e303 wakeup g1
[   58.273715] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   58.277011] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   58.277046] VCOM: Bringing 2790000uV into 2750000-2750000uV
[   58.278980] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   58.280918] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   58.314575] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   58.318385] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   58.328394] tps6518x_setup_timings():upseq=>0xe1,0x0,dwnseq=>0x1e,0xe0
[   64.501582] cfg80211: failed to load regulatory.db
[   64.504729] imx-sdma 20ec000.dma-controller: external firmware not found, using ROM firmware
[   69.765495] imx_epdc_v2_fb 20f4000.epdc: No qos phandle specified. Ignored.
[   69.768356] imx_epdc_v2_fb 20f4000.epdc: resolution 1448x1072, bpp 16
[   69.786050] imx_epdc_v2_fb 20f4000.epdc: EPDC version = 30
[   69.862082] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   69.867877] Console: switching to colour frame buffer device 181x67
[   69.889044] imx_epdc_v2_fb 20f4000.epdc:  --- Extra Waveform Data length: 40 bytes---
[   69.889134] imx_epdc_v2_fb 20f4000.epdc:      Extra Waveform Data: 320_R280_AJ2201_ED060KH6C5_VB3300-FOE_TC
[   69.910570] imx_epdc_v2_fb 20f4000.epdc: Unable to get an accurate EPDC pix clkdesired = 80000000, actual = 72605042
[   69.977259] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   70.023203] tps6518x 1-0068: TPS6518X intr occured !!,INT1=0x4,INT2=0x1
[   72.176800] tps6518x 1-0068: tps6518x_wait_power_good():waiting(72) for PG(0) timeout
[   72.185623] imx_epdc_v2_fb 20f4000.epdc: Unable to enable DISPLAY regulator.err = 0xffffff92```


[7/10/2022 10:21 AM] cieldautomne
This is after
```modprobe tps6518x-regulator
modprobe tps6518x-hwmon
modprobe mxc_epdc_v2_fb```


[7/10/2022 10:22 AM] cieldautomne
and now after `/etc/init.d/inkbox-splash` the screen goes white


[7/10/2022 10:22 AM] cieldautomne
It goes from this black screen to full white


[7/11/2022 8:14 PM] andi15701
does trying to redraw later resolve that issue?


[7/11/2022 8:14 PM] andi15701
tps6518x 1-0068: tps6518x_wait_power_good():waiting(72) for PG(0) timeout <-- so this is only temporary?


[8/5/2022 6:48 PM] anovella
Hey its possible to install it on clara yet?


[8/5/2022 6:49 PM] szybet
propably not


[8/5/2022 6:49 PM] szybet
but you can help


[8/5/2022 6:49 PM] szybet
¯\_(ツ)_/¯


[8/7/2022 7:05 PM] anovella
Ok, tell me if you need something


[8/7/2022 7:17 PM] szybet
@tux-linux 🥴


[8/10/2022 3:06 PM] zalaxx
just got mine, I can help too if needed


[8/10/2022 3:06 PM] szybet
for now read the entire thread


[8/10/2022 3:06 PM] szybet
to know what doesnt work


[8/10/2022 3:07 PM] tux_linux
And ask questions
Whatever they are
We can explain things to you


[8/10/2022 3:08 PM] szybet
i really hope you will finally port inkbox to it, its suprising it isint yet


[8/10/2022 3:44 PM] zalaxx
what is a "waveform" in this context?


[8/10/2022 3:45 PM] szybet
https://goodereader.com/blog/e-paper/e-ink-waveforms-are-a-closely-guarded-secret

can you give the context?


[8/10/2022 3:45 PM] szybet
it can mean many things here, the link says the most official one i think


[8/10/2022 3:46 PM] zalaxx
""waveforms” are software based and control the transition from different state changes on the screen."
just what i was looking for, thanks


[8/10/2022 3:47 PM] szybet
okay...


[8/10/2022 3:48 PM] zalaxx
(im not an native english speaker btw, sorry if I misinterpret things)


[8/10/2022 3:49 PM] szybet
im not too 🥴


[8/10/2022 3:50 PM] zalaxx
so the current issue with the Clara HD is refreshing the screen?


[8/10/2022 3:51 PM] szybet
yes


[8/10/2022 3:51 PM] szybet
maybe some other things, led?


[8/10/2022 3:51 PM] szybet
i dont remember


[8/10/2022 6:50 PM] tux_linux
Did you set up a serial connection? That's currently the only way to debug it


[8/10/2022 7:57 PM] zalaxx
do I need something special to do that? I'm not much into hardware


[8/10/2022 7:57 PM] szybet
oh


[8/10/2022 7:57 PM] szybet
do you have a usb to serial adapter ( UART )


[8/10/2022 8:01 PM] zalaxx
maybe, let me go check in my basement


[8/10/2022 8:02 PM] szybet
a arduino, any *rpi, will also do the job


[8/10/2022 8:03 PM] szybet
stm


[8/10/2022 8:03 PM] szybet
microcontrollers in general


[8/10/2022 8:30 PM] zalaxx
i dont have any of that currently


[8/10/2022 8:31 PM] szybet
buy one


[8/10/2022 8:31 PM] szybet
they are cheap, really cheap


[8/10/2022 8:31 PM] szybet
if you can get one on 3.3V it would be better. i dont know what voltage is needed


[8/10/2022 8:31 PM] szybet
@tux-linux?


[8/10/2022 8:41 PM] tux_linux
3.3V


[8/10/2022 8:41 PM] tux_linux
You can use a Raspberry Pi or Arduino too


[8/10/2022 9:25 PM] zalaxx
there is really no other way to debug it? no log files?


[8/10/2022 9:25 PM] tux_linux
not until we have a working kernel and rootfs


[8/13/2022 11:48 AM] cieldautomne
https://discord.com/channels/809205711778480158/934581303674798101/996117346135572550
(I don't know why I can't quote a message as usual so I link it...)
I'm not sure to understand. If I re-launch `/etc/init.d/inkbox-splash` nothing happens


[8/13/2022 11:50 AM] cieldautomne
the first time my screen was black with "Éteint" written on it because it is the idle screen of the original OS, the first time I launched inkbox-splash it has disappeared in favor of a white screen, now if I re-launch inkbox-splash nothing appear on the screen, it is still white


[8/13/2022 11:53 AM] cieldautomne
(and sorry for the long abscence, my summer job takes all my time and energy ^^')


[8/13/2022 2:28 PM] tux_linux
It's ok, np
What cleared the screen was probably the module loading
You're sure inkbox splash made it white or maybe something else could have?


[8/13/2022 2:35 PM] cieldautomne
I'll try again after work

{Reactions}
👍 

[8/23/2022 9:06 PM] tux_linux
Hm so... uh, anybody here?


[8/23/2022 9:09 PM] szybet
@zalax heh he left, i had hopes
@alex has a job
@anovella


[8/23/2022 9:09 PM] szybet
if i had money and wanted an eink device i would buy the clara to finnaly port it


[8/23/2022 9:10 PM] szybet
why the heck it wasnt yet done

sd card
old
even postmarketos works on it

:/


[8/23/2022 10:11 PM] the.mightydill
i MIGHT get one... but that will be during september


[8/24/2022 11:39 AM] artus25200
I have a clara hd if needed


[8/24/2022 11:58 AM] szybet
well, your "will" is also needed


[8/25/2022 1:06 AM] artus25200
Well, I have "will"


[8/25/2022 1:18 AM] tux_linux
Then
Welcome aboard


[8/25/2022 1:19 AM] tux_linux
You need a serial console


[8/25/2022 12:21 PM] artus25200
I don’t have one but could I use `telnet` or `ssh` to connect to the kobo, and access the serial port with something like `screen /dev/ttymxc0 <speed>` ?


[8/25/2022 12:22 PM] szybet
nope, thats not the point


[8/25/2022 12:23 PM] artus25200
Why doesn’t it work


[8/25/2022 12:24 PM] szybet
we need kernel / uboot botting logs


[8/25/2022 12:24 PM] artus25200
Okay


[8/25/2022 3:08 PM] tux_linux
Nope


[8/25/2022 3:08 PM] tux_linux
We will wipe off Kobo software


[8/25/2022 3:11 PM] andi15701
so what is the status here? waveform and display gets initilailized but nothing shown?


[8/25/2022 3:11 PM] andi15701
display flashes during boot


[8/25/2022 3:12 PM] tux_linux
It seems, from what I've understood


[8/25/2022 3:12 PM] andi15701
so the next step is to check whether fbink is working here? Or switch to the drm-variant alltogether where no fbink is needed


[8/25/2022 3:12 PM] tux_linux
We do use FBInk everywhere in InkBox OS


[8/25/2022 3:13 PM] andi15701
then I could probably help and analyze


[8/25/2022 3:13 PM] tux_linux
thanks


[8/25/2022 3:13 PM] andi15701
by trying to checkout what fbink is doing


[8/25/2022 4:15 PM] andi15701
what can happen here is that fbink is using some special kobo/netronix ioctl stuff which is not included in Freescale/NXP kernels.


[8/25/2022 4:16 PM] andi15701
Freescale/NXP kernels already contain things to refresh the display


[8/25/2022 4:18 PM] tux_linux
Then what to do?


[8/25/2022 4:25 PM] andi15701
teach fbink to use the more standard ioctl, i am still looking what it does


[8/25/2022 4:26 PM] andi15701
I am analyzing it a bit


[8/25/2022 4:58 PM] andi15701
that works here on the kernel-variant without drm, for reference

{Attachments}
/mnt/data/projects/git/conversations/media/fbupdate-simple.tar-55BE3.gz


[8/25/2022 4:59 PM] ninuje
IIRC, we've already established that the ioctls are compatible


[8/25/2022 5:00 PM] ninuje
And it would throw a different error if that were the issue


[8/25/2022 5:00 PM] andi15701
fbink -s top=0,left=0,width=600,height=600


[8/25/2022 5:00 PM] andi15701
works here


[8/25/2022 5:01 PM] ninuje
Yup, that's what I would have expected 😉


[8/25/2022 5:01 PM] tux_linux
Maybe you can try using InkBox kernel?


[8/25/2022 5:03 PM] tux_linux
.


[8/25/2022 5:47 PM] andi15701
i am compling it

{Reactions}
👍 

[8/25/2022 5:48 PM] tux_linux
You will probably need the dtb too, iirc the script compiles the zimage and dtb but leaves the dtb in the kernel source


[8/25/2022 10:58 PM] andi15701
hmm, what about a bootscript?


[8/25/2022 10:58 PM] andi15701
somehow my serial adapter seems to have a bad day


[8/25/2022 10:58 PM] tux_linux
well, you can edit the rcS


[8/25/2022 10:58 PM] tux_linux
or the inittab


[8/25/2022 10:59 PM] andi15701
I mean for uboot


[8/25/2022 10:59 PM] tux_linux
I never did that


[8/25/2022 11:01 PM] szybet
rx tx didnt switched?
bad gnd connection?
those arduino cables are bad?


[8/25/2022 11:02 PM] tux_linux
tip: maybe just connect your kobo to another kobo and access the serial port there


[8/25/2022 11:02 PM] andi15701
something has a bad connection, I will try more tomorrow

{Reactions}
👍 

[8/25/2022 11:02 PM] andi15701
my good adaptor is vanished


[8/25/2022 11:02 PM] szybet
herezy


[8/25/2022 11:03 PM] tux_linux
if you really need it
it's a good option


[8/25/2022 11:04 PM] andi15701
the bootloader seems to give me fastboot if started with uuu


[8/25/2022 11:04 PM] andi15701
I have seen some output


[8/25/2022 11:04 PM] andi15701
on serial, but I do not want to fiddle around when I am tired

{Reactions}
👍 

[8/25/2022 11:05 PM] andi15701
last time I just wanted to try something quickly before going to sleep, I had a quite heavy 5v accident


[8/25/2022 11:05 PM] andi15701
killed a kobo


[8/25/2022 11:05 PM] tux_linux
note that fbink in the initrd is in a compressed tar.xz
to run it, `/etc/init.d/inkbox-splash`


[8/25/2022 11:05 PM] tux_linux
whoops


[8/25/2022 11:19 PM] andi15701
=> load mmc 0:1 0x82000000 /zImage-root
11305544 bytes read in 700 ms (15.4 MiB/s)
=> setenv bootargs root=/dev/ram0 console=ttymxc0,115200
=> boo<INTERRUPT>
=> load mmc 0:1 0x81800000 /imx6sll-kobo-clarahd.dtb
28839 bytes read in 18 ms (1.5 MiB/s)
=> bootz 0x82000000 - 0x81800000
Kernel image @ 0x82000000 [ 0x000000 - 0xac8248 ]
## Flattened Device Tree blob at 81800000
   Booting using the fdt blob at 0x81800000
   Loading Device Tree to 9ef8f000, end 9ef990a6 ... OK

Starting kernel ...

[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.200298] debugfs: Directory 'dummy-iomuxc-gpr@20e4000' with parent 'regmap' already present!
[    1.601350] cyttsp5_i2c_adapter 1-0024: cyttsp5_get_hid_descriptor_: failed to get HID descriptor length and version, rc=-6
[    1.624538] cyttsp5_i2c_adapter 1-0024: cyttsp5_startup_: Error on getting HID descriptor r=-6
[    1.846696] cyttsp5_i2c_adapter 1-0024: cyttsp5_read_input: Error getting report, r=-6
[    4.085172] Warning: unable to open an initial console.


[8/25/2022 11:19 PM] andi15701
I could not resist


[8/25/2022 11:19 PM] andi15701
probably no /dev/console for some reason


[8/25/2022 11:19 PM] tux_linux
well, great, but it seems the device nodes script didn't run


[8/25/2022 11:20 PM] tux_linux
what's in `initrd/n249/dev`?


[8/25/2022 11:20 PM] andi15701
CONFIG_DEVTMPFS_MOUNT=y


[8/25/2022 11:21 PM] andi15701
nothing


[8/25/2022 11:21 PM] tux_linux
you don't need to set bootargs I think


[8/25/2022 11:21 PM] tux_linux
strange


[8/25/2022 11:21 PM] tux_linux
hmm


[8/25/2022 11:21 PM] tux_linux
did you clone the repo before and not pull it for a long time?


[8/25/2022 11:21 PM] andi15701
no


[8/25/2022 11:21 PM] andi15701
just fresh checkout


[8/25/2022 11:21 PM] andi15701
the commands you gave


[8/25/2022 11:21 PM] tux_linux
then try `sudo env GITDIR="${PWD}" scripts/make_devicenodes.sh`


[8/25/2022 11:22 PM] tux_linux
oh, maybe I forgot the clara in that script


[8/25/2022 11:23 PM] tux_linux
```
        cd ${GITDIR}/initrd/n249
        make_nodes 2>/dev/null
```
hmm no, should work


[8/25/2022 11:25 PM] andi15701
+ cd /home/build/inkbox/kernel/initrd/n249
+ make_nodes
+ mkdir -p dev
+ sudo mknod dev/console c 5 1
mknod: dev/console: Operation not permitted
+ sudo mknod dev/null c 1 3
mknod: dev/null: Operation not permitted


[8/25/2022 11:25 PM] tux_linux
uh??


[8/25/2022 11:25 PM] tux_linux
are you root?


[8/25/2022 11:26 PM] andi15701
well, yes and no


[8/25/2022 11:26 PM] tux_linux
which means


[8/25/2022 11:26 PM] andi15701
I am running in an unpriviled lxc container


[8/25/2022 11:27 PM] tux_linux
ah well


[8/25/2022 11:27 PM] tux_linux
that probably isn't helping


[8/25/2022 11:27 PM] andi15701
so I cannot create devicenodes on the host file system


[8/25/2022 11:27 PM] tux_linux
I can compile you a kernel


[8/25/2022 11:27 PM] tux_linux
hang on


[8/25/2022 11:29 PM] andi15701
I can also do it, I just have not thought about it


[8/25/2022 11:29 PM] andi15701
but now it is really time to sleep


[8/25/2022 11:29 PM] tux_linux
ok, good night


[8/25/2022 11:30 PM] tux_linux
it's compiling now


[8/25/2022 11:37 PM] tux_linux
http://pkgs-inkbox.duckdns.org:25560/misc/zImage-root


[8/26/2022 8:08 AM] andi15701
Linux inkbox 5.16.0 #1 SMP Fri Aug 26 05:37:29 UTC 2022 armv7l GNU/Linux
InkBox OS, kernel build lpybvigS, commit 0627009
Copyright (C) 2021-2022 Nicolas Mailloux <nicolecrivain@gmail.com>

Checking filesystems ...

e2fsck 1.46.2 (28-Feb-2021)
pmOS_boot was not cleanly unmounted, check forced.
Pass 1: Checking inodes, blocks, and sizes

Pass 2: Checking directory structure
Pass 3: Checking directory connectivity
Pass 4: Checking reference counts
Pass 5: Checking group summary information
pmOS_boot: 21/118784 files (23.8% non-contiguous), 67247/475136 blocks
e2fsck 1.46.2 (28-Feb-2021)
pmOS_root: clean, 74385/1916928 files, 362261/7666688 blocks
e2fsck 1.46.2 (28-Feb-2021)
/usr/bin/fsck.ext4: No such file or directory while trying to open /dev/mmcblk0p3
Possibly non-existent device?
e2fsck 1.46.2 (28-Feb-2021)
/usr/bin/fsck.ext4: No such file or directory while trying to open /dev/mmcblk0p4
Possibly non-existent device?

(initrd) Hit any key to stop auto-boot ... 
Utility root filesystem's signature is invalid! Shutting down ...
/etc/init.d/inkbox-splash: line 130: can't create /sys/class/graphics/fb0/rotate: nonexistent directory

[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
awk: cmd. line:1: Unexpected end of string


[8/26/2022 8:08 AM] andi15701
so no /sys


[8/26/2022 8:21 AM] tux_linux
Probably not
You can experiment in the shell


[8/26/2022 8:21 AM] tux_linux
Stop auto boot


[8/26/2022 8:22 AM] andi15701
and delete quiet from the forced cmdline...

{Reactions}
👍 

[8/26/2022 8:22 AM] tux_linux
It needs to have the module loaded
You will find them in /opt/modules.sqsh and mount them in /lib/modules (create dir if it doesn't exist)


[8/26/2022 8:24 AM] tux_linux
Though you can do dmesg


[8/26/2022 8:31 AM] andi15701
first of all, the make_devicenodes.sh script has annoyed me too much


[8/26/2022 8:31 AM] andi15701
it gets its sentence


[8/26/2022 8:33 AM] tux_linux
In what way


[8/26/2022 8:34 AM] tux_linux
It was written by 15 year old me with next to no experience in sh in 2021


[8/26/2022 8:37 AM] andi15701


{Attachments}
/mnt/data/projects/git/conversations/media/0001-remove-make_devicenodes-script-62911.patch


[8/26/2022 8:37 AM] andi15701
just apply that file with git am 0001-remove-make_devicenodes-script.patch


[8/26/2022 8:40 AM] tux_linux
Oh, nice


[8/26/2022 8:40 AM] tux_linux
Do you handle if conditions in the make_nodes functions?


[8/26/2022 8:40 AM] andi15701
yes


[8/26/2022 8:41 AM] andi15701
--- /dev/null
+++ b/initrd/devnodes-bpi.txt
@@ -0,0 +1,3 @@
+nod dev/console 0620 0 0 c 5 1
+nod dev/null 0666 0 0 c 1 3
+nod dev/ttyAMA0 0660 0 0 c 204 64
diff --git a/initrd/devnodes-emu.txt b/initrd/devnodes-emu.txt
new file mode 100644
index 0000000000..f74c1f84f9
--- /dev/null
+++ b/initrd/devnodes-emu.txt
@@ -0,0 +1,3 @@
+nod dev/console 0620 0 0 c 5 1
+nod dev/null 0666 0 0 c 1 3
+nod dev/ttyS0 0660 0 0 c 4 64
diff --git a/initrd/devnodes-imx.txt b/initrd/devnodes-imx.txt
new file mode 100644
index 0000000000..f3b713b472
--- /dev/null
+++ b/initrd/devnodes-imx.txt
@@ -0,0 +1,3 @@
+nod dev/console 0620 0 0 c 5 1
+nod dev/null 0666 0 0 c 1 3
+nod dev/ttymxc0 0660 0 0 c 207 16


[8/26/2022 8:43 AM] tux_linux
Good


[8/26/2022 9:18 AM] andi15701
ok, need to work


[8/26/2022 9:19 AM] andi15701
i got into shell and I could get modules unsquashed


[8/26/2022 9:19 AM] andi15701
and something loaded


[8/26/2022 12:26 PM] andi15701
btw: we have / # cat /sys/firmware/devicetree/base/compatible 
kobo,clarahdfsl,imx6sll/ # 
/ # cat /sys/firmware/devicetree/base/mo /sys/firmware/devicetree/base/model
Kobo Clara HD/ # 
/ #


[8/26/2022 12:26 PM] andi15701
with well-behaved kernels

{Reactions}
👍 

[8/26/2022 12:27 PM] andi15701
and even on kobo-vendor kernels with devicetree, there is at least the processor type visible


[8/26/2022 12:29 PM] andi15701
probably it is a good idea to check that first whenever device-specific stuff is used


[8/26/2022 5:54 PM] andi15701
well, that sudo incident. For the devicenodes, no root is involved anymore. The new text file is directly converted. I also think everything else in the initramfs also does not need sudo because it is set to uid/gid in the archive by the kernel scripts anyways


[8/26/2022 5:58 PM] tux_linux
Yeah, when I first wrote the script I really didn't know about all of this
Also, it's so badly written, I have fixed some locally already, it will be pushed soon


[8/26/2022 5:59 PM] tux_linux
I'm also in the process of rewriting the rcS in C


[8/26/2022 5:59 PM] tux_linux
https://github.com/Kobo-InkBox/inkbox-os-init/blob/main/init.c

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/main/init.c
inkbox-os-init/init.c at main · Kobo-InkBox/inkbox-os-init
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[8/26/2022 7:02 PM] andi15701
well, everybody says after some time, that things are badly written because at that time he/she did not knew better


[8/26/2022 7:02 PM] andi15701
ok, now back to the real problem


[8/26/2022 7:07 PM] tux_linux
well, at that time, I really wrote crap


[8/26/2022 7:29 PM] andi15701
/etc/init.d/inkbox-splash alert_splash


[8/26/2022 7:30 PM] andi15701
that works here


[8/26/2022 7:30 PM] tux_linux
really?


[8/26/2022 7:30 PM] tux_linux
and inkbox-splash with no arguments?


[8/26/2022 7:30 PM] andi15701
empty screen


[8/26/2022 7:30 PM] tux_linux
https://inkbox.ddns.net/wiki/index.php?title=File:N437-_Alert_splash.png
Displays something like this?

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=File:N437-_Alert_splash.png
Index.php


[8/26/2022 7:31 PM] andi15701
alert_splash are two qr codes


[8/26/2022 7:31 PM] tux_linux
yes, and you should see an ascii bomb in the center


[8/26/2022 7:31 PM] tux_linux
like in the picture


[8/26/2022 7:34 PM] andi15701
well, bombs are exploding in around 1800km or so, not on my display


[8/26/2022 7:35 PM] tux_linux
it seems it lacks bitmap printing capability


[8/26/2022 7:46 PM] andi15701


{Attachments}
/mnt/data/projects/git/conversations/media/inkbox-556B9.log3


[8/26/2022 7:47 PM] andi15701
things I did after logging into inkbox shell


[8/26/2022 7:48 PM] tux_linux
did you know that `ifconfig usb0 192.168.0.214` without `up` still sets the interface up?


[8/26/2022 7:48 PM] tux_linux
anyway


[8/26/2022 7:48 PM] tux_linux
good, now what do you think is needed to make bitmap printing work?


[8/26/2022 7:48 PM] tux_linux
and OpenType


[8/26/2022 8:01 PM] andi15701
something not unsquashed?


[8/26/2022 8:01 PM] andi15701
btw:  /lib/firmware/imx/epdc/epdc_PENG060D.fw is required for eink waveform


[8/26/2022 8:02 PM] andi15701
epdc.fw is tried after some quite long timeout


[8/26/2022 8:02 PM] tux_linux
hm ok, can you provide it? I will put it in the initrd


[8/26/2022 8:02 PM] andi15701
so that probably software already chokes before /dev/fb0 is available


[8/26/2022 8:03 PM] andi15701
just symlinking it


[8/26/2022 8:03 PM] tux_linux
can I just change the kernel code to tell it to directly fetch `/lib/epdc.fw`?


[8/26/2022 8:04 PM] andi15701
you can


[8/26/2022 8:06 PM] andi15701
static int mxc_epdc_fb_init_hw(struct fb_info *info)
{
        struct mxc_epdc_fb_data *fb_data = (struct mxc_epdc_fb_data *)info;
        int ret;

        /*
         * Create fw search string based on ID string in selected videomode.
         * Format is "imx/epdc/epdc_[panel string].fw"
         */
        if (fb_data->cur_mode) {
                strcpy(fb_data->fw_str, "imx/epdc/epdc_");
                strcat(fb_data->fw_str, fb_data->cur_mode->vmode->name);
                strcat(fb_data->fw_str, ".fw");
        }


[8/26/2022 8:06 PM] andi15701
probably just change that one


[8/26/2022 8:06 PM] tux_linux
ok thanks


[8/26/2022 8:06 PM] tux_linux
.


[8/26/2022 8:09 PM] andi15701
probably better just disable CONFIG_FW_LOADER_USER_HELPER


[8/26/2022 8:09 PM] tux_linux
```
build@inkbox ~/i/k/k/linux-5.16-n249 (master)> rg epdc.fw
drivers/video/fbdev/mxc/mxc_epdc_fb.c
4747:                   "imx/epdc/epdc.fw", fb_data->dev, GFP_KERNEL, fb_data,

drivers/video/fbdev/mxc/mxc_epdc_v2_fb.c
5568:                   "imx/epdc/epdc.fw", fb_data->dev, GFP_KERNEL, fb_data,
build@inkbox ~/i/k/k/linux-5.16-n249 (master)>
```
I get that


[8/26/2022 8:09 PM] tux_linux
why?


[8/26/2022 8:10 PM] andi15701
and probably CONFIG_FW_LOADER_USER_HELPER_FALLBACK


[8/26/2022 8:10 PM] tux_linux
this reminds me of a @@#%@~@! bug I had on the kindle


[8/26/2022 8:10 PM] andi15701
then the two files can be probed

{Reactions}
👍 

[8/26/2022 8:10 PM] tux_linux
https://www.mobileread.com/forums/showthread.php?t=346698
I got everything working on it except that

{Embed}
https://www.mobileread.com/forums/showthread.php?t=346698
K5 Can't get self-compiled ar6003 module to work - MobileRead Forums
K5 Can't get self-compiled ar6003 module to work Kindle Developer's Corner


[8/26/2022 8:10 PM] andi15701
and there is not that buch delay


[8/26/2022 8:11 PM] andi15701
and we stay a bit more compatible with nxp kernels

{Reactions}
👍 

[8/26/2022 8:11 PM] tux_linux
So I don't change anything in the kernel source but only in the config?


[8/26/2022 8:11 PM] andi15701
yes


[8/26/2022 8:30 PM] andi15701
about the waveform: should we extract it from the unpartitioned space?


[8/26/2022 8:30 PM] andi15701
and rely on it being there


[8/26/2022 8:30 PM] tux_linux
well, we never did that except for the kindle


[8/26/2022 8:30 PM] tux_linux
and the kindle has a built-in one if the emmc one isn't there


[8/26/2022 8:34 PM] andi15701
ok, then here we have a waveform from a kobo clara

{Attachments}
/mnt/data/projects/git/conversations/media/epdc_PENG060D.fw-D52C6.xz


[8/26/2022 8:35 PM] tux_linux
ok thanks


[8/26/2022 8:46 PM] tux_linux
https://github.com/Kobo-InkBox/kernel/commit/74b84d657a810d7dab07a9a7bdab143de47e3414

{Embed}
https://github.com/Kobo-InkBox/kernel/commit/74b84d657a810d7dab07a9a7bdab143de47e3414
N249: Improvements · Kobo-InkBox/kernel@74b84d6
/mnt/data/projects/git/conversations/media/74b84d657a810d7dab07a9a7bdab143de47e3414-5E00A


[8/26/2022 8:47 PM] tux_linux
I also applied your patch in the previous commit


[8/26/2022 10:59 PM] andi15701
and I made one mistake in the final cleanup


[8/26/2022 10:59 PM] andi15701
of that commit


[8/26/2022 10:59 PM] tux_linux
what is it?


[8/26/2022 10:59 PM] andi15701
I switched entries in the initramfs config option


[8/26/2022 11:00 PM] andi15701
I thought it is so trivial, I only need to build-test it


[8/26/2022 11:00 PM] tux_linux
do you have another patch?


[8/26/2022 11:00 PM] andi15701
I am preparing

{Reactions}
👍 

[8/26/2022 11:01 PM] andi15701
but now, the kernel tries to create the device nodes before the /dev directory exists


[8/26/2022 11:01 PM] tux_linux
ah
great


[8/26/2022 11:09 PM] andi15701


{Attachments}
/mnt/data/projects/git/conversations/media/0001-create-dev-before-creating-devicenode-EA883.patch


[8/26/2022 11:16 PM] tux_linux
ok thanks, will apply it


[8/27/2022 1:42 AM] looooooke
I just stumbled across this project, if you guys need any help testing i've got a n249

{Reactions}
👍 

[8/27/2022 1:44 AM] szybet
welcome, im sure you are the 7 person that says that

but i hope you will be the first to actually do something...


[8/27/2022 1:45 AM] looooooke
haha, I dont have much experience with this kind of thing but with some guidance I'm happy to help


[8/27/2022 11:21 AM] andi15701
well, I think I have actually done something


[8/27/2022 11:27 AM] andi15701
The main point is that you actually have to do so much here for a new device.


[8/27/2022 11:32 AM] andi15701
structurize things better for that task


[8/27/2022 11:48 AM] andi15701
the init script was not written with that much experience


[8/27/2022 2:13 PM] andi15701
some rcS hacks so that Kobo Clara HD gets to usb debug and displays a qr code on the screen

{Attachments}
/mnt/data/projects/git/conversations/media/0001-rcS-root-fix-things-for-kobo-clara-hd-9AECC.patch


[8/27/2022 2:14 PM] andi15701
i have not installed anything else from inkbox besides zImage-root and the bootloader +  dtb


[8/27/2022 2:15 PM] andi15701
and on that card there is nothing left from the original system besides parts of the unpartitioned space


[8/27/2022 2:19 PM] andi15701
bootloader needs bootcmd set via environment to actually boot the kernel


[8/27/2022 3:15 PM] tux_linux
Ok great thanks


[8/27/2022 3:46 PM] andi15701
do you have any other devices covered by this kernel?


[8/27/2022 3:46 PM] andi15701
The Kobo Glo HD?


[8/27/2022 3:53 PM] tux_linux
None currently


[8/27/2022 3:54 PM] tux_linux
I'd first like the Clara being fully ported


[8/27/2022 3:58 PM] szybet
could this kernel run on other devices?


[8/27/2022 3:59 PM] andi15701
yes


[8/27/2022 4:01 PM] andi15701
The drm version of it (which contains a epdc driver which does use standard kernel interfaces for refreshing) is used in pmOS for several devices (the Kobo Clara HD, Tolino Shine 2HD (=Kobo Glo HD with some more buttons), Tolino 3 (=Kobo Clara HD with imx6sl instead of 6sll)


[8/27/2022 4:01 PM] andi15701
the non-drm version also runs on these devices


[8/27/2022 4:03 PM] andi15701
only FBInk has to be teached to look at  /sys/firmware/devicetree/base/compatible first before deciding what refresh command to use


[8/27/2022 4:05 PM] tux_linux
Ping NiLuJe for this
Or send him a patch


[8/27/2022 4:08 PM] tux_linux
Oh, you mean, having these in hand? Yes, I have pretty much every one supported by InkBox except the Clara and the Libra (seem to have lost it)


[8/27/2022 4:13 PM] andi15701
So if you have a Kobo Glo HD, and try the Shine2 HD bootloader used in pmOS with the Kobo Clara HD kernel+initrd  and the Shine2 devicetree you should get as far as I am now

{Reactions}
👍 

[8/27/2022 4:14 PM] andi15701
besides of that mentioned FBInk issue


[8/27/2022 4:15 PM] andi15701
I guess that would be a good starting point for cleaning up rcS and stuff


[8/27/2022 4:16 PM] andi15701
and the default branches in any if construction should be for a more clean kernel


[8/27/2022 4:17 PM] szybet
you dont have the nia


[8/27/2022 4:17 PM] szybet
how hard would it be run it on the nia?


[8/27/2022 4:18 PM] szybet
a higher kernel version would be helpfull


[8/27/2022 4:18 PM] andi15701
leds paths have logical patterns there


[8/27/2022 4:18 PM] andi15701
/sys/class/led/device:color:function


[8/27/2022 4:18 PM] andi15701
so you do not need hardcoded paths


[8/27/2022 4:19 PM] andi15701
the nia: what SoC does it have?


[8/27/2022 4:20 PM] szybet
https://github.com/Szybet/niAudio/blob/main/images/nia/img5.jpg

{Embed}
https://github.com/Szybet/niAudio/blob/main/images/nia/img5.jpg
niAudio/img5.jpg at main · Szybet/niAudio
Kobo nia ereader with audio added. Contribute to Szybet/niAudio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/niAudio-7924C


[8/27/2022 4:20 PM] szybet
this one


[8/27/2022 4:20 PM] szybet
https://github.com/Szybet/niAudio/blob/main/images/nia/img6.jpg another image

{Embed}
https://github.com/Szybet/niAudio/blob/main/images/nia/img6.jpg
niAudio/img6.jpg at main · Szybet/niAudio
Kobo nia ereader with audio added. Contribute to Szybet/niAudio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/niAudio-7924C


[8/27/2022 4:21 PM] andi15701
I always thought about adding an alarm function to the Kobo Clara HD


[8/27/2022 4:22 PM] andi15701
but.. who has stolen half the RAM?


[8/27/2022 4:22 PM] szybet
on the nia?


[8/27/2022 4:22 PM] andi15701
yes


[8/27/2022 4:23 PM] szybet
you mean the empty solder pads for another IC?


[8/27/2022 4:24 PM] andi15701
well, no idea what it is. But placing there 256MB chips instead of 512MB should be considered a crime 😉


[8/27/2022 4:26 PM] szybet
well of course

the nia is a "chip shortage" designed device
in my opinion they wanted to release a new device, but no chips were available so they glued together what was there, with no extra features and released it at a high price...


[8/27/2022 4:26 PM] szybet
if i knew i would buy a glo hd


[8/27/2022 4:27 PM] szybet
also the place for another IC is for bluetooth, next to it is a antena connector. There are high chances in the future that they will release a nia bluetooth version


[8/27/2022 4:32 PM] andi15701
and then you connect a bluetooth keyboard to it


[8/27/2022 4:32 PM] andi15701
and work outdoor in the sun


[8/27/2022 4:34 PM] szybet
i dont think eink likes sun light


[8/27/2022 4:36 PM] andi15701
I am using the Kobo Clara HD for navigation purposes on my bicycle, best thing to have in the sun


[8/27/2022 4:36 PM] szybet
i readed somewhere that, so idk


[8/27/2022 4:36 PM] szybet
which navigation software you use?


[8/27/2022 4:37 PM] andi15701
navit if I want to have routing


[8/27/2022 4:37 PM] andi15701
or something homebrewed, if I want to look at bitmap maps


[8/27/2022 4:37 PM] szybet
how did you were able to run it / compile? i had problems with it because of too old glibc


[8/27/2022 4:38 PM] andi15701
I am using Debian bullseye


[8/27/2022 4:38 PM] andi15701
and just apt-get install


[8/27/2022 4:38 PM] szybet
this explains a bit


[8/27/2022 4:38 PM] szybet
and xorg?


[8/27/2022 4:39 PM] andi15701
Xorg with patched fbdev driver (or just plain modesetting driver without patches if I am using the drm kernel variant)


[8/27/2022 4:40 PM] szybet
it works well i quess?
navit has an sailfish os port which uses qt, and is able to use qt platform plugins, it might work better than xorg
but i was not able to compile it


[8/27/2022 4:41 PM] andi15701
It works well


[8/27/2022 4:42 PM] andi15701
I do not think qt will bring so much advantage


[8/27/2022 4:43 PM] andi15701
as long as something catches Xorg damage events and generates display refreshes, everything is fine


[8/27/2022 4:43 PM] szybet
well i would want to compile it at all, but glibc :(


[8/27/2022 4:43 PM] szybet
so how is the hope for this?


[8/27/2022 4:45 PM] andi15701
so with a devicetree supported should be: CPU, RTC, Battery monitoring, the EPDC PMIC, probably also the display


[8/27/2022 4:45 PM] andi15701
what FCC ID does it have?


[8/27/2022 4:45 PM] szybet
um i dont know


[8/27/2022 4:46 PM] andi15701
https://apps.fcc.gov/eas/GetApplicationAttachment.html?id=4694219


[8/27/2022 4:46 PM] andi15701
so this one?


[8/27/2022 4:47 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-08171.png


[8/27/2022 4:47 PM] szybet
🤨


[8/27/2022 4:49 PM] andi15701
www.fcc.io


[8/27/2022 4:49 PM] andi15701
enter


[8/27/2022 4:49 PM] andi15701
NOIKBN306


[8/27/2022 4:50 PM] andi15701
the second detail link


[8/27/2022 4:50 PM] andi15701
then internal photos


[8/27/2022 4:51 PM] szybet
wow those are quality photos


[8/27/2022 4:51 PM] szybet
thats the nia for sure


[8/27/2022 4:57 PM] andi15701
&uart3 {
        pinctrl-names = "default","sleep";
        fsl,uart-has-rtscts;
        fsl,dte-mode;
        pinctrl-0 = <&pinctrl_uart3_dte>, <&pinctrl_bt>;
        pinctrl-1 = <&pinctrl_uart3_dte_sleep>;
        status = "okay";
};


[8/27/2022 4:57 PM] andi15701
_bt ... = bluetooh?!


[8/27/2022 4:57 PM] szybet
you get this from nia device tree?


[8/27/2022 4:58 PM] andi15701
yes


[8/27/2022 4:58 PM] szybet
well as i said


[8/27/2022 4:58 PM] szybet
they planed it but a chip was missing


[8/27/2022 4:58 PM] szybet
¯\_(ツ)_/¯


[8/27/2022 5:25 PM] tux_linux
Absolutely


[8/27/2022 5:26 PM] tux_linux
Well yeah, because you have a fair kernel
On InkBox we are stuck at Jessie to ensure it's compatible for all devices 😢


[8/27/2022 5:30 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/Screenshot_20220827-113002-4C1DD.png


[8/27/2022 5:30 PM] tux_linux
Note that only recent devices kernels are modprobe-enabled


[8/27/2022 5:32 PM] tux_linux
So will you make a patch for FBInk so that it can display bitmap?


[8/27/2022 5:32 PM] tux_linux
True


[8/27/2022 5:33 PM] andi15701
I do not really understand the problem correctly


[8/27/2022 5:33 PM] andi15701
it can refresh the screen


[8/27/2022 5:33 PM] andi15701
and the qr code should be nothing else


[8/27/2022 5:34 PM] tux_linux
Yeah, it's strange it can display pictures but not text


[8/27/2022 5:34 PM] andi15701
maybe the font is missing?


[8/27/2022 5:34 PM] tux_linux
I did not enable squashfs xz support in kernel?


[8/27/2022 5:34 PM] andi15701
in kernel it is enabled


[8/27/2022 5:34 PM] andi15701
but not in busybox


[8/27/2022 5:35 PM] tux_linux
unsquashfs


[8/27/2022 5:35 PM] tux_linux
Ok


[8/27/2022 5:35 PM] tux_linux
Not busybox
But standalone program


[8/27/2022 5:35 PM] tux_linux
If it works on every other device...


[8/27/2022 5:36 PM] tux_linux
Maybe look in the inbox splash script, might there be some stupid forgotten if conditions


[8/27/2022 5:36 PM] andi15701
where does the font come from?


[8/27/2022 5:36 PM] tux_linux
Built-in


[8/27/2022 5:36 PM] tux_linux
In the binary


[8/27/2022 5:59 PM] andi15701
/ # LD_LIBRARY_PATH=/opt/fbink /opt/fbink/fbink -x 1 -y 1 "Hello World"
[FBInk] Couldn't find a Kobo version tag (onboard unmounted or not running on a Kobo?)!
[FBInk] Detected a Kobo Clara HD (376 => Nova @ Mark 7)
[FBInk] Enabled Kobo Mark 7 quirks
[FBInk] Clock tick frequency appears to be 100 Hz
[FBInk] Screen density set to 300 dpi
[FBInk] Variable fb info: 1072x1448, 16bpp @ rotation: 3 (Counter Clockwise, 270°)
[FBInk] Fixed fb info: ID is "mxc_epdc_fb", length of fb mem: 6782976 bytes & line length: 2176 bytes
[FBInk] Canonical rotation: 0 (Upright, 0°)
[FBInk] Fontsize set to 24x24 (IBM base glyph size: 8x8)
[FBInk] Line length: 44 cols, Page size: 60 rows
[FBInk] Vertical fit isn't perfect, shifting rows down by 4 pixels
[FBInk] Pen colors set to #000000 for the foreground and #FFFFFF for the background
Printing string 'Hello World' @ column 1 + 0px, row 1 + 0px (overlay: N, no BG: N, no FG: N, inverted: N, flashing: N, centered: N, halfway: N, left padded: N, right padded: N, clear screen: N, waveform: AUTO, dithering: PASSTHROUGH, nightmode: N, skip refresh: N, font: 0, font scaling: x0)
Next line should start @ row 2
/ #


[8/27/2022 5:59 PM] andi15701
works


[8/27/2022 5:59 PM] tux_linux
Oh ok


[8/27/2022 5:59 PM] tux_linux
Strange


[8/27/2022 6:13 PM] andi15701
elif [ "${1}" == "usb_debug" ]; then                                                                                                                   
        LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink "-k" "-f" "-h"  -q                                                          
        sleep 0.9                                                                                 
        LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink "-t" "regular=/opt/fbink/inter-b.ttf,size=30" "USB Debug" "-w" "-m" "-M" "-h" -q
        print_qr "https://inkbox.ddns.net/wiki/index.php?title=Boot-time_USB_debug_mode" invert                                                            
        #LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink -s                                                                                      
                                                                                                                                                                                              
else


[8/27/2022 6:13 PM] andi15701
this works


[8/27/2022 6:15 PM] tux_linux
The QR and the text?


[8/27/2022 6:16 PM] andi15701
yes


[8/27/2022 6:16 PM] andi15701
sleeping there is important


[8/27/2022 6:16 PM] tux_linux
try `-w`


[8/27/2022 6:16 PM] tux_linux
instead of sleeping


[8/27/2022 6:18 PM] ninuje
Better: drop the refreshes in the two draw calls, and keep the final full-screen one

{Reactions}
👍 

[8/27/2022 6:18 PM] ninuje
(`-b` in the two draw calls, and drop the refresh related stuff from that because it becomes meaningless)


[8/27/2022 6:20 PM] ninuje
`fbink -qbhk` into `fbink -t blah bloop -qbmMh` into `fbink -qfws`


[8/27/2022 6:23 PM] ninuje
(I've finished reordering flags now, promise ;p)


[8/27/2022 6:24 PM] ninuje
(k and s need to come last because getsubopt)


[8/27/2022 6:27 PM] ninuje
Even better: drop the dedicated clear, because it's useless if you draw something later


[8/27/2022 6:27 PM] ninuje
Just pop a `-c` in the first draw


[8/27/2022 6:27 PM] ninuje
`fbink -t blah bloop -qbcmMh` into `fbink -qfws`


[8/27/2022 6:28 PM] ninuje
I imagine whatever `print_qr` does needs the same tweak (`-b`) to drop its refresh


[8/27/2022 6:28 PM] ninuje
(I, err, feel like I already explained that at least 3 times, oh, well :D)


[8/27/2022 6:35 PM] andi15701
elif [ "${1}" == "usb_debug" ]; then                                                                                                                          
        LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink "-t" "regular=/opt/fbink/inter-b.ttf,size=30" "USB Debug" -qbmhM                   
        print_qr "https://inkbox.ddns.net/wiki/index.php?title=Boot-time_USB_debug_mode" invert                                                               
        LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink -s                                                                          
                                                                                                                                                       
else


[8/27/2022 6:36 PM] andi15701
if [ "${2}" == "invert" ]; then                                                                                                                       
                LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink -qhb -g file=/tmp/out.png,halign=CENTER,valign=TOP,y=60                    
                LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink -qhb -g file=/tmp/out.png,halign=CENTER,valign=BOTTOM,y=-50                
        else                                                                                                                                                  
                LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink -qb -g file=/tmp/out.png,halign=CENTER,valign=TOP,y=60                     
                LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink -qb -g file=/tmp/out.png,halign=CENTER,valign=BOTTOM,y=-50          
        fi                                                                                                                                                    
        rm -f /splash/tmp/out.png &>/dev/null


[8/27/2022 6:37 PM] ninuje
I assume the second snippet is `print_qr` ;). Missed a `-c` in the "USB Debug" text, but that's it, yeah

{Reactions}
👍 

[8/27/2022 6:38 PM] ninuje
And possibly a `-f` in the refresh if we want a flash


[8/27/2022 6:38 PM] ninuje
And a `-w` if we want to wait for it


[8/27/2022 6:38 PM] ninuje
(i.e., block for 450ms ;p)


[8/27/2022 6:38 PM] tux_linux
no flash, it prints that in batch, only an initial flash is needed


[8/27/2022 6:38 PM] ninuje
That *would* make it the initial ;o)


[8/27/2022 6:38 PM] ninuje
That's the point of batching


[8/27/2022 6:39 PM] tux_linux
I'm not sure when it prints the ascii bomb, before or after


[8/27/2022 6:40 PM] tux_linux
it's before, actually
https://github.com/Kobo-InkBox/kernel/blob/74b84d657a810d7dab07a9a7bdab143de47e3414/initrd/common/inkbox-splash#L194


[8/27/2022 6:42 PM] andi15701
i am cleaning up a bit


[8/27/2022 6:42 PM] ninuje
Same dealio there, drop the dedicated clear, pop a `-c` in the bomb draw, and flash that. Or just batch it with the rest


[8/27/2022 6:42 PM] ninuje
depending on whether the two can mix or not


[8/27/2022 6:43 PM] tux_linux
please try to follow
https://inkbox.ddns.net/wiki/index.php?title=InkBox_project_code_contributing_guidelines

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=InkBox_project_code_contributing_guidelines
Index.php


[8/27/2022 6:52 PM] andi15701
well, if I add a -c in the bomb draw only the last line appears


[8/27/2022 7:03 PM] ninuje
That makes sense, assuming it's multiline, yeah 😉


[8/27/2022 7:05 PM] ninuje
I was thinking of my own approach to the bomb crash screen, which uses nerdfont, so it's a single codepoint in a truetype font


[8/27/2022 8:48 PM] andi15701


{Attachments}
/mnt/data/projects/git/conversations/media/0001-inkbox-splash-refresh-only-once-214D9.patch

{Reactions}
👍 

[8/27/2022 8:48 PM] tux_linux
thanks


[8/27/2022 8:50 PM] ninuje
Stray leading whitespace in the first + of the second hunk 😉


[8/27/2022 8:51 PM] ninuje
And the refresh in that hunk is not in quiet mode either, no idea if that's on purpose 😉


[8/27/2022 8:52 PM] tux_linux
it should be quiet


[8/27/2022 11:55 PM] andi15701
fixed

{Attachments}
/mnt/data/projects/git/conversations/media/0001-inkbox-splash-refresh-only-once-F0901.patch

{Reactions}
👍 

[8/29/2022 8:33 PM] cieldautomne
I have a few days off until the end of September, I can help a little!

{Reactions}
👍 

[8/29/2022 8:56 PM] szybet
@tux-linux


[8/29/2022 8:56 PM] szybet
oh you already saw it


[8/29/2022 8:56 PM] szybet
nevermind


[9/3/2022 9:21 PM] zenlou
man, I wish I could understand half of what's going on here :LUL:


[9/3/2022 9:28 PM] szybet
its never late to learn


[9/3/2022 9:34 PM] zenlou
well where would I start?


[9/3/2022 9:34 PM] zenlou
what am I even looking at


[9/3/2022 9:34 PM] szybet
learn linux


[9/3/2022 9:34 PM] szybet
first


[9/3/2022 9:34 PM] szybet
till a good point


[9/3/2022 9:34 PM] zenlou
I think I got that far


[9/3/2022 9:35 PM] the.mightydill
do LFS


[9/3/2022 9:35 PM] the.mightydill
:p


[9/3/2022 9:35 PM] szybet
well then learn basics of programming


[9/3/2022 9:35 PM] the.mightydill
^


[9/3/2022 9:35 PM] the.mightydill
like bash, C++, etc


[9/3/2022 9:35 PM] zenlou
:thinklua:


[9/3/2022 9:35 PM] zenlou
next up?


[9/3/2022 9:36 PM] the.mightydill
you know lua?


[9/3/2022 9:36 PM] the.mightydill
do you know bash or c++ though


[9/3/2022 9:36 PM] zenlou
bash I do


[9/3/2022 9:36 PM] szybet
lua is bash and cpp combined in a metaphoric way


[9/3/2022 9:36 PM] szybet
so good


[9/3/2022 9:36 PM] zenlou
C++, ehhhh. I think I can read it


[9/3/2022 9:37 PM] szybet
well then a bit of electronic background


[9/3/2022 9:37 PM] szybet
like what is serial voltage etc


[9/3/2022 9:37 PM] szybet
and you should be fine


[9/3/2022 9:37 PM] tux_linux
you should read about embedded linux on arm


[9/3/2022 9:37 PM] szybet
i havent anything


[9/3/2022 9:38 PM] szybet
i didn't even play arround with rpi


[9/3/2022 9:38 PM] szybet
and i understand most of the things here are going on


[9/3/2022 9:38 PM] tux_linux
pi isn't embedded linux


[9/3/2022 9:38 PM] szybet
why?


[9/3/2022 9:39 PM] tux_linux
when people say "use a rpi for doing that, or that", i'm like cmon, you could use a microcontroller or just a smaller linux board to do this, it's overpowered


[9/3/2022 9:39 PM] tux_linux
imo


[9/3/2022 9:39 PM] szybet
easy linux embeded on arm with some power ups?


[9/3/2022 9:40 PM] szybet
overpriced too 🥴


[9/3/2022 9:40 PM] tux_linux
actually doesn't fit the definition
https://en.wikipedia.org/wiki/Embedded_system

{Embed}
https://en.wikipedia.org/wiki/Embedded_system
Embedded system
An embedded system is a computer system—a combination of a computer processor, computer memory, and input/output peripheral devices—that has a dedicated function within a larger mechanical or electronic system. It is embedded as part of a complete device often including electrical or electronic hardware and mechanical parts. 
Because an embedded...
/mnt/data/projects/git/conversations/media/1200px-DHCOM_Computer_On_Module_-_AM35x-2FC5E.jpg


[9/3/2022 9:41 PM] szybet
dont use rpi, use arduino -> dont use arduino, use 555 IC -> dont use 555 IC, some simple transistors can do the job


[9/3/2022 9:41 PM] szybet
😄


[9/3/2022 9:41 PM] szybet
in which place


[9/3/2022 9:41 PM] tux_linux
rpi


[9/3/2022 9:42 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-73D55.png


[9/3/2022 9:42 PM] szybet
?


[9/4/2022 1:52 AM] the.mightydill
but rpi is essentially a complete computer


[9/4/2022 12:04 PM] szybet
so what is embedded linux anyway?


[9/4/2022 12:04 PM] szybet
https://youtu.be/1dwu4iVA1yo


[9/5/2022 2:10 PM] anovella
https://wiki.postmarketos.org/wiki/Kobo_Clara_HD_(kobo-clara)

{Embed}
https://wiki.postmarketos.org/wiki/Kobo_Clara_HD_(kobo-clara)
Kobo Clara HD (kobo-clara)


[9/5/2022 2:10 PM] anovella
You cannot use things from this?


[9/5/2022 2:39 PM] szybet
we are


[9/5/2022 2:39 PM] szybet
andi is using this for sure


[9/5/2022 2:39 PM] szybet
he is the inventor? maybe


[9/5/2022 3:41 PM] andi15701
I am maintaining the kernel behind that


[9/5/2022 3:42 PM] andi15701
Basically I am trying to get things as close to mainline a possible


[9/5/2022 3:43 PM] andi15701
I played a bit around wit Inkbox and got things to the point it booted to show something


[9/5/2022 5:25 PM] andi15701
for the pmOS support, somebody else took my kernel and created the pmOS packages around it


[9/5/2022 5:26 PM] andi15701
and the device packages


[9/5/2022 5:26 PM] andi15701
I then added device packages for other devices as well


[9/5/2022 5:26 PM] andi15701
using the same kernel


[9/5/2022 10:38 PM] andi15701
what is the path to go further here?


[9/5/2022 10:39 PM] andi15701
since there is at least an rcS-root  doing stuff


[9/5/2022 10:41 PM] tux_linux
So we are certain that FBInk works?


[9/5/2022 11:12 PM] andi15701
we have seen these various qr-codes


[9/5/2022 11:14 PM] tux_linux
yes, and bitmap font printing seems to work too right?


[9/5/2022 11:16 PM] andi15701
seems so


[9/5/2022 11:22 PM] tux_linux
so a partition layout would be needed


[9/5/2022 11:23 PM] tux_linux
https://github.com/Kobo-InkBox/emu/blob/main/sd/sd-layout

{Embed}
https://github.com/Kobo-InkBox/emu/blob/main/sd/sd-layout
emu/sd-layout at main · Kobo-InkBox/emu
InkBox OS emulator. Contribute to Kobo-InkBox/emu development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/emu-B44AF


[9/5/2022 11:23 PM] tux_linux
pretty much the same, except you need to change the first sector not to eat your unpartitionned space


[9/5/2022 11:31 PM] andi15701
last partition: as big as possible?


[9/5/2022 11:32 PM] andi15701
then we can leave out size


[9/5/2022 11:33 PM] szybet
for standard inkbox, yes


[9/5/2022 11:33 PM] szybet
for dual boot, idk


[9/5/2022 11:33 PM] andi15701
lets start with standard


[9/5/2022 11:35 PM] andi15701
reason: the kernel supports several ebookreaders, even some with a 3.0.35 vendor kernel, so I would like to streamline the simpliest case here first


[9/5/2022 11:36 PM] andi15701
so in a nice world we would just replace bootloader + devicetree and we are done


[9/5/2022 11:36 PM] andi15701
with the next reader


[9/5/2022 11:37 PM] tux_linux
yes, but it's not strictly necessary


[9/5/2022 11:37 PM] tux_linux
at least not here on the Clara


[9/5/2022 11:38 PM] andi15701
I am talking about quickly porting the next one supported by my near-mainline kernels


[9/5/2022 11:38 PM] andi15701
when Clara is done


[9/5/2022 11:39 PM] tux_linux
yes


[9/5/2022 11:39 PM] tux_linux
you might want to look into imgtool script for details on how an image is made


[9/5/2022 11:39 PM] tux_linux
https://github.com/Kobo-InkBox/imgtool/blob/main/release.bash

{Embed}
https://github.com/Kobo-InkBox/imgtool/blob/main/release.bash
imgtool/release.bash at main · Kobo-InkBox/imgtool
Reproducible image builder for InkBox OS. Contribute to Kobo-InkBox/imgtool development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/imgtool-0EE5B


[9/5/2022 11:40 PM] tux_linux
I usually make images from scratch first then integrate them into imgtool


[11/20/2022 4:50 PM] szybet
here


[11/20/2022 4:50 PM] szybet
did you readed the chat through?


[11/20/2022 4:50 PM] atro_atro
Here I am


[11/20/2022 4:51 PM] atro_atro
I read a lot of the early messages, and some of the last ones


[11/20/2022 4:51 PM] szybet
good


[11/20/2022 4:52 PM] szybet
can you estabalish a serial connection?


[11/20/2022 4:53 PM] szybet
dont do something that you arent certain - it could damage the device


[11/20/2022 4:53 PM] atro_atro
I'm a noob when it comes to embedded


[11/20/2022 4:53 PM] atro_atro
Can you be more specific? I can send photos


[11/20/2022 4:53 PM] szybet
do you have a solder station?


[11/20/2022 4:53 PM] atro_atro
Nope


[11/20/2022 4:53 PM] szybet
can you solder?


[11/20/2022 4:53 PM] szybet
okay


[11/20/2022 4:53 PM] atro_atro
Nope


[11/20/2022 4:53 PM] szybet
hmmm so


[11/20/2022 4:54 PM] szybet
get touch some ground to eliminate static energy


[11/20/2022 4:54 PM] atro_atro
Okay


[11/20/2022 4:55 PM] szybet
and dont touch anything on the ereader


[11/20/2022 4:55 PM] szybet
be gentle with the sd card port


[11/20/2022 4:55 PM] atro_atro
Should I insert an SD in the ereader?


[11/20/2022 4:55 PM] szybet
no


[11/20/2022 4:56 PM] szybet
im only talking with caution


[11/20/2022 4:56 PM] szybet
can you show me your serial adapter?


[11/20/2022 4:56 PM] atro_atro
Gotcha, thanks for that


[11/20/2022 4:57 PM] szybet
wrong chat


[11/20/2022 4:57 PM] szybet
and the cables?


[11/20/2022 4:59 PM] szybet
wrong chat one more time


[11/20/2022 4:59 PM] szybet
good


[11/20/2022 4:59 PM] atro_atro
Sorry, wrong chat again


[11/20/2022 4:59 PM] szybet
can you show me the pcb of the clara?


[11/20/2022 5:04 PM] atro_atro
Best light I could find

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221120_170327_143-8294C.jpg


[11/20/2022 5:05 PM] atro_atro
Another one with better light from the chat, I think it's a different hardware version but very close to mine

{Attachments}
/mnt/data/projects/git/conversations/media/HighResGloAndClaraAnnotated-9940C.jpg


[11/20/2022 5:07 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-DCD95.png


[11/20/2022 5:07 PM] szybet
we will focus on that


[11/20/2022 5:07 PM] szybet
do you have some tape?


[11/20/2022 5:08 PM] szybet
such one, or just transparent

{Attachments}
/mnt/data/projects/git/conversations/media/image-DD650.png


[11/20/2022 5:14 PM] atro_atro
I will buy some real quick


[11/20/2022 5:15 PM] andi15701
hmm, inkbox was in the cala was in the state that usb access is already working


[11/20/2022 5:17 PM] andi15701
it is always good to have a serial connection


[11/20/2022 5:17 PM] atro_atro
@andi should I just flash something to the SD and boot it up?


[11/20/2022 5:18 PM] andi15701
if you feel not confident with serial connection, than you can try


[11/20/2022 5:18 PM] atro_atro
If you suggest getting the serial connection first I'll be happy to get some tape and try


[11/20/2022 5:19 PM] atro_atro
I will be right back


[11/20/2022 5:23 PM] szybet
its helpfull


[11/20/2022 5:23 PM] szybet
to fully port inkbox, it is neccesery


[11/20/2022 5:25 PM] atro_atro
Store is closed, I'll buy that yellow tape online


[11/20/2022 5:25 PM] szybet
a simple transpent one is good too


[11/20/2022 5:25 PM] szybet
your preference


[11/20/2022 5:26 PM] atro_atro
That one seems better for circuits


[11/20/2022 5:26 PM] szybet
we only dont want a short with the metal below the serial port


[11/20/2022 5:26 PM] szybet
thats all


[11/20/2022 5:27 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-BA3A1.png


[11/20/2022 5:27 PM] szybet
do you have a usb cable for this adapter?


[11/20/2022 5:27 PM] szybet
its mini b - its rare


[11/20/2022 5:28 PM] atro_atro
Yes, that's the one I use for my STM32 board


[11/20/2022 5:28 PM] szybet
good


[11/20/2022 5:30 PM] andi15701
first check: is there everything of my work upstream?


[11/20/2022 5:30 PM] szybet
IDK


[11/20/2022 5:30 PM] andi15701
i will


[11/20/2022 5:30 PM] andi15701
check


[11/20/2022 5:31 PM] andi15701
since we have initrd+kernel,  next step should be image creation


[11/20/2022 5:32 PM] andi15701
ok, two patches missing


[11/20/2022 5:33 PM] szybet
first we should make it with bare hands, then the script


[11/20/2022 5:39 PM] andi15701
uploading the missing patch


[11/20/2022 5:39 PM] andi15701
to #patches


[11/20/2022 5:42 PM] szybet
well @tux-linux is offline


[11/20/2022 5:43 PM] szybet
actually not


[11/20/2022 5:43 PM] szybet
actually yes


[11/20/2022 5:43 PM] szybet
well not


[11/20/2022 5:43 PM] szybet
and i dont have permissions to the repo


[11/20/2022 5:45 PM] tux_linux
I think I put only one of Andi's patches in the repo
The other one is missing
Right?


[11/20/2022 5:52 PM] andi15701
the one I  posted


[11/20/2022 5:52 PM] andi15701
is apparently missing


[11/21/2022 3:47 PM] szybet
Here is what you need to do with the tape:
https://user-images.githubusercontent.com/53944559/183510614-dddab2b1-51b0-42ae-a84b-d555c46c2ae4.jpg

here is the description:
https://github.com/Szybet/niAudio/blob/main/case/guide.md

i hope its possible on the clara

{Embed}
https://user-images.githubusercontent.com/53944559/183510614-dddab2b1-51b0-42ae-a84b-d555c46c2ae4.jpg
/mnt/data/projects/git/conversations/media/183510614-dddab2b1-51b0-42ae-a84b-d555c46c-8D01E.jpg

{Embed}
https://github.com/Szybet/niAudio/blob/main/case/guide.md
niAudio/guide.md at main · Szybet/niAudio
Kobo nia ereader with audio added. Contribute to Szybet/niAudio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/niAudio-613C3


[11/21/2022 3:49 PM] szybet
if you want be extra safe, disconnect the battery with something non conductive, like a wooden tooth stick, click thr power button a few times for arround 2s to discharge the capacitors, and put the tape arround - next to the serial connection. So if it will slip, less worries in that


[11/21/2022 3:49 PM] szybet
be very carefull while doing everything


[11/22/2022 6:30 PM] atro_atro
Kapton tape arrived, I disconnected the battery and attached the tape


[11/22/2022 6:30 PM] atro_atro


{Attachments}
/mnt/data/projects/git/conversations/media/rn_image_picker_lib_temp_24430141-2dd1-46a-9F3E7.jpg


[11/22/2022 7:31 PM] szybet
is it under the holes too?


[11/22/2022 7:31 PM] szybet
is it solid / the tape isint moving?


[11/22/2022 7:31 PM] atro_atro
I need to unscrew it to get under the holes


[11/22/2022 7:33 PM] atro_atro
It seems like there's a black coating between the PCB and the metal plate but I may be wrong


[11/22/2022 7:34 PM] atro_atro
Do I risk messing everything up if I touch the metal plate with the pins?


[11/22/2022 7:36 PM] szybet
REALLY?


[11/22/2022 7:36 PM] szybet
take a good picture


[11/22/2022 7:36 PM] szybet
dont do this


[11/22/2022 7:36 PM] szybet
in my opinion, yes


[11/22/2022 7:40 PM] atro_atro
You can see the black coating starting near the screw

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221122_193839-02955.jpg


[11/22/2022 7:40 PM] szybet
oh good


[11/22/2022 7:40 PM] szybet
very good


[11/22/2022 7:40 PM] atro_atro
Then it runs through the edge, you can see it in this other picture near the bottom of the Kobo

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221122_193753_478-720DF.jpg


[11/22/2022 7:40 PM] szybet
the nia doesnt have something like that


[11/22/2022 7:41 PM] szybet
good then, now you can connect the serial cables


[11/22/2022 7:41 PM] szybet
@dill how exactly tho?


[11/22/2022 7:42 PM] the.mightydill
are you familiar with play-doh


[11/22/2022 7:42 PM] szybet
im talking about no solder technique


[11/22/2022 7:42 PM] the.mightydill
yeah


[11/22/2022 7:42 PM] the.mightydill
also ask @tux-linux when he gets home from school


[11/22/2022 7:42 PM] szybet
plasticine.


[11/22/2022 7:42 PM] the.mightydill
yeah


[11/22/2022 7:42 PM] the.mightydill
same thing


[11/22/2022 7:43 PM] cieldautomne
i did this

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221122_194037_664-3F979.jpg


[11/22/2022 7:43 PM] szybet
well @atro do you have plasticine? maybe try only with the cables and tape for now or smth? you need to try


[11/22/2022 7:43 PM] the.mightydill
oh that works


[11/22/2022 7:43 PM] szybet
Very cool


[11/22/2022 7:43 PM] szybet
do this then


[11/22/2022 7:43 PM] the.mightydill
whenever i set up a serial connection, it ends up outputting gibberish


[11/22/2022 7:44 PM] the.mightydill
so i gave up


[11/22/2022 7:44 PM] cieldautomne
yours is much better


[11/22/2022 7:45 PM] szybet
https://tenor.com/view/renegade-labs-madscientist-steve-soldering-tip-gif-17512747

{Embed}
https://tenor.com/view/renegade-labs-madscientist-steve-soldering-tip-gif-17512747
/mnt/data/projects/git/conversations/media/renegade-labs-madscientist-ED3C5.png


[11/22/2022 7:45 PM] the.mightydill
LMFAO


[11/22/2022 7:45 PM] the.mightydill
no it's because i didnt have the serial to usb program running or something


[11/22/2022 7:46 PM] szybet
O.o


[11/22/2022 7:46 PM] the.mightydill
lol


[11/22/2022 7:46 PM] the.mightydill
ok have to go


[11/22/2022 7:46 PM] the.mightydill
byw


[11/22/2022 7:46 PM] the.mightydill
bye


[11/22/2022 7:46 PM] szybet
do you know if he doesnt have time lately?


[11/22/2022 7:46 PM] szybet
or is he simply ignoring me


[11/22/2022 7:46 PM] szybet
;p


[11/22/2022 7:46 PM] szybet
um bye then


[11/22/2022 7:47 PM] andi15701
my connection technique

{Attachments}
/mnt/data/projects/git/conversations/media/kobo-debug-pogo-6C9EB.jpg


[11/22/2022 7:47 PM] andi15701
leaving out backcover


[11/22/2022 7:47 PM] andi15701
and cutting holes in the covers


[11/22/2022 7:47 PM] cieldautomne
contact is far from perfect


[11/22/2022 7:47 PM] szybet
your is the best - overkill even


[11/22/2022 7:47 PM] andi15701
so risk for short-ciruits


[11/22/2022 7:48 PM] szybet
does it work?


[11/22/2022 7:48 PM] atro_atro
I don't have screwdrivers here, I'll go with the tape mode


[11/22/2022 7:48 PM] cieldautomne
yep


[11/22/2022 7:48 PM] andi15701
just general info: TP198 is a second uart


[11/22/2022 7:49 PM] szybet
if you manage to do it, sure if not do it as alex did


[11/22/2022 7:49 PM] andi15701
the place to attach additional hardware


[11/22/2022 7:49 PM] andi15701
but that would require soldering


[11/22/2022 7:55 PM] atro_atro
@Szybet

{Attachments}
/mnt/data/projects/git/conversations/media/rn_image_picker_lib_temp_2e3e0cd1-bf37-401-AA533.jpg


[11/22/2022 7:56 PM] szybet
is the connection solid?


[11/22/2022 7:56 PM] szybet
are they moving


[11/22/2022 7:56 PM] atro_atro
Not moving if I don't move


[11/22/2022 7:56 PM] szybet
then well dont move it


[11/22/2022 7:56 PM] atro_atro
👍


[11/22/2022 7:57 PM] atro_atro
Should I read something or flash something now?


[11/22/2022 7:58 PM] szybet
load the default sd card, or a copy of the original firmware


[11/22/2022 7:58 PM] szybet
put the sd card in


[11/22/2022 7:58 PM] szybet
run a serial monitor on speed 115200


[11/22/2022 7:58 PM] szybet
turn on the ereader


[11/22/2022 7:58 PM] szybet
look if there is something on the serial monitor, there should be uboot logs


[11/22/2022 7:59 PM] szybet
carefull when connecting battery


[11/22/2022 8:00 PM] atro_atro
I used kermit some years ago, is there any command line serial monitor you suggest?


[11/22/2022 8:01 PM] szybet
minicom


[11/22/2022 8:01 PM] andi15701
Pitfalls: handling of modem lines, cts /rts, disable hardware handshake


[11/22/2022 8:06 PM] andi15701
part 1

{Attachments}
/mnt/data/projects/git/conversations/media/zImage-root-1-F17FA


[11/22/2022 8:06 PM] andi15701
part 2

{Attachments}
/mnt/data/projects/git/conversations/media/zImage-root-2-FC80E


[11/22/2022 8:07 PM] andi15701
of current state of inkbox kernel


[11/22/2022 8:07 PM] szybet
what are those


[11/22/2022 8:07 PM] szybet
are they from the repo?


[11/22/2022 8:07 PM] andi15701
including initrd


[11/22/2022 8:07 PM] andi15701
from my checked-out repo


[11/22/2022 8:07 PM] szybet
what is missing from inkbox repo?


[11/22/2022 8:08 PM] szybet
he will need to be able to create himself things


[11/22/2022 8:08 PM] andi15701
the two patches


[11/22/2022 8:08 PM] andi15701
I sent yesterday


[11/22/2022 8:08 PM] szybet
only?


[11/22/2022 8:08 PM] andi15701
I think so


[11/22/2022 8:08 PM] szybet
good then


[11/22/2022 8:08 PM] andi15701
I have not checked if they are merged


[11/22/2022 8:08 PM] andi15701
now


[11/22/2022 8:08 PM] szybet
propably now


[11/22/2022 8:09 PM] szybet
tux-linux is absent completly


[11/22/2022 8:09 PM] andi15701
so you have to git-am them


[11/22/2022 8:09 PM] szybet
good


[11/22/2022 8:10 PM] szybet
did you tried getting into rootfs?


[11/22/2022 8:10 PM] szybet
probably not


[11/22/2022 8:10 PM] andi15701
only the initrd


[11/22/2022 8:10 PM] szybet
okay


[11/22/2022 8:10 PM] andi15701
I could telnet into it


[11/22/2022 8:10 PM] szybet
we will focus on that


[11/22/2022 8:11 PM] andi15701
you need the devicetree, too


[11/22/2022 8:11 PM] szybet
you mean?


[11/22/2022 8:12 PM] szybet
the kernel booted


[11/22/2022 8:12 PM] szybet
modules will be a problem, but what this have to do with device tree?


[11/22/2022 8:12 PM] andi15701
modules are integrated in the initrd


[11/22/2022 8:13 PM] andi15701
the kernel will need it to know the hardware


[11/22/2022 8:13 PM] andi15701
imx6sll-kobo-clarahd.dtb


[11/22/2022 8:13 PM] szybet
i know


[11/22/2022 8:13 PM] szybet
yes, and? the kernel booted already


[11/22/2022 8:14 PM] andi15701
which one?


[11/22/2022 8:14 PM] szybet
im missing something


[11/22/2022 8:14 PM] szybet
yours


[11/22/2022 8:14 PM] andi15701
it boots when the devicetree is provided


[11/22/2022 8:15 PM] szybet
?... isint it added while compiling?


[11/22/2022 8:17 PM] andi15701
./kernel/linux-5.16-n249/arch/arm/boot/dts/imx6sll-kobo-clarahd.dtb


[11/22/2022 8:17 PM] atro_atro
How do I find which ttyS I'm using? Is it just trial and error?


[11/22/2022 8:18 PM] szybet
i know about this file? and?


[11/22/2022 8:18 PM] andi15701
something with USB


[11/22/2022 8:18 PM] andi15701
for usb


[11/22/2022 8:18 PM] szybet
`ls /dev/ | grep ttyUSB`


[11/22/2022 8:18 PM] andi15701
the file needs to be placed on uSD


[11/22/2022 8:18 PM] atro_atro
Thanks


[11/22/2022 8:18 PM] andi15701
in the end


[11/22/2022 8:20 PM] szybet
where placed


[11/22/2022 8:20 PM] szybet
i didnt know about that


[11/22/2022 8:21 PM] andi15701
well, we have a well-behaved u-boot, so several options:


[11/22/2022 8:22 PM] andi15701
if there is no kernel on the disk, it will fallback to fastboot, we can put it together with mkbootimage into one thing


[11/22/2022 8:22 PM] andi15701
for later, put it somewhere, preferrably on the boot partition


[11/22/2022 8:23 PM] andi15701
and also the zImage


[11/22/2022 8:23 PM] andi15701
tell the u-boot to load both


[11/22/2022 8:23 PM] szybet
it is diffrent from regular kobo kernels right?


[11/22/2022 8:23 PM] szybet
this process


[11/22/2022 8:24 PM] andi15701
the difference is that a) uboot does not use the hidden partitions by default


[11/22/2022 8:24 PM] andi15701
b) we need to have u-boot configured


[11/22/2022 8:25 PM] andi15701
add commands to boot


[11/22/2022 8:25 PM] andi15701
into its environment


[11/22/2022 8:25 PM] andi15701
and devicetree is different/incompatible


[11/22/2022 8:25 PM] andi15701
kobo 4.1.15 kernels need also devicetrees


[11/22/2022 8:26 PM] szybet
well will you guide atro into doing that? i dont have any experience with this


[11/22/2022 8:26 PM] andi15701
I will


[11/22/2022 8:26 PM] szybet
propablt changes to the kernel repo are needed, and the rest will be the same


[11/22/2022 8:26 PM] szybet
thanks


[11/22/2022 8:26 PM] szybet
nia has 4.15 as i remember


[11/22/2022 8:26 PM] atro_atro
So, I'm connected, I configured the speed and port via `minicom -s`, I start `minicom`, connect the battery and turn it on but nothing appears on the console


[11/22/2022 8:27 PM] szybet
try to turn it on / off a couple of times


[11/22/2022 8:27 PM] szybet
look at the diode


[11/22/2022 8:27 PM] atro_atro
I have the tx pin connected to the rx pin and viceversa


[11/22/2022 8:27 PM] atro_atro
Is that right?


[11/22/2022 8:27 PM] szybet
are you sure?


[11/22/2022 8:27 PM] szybet
yes


[11/22/2022 8:27 PM] szybet
do you have any diodes on the adapter?


[11/22/2022 8:28 PM] andi15701
hardware flow control is off?


[11/22/2022 8:28 PM] szybet
maybe just send the picture of the connection, some detailed ones


[11/22/2022 8:28 PM] szybet
he should be still able to read it


[11/22/2022 8:29 PM] atro_atro
It is on


[11/22/2022 8:30 PM] atro_atro
The diode on the serial connector isn't blinking, it's just red


[11/22/2022 8:30 PM] atro_atro
I'll take some pictures


[11/22/2022 8:30 PM] szybet
did you turned the device on?


[11/22/2022 8:30 PM] szybet
look at the diode of the ereader


[11/22/2022 8:32 PM] atro_atro
Which diode?


[11/22/2022 8:32 PM] szybet
does the clara have a diode?


[11/22/2022 8:32 PM] szybet
on the power on button?


[11/22/2022 8:33 PM] atro_atro
Wait, maybe I need to charge it


[11/22/2022 8:34 PM] andi15701
yes


[11/22/2022 8:34 PM] andi15701
it has


[11/22/2022 8:34 PM] szybet
did you connected the battery>


[11/22/2022 8:34 PM] andi15701
it boots without


[11/22/2022 8:35 PM] atro_atro
Yo, I'm so happy
```
U-Boot 2016.03-00038-g4a92f9d (Jun 04 2018 - 14:20:13 +0800)
```


[11/22/2022 8:35 PM] atro_atro
Plus a lot more lines


[11/22/2022 8:36 PM] szybet
gooood


[11/22/2022 8:39 PM] andi15701
connection is bidirectional?


[11/22/2022 8:39 PM] andi15701
so you also can type?


[11/22/2022 8:40 PM] szybet
https://github.com/Kobo-InkBox/kernel

{Embed}
https://github.com/Kobo-InkBox/kernel
GitHub - Kobo-InkBox/kernel: Kernel sources for InkBox OS
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-07C4C


[11/22/2022 8:40 PM] szybet
clone this repo too


[11/22/2022 8:41 PM] atro_atro
Can't type, do I need extra settings?


[11/22/2022 8:41 PM] szybet
🥴


[11/22/2022 8:45 PM] atro_atro
Aaah, so these are lines that I need to change in the configuration, the last one seems to be "Hardware Flow Control", I guess the second one is "RS485 Rts On Send", can't understand the first one


[11/22/2022 8:45 PM] andi15701
more pitfalls: gpsd or modemmanager might talk with your usb-serial converter


[11/22/2022 8:45 PM] andi15701
hardware flow control off


[11/22/2022 8:45 PM] andi15701
it is often on per default


[11/22/2022 8:45 PM] atro_atro
Gotcha, switched off


[11/22/2022 8:47 PM] atro_atro
Now, if I type on minicom a green LED blinks on the serial-USB connector but my keypress don't appear on the console


[11/22/2022 8:49 PM] szybet
try to spam while the device boots


[11/22/2022 8:51 PM] atro_atro
Nothing appears


[11/22/2022 8:51 PM] atro_atro
@andi what configuration are you referring to with "handling of modem lines" and "cts/rts"?


[11/22/2022 8:52 PM] szybet
maybe the TX cable isint conntected properly


[11/22/2022 8:52 PM] andi15701
cts/rts = hardware flow control


[11/22/2022 8:53 PM] atro_atro
Nice, and by gpsd you mean the Linux GPS daemon?


[11/22/2022 8:53 PM] andi15701
yes


[11/22/2022 8:54 PM] atro_atro
I have no gpsd nor modemmanager running


[11/22/2022 8:54 PM] atro_atro
I'll check if the cable moved


[11/22/2022 8:54 PM] andi15701
depending on distro, it just picks arbitary usb-serial adaptors


[11/22/2022 8:55 PM] andi15701
maybe I should create a shell script to convert the output of the kernel build into some bootable sd card?


[11/22/2022 8:56 PM] atro_atro
I don't even have modemmanager installed


[11/22/2022 8:57 PM] andi15701
ok


[11/22/2022 8:58 PM] szybet
?


[11/22/2022 8:58 PM] atro_atro
Cables are connected, still no output on the console


[11/22/2022 8:58 PM] szybet
while uboot is booting, and you would spam a lot it should stop booting. try that


[11/22/2022 8:58 PM] szybet
the stock os can be laggy on serial sometimes


[11/22/2022 9:04 PM] atro_atro
I think that something happened because I was able to stop the boot


[11/22/2022 9:04 PM] atro_atro
Last lines are:
```
Resetting CPU ...

resetting ...
```


[11/22/2022 9:04 PM] szybet
try to type now


[11/22/2022 9:04 PM] szybet
um idk?


[11/22/2022 9:04 PM] atro_atro
Nothing


[11/22/2022 9:05 PM] szybet
did you turned hard ware flow off?


[11/22/2022 9:05 PM] szybet
did you used sudo with minicom?


[11/22/2022 9:05 PM] szybet
maybe try screen then


[11/22/2022 9:05 PM] szybet
screen command


[11/22/2022 9:06 PM] atro_atro
Current setup:
```
    +-----------------------------------------------------------------------+
    | A -    Serial Device      : /dev/ttyUSB0                              |
    | B - Lockfile Location     : /var/run                                  |
    | C -   Callin Program      :                                           |
    | D -  Callout Program      :                                           |
    | E -    Bps/Par/Bits       : 115200 8N1                                |
    | F - Hardware Flow Control : No                                        |
    | G - Software Flow Control : No                                        |
    | H -     RS485 Enable      : No                                        |
    | I -   RS485 Rts On Send   : No                                        |
    | J -  RS485 Rts After Send : No                                        |
    | K -  RS485 Rx During Tx   : No                                        |
    | L -  RS485 Terminate Bus  : No                                        |
    | M - RS485 Delay Rts Before: 0                                         |
    | N - RS485 Delay Rts After : 0                                         |
    |                                                                       |
    |    Change which setting?                                              |
    +-----------------------------------------------------------------------+
```
I'll try screen after dinner/tomorrow


[11/22/2022 9:06 PM] szybet
looks good


[11/22/2022 9:07 PM] the.mightydill
sorry i'm at school and i was going to another class


[11/22/2022 9:07 PM] the.mightydill
idk probably


[11/22/2022 9:07 PM] the.mightydill
i would be more active, but school is hard


[11/22/2022 9:18 PM] atro_atro
Fixed! I needed to turn local echo on with C-A, E


[11/22/2022 9:20 PM] atro_atro
So it was sending the characters, just not displaying them


[11/22/2022 9:20 PM] szybet
i dont think its a fix


[11/22/2022 9:20 PM] szybet
well, try it one more time


[11/22/2022 9:20 PM] szybet
you should get a console


[11/22/2022 9:20 PM] szybet
with some commands available


[11/22/2022 9:23 PM] andi15701
the kobo should send the echo


[11/22/2022 9:24 PM] andi15701
now it is your minicom


[11/22/2022 9:24 PM] szybet
exactly


[11/22/2022 9:24 PM] atro_atro
Is this a shell?
```
eBR-1A #
```


[11/22/2022 9:24 PM] szybet
show me you serial to usb adapter, photos


[11/22/2022 9:24 PM] szybet
um yea? i dont remember


[11/22/2022 9:24 PM] szybet
type help


[11/22/2022 9:24 PM] szybet
`help`


[11/22/2022 9:24 PM] andi15701
yes


[11/22/2022 9:24 PM] andi15701
it is the u-boot commandline interface


[11/22/2022 9:25 PM] atro_atro
Yup, got a lot of lines, including:
```
ping    - send ICMP ECHO_REQUEST to network host
printenv- print environment variables
protect - enable or disable FLASH write protection
reset   - Perform RESET of the CPU
ricoh_reg- ricoh_reg -  read / write ricoh register .
```


[11/22/2022 9:25 PM] atro_atro
Seems like the U-Boot shell


[11/22/2022 9:25 PM] andi15701
ok, then serial is working


[11/22/2022 9:26 PM] andi15701
so next step would be to prepare a fresh sd card


[11/22/2022 9:26 PM] andi15701
with the uboot  + kernel + dtb from inkbox


[11/22/2022 9:27 PM] andi15701
basically


[11/22/2022 9:27 PM] szybet
cool


[11/22/2022 9:27 PM] szybet
this, clone it


[11/22/2022 9:41 PM] atro_atro
I'm done for today, hopefully I will have time to try that tomorrow


[11/22/2022 9:41 PM] atro_atro
Thanks a lot for now 🙏


[11/22/2022 9:44 PM] szybet
good


[11/22/2022 9:44 PM] szybet
i also dont have time today


[11/22/2022 9:45 PM] szybet
i dont know if tommorow i will have any. If you want, you can read the scripts / directory structure in the kernel repo and read this:
https://github.com/Szybet/niAudio/blob/main/inkbox.md


[11/22/2022 9:46 PM] szybet
also here is a good lecture:
https://inkbox.ddns.net/wiki/index.php?title=Special:AllPages

{Reactions}
👍 

[11/23/2022 12:27 PM] tux_linux
time
Not ignoring you


[11/25/2022 3:01 PM] szybet
any updates atro?


[11/28/2022 11:16 PM] andi15701
probably I should step in here a bit more


[11/28/2022 11:17 PM] andi15701
so it is more fine-tuning left


[11/28/2022 11:20 PM] szybet
well he dissapeared


[11/28/2022 11:20 PM] szybet
🥴🥲


[11/29/2022 12:23 AM] the.mightydill
Clara HD


[11/29/2022 12:23 AM] the.mightydill
What do you expect


[11/29/2022 1:08 AM] tux_linux
Clara HD curse


[11/29/2022 3:09 PM] szybet
@atro 🥴🥴🥴🥴🥴🥴


[12/3/2022 2:50 PM] atro_atro
Sorry, I've been really busy


[12/3/2022 2:50 PM] atro_atro
I'm here, making space on the disk to fit the kernel


[12/3/2022 2:50 PM] atro_atro
Don't worry guys, I'm serious about contributing to this project


[12/3/2022 3:07 PM] tux_linux
No problem, it's just that when someone does that we have the impression that they left
It was true in like 90% of other cases
Thanks for staying with us !


[12/3/2022 3:09 PM] tux_linux
I have no problem with you being busy, I am already too much busy myself I barely respond to those messages...


[12/3/2022 3:45 PM] szybet
😮


[12/4/2022 1:29 PM] atro_atro
@Szybet do I need the same toolchain as the Kobo Nia? (Linaro + NickelTC)


[12/4/2022 1:29 PM] szybet
just clone the kernel repo


[12/4/2022 1:29 PM] atro_atro
Done


[12/4/2022 1:30 PM] szybet
now apply the patches that andi1 was talking about


[12/4/2022 1:43 PM] atro_atro
Done


[12/4/2022 2:59 PM] szybet
let me give a look


[12/4/2022 2:59 PM] szybet
there is already a clara build


[12/4/2022 2:59 PM] szybet
well just build it


[12/4/2022 3:00 PM] szybet
look into my repo, there is a command to create the root kernel


[12/4/2022 3:00 PM] szybet
inkbox.md


[12/4/2022 3:01 PM] szybet
you need also to generete the keys


[12/4/2022 3:07 PM] szybet
generate the keys, and then let me know


[12/4/2022 3:40 PM] atro_atro
I ran
```
env GITDIR="$PWD" TOOLCHAINDIR="$PWD/toolchain/arm-nickel-linux-gnueabihf/" THREADS=$(($(nproc) * 2)) TARGET=arm-nickel-linux-gnueabihf scripts/build_kernel.sh n249 root
```


[12/4/2022 3:41 PM] atro_atro
But got this error:
```
***
*** Compiler is too old.
***   Your GCC version:    4.9.4
***   Minimum GCC version: 5.1.0
***
scripts/Kconfig.include:44: Sorry, this compiler is not supported.
```


[12/4/2022 3:42 PM] szybet
try a diffrent compiler then


[12/4/2022 3:42 PM] szybet
there are a few


[12/4/2022 3:42 PM] szybet
but not musl


[12/4/2022 3:47 PM] atro_atro
```
ARM system type
> 1. Allow multiple platforms to be selected (ARCH_MULTIPLATFORM)
  2. EP93xx-based (ARCH_EP93XX)
  3. FootBridge (ARCH_FOOTBRIDGE)
  4. IOP32x-based (ARCH_IOP32X)
  5. IXP4xx-based (ARCH_IXP4XX)
  6. Marvell Dove (ARCH_DOVE)
  7. PXA2xx/PXA3xx-based (ARCH_PXA)
  8. RiscPC (ARCH_RPC) (NEW)
  9. SA1100-based (ARCH_SA1100)
  10. Samsung S3C24XX SoCs (ARCH_S3C24XX)
  11. TI OMAP1 (ARCH_OMAP1)
choice[1-11?]:
```


[12/4/2022 3:48 PM] szybet
your kernel config broke


[12/4/2022 3:48 PM] szybet
or hmm


[12/4/2022 3:48 PM] szybet
run `make clean` in the kernel dir where the sources are


[12/4/2022 3:51 PM] atro_atro
Done, same result


[12/4/2022 3:52 PM] szybet
what toolchain did you use


[12/4/2022 3:52 PM] atro_atro
Here is the command I'm running:
```
env GITDIR="$PWD" TOOLCHAINDIR="$PWD/toolchain/arm-kobo-linux-gnueabihf/" THREADS=$(($(nproc) * 2)) TARGET=arm-kobo-linux-gnueabihf scripts/build_kernel.sh n249 root
```


[12/4/2022 3:53 PM] szybet
well weird


[12/4/2022 3:53 PM] szybet
@andi  what toolchain did you use for your kernel


[12/4/2022 3:53 PM] szybet
we need to wait for the reply


[12/4/2022 3:54 PM] szybet
in the meantime you can generate your keys


[12/4/2022 4:00 PM] atro_atro
I created the keys


[12/4/2022 4:00 PM] szybet
do you know how to replace them?


[12/4/2022 4:01 PM] atro_atro
Nope


[12/4/2022 4:01 PM] szybet
in the initrd is a squashfs, look arround you will find it


[12/4/2022 4:05 PM] atro_atro
```
$ pwd
/home/atro/build/kernel/initrd/n249
$ find . -name "*squash*"
./usr/bin/mksquashfs
./usr/bin/unsquashfs
```


[12/4/2022 4:05 PM] szybet
its not named squash


[12/4/2022 4:05 PM] szybet
but its a squash


[12/4/2022 4:05 PM] atro_atro
Mmmh, let me search again


[12/4/2022 4:05 PM] szybet
squashfs*


[12/4/2022 4:05 PM] szybet
if you want to search that way, use the `file` command and its output


[12/4/2022 4:11 PM] atro_atro
Is it `opt/root.sqsh`?


[12/4/2022 4:11 PM] szybet
maybe


[12/4/2022 4:11 PM] atro_atro
I found these:
```
./opt/modules.sqsh
./opt/key.sqsh
./opt/lockdown.sqsh
./opt/firmware.sqsh
./opt/valid-devkey.sqsh
./opt/root.sqsh
```


[12/4/2022 4:11 PM] szybet
open it up


[12/4/2022 4:11 PM] szybet
hmmmmm


[12/4/2022 4:11 PM] szybet
open them up


[12/4/2022 4:11 PM] szybet
we will see


[12/4/2022 4:11 PM] szybet
key maybe first


[12/4/2022 4:13 PM] atro_atro
Sorry I started from root, it only contained a dir called `rooted`


[12/4/2022 4:14 PM] szybet
what?


[12/4/2022 4:14 PM] atro_atro
```
$ tree
.
├── applications-public.pem
├── kobox-graphic-public.pem
├── kobox-nographic-public.pem
└── public.pem

0 directories, 4 files
```


[12/4/2022 4:14 PM] atro_atro
This one is `key.sqsh`


[12/4/2022 4:14 PM] szybet
open the other ones


[12/4/2022 4:14 PM] szybet
root maybe


[12/4/2022 4:14 PM] szybet
and modules


[12/4/2022 4:15 PM] atro_atro
This is `root.sqsh`
```
$ tree
.
└── rooted

0 directories, 1 file
```


[12/4/2022 4:17 PM] atro_atro
This is `modules.sqsh`
```
.
└── 5.16.0
    ├── build -> /home/build/inkbox/kernel/kernel/linux-5.16-n249
    ├── kernel
    ├── modules.alias
    ├── modules.alias.bin
    ├── modules.builtin
    ├── modules.builtin.alias.bin
    ├── modules.builtin.bin
    ├── modules.builtin.modinfo
    ├── modules.dep
    ├── modules.dep.bin
    ├── modules.devname
    ├── modules.order
    ├── modules.softdep
    ├── modules.symbols
    ├── modules.symbols.bin
    └── source -> /home/build/inkbox/kernel/kernel/linux-5.16-n249

2 directories, 15 files
```


[12/4/2022 4:19 PM] szybet
well then


[12/4/2022 4:19 PM] szybet
propably


[12/4/2022 4:19 PM] szybet
im not sure


[12/4/2022 4:19 PM] szybet
you need replace public.pem in key.squash


[12/4/2022 4:19 PM] szybet
with you key


[12/4/2022 4:27 PM] atro_atro
Done


[12/4/2022 4:30 PM] szybet
is it the same now as it was?


[12/4/2022 4:30 PM] szybet
the tree structure


[12/4/2022 4:30 PM] szybet
then you mount it


[12/4/2022 4:30 PM] szybet
or unquash it


[12/4/2022 4:36 PM] atro_atro
Yes, I accidentaly extended it before but now it is exactly as it was, only the `public.pem` changed
```
$ sudo mount -t squashfs kernel/initrd/n249/opt/key.sqsh /mnt
$ tree /mnt
/mnt
├── applications-public.pem
├── kobox-graphic-public.pem
├── kobox-nographic-public.pem
└── public.pem

0 directories, 4 files
```


[12/4/2022 4:37 PM] szybet
good


[12/4/2022 4:37 PM] szybet
now simply replace it


[12/4/2022 4:38 PM] szybet
the sqiashfs*


[12/4/2022 4:38 PM] atro_atro
It's already in place inside the kernel initrd


[12/4/2022 4:38 PM] szybet
gooood


[12/4/2022 4:38 PM] atro_atro
:)


[12/4/2022 4:38 PM] szybet
now you can clone the rootfs repo as a root user


[12/4/2022 4:43 PM] atro_atro
Done


[12/4/2022 4:52 PM] szybet
well


[12/4/2022 4:52 PM] szybet
you have a second sd card right?


[12/4/2022 5:32 PM] atro_atro
Yes


[12/4/2022 5:32 PM] szybet
you can make a mirror of the original one on it


[12/11/2022 5:45 PM] szybet
silence once more

if anything happens here, and i dont reply thats because i got no notyfication from the thread, so ping me from another channel


[12/12/2022 8:23 AM] szybet
@andi @tux-linux when you have time please reply, what is the toolchain used for clara?


[12/12/2022 6:43 PM] ninuje
Anything you want except nickel, I guess?


[12/12/2022 6:43 PM] ninuje
e.g., https://github.com/koreader/koxtoolchain kobo or kobomk7 would do

{Embed}
https://github.com/koreader/koxtoolchain
GitHub - koreader/koxtoolchain: Build script for various toolchains...
Build script for various toolchains used by KOReader - GitHub - koreader/koxtoolchain: Build script for various toolchains used by KOReader
/mnt/data/projects/git/conversations/media/koxtoolchain-3CF62


[12/12/2022 6:44 PM] ninuje
Although you could admittedly use a custom one built against an even more recent glibc (and/or possibly kernel, depending) for inkbox, I guess


[12/12/2022 6:46 PM] ninuje
Or musl, even? can't remember where you guys use glibc or not


[12/12/2022 6:46 PM] ninuje
In any case, the libc is irrelevant for a kernel build


[12/12/2022 6:47 PM] ninuje
so, TL;DR: kobomk7


[12/12/2022 6:47 PM] ninuje
or kobo if you want more portable binaries


[12/12/2022 6:56 PM] szybet
both...


[12/12/2022 6:57 PM] szybet
kobo doesnt work for mainline


[12/12/2022 6:57 PM] szybet
maybe kobomk7 will then


[12/12/2022 11:17 PM] ninuje
Define "doesn't work"


[12/12/2022 11:21 PM] szybet
i define


[12/13/2022 2:01 AM] ninuje
That's not the `kobo` variant


[12/13/2022 2:01 AM] ninuje
That's the `nickel` one


[12/13/2022 2:02 AM] ninuje
Which nobody in their right mind should be using, ever


[12/13/2022 2:02 AM] ninuje
It's only there for Nickel* addons


[12/13/2022 2:03 AM] ninuje
(and possibly building 2.x kernels without jumping through extra hoops, or to keep compatibility with vendor kernels when building modules)


[12/13/2022 7:27 AM] szybet
this alao didnt worked


[12/13/2022 7:27 AM] szybet
well maybe the kernel dir got messed up after the nickel try


[12/13/2022 8:10 AM] cieldautomne
this ? https://discord.com/channels/809205711778480158/934581303674798101/970322806933958686


[12/13/2022 8:25 AM] szybet
oh


[12/13/2022 8:25 AM] szybet
uhm


[12/13/2022 8:25 AM] szybet
okay


[12/13/2022 8:25 AM] szybet
thanks


[12/13/2022 8:25 AM] szybet
musl😟🤮


[12/17/2022 11:56 AM] atro_atro
I built the bootloader successfully, however I can't see the kernel zImage in `kernel/out/n249`


[12/17/2022 11:57 AM] atro_atro
My bad, fixed it


[12/17/2022 12:16 PM] szybet
I lost track, did you replaced the keys?


[12/17/2022 12:16 PM] szybet
and have a partitioned sd card? ( but before partitioning, you cloned the old one? )


[12/17/2022 12:17 PM] atro_atro
I also lost track, I'm making a notes repository on GitHub like yours and starting from scratch


[12/17/2022 12:20 PM] szybet
Good! this is very important to finally have a complete guide for inkbox


[12/17/2022 12:20 PM] szybet
can i have a look to it?


[12/17/2022 12:21 PM] atro_atro
Sure thing! I'll post the link in a few hours

{Reactions}
👍 

[12/17/2022 6:45 PM] atro_atro
@Szybet I'm still missing the squash part because I need to remember what I did last time. I think that I should create the keys first, then move the public one in the kernel's initrd, then compile the kernel, then sign the rootfs with the same key that I moved into the kernel, right?


[12/17/2022 6:45 PM] atro_atro
https://github.com/aartoni/n249

{Reactions}
👍 

[12/17/2022 6:47 PM] szybet
no, let me explain how openssl key work


[12/17/2022 6:48 PM] szybet
the public ones can verify if files signed by those private keys are valid


[12/17/2022 6:48 PM] szybet
so you sign everything with private keys, and move the public ones into the kernel


[12/17/2022 6:48 PM] szybet
very cool guide

{Reactions}
😃 

[12/17/2022 7:46 PM] atro_atro
You're right, I typed it wrong, so basically the same but sign with the private one, right?


[12/17/2022 7:47 PM] szybet
1. You put public keys into the kernel
2. You sign with the pair - private key the rootfs


[12/17/2022 7:47 PM] szybet
thats it


[12/17/2022 7:48 PM] atro_atro
Nice, I'll update the guide tomorrow

{Reactions}
👍 

[12/18/2022 1:20 PM] atro_atro
@Szybet I've updated the installation guide, hopefully I'll be able to format the microSD card today
https://github.com/aartoni/n249/blob/main/installation.md


[12/18/2022 1:21 PM] szybet
looks good


[12/18/2022 1:22 PM] szybet
remember: first clone the original, then format it


[12/18/2022 1:22 PM] szybet
i mean not format - use fdisk to create partitions


[12/18/2022 1:23 PM] atro_atro
I made a backup of my card and put it in a safe place, now I'm going to make the same partition table in a new one, is that okay?


[12/18/2022 1:23 PM] szybet
you need to clone it


[12/18/2022 1:24 PM] szybet
there are waveshare calibration things for you eink display on that sd card


[12/18/2022 1:25 PM] atro_atro
Ah, you're right, can I use the backed up image to make the new SD identical to the original one?


[12/18/2022 1:27 PM] szybet
yes, exactly


[12/18/2022 1:29 PM] atro_atro
Nice, I will let you know when I'm done


[12/18/2022 1:58 PM] szybet
You seem to understand more things with inkbox than me when i was new to the project, so good job


[12/18/2022 6:30 PM] atro_atro
That's nice to hear, thank you


[12/18/2022 6:30 PM] atro_atro
I've cloned the SD


[12/18/2022 6:31 PM] atro_atro
Can I check if it works by putting it in and turning the Clara on?


[12/18/2022 7:01 PM] szybet
exactly, do that


[12/18/2022 7:03 PM] atro_atro
Okay, it showed me the configuration page


[12/18/2022 7:03 PM] atro_atro
Exactly like it should at first boot


[12/18/2022 7:03 PM] szybet
good then


[12/18/2022 7:03 PM] szybet
then you can go further


[12/18/2022 7:04 PM] szybet
maybe start with the bootloader


[12/18/2022 7:04 PM] szybet
inkbox one


[12/18/2022 7:42 PM] atro_atro
Where should I write it? First partition?


[12/18/2022 7:42 PM] szybet
look up my guide


[12/18/2022 7:42 PM] szybet
github


[12/18/2022 7:42 PM] szybet
niAudio


[12/18/2022 7:43 PM] atro_atro
What's `$DEVICE`?
```
dd if=$UBOOT of=/dev/$DEVICE bs=1K seek=1
```


[12/18/2022 7:43 PM] szybet
sd card


[12/18/2022 7:44 PM] atro_atro
Yeah but which partition?


[12/18/2022 7:44 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-90872.png


[12/18/2022 7:44 PM] szybet
my laptop example


[12/18/2022 7:45 PM] szybet
`sda` means the whole disk, `sda1` means the first partition


[12/18/2022 7:45 PM] szybet
mmcblk0 will be the whole sd card, mmcblk0p1 will be the first partition


[12/18/2022 7:46 PM] atro_atro
Mmmm, okay, so should I write to the first one?


[12/18/2022 7:46 PM] atro_atro
I already know how partitions work, I'm just unsure on which one I should write


[12/18/2022 7:47 PM] szybet
to the whole sd card you should write


[12/18/2022 7:47 PM] szybet
not partition


[12/18/2022 7:47 PM] atro_atro
Now I get it, sorry for that


[12/18/2022 7:50 PM] atro_atro
Then I guess I should check the logs with the serial connection


[12/18/2022 7:50 PM] szybet
no need to be sory


[12/18/2022 7:50 PM] szybet
estabalish the serial connection


[12/18/2022 7:50 PM] szybet
get into u-boot cmd


[12/18/2022 7:56 PM] atro_atro
I'm into u-boot cmd, and am following your guide


[12/18/2022 7:57 PM] atro_atro
I did `ums 0 mmc 0` and it seems like it's taking a while


[12/18/2022 7:58 PM] atro_atro
Here's the output:
```
=> ums 0 mmc 0
UMS: LUN 0, dev 0, hwpart 0, sector 0x0, count 0x3b78000
usb dr_mode not found
```


[12/18/2022 7:58 PM] atro_atro
Below that there's a rotating slash


[12/18/2022 7:58 PM] szybet
connect usb to your pc


[12/18/2022 8:01 PM] atro_atro
Do you mean to connect the normal one?


[12/18/2022 8:02 PM] szybet
connect your kobo to the pc


[12/18/2022 8:02 PM] szybet
just as you would transfer books


[12/18/2022 8:02 PM] atro_atro
Done, nothing happens


[12/18/2022 8:02 PM] atro_atro
No output


[12/18/2022 8:02 PM] atro_atro
Ah, connection lost


[12/18/2022 8:10 PM] szybet
?


[12/18/2022 8:10 PM] szybet
first connect it, then launch the command in u-boot


[12/18/2022 8:12 PM] atro_atro
Tried again, here's the output:
```
=> ums 0 mmc 0
UMS: LUN 0, dev 0, hwpart 0, sector 0x0, count 0x3b78000
usb dr_mode not found
\undefined instruction
pc : [<9ffbd682>]          lr : [<9ffbcf87>]
relog pc : [<8781a682>]    lr : [<87819f87>]
sp : 9ef9a880  ip ; 00000018     fp : 9efa3180
r11: 00000000  r9 : %<l|         r8 : 9efa0ed0
r7 : 9ffe8200  r6 : %:lx         r5 : 00000040  r4 : 00000001
r3 :               1000  r2 : 00000000   r1 : 9ef9a8d0  r0 : 9ffe8200
```


[12/18/2022 8:12 PM] szybet
😐


[12/18/2022 8:12 PM] szybet
https://tenor.com/view/m-and-ms-red-this-is-bad-not-good-this-isnt-good-gif-24636730

{Embed}
https://tenor.com/view/m-and-ms-red-this-is-bad-not-good-this-isnt-good-gif-24636730
/mnt/data/projects/git/conversations/media/m-and-ms-red-5E054.png


[12/18/2022 8:13 PM] atro_atro
Is this where the fun part begins?


[12/18/2022 8:13 PM] atro_atro
:)


[12/18/2022 8:13 PM] szybet
dont try with this command again


[12/18/2022 8:13 PM] szybet
hmm


[12/18/2022 8:13 PM] szybet
look up previous chat in this thread, maybe there is a diffrent command for that


[12/18/2022 8:14 PM] szybet
we dont really need it, but its good to have for the sd card slot


[12/18/2022 8:15 PM] szybet
@alex(O_o)  can you remember anything?


[12/18/2022 8:18 PM] szybet
well i dont see anything


[12/18/2022 8:18 PM] szybet
well then @andi ? maybe you can help


[12/18/2022 8:18 PM] szybet
anyway, you can start creating the partition table


[12/18/2022 8:21 PM] atro_atro
I cannot type anymore, I will reboot the Kobo


[12/18/2022 8:21 PM] szybet
i hope nothing happened wrong...


[12/18/2022 8:21 PM] szybet
yea do this


[12/18/2022 8:26 PM] atro_atro
Wait, if I write the partition table, wouldn't I delete U-Boot?


[12/18/2022 8:26 PM] szybet
no


[12/18/2022 8:26 PM] szybet
does it work after reboot?


[12/18/2022 8:27 PM] atro_atro
Yeah, the U-Boot console can still print the version :)


[12/18/2022 8:27 PM] szybet
i mean


[12/18/2022 8:27 PM] szybet
can you type in uboot


[12/18/2022 8:27 PM] szybet
like help for example


[12/18/2022 8:27 PM] atro_atro
Yes, I ran both `help` and `version` and everything was fine


[12/18/2022 8:27 PM] szybet
good


[12/18/2022 8:28 PM] szybet
for 99% everything is fine


[12/18/2022 8:29 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-4F553.png


[12/18/2022 8:29 PM] szybet
its something like that


[12/18/2022 8:29 PM] szybet
i dont quite remember


[12/18/2022 8:29 PM] szybet
order could be wrong


[12/18/2022 8:29 PM] szybet
actually kernel and waveshare is next to each other


[12/18/2022 8:29 PM] szybet
but something like that


[12/18/2022 8:29 PM] szybet
you get the idea


[12/18/2022 8:29 PM] atro_atro
:|


[12/18/2022 8:30 PM] atro_atro
So they have the waveshare and U-Boot in unpartitioned space, I've never seen that


[12/18/2022 8:30 PM] atro_atro
Is that common practice?


[12/18/2022 8:31 PM] szybet
yes


[12/18/2022 8:31 PM] szybet
for arm bootloaders, yes


[12/18/2022 8:31 PM] szybet
for calibration things, im not sure


[12/18/2022 8:32 PM] cieldautomne
im not sure it's relevant but this is the partition layout


[12/18/2022 8:33 PM] szybet
no


[12/18/2022 8:33 PM] szybet
do you remember anything that in u-boot you would type a command that would share the sd card over usb?


[12/18/2022 8:34 PM] szybet
also if you are so active, wouldnt you like to help porting it? :D


[12/18/2022 8:39 PM] cieldautomne
also that part


[12/18/2022 8:39 PM] cieldautomne
this


[12/18/2022 8:40 PM] szybet
kernel is on p1?...


[12/18/2022 8:40 PM] cieldautomne
nop


[12/18/2022 8:41 PM] cieldautomne
i remember removing the sdcard everytime i needed to replace something on the partitions


[12/18/2022 8:43 PM] szybet
whats this?


[12/18/2022 8:44 PM] cieldautomne
i'd like to


[12/18/2022 8:45 PM] szybet
then for what you are waiting for


[12/18/2022 8:54 PM] cieldautomne
T.T


[12/18/2022 8:56 PM] cieldautomne
I'm on holiday starting next Thursday


[12/18/2022 8:57 PM] atro_atro
Okay, partition table, format and root flag are done, I will leave now because I need to eat


[12/18/2022 8:57 PM] atro_atro
@Szybet what's the next step for me?


[12/18/2022 8:57 PM] szybet
is this an emote?


[12/18/2022 8:58 PM] szybet
good
i wonder where @tux-linux is


[12/18/2022 8:58 PM] the.mightydill
Yeah lol


[12/18/2022 8:58 PM] szybet
smacznego i mean Bon appetit!


[12/18/2022 8:58 PM] szybet
ok 🥴


[12/18/2022 8:59 PM] szybet
kernel


[12/18/2022 9:02 PM] cieldautomne
yep, similar to this 😭


[12/18/2022 9:03 PM] szybet
oh okay


[12/18/2022 9:03 PM] szybet
well


[12/18/2022 9:03 PM] szybet
its not late to start


[12/18/2022 9:06 PM] cieldautomne
since last summer im following a training to be a sailing coach, i don't have a lot of time and im often not at my parents house where i store the kobo and all the stuff


[12/18/2022 9:07 PM] szybet
understandable


[12/27/2022 8:20 PM] cieldautomne
Hey! I'm back and im at this step, same thing happen -> screen from black to white after inkbox-splash


[12/27/2022 8:23 PM] cieldautomne
i've also summarized the instructions i followed (it's just a draft, not clean)

{Attachments}
/mnt/data/projects/git/conversations/media/instructions-F12D0.txt


[12/27/2022 8:25 PM] cieldautomne
`/etc/init.d/inkbox-splash alert_splash` shows two qr-code


[12/27/2022 9:21 PM] szybet
well did you included andi's patches?


[12/27/2022 9:42 PM] cieldautomne
i've done nothing else than what i wrote on the txt file


[12/27/2022 9:43 PM] szybet
well then do it, #patches


[12/27/2022 9:43 PM] szybet
i dont think tux-linux added them into the official repo?


[12/27/2022 9:43 PM] cieldautomne
okay im going to take a look at it


[12/27/2022 9:45 PM] cieldautomne
what are we trying to solve now?


[12/27/2022 9:45 PM] szybet
Idk, lets first check the patches


[12/27/2022 9:46 PM] cieldautomne
👍


[12/27/2022 10:14 PM] cieldautomne
im not familiar with git patches (how to apply them)


[12/27/2022 10:16 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-F745F.png

{Reactions}
😂 

[12/27/2022 10:16 PM] szybet
let AI and skynet be with you

{Reactions}
😭 

[12/27/2022 10:19 PM] cieldautomne
is it correct ?


[12/27/2022 10:19 PM] cieldautomne
```% git apply 0001-inkbox-splash-refresh-only-once.patch 
0001-inkbox-splash-refresh-only-once.patch:21: trailing whitespace.
        LD_LIBRARY_PATH=/opt/fbink busybox chroot /splash /opt/fbink/fbink -qhb -g file=/tmp/out.png,halign=CENTER,valign=TOP,y=60 
warning: 1 line adds whitespace errors.
```


[12/27/2022 10:20 PM] szybet
https://stackoverflow.com/questions/14509950/my-diff-contains-trailing-whitespace-how-to-get-rid-of-it

{Embed}
https://stackoverflow.com/questions/14509950/my-diff-contains-trailing-whitespace-how-to-get-rid-of-it
My diff contains trailing whitespace - how to get rid of it?
I've tried editing a php file in TextWrangler with line endings set to Unix, in NetBeans, and in vim. When I save the diff to a patch and then try to apply it, it gives whitespace errors. When I ty...
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[12/27/2022 10:20 PM] szybet
let humans be with you


[12/27/2022 10:20 PM] szybet
yea propably


[12/27/2022 10:20 PM] szybet
looks like that


[12/27/2022 10:22 PM] cieldautomne
the second one has two errors


[12/27/2022 10:22 PM] cieldautomne
```22:17 ciel@archciel /home/build/inkbox/kernel
% git apply 0001-rcS-root-fix-things-for-kobo-clara-hd.patch 
0001-rcS-root-fix-things-for-kobo-clara-hd.patch:44: trailing whitespace.
    unsquashfs -d /lib/modules /opt/modules.sqsh 
error: patch failed: initrd/common/rcS-root:60
error: initrd/common/rcS-root: patch does not apply
```


[12/27/2022 10:23 PM] szybet
well thats tux-linux fault because he didn't applied them when they were needed


[12/27/2022 10:23 PM] szybet
now there are conflicts


[12/27/2022 10:24 PM] szybet
/etc/init.d/inkbox-splash
 doesnt show anything?


[12/27/2022 10:27 PM] cieldautomne
without patch it just change the screen from black to white


[12/27/2022 10:27 PM] cieldautomne
(if it was previously black, in the case the screen was already white it does visualy nothing)


[12/27/2022 10:28 PM] szybet
is this a script? can you show me it?


[12/27/2022 10:29 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/message-0C53E.txt


[12/27/2022 10:29 PM] cieldautomne
after patch


[12/27/2022 10:36 PM] cieldautomne
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/inkbox-splash

{Embed}
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/inkbox-splash
kernel/inkbox-splash at master · Kobo-InkBox/kernel
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-07C4C


[12/27/2022 10:36 PM] cieldautomne
non patched


[12/27/2022 10:38 PM] szybet
im busy right now, can you just show me the diffrences between those 2? so i can understand the issue


[12/27/2022 10:42 PM] cieldautomne
https://editor.mergely.com/U8qeU0n7/

{Embed}
https://editor.mergely.com/U8qeU0n7/
Mergely - Diff online, merge documents
Merge and compare your documents online and share


[12/27/2022 10:43 PM] szybet
and with the patch, nothing changes?


[12/27/2022 10:46 PM] cieldautomne
im compiling the kernel again to test it


[12/27/2022 10:47 PM] cieldautomne
my computer is not a beast so it takes a bit of time to compile ^^


[12/27/2022 10:54 PM] szybet
👍


[12/27/2022 11:15 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221227_231351_368-402AC.jpg


[12/27/2022 11:15 PM] cieldautomne
the result


[12/27/2022 11:16 PM] cieldautomne
(yes me ereader is not clean :/)


[12/27/2022 11:16 PM] szybet
wooooooooooooooot


[12/27/2022 11:16 PM] szybet
what happened


[12/27/2022 11:16 PM] szybet
why is this so


[12/27/2022 11:16 PM] szybet
😐


[12/27/2022 11:16 PM] szybet
only the border


[12/27/2022 11:19 PM] cieldautomne
yep weird


[12/27/2022 11:20 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221227_231953_188-01E87.jpg


[12/27/2022 11:20 PM] cieldautomne
with `/etc/init.d/inkbox-splash alert_splash`


[12/27/2022 11:21 PM] szybet
is your ereader working?...


[12/27/2022 11:21 PM] szybet
like the screen looks if it had dead lines


[12/27/2022 11:22 PM] cieldautomne
im going to test again with the stock os


[12/27/2022 11:23 PM] cieldautomne
earlier in the day i was testing the stock os and it was ok


[12/27/2022 11:23 PM] cieldautomne
`/etc/init.d/inkbox-splash update_splash` seems to work well, black screen with 3 white (moving) dots


[12/27/2022 11:25 PM] szybet
well im going offline now
you can play arround with the fbink command to fix this, or make the partition table, install the rootfs, try out init, collect logs with problems etc, everything can be found in this chat, and #quill and #chat


[12/27/2022 11:25 PM] cieldautomne
same i need to sleep!


[12/27/2022 11:27 PM] cieldautomne
one more


[12/27/2022 11:27 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221227_232639_743-9C7D9.jpg


[12/28/2022 2:58 PM] cieldautomne
with stock os

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221228_145736_862-E67AD.jpg
/mnt/data/projects/git/conversations/media/IMG_20221228_145750_066-F7A97.jpg


[12/28/2022 2:58 PM] cieldautomne
seems ok


[12/28/2022 3:06 PM] szybet
very weird


[12/28/2022 3:07 PM] szybet
play out with fbink command

{Reactions}
👍 

[12/28/2022 5:19 PM] szybet
i saw, something


[12/28/2022 5:19 PM] szybet
and it vanished


[12/28/2022 5:19 PM] szybet
¯\_(ツ)_/¯


[12/28/2022 5:20 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20221228_171719_383-703B1.jpg
/mnt/data/projects/git/conversations/media/IMG_20221228_172006_871-E2ABA.jpg


[12/28/2022 5:20 PM] cieldautomne
one of the image was corrupted


[12/28/2022 5:21 PM] szybet
it works now?


[12/28/2022 5:22 PM] cieldautomne
basically i did nothing else than trying the stock os to see if the screen was broken


[12/28/2022 5:22 PM] cieldautomne
and then trying inkbox again without any modification to the sdcard


[12/28/2022 5:22 PM] cieldautomne
it seems


[12/28/2022 5:23 PM] szybet
random hardware problem, maybe


[12/28/2022 5:23 PM] cieldautomne
also if i type `fbink --help` it output "-sh: fbink: not found"


[12/28/2022 5:23 PM] szybet
¯\_(ツ)_/¯


[12/28/2022 5:24 PM] szybet
look up how the script uses fbink


[12/28/2022 5:26 PM] cieldautomne
it does some magic tricks


[12/28/2022 5:29 PM] cieldautomne
creating a /splash dir then extracting splash-rootfs.tar.xz into it, mounting some stuff and using chroot


[12/28/2022 5:29 PM] szybet
first run the script


[12/28/2022 5:29 PM] szybet
it unpacks it


[12/28/2022 5:29 PM] szybet
then launch fbink just as the script does


[12/28/2022 5:32 PM] cieldautomne
the script seems to create /splash and then chroot into it


[12/28/2022 5:32 PM] cieldautomne
but i don't have /splash


[12/28/2022 5:33 PM] cieldautomne
also `find / fbink` can't find fbink


[12/28/2022 5:37 PM] cieldautomne
i created /splaash, extracted splash-rootfs in it and then i can run something like that


[12/28/2022 5:38 PM] cieldautomne
`LD_LIBRARY_PATH=/opt/fbink busybox chroot /splaash/ /opt/fbink/fbink --help`


[12/28/2022 5:38 PM] szybet
it unpacks fbink


[12/28/2022 5:39 PM] cieldautomne
```cleanup() {
        umount "${CHROOT_DIR}/dev" -l -f &>/dev/null
        umount "${CHROOT_DIR}/sys" -l -f &>/dev/null
        umount "${CHROOT_DIR}/proc" -l -f &>/dev/null
        rm -rf "${CHROOT_DIR}" &>/dev/null
}```


[12/28/2022 5:40 PM] cieldautomne
maybe this remove /splash after /etc/init.d/inkbox-splash has been executed ?


[12/28/2022 5:41 PM] szybet
yea


[12/28/2022 5:41 PM] szybet
kind off


[12/28/2022 5:41 PM] szybet
unpack it manually


[12/28/2022 5:41 PM] cieldautomne
done


[12/28/2022 5:42 PM] cieldautomne
maybe i also need to mount some stuff to use something else than fbink --help


[12/28/2022 5:42 PM] szybet
something else doesnt work?


[12/28/2022 5:44 PM] cieldautomne
after mounting it seems to work


[12/28/2022 5:44 PM] cieldautomne
`mount -t devtmpfs devtmpfs "/splaash/dev" && mount -t sysfs sysfs "/splaash/sys" && mount -t proc proc "/splaash/proc"
` like in the script


[12/28/2022 5:44 PM] cieldautomne
then `LD_LIBRARY_PATH=/opt/fbink busybox chroot /splaash/ /opt/fbink/fbink -x 1 -y
 10 "Hello World!"`


[12/28/2022 5:45 PM] cieldautomne
```[FBInk] Couldn't find a Kobo version tag (onboard unmounted or not running on a Kobo?)!
[FBInk] Detected a Kobo Clara HD (376 => Nova @ Mark 7)
[FBInk] Enabled Kobo Mark 7 quirks
[FBInk] Clock tick frequency appears to be 100 Hz
[FBInk] Screen density set to 300 dpi
[FBInk] Variable fb info: 1072x1448, 16bpp @ rotation: 3 (Counter Clockwise, 270°)
[FBInk] Fixed fb info: ID is "mxc_epdc_fb", length of fb mem: 6782976 bytes & line length: 2176 bytes
[FBInk] Canonical rotation: 0 (Upright, 0°)
[FBInk] Fontsize set to 24x24 (IBM base glyph size: 8x8)
[FBInk] Line length: 44 cols, Page size: 60 rows
[FBInk] Vertical fit isn't perfect, shifting rows down by 4 pixels
[FBInk] Pen colors set to #000000 for the foreground and #FFFFFF for the background
Printing string 'Hello World!' @ column 1 + 0px, row 10 + 0px (overlay: N, no BG: N, no FG: N, inverted)
Next line should start @ row 11```


[12/28/2022 5:46 PM] cieldautomne
now there is also "Hello World!" on the screen


[12/28/2022 5:46 PM] szybet
okay, play arround to check if everything is working


[12/28/2022 5:52 PM] cieldautomne
as expected -c clears the screen before printing, -h correctly invert background and foreground, -f works


[12/28/2022 5:52 PM] szybet
well so everything works/


[12/28/2022 5:55 PM] cieldautomne
changing the font also seems to work


[12/28/2022 6:12 PM] szybet
good


[12/28/2022 6:12 PM] szybet
you can go now with rootfs i think


[12/28/2022 6:13 PM] cieldautomne
i have to unsquashfs rootfs.squashfs ?


[12/28/2022 6:13 PM] szybet
no


[12/28/2022 6:13 PM] szybet
stop


[12/28/2022 6:14 PM] szybet
you have the latest rootfs


[12/28/2022 6:14 PM] szybet
and you signed it


[12/28/2022 6:14 PM] szybet
and you replaced the keys in the kernel?


[12/28/2022 6:35 PM] cieldautomne
i think so


[12/28/2022 6:35 PM] cieldautomne
yep


[12/28/2022 6:35 PM] cieldautomne
i dont think so


[12/28/2022 6:37 PM] szybet
then with what did you signed it


[12/28/2022 6:39 PM] cieldautomne
with the private key i generated with `openssl genrsa -out private.pem 2048`


[12/28/2022 6:40 PM] cieldautomne
rootfs and overlaymount-rootfs have been signed with it


[12/28/2022 6:50 PM] szybet
you have to replace the key in the kernel rpeo and then recompile


[12/28/2022 6:50 PM] szybet
atro did it and did a guide, a guy at #quill also did it, at #chat

{Reactions}
👍 

[12/28/2022 6:50 PM] szybet
just look up the chat


[12/28/2022 7:19 PM] cieldautomne
is this command still needed ?


[12/28/2022 7:19 PM] szybet
no


[12/28/2022 7:19 PM] szybet
finally no ;p


[12/28/2022 7:42 PM] cieldautomne
after recompiling and rebooting i have this issue again...


[12/28/2022 7:42 PM] cieldautomne
anyway


[12/28/2022 7:43 PM] cieldautomne
i followed this https://discord.com/channels/809205711778480158/934478430903337020/935581571296165928


[12/28/2022 7:43 PM] cieldautomne
and it seems okay, the rootfs is correctly signed


[12/28/2022 8:13 PM] cieldautomne
I have read a few threads (libra h2o, nia) and to be honest I'm a bit lost, there's a lot of info dispersed all over the place and unfortunately I don't have the skills to sort it out...


[12/28/2022 8:15 PM] szybet
error code?


[12/28/2022 8:15 PM] szybet
you resigned it?


[12/28/2022 8:15 PM] cieldautomne
nop


[12/28/2022 8:16 PM] szybet
then do it


[12/28/2022 8:16 PM] szybet
with the keys you replaces in kernel


[12/28/2022 8:16 PM] cieldautomne
nothing special in dmesg and there is no /var/log/...


[12/28/2022 8:16 PM] szybet
i mean on the screen


[12/28/2022 8:16 PM] szybet
or serial


[12/28/2022 8:16 PM] cieldautomne
nop and nop


[12/28/2022 8:16 PM] szybet
nothing on serial?...


[12/28/2022 8:17 PM] cieldautomne
rootfs was already signed i just added public.pem to kernel, recompiled kernel and then copy zImage to p1 and boot


[12/28/2022 8:17 PM] szybet
good


[12/28/2022 8:18 PM] szybet
added?


[12/28/2022 8:18 PM] szybet
you mean replaced the key in squash in kernel?


[12/28/2022 8:18 PM] cieldautomne
yep


[12/28/2022 8:18 PM] szybet
good


[12/28/2022 8:18 PM] szybet
.


[12/28/2022 8:18 PM] cieldautomne
nothing


[12/28/2022 8:18 PM] szybet
even not uboot?


[12/28/2022 8:19 PM] cieldautomne
nothing related to the weird screen, the rest is functioning perfectly fine


[12/28/2022 8:19 PM] szybet
show me the log


[12/28/2022 8:20 PM] cieldautomne
i've rebooted since then


[12/28/2022 8:23 PM] cieldautomne
```[   64.315809] tps6518x-regulator tps6518x-regulator: tps6518x_regulator_probe(622): revID=102,6518x@641
[   64.319095] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   64.323471] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   64.323506] VCOM: Bringing 2790000uV into 2750000-2750000uV
[   64.326284] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   64.328244] _tps6518x_vcom_get_voltage() : vcom=2790000uV
[   64.365726] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   64.376410] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   64.383313] tps6518x_setup_timings():upseq=>0xe1,0x0,dwnseq=>0x1e,0xe0
[   72.356869] imx_epdc_v2_fb 20f4000.epdc: No qos phandle specified. Ignored.
[   72.359268] imx_epdc_v2_fb 20f4000.epdc: resolution 1448x1072, bpp 16
[   72.373306] imx_epdc_v2_fb 20f4000.epdc: EPDC version = 30
[   72.450414] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   72.455930] Console: switching to colour frame buffer device 181x67
[   72.477715] imx_epdc_v2_fb 20f4000.epdc:  --- Extra Waveform Data length: 40 bytes---
[   72.477806] imx_epdc_v2_fb 20f4000.epdc:      Extra Waveform Data: 320_R280_AJ2201_ED060KH6C5_VB3300C
[   72.501542] imx_epdc_v2_fb 20f4000.epdc: Unable to get an accurate EPDC pix clkdesired = 80000000, a2
[   72.573244] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   72.618023] tps6518x 1-0068: TPS6518X intr occured !!,INT1=0x4,INT2=0x1
[   74.773074] tps6518x 1-0068: tps6518x_wait_power_good():waiting(72) for PG(0) timeout
[   74.781961] imx_epdc_v2_fb 20f4000.epdc: Unable to enable DISPLAY regulator.err = 0xffffff92```


[12/28/2022 8:23 PM] cieldautomne
dmesg after modprobe tps6518x-regulator tps6518x-hwmon and mxc_epdc_v2_fb


[12/28/2022 8:23 PM] szybet
thats not all?


[12/28/2022 8:23 PM] cieldautomne
there are errors after mxc_epdc_v2_fb


[12/28/2022 8:24 PM] cieldautomne
but it seems to me they are always there


[12/28/2022 8:24 PM] szybet
show me *everything* **every** log you got from serial from beginning to end


[12/28/2022 8:25 PM] cieldautomne
after `/etc/init.d/inkbox-splash` there is nothing more in dmesg


[12/28/2022 8:25 PM] szybet
reboot, do nothing, only gather logs, show me them


[12/28/2022 8:25 PM] szybet
even dont press space


[12/28/2022 8:25 PM] szybet
to enter init, just let it go


[12/28/2022 8:26 PM] cieldautomne
ok


[12/28/2022 8:26 PM] cieldautomne
first bootloader


[12/28/2022 8:26 PM] cieldautomne
```U-Boot 2020.10 (Jun 28 2022 - 18:38:58 +0200)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 34C
Reset cause: POR
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0 
switch to partitions #0, OK
mmc0 is current device
Unknown command 'load_ntxkernel' - try 'help'
=>```


[12/28/2022 8:27 PM] cieldautomne
to boot i need to send these cmd ```ext4load mmc 0:1 0x83000000 DTB
ext4load mmc 0:1 0x80800000 zImage
bootz 0x80800000 - 0x83000000```


[12/28/2022 8:28 PM] cieldautomne
then


[12/28/2022 8:28 PM] cieldautomne
```=> ext4load mmc 0:1 0x83000000 DTB
28839 bytes read in 16 ms (1.7 MiB/s)
=> ext4load mmc 0:1 0x80800000 zImage
11220464 bytes read in 582 ms (18.4 MiB/s)
=> bootz 0x80800000 - 0x83000000
Kernel image @ 0x80800000 [ 0x000000 - 0xab35f0 ]
## Flattened Device Tree blob at 83000000
   Booting using the fdt blob at 0x83000000
   Using Device Tree in place at 83000000, end 8300a0a6

Starting kernel ...

[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.204952] debugfs: Directory 'dummy-iomuxc-gpr@20e4000' with parent 'regmap' already present!
[    1.617010] cyttsp5_i2c_adapter 1-0024: cyttsp5_get_hid_descriptor_: failed to get HID descriptor le6
[    1.641383] cyttsp5_i2c_adapter 1-0024: cyttsp5_startup_: Error on getting HID descriptor r=-6
[    1.862846] cyttsp5_i2c_adapter 1-0024: cyttsp5_read_input: Error getting report, r=-6
Interface 'lo': flags set to 0001.

Linux inkbox #1 SMP Wed Dec 28 19:02:01 CET 2022 GNU/Linux
InkBox OS, kernel build Mc8mBMTT, commit b0dec61

Copyright (C) 2021-2022 Nicolas Mailloux <nicolecrivain@gmail.com>
 * Checking filesystems ...

e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p1: clean, 13/3840 files, 13222/15360 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p2: clean, 12/128016 files, 46475/512000 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p3: clean, 14/32768 files, 70926/131072 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p4: clean, 12/442368 files, 52580/1766656 blocks```


[12/28/2022 8:28 PM] cieldautomne
```(initrd) Hit ENTER to stop auto-boot ... 

 * Security policy was violated! Shutting down ...
/etc/init.d/inkbox-splash: line 130: can't create /sys/class/graphics/fb0/rotate: nonexistent directory
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
awk: cmd. line:1: Unexpected end of string
```


[12/28/2022 8:29 PM] szybet
did you recompiled / flashed uboot lately?


[12/28/2022 8:29 PM] cieldautomne
i don't think so


[12/28/2022 8:30 PM] szybet
well then do it


[12/28/2022 8:31 PM] szybet
i hope after it you wont need to apply those commands


[12/28/2022 8:31 PM] cieldautomne
now if it reboot it shows `* Device is locked down and will not boot` and i have remove the sdcard to copy a fresh kernel/DTB to make it work again


[12/28/2022 8:31 PM] szybet
` * Security policy was violated! Shutting down ...` propably rootfs wasn't found


[12/28/2022 8:32 PM] cieldautomne
i've never followed those steps before


[12/28/2022 8:32 PM] szybet
?


[12/28/2022 8:32 PM] szybet
is this stock uboot?


[12/28/2022 8:32 PM] szybet
oh, uhm


[12/28/2022 8:32 PM] szybet
okay


[12/28/2022 8:33 PM] szybet
lets focus on uboot


[12/28/2022 8:33 PM] szybet
then rootfs


[12/28/2022 8:33 PM] szybet
.


[12/28/2022 8:35 PM] cieldautomne
i dont think so


[12/28/2022 8:36 PM] cieldautomne
but it has never been updated since then


[12/28/2022 8:39 PM] cieldautomne
```U-Boot 2020.10 (Jun 28 2022 - 18:38:58 +0200)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 33C
Reset cause: POR
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0 
switch to partitions #0, OK
mmc0 is current device
Unknown command 'load_ntxkernel' - try 'help'
=>```


[12/28/2022 8:39 PM] cieldautomne
it seems to be the same u-boot


[12/28/2022 8:39 PM] cieldautomne
2020.10


[12/28/2022 8:41 PM] cieldautomne
and i still need these cmd


[12/28/2022 8:41 PM] szybet
well but i hoped andi made changes


[12/28/2022 8:41 PM] szybet
well sad, this needs to be figured out


[12/28/2022 8:42 PM] cieldautomne
"Unknown command 'load_ntxkernel' - try 'help'"


[12/28/2022 8:42 PM] szybet
propably in the code your commands need to be replaced with this load_ntxkernel


[12/28/2022 8:42 PM] szybet
you can tinker with it, maybe you will figure it out


[12/28/2022 8:42 PM] szybet
with uboot we have the same level of experience ;p


[12/28/2022 8:43 PM] cieldautomne
=0


[12/28/2022 8:43 PM] szybet
`/etc/init.d/inkbox-splash: line 130: can't create /sys/class/graphics/fb0/rotate: nonexistent directory`


[12/28/2022 8:43 PM] szybet
this


[12/28/2022 8:43 PM] szybet
maybe fix this


[12/28/2022 8:43 PM] szybet
look up the line maybe first


[12/28/2022 8:43 PM] cieldautomne
and this `* Security policy was violated! Shutting down ...`


[12/28/2022 8:46 PM] cieldautomne
isn't it because some modules are not loaded ?


[12/28/2022 8:46 PM] cieldautomne
and also i always have to copy manualy epdc.fw


[12/28/2022 8:47 PM] szybet
this later, maybe because you haven't copied rootfs?


[12/28/2022 8:48 PM] cieldautomne
(also i have pretty much no knowledge in code, i can do noob shell scripting)


[12/28/2022 8:48 PM] szybet
oh hm... can you write c code? or willing to learn at pretty basic level


[12/28/2022 8:48 PM] cieldautomne
rootfs is in p3


[12/28/2022 8:49 PM] szybet
just to edit the init, using code from the internet to copy the epdc or something


[12/28/2022 8:49 PM] szybet
yes, have you coppied it?


[12/28/2022 8:49 PM] cieldautomne
no it's just staying in p3 as of know


[12/28/2022 8:50 PM] szybet
do you have 
```
rootfs.squashfs
rootfs.squashfs.dgst
```
in p3?


[12/28/2022 8:50 PM] cieldautomne
yep


[12/28/2022 8:51 PM] cieldautomne
with overlaymountfs and its digest


[12/28/2022 8:51 PM] cieldautomne
i think we need external help ^^'


[12/28/2022 8:51 PM] szybet
what was overlaymountfs once more?...


[12/28/2022 8:51 PM] cieldautomne
recovery stuff i think so


[12/28/2022 8:51 PM] cieldautomne
(and also i need to eat)


[12/28/2022 8:51 PM] szybet
idk ¯\_(ツ)_/¯


[12/28/2022 8:52 PM] szybet
this is propably because it locked down the device, and now it doesnt even check other things


[12/28/2022 8:53 PM] szybet
well look up in the code why is it showing it, just find the code, i will have a look of it


[12/28/2022 8:54 PM] cieldautomne
security policy violated is it a selinux thing ?


[12/28/2022 8:54 PM] cieldautomne
we could disable it for testing ?


[12/28/2022 8:54 PM] szybet
no


[12/28/2022 8:54 PM] szybet
thats what i aim for


[12/28/2022 8:55 PM] szybet
just find the code


[12/28/2022 8:55 PM] szybet
its in another repo


[12/28/2022 10:45 PM] cieldautomne
it's not in kernel repo ?


[12/29/2022 12:57 AM] szybet
https://github.com/Kobo-InkBox/inkbox-os-init

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init
GitHub - Kobo-InkBox/inkbox-os-init: InkBox OS' initialization prog...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 1:02 AM] tux_linux
No, he's using an older init I think


[12/29/2022 1:04 AM] szybet
then we should move to this anyway


[12/29/2022 1:04 AM] tux_linux
Yes but there were some patches I didn't accept yet


[12/29/2022 1:06 AM] szybet
he could implement them


[12/29/2022 1:06 AM] szybet
this isin't hard stuff


[12/29/2022 1:06 AM] szybet
just googling and praying it will work


[12/29/2022 11:00 AM] cieldautomne
where can i find the patches ?


[12/29/2022 11:28 AM] szybet
#patches


[12/29/2022 11:28 AM] szybet
i though you already used them?...


[12/29/2022 11:50 AM] cieldautomne
yes, andi1 patches for inkbox-splash and rcS-root but nothing for inkbox-os-init


[12/29/2022 11:53 AM] cieldautomne
I was asking because after looking at #patches I don't think there are any patches for inkbox-os-init


[12/29/2022 1:21 PM] szybet
yea i mean using those patches and applying them ( rewriting ) for the clara


[12/29/2022 1:21 PM] szybet
inkbox os init is a replacement for the current init


[12/29/2022 1:39 PM] andi15701
load_ntxkernel is a special kobo invention


[12/29/2022 1:39 PM] andi15701
we are using a near-mainline u-boot


[12/29/2022 1:39 PM] andi15701
so we use load mmc 0:x ${loadaddr} /kernel


[12/29/2022 1:39 PM] andi15701
to load the kernel


[12/29/2022 1:39 PM] andi15701
e.g.


[12/29/2022 1:41 PM] andi15701
load mmc 0:x ${fdt_addr_r} /path/to/imx6sll-kobo-clarahd.dtb


[12/29/2022 1:42 PM] andi15701
load mmc 0:x ${loadaddr} /zImage


[12/29/2022 1:43 PM] andi15701
setenv bootargs root=/dev/mmcblk0pX console=ttymxc0,115200


[12/29/2022 1:43 PM] andi15701
bootz ${loadaddr} - ${fdt_addr_r}


[12/29/2022 1:43 PM] andi15701
that is basically the mainline u-boot game


[12/29/2022 1:44 PM] andi15701
and of course, you do not want to type that in every now and then


[12/29/2022 1:45 PM] andi15701
so do some setenv bootcmd load mmc ...  \; load mmc ... \; setenv bootargs ...\; bootz ${loadaddr} - ${fdt_addr_r}


[12/29/2022 1:46 PM] andi15701
and saveenv


[12/29/2022 1:46 PM] andi15701
and them it should boot automatically


[12/29/2022 1:46 PM] andi15701
the next time


[12/29/2022 2:08 PM] andi15701
of course that can be automated


[12/29/2022 2:10 PM] andi15701
for how to do that, simply look at the device-tolino-shine2hd package


[12/29/2022 2:10 PM] andi15701
of pmOS


[12/29/2022 2:10 PM] andi15701
that is the most simpliest solution


[12/29/2022 2:10 PM] andi15701
there I create a boot.scr in /boot/


[12/29/2022 2:22 PM] andi15701
or more precise in the first partition


[12/29/2022 2:24 PM] andi15701
https://gitlab.com/postmarketOS/pmaports/-/blob/master/device/testing/device-tolino-shine2hd/uboot-script.cmd

{Embed}
https://gitlab.com/postmarketOS/pmaports/-/blob/master/device/testing/device-tolino-shine2hd/uboot-script.cmd
device/testing/device-tolino-shine2hd/uboot-script.cmd · master · p...
postmarketOS package build recipes
/mnt/data/projects/git/conversations/media/icon_mobile-9A834.png


[12/29/2022 2:25 PM] andi15701
mkimage -A arm -O linux -T script -n postmarketOS \
                -d "$srcdir/uboot-script.cmd" "$srcdir/boot.scr"


[12/29/2022 2:30 PM] cieldautomne
i can remove the lines that tells to load the initrd ?


[12/29/2022 2:31 PM] andi15701
if the initrd is not loaded or included in the kernel, yes


[12/29/2022 2:31 PM] cieldautomne
im not sure but i think it built into the kernel


[12/29/2022 2:32 PM] andi15701
bootz .... 0x85000000 ...


[12/29/2022 2:32 PM] szybet
its one file, so yes its built in


[12/29/2022 2:32 PM] andi15701
that has to be bootz 0x80800000 - 0x83000000


[12/29/2022 2:34 PM] andi15701
loading such a script in u-boot to test:


[12/29/2022 2:35 PM] andi15701
load mmc 0:1 ${loadaddr} /boot.scr


[12/29/2022 2:35 PM] andi15701
source ${loadaddr}


[12/29/2022 2:40 PM] cieldautomne
nice it's working


[12/29/2022 2:40 PM] cieldautomne
is it possible to load the kernel directly without having to type ? ```load mmc 0:1 ${loadaddr} /boot.scr
source ${loadaddr}```


[12/29/2022 2:41 PM] andi15701
it should do


[12/29/2022 2:41 PM] andi15701
if you just reboot


[12/29/2022 2:42 PM] cieldautomne
is it normal that reboot/poweroff commands do nothing in shell (with auto-boot interrupted)


[12/29/2022 2:43 PM] andi15701
I think for poweroff there is a driver required which is not included for the PMIC


[12/29/2022 2:44 PM] andi15701
reset might work


[12/29/2022 2:44 PM] andi15701
we are talking about u-boot shell?


[12/29/2022 2:44 PM] cieldautomne
nop


[12/29/2022 2:44 PM] andi15701
or linux shell


[12/29/2022 2:44 PM] cieldautomne
after kernel is loaded but init is interrupted


[12/29/2022 2:45 PM] andi15701
for linux shell: these commands interact with the init system


[12/29/2022 2:45 PM] andi15701
and do not poweroff/reboot themselves


[12/29/2022 2:45 PM] andi15701
you can do echo -n u >/proc/sysrq-trigger ; echo -n b >/proc/sysrq-trigger


[12/29/2022 2:46 PM] andi15701
to reboot


[12/29/2022 2:47 PM] cieldautomne
after a reboot im still welcomed with `Unknown command 'load_ntxkernel' - try 'help`


[12/29/2022 2:48 PM] andi15701
type print


[12/29/2022 2:49 PM] andi15701
the ugly way for now:


[12/29/2022 2:49 PM] cieldautomne
```baudrate=115200
bootcmd=mmc dev ${mmcdev};if run loadimage; then run mmcboot; fi; 
bootcmd_mfg=run mfgtool_args;bootz ${loadaddr} ${initrd_addr} ${fdt_addr};
bootdelay=1
bootscript=echo Running bootscript from mmc ...; source
console=ttymxc0
epdc_waveform=epdc_splash.bin
fastboot_dev=mmc0
fdt_addr=0x83000000
fdt_file=undefined
fdt_high=0xffffffff
fdtcontroladdr=9ef9ab30
image=zImage
initrd_addr=0x83800000
initrd_high=0xffffffff
ip_dyn=yes
loadaddr=0x80800000
loadbootscript=fatload mmc ${mmcdev}:${mmcpart} ${loadaddr} ${script};
loadfdt=load_ntxdtb
loadimage=load_ntxkernel
mfgtool_args=setenv bootargs console=${console},${baudrate} rdinit=/linuxrc g_mass_storage.stall=0 g_ma 
mmcargs=setenv bootargs console=${console},${baudrate} rootwait rw no_console_suspend 
mmcautodetect=no
mmcboot=echo Booting from mmc ...; run mmcargs; if run loadfdt; then bootz ${loadaddr} - ${fdt_addr}; e;
mmcdev=0
mmcpart=1
script=boot.scr
stderr=serial
stdin=serial
stdout=serial

Environment size: 1169/8188 bytes```


[12/29/2022 2:49 PM] andi15701
so,  you can either kill the environment


[12/29/2022 2:49 PM] andi15701
or modify it


[12/29/2022 2:49 PM] cieldautomne
like this ?


[12/29/2022 2:50 PM] andi15701
setenv bootcmd load mmc 0:1 ${loadaddr} /boot.scr \\; source ${loadaddr}


[12/29/2022 2:50 PM] andi15701
saveenv


[12/29/2022 2:51 PM] andi15701
hmm, discord eats \


[12/29/2022 2:52 PM] cieldautomne
nice it's working


[12/29/2022 2:53 PM] szybet
try
```
\/ setenv bootcmd load mmc 0:1 ${loadaddr} /boot.scr \; source ${loadaddr} 
```


[12/29/2022 2:53 PM] szybet
\/ setenv bootcmd load mmc 0:1 ${loadaddr} /boot.scr \; source ${loadaddr}


[12/29/2022 2:54 PM] andi15701
the backslash before the ; is important, I had to double it


[12/29/2022 2:55 PM] andi15701
to make discord display it


[12/29/2022 2:56 PM] cieldautomne
also i compiled inkbox-os-init and changed inittab to use /etc/init.d/init rather than /etc/init.d/rcS


[12/29/2022 2:56 PM] cieldautomne
should i try to not interrupt auto-boot now ?


[12/29/2022 2:56 PM] andi15701
try


[12/29/2022 2:56 PM] andi15701
auto-boot of u-boot?


[12/29/2022 2:57 PM] cieldautomne
nop


[12/29/2022 2:57 PM] cieldautomne
here


[12/29/2022 2:58 PM] andi15701
that is inkbox-os-int?


[12/29/2022 2:58 PM] cieldautomne
i don't think so


[12/29/2022 2:59 PM] cieldautomne
.


[12/29/2022 2:59 PM] andi15701
so, that one with my patches?


[12/29/2022 2:59 PM] cieldautomne
```Starting kernel ...

[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.204790] debugfs: Directory 'dummy-iomuxc-gpr@20e4000' with parent 'regmap' already present!
[    1.606844] cyttsp5_i2c_adapter 1-0024: cyttsp5_get_hid_descriptor_: failed to get HID descriptor le6
[    1.631249] cyttsp5_i2c_adapter 1-0024: cyttsp5_startup_: Error on getting HID descriptor r=-6
[    1.851714] cyttsp5_i2c_adapter 1-0024: cyttsp5_read_input: Error getting report, r=-6
Interface 'lo': flags set to 0001.

Linux inkbox #1 SMP Thu Dec 29 14:06:37 CET 2022 GNU/Linux
InkBox OS, kernel build nE7HstPa, commit b0dec61

Copyright (C) 2021-2022 Nicolas Mailloux <nicolecrivain@gmail.com>
 * Checking filesystems ...

e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p1: clean, 14/3840 files, 13222/15360 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p2: clean, 12/128016 files, 46475/512000 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p3: clean, 14/32768 files, 70926/131072 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p4: clean, 12/442368 files, 52580/1766656 blocks

(initrd) Hit ENTER to stop auto-boot ... 

 * Security policy was violated! Shutting down ...
/etc/init.d/inkbox-splash: line 130: can't create /sys/class/graphics/fb0/rotate: nonexistent directory
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
[FBInk] [fbink_open] Cannot open framebuffer character device: No such file or directory!
[CLI] Failed to open the framebuffer, aborting . . .
awk: cmd. line:1: Unexpected end of string```


[12/29/2022 2:59 PM] cieldautomne
same error as before


[12/29/2022 2:59 PM] szybet
i talked about this already


[12/29/2022 2:59 PM] andi15701
hmm, are modules loaded?


[12/29/2022 3:00 PM] szybet
there is propably somewhere written that its locked up and it doesnt even try to check


[12/29/2022 3:05 PM] cieldautomne
it does not seems to be


[12/29/2022 3:10 PM] cieldautomne
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L250

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:12 PM] cieldautomne
so there is a root flag to change to true somewhere ?


[12/29/2022 3:13 PM] cieldautomne
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L210

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:16 PM] andi15701
can you break that autoboot and modprobe tps6518x-hwmon ; modprobe tps6518x-regulator ; modprobe mxc_epdc_v2_fb


[12/29/2022 3:16 PM] cieldautomne
yep and in this case things like /etc/init.d/inkbox-splash will work


[12/29/2022 3:17 PM] szybet
sooo you need to add it into init


[12/29/2022 3:17 PM] szybet
the new one in c


[12/29/2022 3:17 PM] cieldautomne
sometimes like this


[12/29/2022 3:17 PM] cieldautomne
and sometimes like this


[12/29/2022 3:17 PM] szybet
i dont think thats the case


[12/29/2022 3:18 PM] szybet
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L150-L156

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:18 PM] szybet
here is your problem


[12/29/2022 3:19 PM] szybet
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L244-L254

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:19 PM] szybet
here is this problem too


[12/29/2022 3:19 PM] szybet
IDK, maybe... you need to write the root into the sd card


[12/29/2022 3:19 PM] szybet
ine the nia thread, there is somewhere this command that writes root to the sd card using dd


[12/29/2022 3:19 PM] szybet
maybe its that


[12/29/2022 3:19 PM] szybet
but @tux-linux knows whats is going on for 100%


[12/29/2022 3:21 PM] cieldautomne
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L210

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:22 PM] cieldautomne
here it's checking if the root flag is set or not


[12/29/2022 3:22 PM] andi15701
if [ "${DEVICE}" == "n249" ]; then
+    unsquashfs -d /lib/modules /opt/modules.sqsh 
+    # no support for xz in unsquashfs
+    mkdir -p /lib/firmware/imx/epdc
+    mount /opt/firmware.sqsh /lib/firmware/imx/epdc
+    find /sys/devices -name modalias -type f -print0 | xargs -0 sort -u | while read mod ; do modprobe $mod ; done
+fi


[12/29/2022 3:22 PM] andi15701
so we need that one in C


[12/29/2022 3:22 PM] andi15701
especially the find-line


[12/29/2022 3:23 PM] cieldautomne
here it's unsquashing the modules


[12/29/2022 3:23 PM] cieldautomne
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L27

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:23 PM] andi15701
or just insert a system("find /sys/devices -name modalias -type f -print0 | xargs -0 sort -u | while read mod ; do modprobe $mod ; done") I guess


[12/29/2022 3:24 PM] szybet
yea i know


[12/29/2022 3:24 PM] szybet
just look for the root command in nia thread

{Reactions}
👍 

[12/29/2022 3:24 PM] szybet
we would prefer native c


[12/29/2022 3:24 PM] szybet
there is already functions for that


[12/29/2022 3:24 PM] cieldautomne
there are no reference of n249 in init.c


[12/29/2022 3:24 PM] andi15701
probably we can just execute that line unconditionally


[12/29/2022 3:25 PM] cieldautomne
here it's loading the modules https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L885

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:33 PM] szybet
you need to add it


[12/29/2022 3:33 PM] szybet
if device n249 then load modules


[12/29/2022 3:34 PM] andi15701
I think even unconditionally


[12/29/2022 3:48 PM] cieldautomne
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c#L230

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init/blob/87864163a2073f319da34ef6af4b56e1e3bf0e3f/init.c
inkbox-os-init/init.c at 87864163a2073f319da34ef6af4b56e1e3bf0e3f ·...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[12/29/2022 3:48 PM] cieldautomne
this is checking if initrd is rooted


[12/29/2022 3:49 PM] cieldautomne
and if i check manualy the content of /opt/root it shows "rooted" so the initrd is rooted


[12/29/2022 3:50 PM] cieldautomne
the issue is probably the MMC part before


[12/29/2022 3:51 PM] cieldautomne
(i can't find any relevant mention of "root" in nia thread, at least the search feature of discord can't find it)


[12/29/2022 4:12 PM] cieldautomne
what's weird is that other devices don't seem to need this


[12/29/2022 4:12 PM] szybet
every device is diffrent


[12/29/2022 4:12 PM] szybet
¯\_(ツ)_/¯


[12/29/2022 4:14 PM] cieldautomne
they don't need epdc.fw and modules to be loaded to show stuff on display ?!


[12/29/2022 4:14 PM] szybet
this one is mainline kernel


[12/29/2022 4:14 PM] szybet
maybe you could make it built in


[12/29/2022 4:15 PM] szybet
but why


[12/29/2022 4:15 PM] cieldautomne
it's more work to maintain it built-in rather than adapting the init script am i wrong ?


[12/29/2022 4:16 PM] andi15701
there is some weird thing with probing order, touchscreen and epdc pmic probing at the same time seems to create mess


[12/29/2022 4:16 PM] andi15701
so that can be easily avoided by having one as a module


[12/29/2022 4:17 PM] andi15701
I am not sure wether the waveform stuff will load at all with builtin drivers...


[12/29/2022 4:17 PM] andi15701
but I thing adding module support is easy


[12/29/2022 4:19 PM] szybet
yea, linux kernel is weird, some things work only as built in, some only as modules


[12/29/2022 4:25 PM] cieldautomne
```// Kobo Clara HD (N249) specific stuff
    if(strstr(device, "n249")) {
        // Unsquashing modules
        }
            const char * arguments[] = { "/usr/bin/unsquashfs", "-d", "/lib/modules", "/opt/modules.sqsh", NULL }; run_command("/usr/bin/unsquashfs", arguments, true);
        }
        
        // Put epdc.fw in the right place
        mkpath("/lib/firmware/epdc", 0755);    
        mount("/opt/firmware.sqsh", "/lib/firmware/epdc", "squashfs", 0, "");
```


[12/29/2022 4:25 PM] cieldautomne
basically im doing copy/paste


[12/29/2022 4:25 PM] szybet
yea, do this as other things are there doing


[12/29/2022 4:26 PM] cieldautomne
I don't now if mkpath with permission 0755 is adapted


[12/29/2022 4:26 PM] cieldautomne
same for this part `, "squashfs", 0, ""`


[12/29/2022 4:28 PM] cieldautomne
also im not sure to understand what this is doing`find /sys/devices -name modalias -type f -print0 | xargs -0 sort -u | while read mod ; do modprobe $mod ; done`


[12/29/2022 4:29 PM] cieldautomne
I can't just write something to execute this: `modprobe tps6518x-hwmon ; modprobe tps6518x-regulator ; modprobe mxc_epdc_v2_fb`


[12/29/2022 4:29 PM] andi15701
the last one is not that generic


[12/29/2022 4:30 PM] andi15701
the first one is practically poor mans udev


[12/29/2022 4:30 PM] andi15701
it reads out the module alias for every device and tries to load modules


[12/29/2022 4:30 PM] andi15701
for it


[12/29/2022 4:34 PM] cieldautomne
but i started writing it conditionaly


[12/29/2022 4:34 PM] andi15701
cat /sys/bus/i2c/devices/1-0068/modalias 
of:Nepdc-pmicT(null)Cti,tps6518x


[12/29/2022 4:35 PM] andi15701
# modinfo tps6518x
filename:       /lib/modules/6.1.0-00124-g6f9a6143fbd9/kernel/drivers/mfd/tps6518x.ko
license:        GPL
description:    TPS6518xx PMIC for Electronic Paper Display driver
srcversion:     421DF9B1A2BF0A0EAC44DC1
alias:          of:N*T*Cti,tps6518xC*
alias:          of:N*T*Cti,tps6518x
depends:        
intree:         Y
name:           tps6518x
vermagic:       6.1.0-00124-g6f9a6143fbd9 SMP mod_unload modversions ARMv6 p2v8


[12/29/2022 4:41 PM] andi15701
I would even suggest to have such things a bit more cleaned up, somewhere a config file for the device with things like load_modules=yes, waveform_via_firmwarefile=yes


[12/29/2022 4:42 PM] andi15701
It will make porting probably faster, if things have to be adapter at less places


[12/29/2022 4:43 PM] andi15701
but of course, for now, you can just add that simple modprobe line


[12/29/2022 4:43 PM] andi15701
with such a configuration file, you could write if (load_modules)


[12/29/2022 4:43 PM] andi15701
or so


[12/29/2022 4:45 PM] cieldautomne
~ # modinfo tps6518x
modinfo: module '/lib/modules/5.16.0/tps6518x' not found


[12/29/2022 4:47 PM] cieldautomne
even ~ # modinfo tps6518x-regulator
modinfo: module '/lib/modules/5.16.0/tps6518x-regulator' not found


[12/29/2022 4:47 PM] cieldautomne
tps6518x-regulator is located at /lib/modules/5.16.0/kernel/drivers/regulator/


[12/29/2022 5:08 PM] szybet
what are you even trying to do


[12/29/2022 5:08 PM] cieldautomne
replicate this


[12/29/2022 5:08 PM] szybet
why do you want this


[12/29/2022 5:10 PM] cieldautomne
i don't know


[12/29/2022 5:10 PM] cieldautomne
i find it weird that modinfo can't find the modules


[12/29/2022 5:11 PM] szybet
because its looking into `/lib/modules/5.16.0/`


[12/29/2022 5:11 PM] cieldautomne
yep


[12/29/2022 5:11 PM] szybet
and you are unsqiashing those modules somewhere else


[12/29/2022 5:12 PM] cieldautomne
hmmm


[12/29/2022 5:12 PM] cieldautomne
`/lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko`


[12/29/2022 5:12 PM] cieldautomne
it is in /lib/modules/


[12/29/2022 5:12 PM] szybet
diffrent path.


[12/29/2022 5:13 PM] andi15701
so you have /lib//modules//lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko?


[12/29/2022 5:13 PM] szybet
no?


[12/29/2022 5:13 PM] andi15701
instead of /lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko


[12/29/2022 5:15 PM] cieldautomne
yep i know what's weird is that when andi1 type modinfo tps6518x it is able to find the module even if it's not in /lib/modules/5.16.0/tps6518x but in /lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko


[12/29/2022 5:16 PM] cieldautomne
anyway


[12/29/2022 5:16 PM] cieldautomne
modprobe is able to find the modules and correctly load them....


[12/29/2022 5:17 PM] szybet
good, focus on that


[12/29/2022 5:17 PM] szybet
we dont need modinfo


[12/29/2022 5:19 PM] cieldautomne
```// Kobo Clara HD (N249) specific stuff
    if(strstr(device, "n249")) {
        // Unsquashing modules
        {    
            const char * arguments[] = { "/usr/bin/unsquashfs", "-d", "/lib/modules", "/opt/modules.sqsh", NULL }; run_command("/usr/bin/unsquashfs", arguments, true);
        }
        
        // Put epdc.fw in the right place
        mkpath("/lib/firmware/imx/epdc", 0755);    
        mount("/opt/firmware.sqsh", "/lib/firmware/imx/epdc", "squashfs", 0, "");

        // Load some modules
        load_module("/lib/modules/5.16.0/kernel/drivers/hwmon/tps6518x-hwmon.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/regulator/tps6518x-regulator.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko", "");

        }
```


[12/29/2022 5:19 PM] cieldautomne
i've written this


[12/29/2022 5:19 PM] szybet
does it work


[12/29/2022 5:19 PM] szybet
?


[12/29/2022 5:20 PM] cieldautomne
im going to try


[12/29/2022 5:20 PM] cieldautomne
kernel compilation is quite long


[12/29/2022 5:20 PM] szybet
well also put some logs in there


[12/29/2022 5:20 PM] andi15701
why are you using full paths?


[12/29/2022 5:20 PM] andi15701
maybe tomorrow I want to update the kernel


[12/29/2022 5:20 PM] cieldautomne
it's conditional but it's just to try


[12/29/2022 5:21 PM] cieldautomne
yep, it's just to try if loading modules and putting epdc where it should be works


[12/29/2022 5:23 PM] szybet
***don't*** 😄


[12/29/2022 5:24 PM] andi15701
you need also drivers/mfd/tps6518x.ko


[12/29/2022 5:25 PM] cieldautomne
```~ # ls /lib/modules/5.16.0/kernel/drivers/
hwmon      net        power      regulator  rtc        usb        video```


[12/29/2022 5:26 PM] andi15701
so it is compiled in


[12/29/2022 5:26 PM] andi15701
fine


[12/29/2022 7:01 PM] andi15701
about automating that u-boot-env stuff (setenv/saveenv)

{Reactions}
👍 

[12/29/2022 7:01 PM] andi15701
https://gitlab.com/postmarketOS/pmaports/-/blob/f046cd5d1b8e5da6c25d712ac4d99b6cd6248e8d/device/testing/u-boot-kobo-librah2o/u-boot-env.txt

{Embed}
https://gitlab.com/postmarketOS/pmaports/-/blob/f046cd5d1b8e5da6c25d712ac4d99b6cd6248e8d/device/testing/u-boot-kobo-librah2o/u-boot-env.txt
device/testing/u-boot-kobo-librah2o/u-boot-env.txt · f046cd5d1b8e5d...
postmarketOS package build recipes
/mnt/data/projects/git/conversations/media/icon_mobile-9A834.png


[12/29/2022 7:01 PM] andi15701
tools/mkenvimage -p 0 -s 8192 -o u-boot-env.bin "$srcdir/u-boot-env.txt"


[12/29/2022 7:02 PM] andi15701
mkenvimage is often available in u-boot tools


[12/29/2022 7:04 PM] andi15701
which is then copied to sector 1536


[12/29/2022 7:05 PM] andi15701
dd if=u-boot-env.bin bs=512 seek=1536 of=/dev/sdX


[12/29/2022 8:17 PM] cieldautomne
i must be doing something wrong, it must be using the old init script and not inkbox-os-init


[12/29/2022 8:17 PM] szybet
did you replaced it?...


[12/29/2022 8:17 PM] cieldautomne
how do i tell correctly the kernel to use the new one ?


[12/29/2022 8:18 PM] cieldautomne
i compiled the new init ```armv7l-linux-musleabihf-gcc init.c -o init -static -D_GNU_SOURCE
armv7l-linux-musleabihf-strip init``` and put it in .../etc/init.d/


[12/29/2022 8:19 PM] andi15701
initrd uses what rdinit kernel parameter is pointing to


[12/29/2022 8:19 PM] cieldautomne
ok so i have to change a kernel parameter


[12/29/2022 8:20 PM] cieldautomne
i tried to find a kernel parameter related to init but without knowing the parameter name it's not easy


[12/29/2022 8:20 PM] andi15701
change the setenv bootargs and recreate the boot.scr


[12/29/2022 8:21 PM] andi15701
if the kernel accepts parameters from u-boot


[12/29/2022 8:21 PM] andi15701
und does not overwrite them


[12/29/2022 8:22 PM] andi15701
which might be the case if CONFIG_CMDLINE_FORCE is set


[12/29/2022 8:22 PM] cieldautomne
it is set to yes


[12/29/2022 8:22 PM] andi15701
but I  do not have special knowledge of the init process here


[12/29/2022 8:23 PM] cieldautomne
i can change `CONFIG_CMDLINE="console=ttymxc0,115200 quiet root=/dev/ram0 rdinit=/sbin/init rootfstype=ramfs"`


[12/29/2022 8:23 PM] cieldautomne
rdinit=/etc/init.d/init ?


[12/29/2022 8:23 PM] andi15701
No idea


[12/29/2022 8:24 PM] andi15701
as said, I do not know the inkbox system too well, I know how kernels work


[12/29/2022 8:24 PM] andi15701
but that is all


[12/29/2022 8:24 PM] szybet
stopp


[12/29/2022 8:24 PM] szybet
just replace the script


[12/29/2022 8:24 PM] cieldautomne
yes


[12/29/2022 8:24 PM] cieldautomne
obviously


[12/29/2022 8:25 PM] szybet
yea


[12/29/2022 8:25 PM] szybet
whats the problem


[12/29/2022 8:25 PM] szybet
look up tux linux commits, he did it for all repos


[12/29/2022 8:25 PM] cieldautomne
im dumb


[12/29/2022 8:26 PM] cieldautomne
so rather than putting init to /etc/init.d/ i put it in /sbin


[12/29/2022 8:28 PM] cieldautomne
```20:28 ciel@archciel /home/build/inkbox/kernel/initrd/busybox-1.32.1/_install-n249/sbin
% ls init                  
lrwxrwxrwx 14 ciel ciel 27 déc.  17:16 init -> ../bin/busybox```


[12/29/2022 8:29 PM] cieldautomne
currently it seems to point to busybox


[12/29/2022 8:31 PM] andi15701
which then uses /etc/inittab


[12/29/2022 8:32 PM] cieldautomne
and


[12/29/2022 8:32 PM] cieldautomne
```cat initrd/busybox-1.32.1/_install-n249/etc/inittab 
::sysinit:/etc/init.d/init```


[12/29/2022 8:32 PM] cieldautomne
and i put init in /etc/init.d/init


[12/29/2022 8:38 PM] szybet
he replaced lately it for all devices, look up the commits...

{Reactions}
👍 

[12/29/2022 10:17 PM] cieldautomne
okay


[12/29/2022 10:17 PM] cieldautomne
changing /sbin/init works


[12/29/2022 10:18 PM] cieldautomne
i modified a bit the init to force not enforcing security policy but i still don't know how to root the device


[12/29/2022 10:18 PM] cieldautomne
```Starting kernel ...

[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.205085] debugfs: Directory 'dummy-iomuxc-gpr@20e4000' with parent 'regmap' already present!
[    1.626020] cyttsp5_i2c_adapter 1-0024: cyttsp5_get_hid_descriptor_: failed to get HID descriptor le6
[    1.652457] cyttsp5_i2c_adapter 1-0024: cyttsp5_startup_: Error on getting HID descriptor r=-6
[    1.872827] cyttsp5_i2c_adapter 1-0024: cyttsp5_read_input: Error getting report, r=-6
Parallel unsquashfs: Using 1 processor
66 inodes (65 blocks) to write



created 64 files
created 32 directories
created 2 symlinks
[    5.302065] /opt/firmware.sqsh: Can't open blockdev

created 0 fifos
created 0 sockets
Interface 'lo': flags set to 0001.

Linux inkbox #1 SMP Thu Dec 29 21:54:39 CET 2022 GNU/Linux
InkBox OS, kernel build SOnRHXu7, commit b0dec61

Copyright (C) 2021-2022 Nicolas Mailloux <nicolecrivain@gmail.com>
 * Checking filesystems ...

e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p1: clean, 14/3840 files, 13251/15360 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p2: clean, 12/128016 files, 46475/512000 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p3: clean, 14/32768 files, 70926/131072 blocks
e2fsck 1.46.2 (28-Feb-2021)
/dev/mmcblk0p4: clean, 12/442368 files, 52580/1766656 blocks

(initrd) Hit ENTER to stop auto-boot ... 

 * Device is rooted; not enforcing security policy
 * Boot mode: Standard
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!
Verifying root filesystem's digital signature ...
```


[12/29/2022 10:18 PM] cieldautomne
```Done.
 * Mounted root filesystem
 * Mounted core SquashFS archives
 * Mounted essential filesystems
Error opening signature file /mnt/opt/storage/gui_rootfs.isa.dgst
3070039412:error:02001002:system library:fopen:No such file or directory:crypto/bio/bss_file.c:69:fopen)
3070039412:error:2006D080:BIO routines:BIO_new_file:no such file:crypto/bio/bss_file.c:76:
Can't open squashfs image: No such file or directory

Failed to open /opt/gui_rootfs/write/: No such file or directory. Aborting!

[   24.126714] Kernel panic - not syncing: Attempted to kill init! exitcode=0x0000000b
```


[12/29/2022 10:23 PM] szybet
I said


[12/29/2022 10:23 PM] szybet
nia thread


[12/29/2022 10:23 PM] szybet
:(


[12/29/2022 10:23 PM] szybet
look there


[12/29/2022 10:23 PM] cieldautomne
i can't find it T.T


[12/29/2022 10:24 PM] cieldautomne
and discord search can't find any relevant mention of "root" or "rooted" in nia thread


[12/29/2022 10:24 PM] cieldautomne
im going to search again


[12/29/2022 10:25 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-9EAE2.png


[12/29/2022 10:26 PM] szybet
got it


[12/29/2022 10:27 PM] cieldautomne
how ?!


[12/29/2022 10:27 PM] cieldautomne
😤


[12/29/2022 10:27 PM] szybet
od: Nicolas Mailloux#6180 przed: 2022-06-15 dd


[12/29/2022 10:28 PM] szybet
discord has some ***fancy*** and ***cool*** so ***`powerfull`*** search engine for its messages


[12/29/2022 10:29 PM] szybet
try this and reenable things in the init


[12/29/2022 10:29 PM] szybet
this looks good

{Reactions}
👍 

[12/29/2022 10:29 PM] cieldautomne
sorry but I don't have a degree of discord search engine


[12/29/2022 10:29 PM] szybet
look it up


[12/29/2022 10:29 PM] szybet
its the only reason we use discord


[12/29/2022 10:33 PM] szybet
make a pull request with the changes you made to init


[12/29/2022 10:33 PM] szybet
tux-linux is rarely online, so it would be better if the changes would be waiting for him to look at them, even if thats not all


[12/29/2022 10:33 PM] szybet
@atro


[12/29/2022 10:34 PM] szybet
https://tenor.com/view/wake-the-fuxx-up-samurai-gif-20053713

{Embed}
https://tenor.com/view/wake-the-fuxx-up-samurai-gif-20053713
/mnt/data/projects/git/conversations/media/wake-the-fuxx-up-samurai-A8844.png


[12/29/2022 10:37 PM] cieldautomne
`[    5.302065] /opt/firmware.sqsh: Can't open blockdev`


[12/29/2022 10:37 PM] cieldautomne
this is from what i added


[12/29/2022 10:37 PM] cieldautomne
and it's not good


[12/29/2022 10:37 PM] szybet
uhm


[12/29/2022 10:37 PM] szybet
show me the code


[12/29/2022 10:38 PM] cieldautomne
```    // Kobo Clara HD (N249) specific stuff
    if(strstr(device, "n249")) {
        // Unsquashing modules
        {    
            const char * arguments[] = { "/usr/bin/unsquashfs", "-d", "/lib/modules", "/opt/modules.sqsh", NULL }; run_command("/usr/bin/unsquashfs", arguments, true);
        }
        
        // Put epdc.fw in the right place
        mkpath("/lib/firmware/imx/epdc", 0755);    
        mount("/opt/firmware.sqsh", "/lib/firmware/imx/epdc", "squashfs", 0, "");

        // Load some modules
        load_module("/lib/modules/5.16.0/kernel/drivers/hwmon/tps6518x-hwmon.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/regulator/tps6518x-regulator.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko", "");

        }
```


[12/29/2022 10:38 PM] cieldautomne
we should also change the module loading part to not be kernel version dependent


[12/29/2022 10:39 PM] cieldautomne
in this line `mount("/opt/firmware.sqsh", "/lib/firmware/imx/epdc", "squashfs", 0, "");`


[12/29/2022 10:39 PM] cieldautomne
i don't think `, "squashfs", 0, "");` is correct


[12/29/2022 10:40 PM] cieldautomne
rather than mounting maybe unsquashfs it


[12/29/2022 10:42 PM] szybet
we can grab the current kernel version and use it in the path


[12/29/2022 10:43 PM] szybet
what are the original commands you needed to paste?


[12/29/2022 10:48 PM] cieldautomne
something like that


[12/29/2022 10:48 PM] cieldautomne
the module loading part could also be conditional


[12/29/2022 10:49 PM] cieldautomne
`modprobe tps6518x-hwmon && modprobe tps6518x-regulator && modprobe mxc_epdc_v2_fb`


[12/29/2022 10:56 PM] szybet
you have wrong arguments for mounting? https://tldp.org/HOWTO/SquashFS-HOWTO/creatingandusing.html


[12/29/2022 10:56 PM] szybet
also, you use 2 squashfs, mount both of them, or unsquash both of them


[12/29/2022 10:56 PM] szybet
no need to do 2 diffrent things i think?


[12/29/2022 10:57 PM] szybet
maybe modules should be unsquashed


[12/29/2022 10:57 PM] szybet
IDK, focus on this


[12/31/2022 5:56 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/message-29A50.txt


[12/31/2022 5:56 PM] szybet
context?


[12/31/2022 5:57 PM] cieldautomne
```// Kobo Clara HD (N249) specific stuff
    if(strstr(device, "n249")) {
        // Unsquashing modules
        {    
            const char * arguments[] = { "/usr/bin/unsquashfs", "-d", "/lib/modules", "/opt/modules.sqsh", NULL }; run_command("/usr/bin/unsquashfs", arguments, true);
        }
        
        // Put epdc.fw in the right place
        {    
            const char * arguments[] = { "/usr/bin/unsquashfs", "-d", "/lib/firmware/imx/epdc", "/opt/firmware.sqsh", NULL }; run_command("/usr/bin/unsquashfs", arguments, true);
        }

        // Load some modules
        load_module("/lib/modules/5.16.0/kernel/drivers/hwmon/tps6518x-hwmon.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/regulator/tps6518x-regulator.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko", "");
        }
```

{Reactions}
👍 

[12/31/2022 5:58 PM] cieldautomne
so this is with modified init


[12/31/2022 6:02 PM] cieldautomne
modules and firmware are unsquashed


[12/31/2022 6:05 PM] cieldautomne
```[    6.311595] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed w2
[    6.312098] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc.fw failed with error2```


[12/31/2022 6:05 PM] cieldautomne
error 2 means it can't find epdc.fw ? is it correct


[12/31/2022 6:07 PM] cieldautomne
after that


[12/31/2022 6:07 PM] cieldautomne
```[    6.366199] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[    6.637783] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[    7.859347] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[    9.070480] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   10.280345] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   11.490117] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   12.699367] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   13.909399] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   15.113539] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   16.319482] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   17.530854] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   18.744564] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   19.952873] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   21.159725] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   22.424588] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   23.639594] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   24.846296] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   26.050490] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
```


[12/31/2022 6:07 PM] cieldautomne
these lines are repeated endlessly


[12/31/2022 11:31 PM] szybet
Idk, it looks like its running in loop?


[1/1/2023 1:00 PM] cieldautomne
yep


[1/3/2023 7:31 PM] szybet
well check what error2 means


[1/3/2023 7:55 PM] cieldautomne
i think it means it can't find epdc.fw


[1/3/2023 8:00 PM] cieldautomne
I should have a bit more time on Thursday and Friday


[1/3/2023 8:02 PM] cieldautomne
maybe i wrote something wrong in the init script


[1/3/2023 8:04 PM] cieldautomne
is it possible to have more log during boot-time ?


[1/3/2023 8:05 PM] cieldautomne
with some kernel parameters? or something else


[1/3/2023 8:05 PM] cieldautomne
i'd like to check if unsquashing and module loading is working


[1/3/2023 8:08 PM] cieldautomne
(quiet is already removed from kernel parameters)


[1/3/2023 8:30 PM] andi15701
firmware is loaded after regulators are available


[1/3/2023 8:31 PM] andi15701
so everything is loaded


[1/3/2023 8:31 PM] andi15701
every module


[1/3/2023 8:32 PM] andi15701
just check that /lib/firmware/imx/epdc/epdc.fw is there


[1/3/2023 8:53 PM] cieldautomne
how? i don't have access to shell


[1/3/2023 9:14 PM] andi15701
well do a access() call before loading the module


[1/3/2023 9:44 PM] cieldautomne
hm


[1/3/2023 10:52 PM] cieldautomne
```// Check the presence of /lib/firmware/imx/epdc/epdc.fw
  int main(void)
  {
    if( access("/lib/firmware/imx/epdc/epdc_PENG060D.fw", F_OK ) != -1)
    {
      printf("epdc_PENG060D.fw is found!");
    }
    else
    {
      printf("epdc_PENG060D.fw is NOT found!");
    }
    return 0;
  }```


[1/3/2023 10:52 PM] cieldautomne
i don't know C, i found something on the internet


[1/3/2023 10:52 PM] cieldautomne
is it correct ?


[1/3/2023 11:04 PM] andi15701
or simply system("ls -lR /lib/firmware/");

{Reactions}
👍 

[1/3/2023 11:16 PM] cieldautomne
because if the code is correct, then there is nothing shown during boot time...


[1/3/2023 11:17 PM] andi15701
so it is either not executed at all or stdout is redirected


[1/3/2023 11:20 PM] cieldautomne
:/


[1/3/2023 11:27 PM] andi15701
btw: is there a reason why we need to squashfs that stuff at all?


[1/3/2023 11:29 PM] cieldautomne
idk


[1/3/2023 11:31 PM] cieldautomne
I am not competent enough to say whether there is a better way to do or not.


[1/3/2023 11:31 PM] andi15701
# no support for xz in unsquashfs


[1/3/2023 11:31 PM] andi15701
maybe that is still true


[1/3/2023 11:33 PM] andi15701
hmm, if we squashfs-mount the stuff, it stays compressed in memory


[1/3/2023 11:33 PM] andi15701
but there is also zram-swap


[1/3/2023 11:34 PM] andi15701
so we could even have that without any magic


[1/3/2023 11:49 PM] cieldautomne
im 100% doing something wrong


[1/3/2023 11:49 PM] cieldautomne
i just tested with an init with all the line i've written commented-out and the log is exactly the same


[1/3/2023 11:51 PM] andi15701
what about checking return codes of run_command


[1/3/2023 11:51 PM] cieldautomne
?


[1/4/2023 12:17 AM] andi15701
hmm, or simpler, interrupt startup again and try to unsquashfs the firmware


[1/4/2023 12:17 AM] andi15701
the way you did in the init program


[1/4/2023 7:18 AM] szybet
um maybe, we need modules after in the main rootfs. idk if its managed otherwise


[1/4/2023 7:19 AM] szybet
use log function, there is one written @alex(O_o)


[1/4/2023 12:41 PM] cieldautomne
```~ # unsquashfs -d /lib/firmware/imx/epdc /opt/firmware.sqsh 
Filesystem uses xz compression, this is unsupported by this version
Decompressors available:
        gzip
~ # unsquashfs -d /lib/modules /opt/modules.sqsh 
Parallel unsquashfs: Using 1 processor
66 inodes (65 blocks) to write



created 64 files
created 32 directories
created 2 symlinks
created 0 devices
created 0 fifos
created 0 sockets
~ # 
```


[1/4/2023 12:41 PM] cieldautomne
i'll check how to change the fs compression to gzip


[1/4/2023 1:09 PM] szybet
interesting


[1/4/2023 1:11 PM] andi15701
mkdir -p /lib/firmware/imx/epdc
+    mount /opt/firmware.sqsh /lib/firmware/imx/epdc


[1/4/2023 1:12 PM] andi15701
that was exactly the reason why I did this


[1/4/2023 1:30 PM] cieldautomne
it was not working


[1/4/2023 1:31 PM] cieldautomne
but maybe arguments are wrong


[1/4/2023 1:39 PM] cieldautomne
or


[1/4/2023 1:40 PM] cieldautomne
```if(root == true) {
        const char * arguments[] = { "/sbin/losetup", "/dev/loop7", "/opt/root.sqsh", NULL }; run_command("/sbin/losetup", arguments, true);
        mount("/dev/loop7", "/mnt/opt/root", "squashfs", MS_NODEV | MS_NOSUID | MS_NOEXEC, "");
    }```


[1/4/2023 1:40 PM] cieldautomne
it should be similar to this


[1/4/2023 1:59 PM] szybet
maybe just mount it


[1/4/2023 2:16 PM] andi15701
or just repack it, or just store stuff directly in there


[1/4/2023 2:23 PM] szybet
some compression must be there


[1/4/2023 2:24 PM] szybet
we are running low on disk space there, waveshare is next to the kernel annd initrd


[1/4/2023 3:09 PM] cieldautomne
i think unsqhashfs -d argument is not capable of creating parent directory


[1/4/2023 3:20 PM] cieldautomne
adding `mkpath("/lib/firmware/imx/epdc/", 0755)` should work


[1/4/2023 3:35 PM] andi15701
initrd itself is compressed


[1/4/2023 3:35 PM] andi15701
so everything within, too


[1/4/2023 3:37 PM] andi15701
you might get advantage on ram usage, if you keep things compressed


[1/4/2023 3:38 PM] andi15701
pmOS has ramdisk running


[1/4/2023 3:38 PM] andi15701
with epd for crypto unlock


[1/4/2023 3:39 PM] andi15701
so the rootfs can be encrypted


[1/4/2023 3:39 PM] andi15701
and that also works nicely without such tricks


[1/4/2023 3:40 PM] andi15701
disk space: well, we have GBs


[1/4/2023 3:40 PM] andi15701
kernel is just loaded as ordinary file, there is some limitation within u-boot I think


[1/4/2023 3:40 PM] andi15701
but I would guess that even 32MB would be ok


[1/4/2023 3:43 PM] andi15701
it is just a file on a partition


[1/4/2023 3:49 PM] andi15701
Reading it a second time: that is the situation with factory u-boot. But said that, I think the lowest disk space we would have if we just highly compress the whole stuff, i.e. CONFIG_KERNEL_XZ=y


[1/4/2023 4:00 PM] szybet
it is already i think

inkbox design is questionable some times


[1/4/2023 5:57 PM] andi15701
yes, it is


[1/4/2023 6:09 PM] andi15701
-rwxr-xr-x 1 andi andi 11196288 Aug 27 12:02 n249/zImage-root


[1/4/2023 6:09 PM] andi15701
with modules / fw squashed


[1/4/2023 6:09 PM] andi15701
-rwxr-xr-x 1 andi andi 11047456 Jan  4 17:07 /home/build/inkbox/kernel/kernel/out/n249/zImage-root


[1/4/2023 6:09 PM] andi15701
not squashed


[1/4/2023 6:11 PM] andi15701
so unsquashed things


[1/4/2023 6:11 PM] andi15701
and removed the squashfs files


[1/4/2023 6:12 PM] andi15701
now I have unpacked the splash root


[1/4/2023 6:12 PM] andi15701
and removed that archive


[1/4/2023 6:12 PM] andi15701
lets see


[1/4/2023 6:17 PM] andi15701
-rwxr-xr-x 1 andi andi 11051216 Jan  4 17:16 /home/build/inkbox/kernel/kernel/out/n249/zImage-root


[1/4/2023 6:17 PM] andi15701
this is now with unpacked splash-root


[1/4/2023 6:17 PM] andi15701
+4KByte


[1/4/2023 6:18 PM] andi15701
neglectible, IMHO


[1/4/2023 6:21 PM] andi15701
so we can save precious time of our life by just unpacking that stuff at compile time


[1/4/2023 6:32 PM] cieldautomne
```// Kobo Clara HD (N249) specific stuff
    if(strstr(device, "n249")) {
        // Unsquashing modules
        {    
            const char * arguments[] = { "/usr/bin/unsquashfs", "-d", "/lib/modules", "/opt/modules.sqsh", NULL }; run_command("/usr/bin/unsquashfs", arguments, true);
        }
        
        // Put epdc.fw in the right place
        mkpath("/lib/firmware/imx", 0755);
        {    
            const char * arguments[] = { "/usr/bin/unsquashfs", "-d", "/lib/firmware/imx/epdc", "/opt/firmware.sqsh", NULL }; run_command("/usr/bin/unsquashfs", arguments, true);
        }
        
        // Load some modules
        load_module("/lib/modules/5.16.0/kernel/drivers/hwmon/tps6518x-hwmon.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/regulator/tps6518x-regulator.ko", "");
        load_module("/lib/modules/5.16.0/kernel/drivers/video/fbdev/mxc/mxc_epdc_v2_fb.ko", "");
    }```


[1/4/2023 6:32 PM] cieldautomne
so, adding this to init.c seems to make things work


[1/4/2023 6:33 PM] cieldautomne
the screen has been refreshed and a progress bar during boot time is showed


[1/4/2023 6:34 PM] cieldautomne
``` * Device is rooted; not enforcing security policy
[   14.025522] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
 * Boot mode: Standard
[   14.064965] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   19.858594] EXT4-fs (mmcblk0p3): mounted filesystem with ordered data mode. Opts: (null). Quota mode: none.
Verifying root filesystem's digital signature ...
Done.
[   23.133057] loop1: detected capacity change from 0 to 7600
 * Mounted root filesystem
[   24.089489] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   24.157160] EXT4-fs (mmcblk0p4): mounted filesystem with ordered data mode. Opts: . Quota mode: none.
[   25.113269] loop7: detected capacity change from 0 to 8
[   25.200342] loop6: detected capacity change from 0 to 8
[   25.280116] loop5: detected capacity change from 0 to 1072
 * Mounted core SquashFS archives
 * Mounted essential filesystems
[   26.066348] loop4: detected capacity change from 0 to 120
Error opening signature file /mnt/opt/storage/gui_rootfs.isa.dgst
3069707636:error:02001002:system library:fopen:No such file or directory:crypto/bio/bss_file.c:69:fopen('/mnt/opt/storage/gui_rootfs.isa.dgst','rb')
3069707636:error:2006D080:BIO routines:BIO_new_file:no such file:crypto/bio/bss_file.c:76:
Can't open squashfs image: No such file or directory

Failed to open /opt/gui_rootfs/write/: No such file or directory. Aborting!

Segmentation fault
The system is going down NOW!
Sent SIGTERM to all processes
Sent SIGKILL to all processes
Requesting system poweroff
[   30.775227] reboot: Power down```


[1/4/2023 6:35 PM] cieldautomne
now we have an issue related to gui_rootfs, i'll check on other thread what it is about


[1/4/2023 6:35 PM] cieldautomne
also


[1/4/2023 6:35 PM] cieldautomne
what does that mean ? `[    9.153371] imx_epdc_v2_fb 20f4000.epdc: Unable to enable DISPLAY regulator.err = 0xffffff92`


[1/4/2023 6:36 PM] cieldautomne
the screen seems to work yet this error is shown


[1/4/2023 6:37 PM] andi15701
-ETIMEDOUT


[1/4/2023 6:37 PM] andi15701
for some reason, regulators do not power up


[1/4/2023 6:38 PM] andi15701
but if that does not repeat, it will probably be no problem

{Reactions}
👍 

[1/4/2023 6:42 PM] szybet
and inkbox labelm


[1/4/2023 6:42 PM] szybet
?


[1/4/2023 6:43 PM] szybet
you simplyhave noothing on p4


[1/4/2023 6:43 PM] szybet
look into image maker from where you are supposed to have them


[1/4/2023 6:55 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20230104_184343_758-9A718.jpg


[1/4/2023 7:01 PM] cieldautomne
i might need user.sqsh in p4


[1/4/2023 7:04 PM] szybet
wtf


[1/4/2023 7:05 PM] szybet
well look up img creator


[1/4/2023 7:05 PM] szybet
can you look into this?

{Reactions}
❔ 

[1/4/2023 7:06 PM] cieldautomne
https://github.com/Kobo-InkBox/imgtool/blob/main/release.bash#L172

{Embed}
https://github.com/Kobo-InkBox/imgtool/blob/main/release.bash
imgtool/release.bash at main · Kobo-InkBox/imgtool
Reproducible image builder for InkBox OS. Contribute to Kobo-InkBox/imgtool development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/imgtool-0EE5B


[1/4/2023 7:09 PM] szybet
look


[1/4/2023 7:09 PM] szybet
`    root_command unsquashfs -f -d "${MOUNT_BASEPATH}/user" user.sqsh && sync && popd`


[1/4/2023 7:09 PM] szybet
its a squash


[1/4/2023 7:09 PM] szybet
and inside it everything you need


[1/4/2023 7:10 PM] szybet
so do it


[1/4/2023 7:10 PM] szybet
nia thread has this topic if you wonder


[1/4/2023 9:11 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/VID_20230104_211004-B0038.mp4


[1/4/2023 9:11 PM] szybet
what is even going on? some things work then they dont


[1/4/2023 9:12 PM] cieldautomne
```OpenRC 0.41.2.6fc2696f3e is starting up Linux 5.16.0 (armv7l)

 * /proc is already mounted
 * Mounting /run ... * /run/openrc: creating directory
 * /run/lock: creating directory
 * /run/lock: correcting owner
[   35.693385] SD3_SPWR: disabling
[   35.696861] LDO1: disabling
[   35.725580] LDO4: disabling
[   35.736246] LDO9: disabling
[   35.742222] LDO10: disabling
[   35.752350] LDORTC1: disabling
 * Caching service dependencies ... [ ok ]
 * Clock skew detected with `(null)'
 * Adjusting mtime of `/run/openrc/deptree' to Tue Dec 27 16:56:34 2022```


[1/4/2023 9:13 PM] cieldautomne
```* WARNING: clock skew detected!
 * Mounting security filesystem ... [ ok ]
 * Mounting debug filesystem ... [ ok ]
 * Mounting fuse control filesystem ... [ ok ]
 * Remounting devtmpfs on /dev ... [ ok ]
 * Mounting /dev/pts ... [ ok ]
 * Mounting /dev/shm ... [ ok ]
 * Starting udev ...[   40.765485] udevd[899]: starting version 3.2.9
[   41.167533] udevd[900]: starting eudev-3.2.9
 [ ok ]
 * WARNING: clock skew detected!
insmod: ERROR: could not load module /modules/arcotg_udc.ko: No such file or directory
 [ ok ]
 * Starting USBNet ... * USB networking is disabled. Please set the USBNET_ENABLE flag and try again.
 [ ok ]
 * Splash screen ... [ ok ]
 * Mounting onboard storage filesystem ...[   44.454119] loop0: detected capacity change from 0 to 1048576
[   44.651254] squashfs: Unknown parameter 'uid'
 [ ok ]
 * Starting InkBox Power Daemon (ipd) .../lib/rc/sh/openrc-run.sh: line 26: can't create /sys/class/leds/pmic_ledsg/brightness: nonexistent directory
 [ ok ]
 * WARNING: clock skew detected!
 * Starting battery watchdog ... [ ok ]
cat: /sys/devices/platform/pmic_battery.1/power_supply/mc13892_bat/capacity: No such file or directory
sh: 5: unknown operand
 * Setting hostname ... [ ok ]
 * Starting InkBox Daemon (ibxd) ... [ ok ]
 * Checking for available updates ...Update skipped or no update available, aborting ...
 [ ok ]
 * Starting InkBox GUI ... * Starting InkBox Daemon (ibxd) ... [ ok ]
 * Setting up GUI user applications
 [ ok ]
 [ ok ]

Welcome to InkBox OS 1.9
Kernel 5.16.0 on armv7l (/dev/ttymxc0)

inkbox login: 
```


[1/4/2023 9:13 PM] cieldautomne
the screen is weird


[1/4/2023 9:13 PM] cieldautomne
but i have access to shell


[1/4/2023 9:13 PM] szybet
hey, rootfs booted


[1/4/2023 9:14 PM] tux_linux
great?


[1/4/2023 9:14 PM] cieldautomne
also, i made update.isa (properly signed) and put it in p4/update/


[1/4/2023 9:14 PM] tux_linux
screen doesn't look promising tho


[1/4/2023 9:14 PM] tux_linux
congratulations on getting that far


[1/4/2023 9:14 PM] cieldautomne
during boot i have a progress bar but the inkbox logo is not shown


[1/4/2023 9:14 PM] tux_linux
I think it was an FBInk problem


[1/4/2023 9:15 PM] tux_linux
@andi ?...


[1/4/2023 9:16 PM] cieldautomne
(i'm going to eat, i'll be back)

{Reactions}
👍 

[1/4/2023 9:18 PM] szybet
well now maybe look into the script of the splash screen, and launch the label "Inkbox" from cli to get logs


[1/4/2023 9:19 PM] szybet
nah, its not so bad to call a wizard, maybe first collect logs


[1/4/2023 9:20 PM] tux_linux
Yes but I remember he fixed it or encountered it somewhere


[1/4/2023 9:21 PM] tux_linux
https://discord.com/channels/809205711778480158/1018508714178781184/1043933454674448526
I think it is that one
@alex(O_o) please check if it has been applied or not


[1/4/2023 9:22 PM] szybet
@atro wake up samurai?


[1/4/2023 9:22 PM] szybet
also, every person working with clara has the first letter "a" in the nick

{Reactions}
🅰️ 

[1/4/2023 9:22 PM] szybet
🤔


[1/4/2023 9:40 PM] cieldautomne
recently i deleted and cloned the repo again to clean up things, i forgot to reapply them...


[1/4/2023 9:40 PM] cieldautomne
kernel is compiling


[1/4/2023 11:13 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20230104_231221_631-C6921.jpg


[1/4/2023 11:13 PM] cieldautomne
:/


[1/4/2023 11:13 PM] tux_linux
Well... there is some progress


[1/4/2023 11:13 PM] cieldautomne
the first time i booted after new kernel compilation it was fine and now after reboot it's looking like this


[1/4/2023 11:14 PM] cieldautomne
so it is able to show the InkBox splash screen correctly (not everytime unfortunatly...)


[1/4/2023 11:30 PM] cieldautomne
in the nia thread after adding update.isa it was show gui


[1/4/2023 11:30 PM] cieldautomne
for clara it's not 😤


[1/5/2023 8:08 AM] szybet
well, give logs


[1/5/2023 12:11 PM] szybet
run inkbox splash line by line by yourself


[1/5/2023 12:11 PM] szybet
copy the command and paste into cli


[1/5/2023 12:11 PM] szybet
and find the problem & copy logs


[1/5/2023 7:10 PM] cieldautomne
hm


[1/5/2023 7:10 PM] cieldautomne
inkbox-splash is not in /etc/init.d/


[1/5/2023 7:10 PM] cieldautomne
maybe it's not in rootfs


[1/5/2023 7:12 PM] cieldautomne
also I can't replicate weird screen behaviour everytime, now it's working fine


[1/5/2023 7:13 PM] cieldautomne
even after 2 reboot


[1/5/2023 7:15 PM] cieldautomne
the only thing i've done is to remove the serial connection, put the original sdcard with stock os back in the sd card slot and then plugged a usb cable to charge the battery


[1/5/2023 7:17 PM] cieldautomne
then after the battery is charged, i reconnected the clara via serial, put back the inkbox sd card and started


[1/5/2023 7:18 PM] cieldautomne
also gui might not be working because there are not mention of n249 in /etc/init.d/inkbox_gui


[1/5/2023 7:18 PM] cieldautomne
i'll take a look a the script


[1/5/2023 7:23 PM] cieldautomne
ClaraHD has the same resolution as GloHD


[1/5/2023 7:23 PM] cieldautomne
cool


[1/5/2023 7:39 PM] szybet
show me


[1/5/2023 7:40 PM] szybet
reboot 10 times


[1/5/2023 7:40 PM] szybet
give me ***logs***


[1/5/2023 7:41 PM] cieldautomne
i didn't even tried


[1/5/2023 7:41 PM] cieldautomne
i added n249 in inkbox_gui


[1/5/2023 7:42 PM] cieldautomne
here


[1/5/2023 7:42 PM] cieldautomne
```if [ "${DEVICE}" == "n705" ] || [ "${DEVICE}" == "n905b" ] || [ "${DEVICE}" == "n905c" ] || [ "${DEVICE}" == "n613" ] || [ "${DEVICE}" == "n873" ] || [ "${DEVICE}" == "n236" ] || [ "${DEVICE}" == "n437" ] || [ "${DEVICE}" == "n306" ] || [ "${DEVICE}" == "n249" ]; then
            echo "true" > /kobo/run/wifi_able
            echo "true" > /run/wifi_able```


[1/5/2023 7:42 PM] cieldautomne
and more importantly here


[1/5/2023 7:43 PM] cieldautomne
```elif [ "${DEVICE}" == "n437" ] || [ "${DEVICE}" == "n249" ]; then
            mount --bind /usr/local/share/inkbox/stylesheets/eink-1072x1448.qss /kobo/mnt/onboard/.adds/inkbox/eink.qss```


[1/5/2023 7:43 PM] szybet
it still should launch


[1/5/2023 7:43 PM] szybet
without logs you can try in blind


[1/5/2023 7:49 PM] cieldautomne
```inkbox:~# /etc/init.d/inkbox_gui -v start
 * WARNING: inkbox_gui has already been started
inkbox:~# /etc/init.d/inkbox_gui -v restart
 * Executing: /lib/rc/sh/openrc-run.sh /lib/rc/sh/openrc-run.sh /etc/init.d/inkbox_gui stop
 * Stopping InkBox GUI ...
 * Executing: /lib/rc/sh/openrc-run.sh /lib/rc/sh/openrc-run.sh /etc/init.d/gui_apps stop
 [ ok ]
 * Executing: /lib/rc/sh/openrc-run.sh /lib/rc/sh/openrc-run.sh /etc/init.d/inkbox_gui start
 * Starting InkBox GUI ...
 * Executing: /lib/rc/sh/openrc-run.sh /lib/rc/sh/openrc-run.sh /etc/init.d/ibxd stop
 * Executing: /lib/rc/sh/openrc-run.sh /lib/rc/sh/openrc-run.sh /etc/init.d/ibxd start
 * Starting InkBox Daemon (ibxd) ...
 [ ok ]
 * Executing: /lib/rc/sh/openrc-run.sh /lib/rc/sh/openrc-run.sh /etc/init.d/gui_apps start
 * Setting up GUI user applications
 [ ok ]
 [ ok ]
 * WARNING: sshd has already been started
inkbox:~# ./inkbox: line 6: /mnt/onboard/.adds/inkbox/inkbox-bin: not found
./inkbox: line 6: /mnt/onboard/.adds/inkbox/inkbox-bin: not found
./inkbox: line 6: /mnt/onboard/.adds/inkbox/inkbox-bin: not found
./inkbox: line 6: /mnt/onboard/.adds/inkbox/inkbox-bin: not found```


[1/5/2023 7:49 PM] cieldautomne
also after poweroff, and changing rootfs the screen is weird again


[1/5/2023 7:49 PM] cieldautomne
after poweroff the screen was white


[1/5/2023 7:50 PM] cieldautomne
while before, after reboots it was black


[1/5/2023 7:51 PM] cieldautomne
ok now after another reboot, screen goes black then it shows inkbox and progress bar correctly


[1/5/2023 7:52 PM] cieldautomne
another poweroff: the screen does not goes to black


[1/5/2023 7:53 PM] cieldautomne
and screen is weird


[1/5/2023 7:53 PM] szybet
nothing makes sense, do this
1. go touch ground ( electric ground )
2. open the clara


[1/5/2023 7:54 PM] szybet
3 disconnect the battery with a toothstick or smth similar


[1/5/2023 7:56 PM] cieldautomne
or


[1/5/2023 7:56 PM] cieldautomne
poweroff = bad


[1/5/2023 7:56 PM] cieldautomne
reboot = good


[1/5/2023 7:56 PM] szybet
4 click the power button for 20 s
5 disconnect screen flex cables, be carefull, look up how its done in the internet
6. with a earstick? this one to clean in, or just some toilet paper collect dust from flex cable contact
7 recconect flex cables
8 recconect battery
9 when using ereader, always connect usb cable with power on it


[1/5/2023 7:56 PM] cieldautomne
it seems to be always bad after power off but reboot is not causing the issue


[1/5/2023 7:56 PM] szybet
yea poweroff is black reboot white, intended feature


[1/5/2023 7:57 PM] szybet
the screen*


[1/5/2023 7:57 PM] cieldautomne
nevermind...


[1/5/2023 7:57 PM] szybet
if any artefacts show up, do this

{Attachments}
/mnt/data/projects/git/conversations/media/image-7FBEF.png

{Reactions}
👍 

[1/5/2023 7:57 PM] cieldautomne
i just rebooted and screen is weird...


[1/5/2023 7:58 PM] szybet
to this, from did you get update isa?


[1/5/2023 7:58 PM] szybet
picture?


[1/5/2023 7:59 PM] cieldautomne
the only common thing is, if screen goes to black then it's okay, if not (like the two last reboot i did) it's weird


[1/5/2023 8:00 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20230105_195921_672-91871.jpg


[1/5/2023 8:02 PM] cieldautomne
https://github.com/Kobo-InkBox/gui-bundle/blob/main/release.sh

{Embed}
https://github.com/Kobo-InkBox/gui-bundle/blob/main/release.sh
gui-bundle/release.sh at main · Kobo-InkBox/gui-bundle
InkBox GUI bundle contents and generation script. Contribute to Kobo-InkBox/gui-bundle development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/gui-bundle-0613A


[1/5/2023 8:04 PM] szybet
do this then


[1/5/2023 8:04 PM] szybet
yea...


[1/5/2023 8:04 PM] szybet
https://github.com/Szybet/gui-bundle

{Embed}
https://github.com/Szybet/gui-bundle
GitHub - Szybet/gui-bundle: InkBox GUI bundle contents and generati...
InkBox GUI bundle contents and generation script. Contribute to Szybet/gui-bundle development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/gui-bundle-51239


[1/5/2023 8:04 PM] szybet
look up this


[1/5/2023 8:05 PM] szybet
here is it written  that you need to crosscompile things


[1/5/2023 8:05 PM] szybet
now go to #chat and scream at tux-linux to accept my pull request in gui-bunle😤


[1/5/2023 8:06 PM] szybet
https://github.com/Szybet/niAudio/blob/main/apps-on-kobo/qt-setup.md

{Embed}
https://github.com/Szybet/niAudio/blob/main/apps-on-kobo/qt-setup.md
niAudio/qt-setup.md at main · Szybet/niAudio
Kobo nia ereader with audio added. Contribute to Szybet/niAudio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/niAudio-613C3


[1/5/2023 8:06 PM] szybet
well good luck, do this


[1/5/2023 8:07 PM] szybet
there is a auto script if you want, too


[1/5/2023 8:07 PM] cieldautomne
9. ?


[1/5/2023 8:08 PM] szybet
always charge it


[1/5/2023 8:08 PM] szybet
always


[1/5/2023 8:08 PM] cieldautomne
during testing and stuff like that


[1/5/2023 8:08 PM] szybet
simply always


[1/5/2023 8:08 PM] cieldautomne
T.T


[1/5/2023 8:08 PM] szybet
maybe there is problem with not enough power because of power regulators @andi? you said you charged it and it was better for a while soo


[1/5/2023 8:09 PM] szybet
if it doesnt accour with charging, and then without it does, we have the cause


[1/5/2023 8:15 PM] cieldautomne
next level


[1/5/2023 8:16 PM] cieldautomne
does not seems easy


[1/5/2023 8:16 PM] cieldautomne
🥲


[1/5/2023 8:19 PM] cieldautomne
i have to compile inkbox-bin, oobe-inkbox-bin and lockscreen-bin, that's it ?


[1/5/2023 8:19 PM] szybet
ya


[1/5/2023 8:19 PM] szybet
you have litterally a step by step guide


[1/5/2023 8:20 PM] szybet
its the best documented things in inkbox


[1/5/2023 8:20 PM] szybet
the only problem that it takes ages


[1/5/2023 8:20 PM] szybet
even on a i5 8 gen


[1/5/2023 8:23 PM] cieldautomne
i5-7200U


[1/5/2023 8:23 PM] cieldautomne
😐


[1/5/2023 8:24 PM] szybet
not that bad


[1/5/2023 8:24 PM] szybet
just open the window that it will not get too hot in the room ;p


[1/5/2023 8:24 PM] cieldautomne
i


[1/5/2023 8:24 PM] cieldautomne
don't


[1/5/2023 8:24 PM] cieldautomne
have


[1/5/2023 8:24 PM] cieldautomne
a window


[1/5/2023 8:25 PM] szybet
open


[1/5/2023 8:25 PM] szybet
the door


[1/5/2023 8:25 PM] cieldautomne
xd


[1/5/2023 8:25 PM] szybet
;p


[1/5/2023 11:55 PM] the.mightydill
Not bad bro


[1/5/2023 11:55 PM] the.mightydill
I compiled gentoo on a pentium t4300


[1/6/2023 12:15 AM] cieldautomne
yep it's pretty good


[1/6/2023 12:15 AM] cieldautomne
i have a T470


[1/6/2023 12:17 AM] cieldautomne
battery sucks and it gets hot and noisy too easily


[1/6/2023 12:18 AM] cieldautomne
my experience with gentoo was pretty good (in part because i was avoiding chromium/llvm/qtwebengine/webkit-gtk)


[1/6/2023 12:22 AM] the.mightydill
Fully graphical


[1/6/2023 12:22 AM] the.mightydill
From what year


[1/6/2023 12:24 AM] cieldautomne
2017/18 ?


[1/6/2023 12:25 AM] cieldautomne
I don't know, I bought it second hand in 2021


[1/6/2023 5:02 AM] the.mightydill
mine's 2011


[1/7/2023 6:32 PM] cieldautomne
for at least 2 weeks I won't have access to my Clara, I may still try to compile what's needed

{Reactions}
👍 (2) 

[1/10/2023 2:33 PM] szybet
@alex(O_o) well submit the changes you made then for @atro to apply

{Reactions}
👍 

[1/10/2023 7:38 PM] atro_atro
Finally managed to read everything, iirc I was just booting with the wrong command and it should work with the new patches and correct U-Boot command, I'll try Thursday


[1/10/2023 9:19 PM] cieldautomne


{Attachments}
/mnt/data/projects/git/conversations/media/0001-clarahd-port-5CC59.patch

{Reactions}
👍 

[1/10/2023 9:20 PM] cieldautomne
to patch inkbox-os-init


[1/10/2023 9:21 PM] cieldautomne
then to compile init use these command


[1/10/2023 9:21 PM] cieldautomne
`/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/bin/armv7l-linux-musleabihf-gcc init.c -o init -static -D_GNU_SOURCE`


[1/10/2023 9:21 PM] cieldautomne
then


[1/10/2023 9:22 PM] cieldautomne
`/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/bin/armv7l-linux-musleabihf-strip init`


[1/10/2023 9:23 PM] cieldautomne
then to replace the init


[1/10/2023 9:24 PM] cieldautomne
`cp /home/build/inkbox/inkbox-os-init/init /home/build/inkbox/kernel/initrd/common/init`


[1/10/2023 9:24 PM] cieldautomne
and build the kernel again


[1/12/2023 5:58 PM] atro_atro
Hey @Szybet, should I use the main kernel branch now?


[1/12/2023 6:05 PM] szybet
you mean?


[1/12/2023 6:06 PM] atro_atro
Can I pull the most recent kernel, have the previous patches been merged by @tux-linux?


[1/12/2023 6:07 PM] szybet
https://github.com/Kobo-InkBox/kernel/commits/master

{Embed}
https://github.com/Kobo-InkBox/kernel/commits/master
Commits · Kobo-InkBox/kernel
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-07C4C


[1/12/2023 6:07 PM] szybet
i dont see it


[1/12/2023 6:07 PM] szybet
you need to apply them anyway i think


[1/12/2023 6:20 PM] tux_linux
I will apply them soon


[1/14/2023 7:33 PM] atro_atro
@Szybet I can't apply this patch:
```
[atro@thinkpad kernel]$ git apply 0001-clarahd-port.patch
/home/atro/0001-clarahd-port.patch:21: trailing whitespace.
                {
/home/atro/0001-clarahd-port.patch:24: trailing whitespace.

/home/atro/0001-clarahd-port.patch:27: trailing whitespace.
                {
/home/atro/0001-clarahd-port.patch:30: trailing whitespace.

error: init.c: No such file or directory
```


[1/14/2023 7:34 PM] szybet
there is somewhere already this


[1/14/2023 7:34 PM] szybet
i mean


[1/14/2023 7:34 PM] szybet
alex dealed with it


[1/14/2023 7:35 PM] atro_atro
You mean that this has already been merged?


[1/14/2023 7:35 PM] szybet
no


[1/14/2023 7:35 PM] szybet
that alex found a solution i think


[1/14/2023 7:37 PM] cieldautomne
`git apply --reject --whitespace=fix your.patch`


[1/14/2023 7:37 PM] atro_atro
Aaaah, thank you


[1/14/2023 7:38 PM] atro_atro
Same error


[1/14/2023 7:38 PM] szybet
woah, you cat evolved😄


[1/14/2023 7:39 PM] atro_atro
@alex(O_o) did you also have the other patches? Because it still prints the same error


[1/14/2023 7:39 PM] szybet
#patches ?


[1/14/2023 7:39 PM] szybet
in correct order


[1/14/2023 7:40 PM] atro_atro
I had the ones from andi1 and am trying to apply the one from alex but it doesn't work, same error as before


[1/14/2023 7:42 PM] szybet
https://stackoverflow.com/questions/14509950/my-diff-contains-trailing-whitespace-how-to-get-rid-of-it

{Embed}
https://stackoverflow.com/questions/14509950/my-diff-contains-trailing-whitespace-how-to-get-rid-of-it
My diff contains trailing whitespace - how to get rid of it?
I've tried editing a php file in TextWrangler with line endings set to Unix, in NetBeans, and in vim. When I save the diff to a patch and then try to apply it, it gives whitespace errors. When I ty...
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[1/14/2023 7:42 PM] szybet
git apply --whitespace=warn patchname.patch


[1/14/2023 7:43 PM] atro_atro
No error in the output but I can't find the patch in the git log


[1/14/2023 7:43 PM] szybet
look up if it was applied


[1/14/2023 7:46 PM] cieldautomne
look at init.c, there should be lines mentioning clarahd (n249)


[1/14/2023 7:46 PM] szybet
also, what repo did you use for it atro ;p ?


[1/14/2023 7:46 PM] atro_atro
Where's the `init.c` file I can find a ton of them 😭


[1/14/2023 7:47 PM] atro_atro
Kernel


[1/14/2023 7:47 PM] szybet
https://github.com/Kobo-InkBox/inkbox-os-init

{Embed}
https://github.com/Kobo-InkBox/inkbox-os-init
GitHub - Kobo-InkBox/inkbox-os-init: InkBox OS' initialization prog...
InkBox OS' initialization program source. Contribute to Kobo-InkBox/inkbox-os-init development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/inkbox-os-init-6D7B9


[1/14/2023 7:47 PM] szybet
😄


[1/14/2023 7:47 PM] szybet
alex patch is for this repo


[1/14/2023 7:47 PM] atro_atro
Makes sense


[1/14/2023 7:48 PM] atro_atro
Do I need it for now? I don't remember downloading it last time


[1/14/2023 7:48 PM] szybet
yes


[1/14/2023 7:48 PM] szybet
alex did that part soo


[1/14/2023 7:51 PM] atro_atro
Okay, then I have to update my tutorial, where should I put this extra step? Current steps are
1 - Compile the bootloader
2 - Build the rootfs
3 - Build the kernel
4 - Install InkBox on SD


[1/14/2023 7:52 PM] szybet
extra step, you mean what?


[1/14/2023 7:53 PM] atro_atro
Getting and building the inkbox-os-init repo, is it something that should go in the kernel?


[1/14/2023 7:54 PM] szybet
in the future it will be merged already, so it isin't needed


[1/14/2023 7:54 PM] szybet
but you can add the steps for the clara, as an example of what patching the init can look like


[1/14/2023 7:55 PM] szybet
link to the repos, etc


[1/14/2023 7:56 PM] atro_atro
Okay, I think that I was asking the wrong question


[1/14/2023 7:57 PM] atro_atro
Where should I put inkbox-os-init?


[1/14/2023 7:59 PM] szybet
in the place of the init


[1/14/2023 7:59 PM] szybet
look up tux-linux commits, he updates it a lot


[1/14/2023 7:59 PM] szybet
the clara path


[1/14/2023 8:45 PM] atro_atro
Rebuilt the kernel, starting to read what alex did to start InkBox here: https://discord.com/channels/809205711778480158/934581303674798101/1057741447312445560


[1/14/2023 8:45 PM] atro_atro
Got
```
U-Boot 2020.10 (Dec 18 2022 - 19:24:55 +0100)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 29C
Reset cause: POR
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0
switch to partitions #0, OK
mmc0 is current device
Unknown command 'load_ntxkernel' - try 'help'
=> ext4load mmc 0:1 0x83000000 DTB
Failed to load 'DTB'
=> ext4load mmc 0:1 0x80800000 zImage
Failed to load 'zImage'
=> bootz 0x80800000 - 0x83000000
zimage: Bad magic!
```


[1/14/2023 8:45 PM] szybet
what are you trying to do


[1/14/2023 8:45 PM] szybet
no


[1/14/2023 8:45 PM] szybet
read everything first


[1/14/2023 8:46 PM] szybet
it will be easier


[1/14/2023 8:47 PM] atro_atro
Okay, I cannot read the entire channel but I can try to dig deeper alex's messages


[1/14/2023 8:48 PM] szybet
exactly do that


[1/14/2023 11:40 PM] cieldautomne (pinned)
• patch the kernel with andi1's patches at #patches

• git clone then patch inkbox-os-init with my patch

• compile inkbox-os-init
```/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/bin/armv7l-linux-musleabihf-gcc init.c -o init -static -D_GNU_SOURCE
 
/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/bin/armv7l-linux-musleabihf-strip init```

• copy (overwrite) init to the right place
```cp /home/build/inkbox/inkbox-os-init/init /home/build/inkbox/kernel/initrd/common/init```

• compile kernel with the usual command and copy zimage to sdcard

• git clone rootfs

• build rootfs

•copy rootfs to sdcard

• root the device
```echo rooted | dd of=/dev/mmcblk0 bs=512 seek=79872```

• Tweak the bootloader to make things work without ext4load and similar anoying commands

1. Create a file named uboot-script.cmd with the following lines in it:
```led tolinoshine2hd:white:on on
setenv bootargs console=ttymxc0,115200

echo Loading kernel
load mmc 0:1 0x80800000 zImage

echo Loading DTB
load mmc 0:1 0x83000000 DTB

echo Booting kernel
bootz 0x80800000 0x83000000```

2. Create a boot.scr file
```mkimage -A arm -O linux -T script -n postmarketOS -d uboot-script.cmd boot.scr```

3. Then put it in the first partition of the sdcard
```cp boot.scr /path/to/first/part```

4. Modify u-boot env
Start the device, when u-boot shell is accessible type ```setenv bootcmd load mmc 0:1 ${loadaddr} /boot.scr \; source ${loadaddr}``` then save the env with ```saveenv```

5. Reboot

{Reactions}
😍 

[1/14/2023 11:41 PM] cieldautomne
maybe not complete/exact, reading the channel will help understand


[1/14/2023 11:42 PM] atro_atro
I'm adding this and the missing parts right now, will push to my tutorial, thank you so much :)


[1/14/2023 11:44 PM] cieldautomne
i think it's missing steps related to public keys and firmware


[1/14/2023 11:45 PM] cieldautomne
i remember unsquash keys.sqsh and put my own public.pem in it


[1/14/2023 11:48 PM] atro_atro
I found everything, will push in roughly 30 min


[1/14/2023 11:50 PM] tux_linux
Pinned a message.


[1/15/2023 12:34 AM] atro_atro
https://github.com/aartoni/n249

{Embed}
https://github.com/aartoni/n249
GitHub - aartoni/n249: Kobo Clara HD and InkBox notes
Kobo Clara HD and InkBox notes. Contribute to aartoni/n249 development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/n249-DEF17


[1/15/2023 12:36 AM] atro_atro
I think that (once complete) the `installation.md` file will have everything a new user needs


[1/15/2023 12:37 AM] atro_atro
I think that I may still be missing a few lines:
```
U-Boot 2020.10 (Dec 18 2022 - 19:24:55 +0100)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 35C
Reset cause: WDOG
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0
289 bytes read in 6 ms (46.9 KiB/s)
## Executing script at 80800000
LED 'tolinoshine2hd:white:on' not found (err=-19)
Loading kernel
Failed to load 'zImage'
Loading DTB
Failed to load 'DTB'
Booting kernel
zimage: Bad magic!
```


[1/15/2023 12:39 AM] atro_atro
@alex(O_o) can you check if I'm missing the firmware you mentioned before in my tutorial?


[1/15/2023 12:41 AM] atro_atro
I haven't found it mentioned here: https://discord.com/channels/809205711778480158/934581303674798101/1057378279440535626


[1/15/2023 7:44 AM] cieldautomne
epdc.fw should be in firmware.sqsh


[1/15/2023 7:47 AM] cieldautomne
zImage and DTB are in partition 1 ?


[1/15/2023 9:56 AM] andi15701
bootz 0x80800000 0x83000000 there should be a dash in between


[1/15/2023 9:57 AM] andi15701
so bootz 0x80800000 - 0x83000000


[1/15/2023 10:04 AM] andi15701
the logic is bootz <kernel_zImage_addr> <initrd.gz_addr> <dtb_addr>


[1/15/2023 10:05 AM] andi15701
if something is not needed, it is replaced with a dash

{Reactions}
👍 (2) 

[1/15/2023 12:55 PM] atro_atro
Yep, is it enough to copy them inside the partition?


[1/15/2023 1:14 PM] andi15701
should be


[1/15/2023 1:14 PM] andi15701
u-boot has a ls command


[1/15/2023 1:14 PM] andi15701
you can verify if things behave as expected


[1/15/2023 1:14 PM] andi15701
ls mmc 0:1 /


[3/8/2023 10:57 AM] propp8625
Any news on this? How is inkbox running on the Clara?


[3/8/2023 11:03 AM] szybet
No, has been ported only partially


[3/8/2023 11:03 AM] szybet
You can help


[3/8/2023 11:03 AM] szybet
¯\_(ツ)_/¯


[3/8/2023 1:08 PM] cieldautomne
much longer than expected...


[3/8/2023 1:18 PM] cieldautomne
i dont have a lot of free time unfortunately...


[3/8/2023 2:09 PM] szybet
¯\_(ツ)_/¯


[3/9/2023 7:21 PM] atro_atro
I'm going back now


[3/9/2023 7:21 PM] atro_atro
Restarting from scratch following my guide


[3/9/2023 7:24 PM] atro_atro
I will post an update as soon as I'm finished rebuilding everything


[3/9/2023 7:50 PM] szybet
https://tenor.com/view/cat-cats-celebration-woohoo-jumping-gif-25834998

{Embed}
https://tenor.com/view/cat-cats-celebration-woohoo-jumping-gif-25834998
/mnt/data/projects/git/conversations/media/cat-cats-779E9.png


[3/9/2023 7:51 PM] atro_atro
Yo @Szybet, do I need patches for the repo?


[3/9/2023 7:54 PM] cieldautomne
I think you do


[3/9/2023 7:54 PM] szybet
yea... if only i could apply them beacause i would have access... right @tux-linux ?

{Reactions}
👍 

[3/9/2023 7:55 PM] atro_atro
Can someone point me to the right patches to apply?


[3/9/2023 7:56 PM] szybet
the ones from alex and andi


[3/9/2023 7:56 PM] szybet
skip my


[3/9/2023 7:56 PM] cieldautomne
https://discord.com/channels/809205711778480158/1018508714178781184/1043929141919109260


[3/9/2023 7:56 PM] cieldautomne
+ the one following


[3/9/2023 7:56 PM] szybet
@atro if you figure the patches out, please make a pull request + complain to tux linux


[3/9/2023 7:58 PM] cieldautomne
and this


[3/9/2023 8:06 PM] atro_atro
Is it fine if I open them even if the author is andi1?


[3/9/2023 8:06 PM] atro_atro
@andi


[3/9/2023 8:06 PM] szybet
yes


[3/9/2023 8:07 PM] szybet
if you apply the patch, the commit author is applied too

{Reactions}
👍 

[3/9/2023 8:26 PM] atro_atro
@Szybet this patch can't be applied anymore, the original file has been almost completely deleted


[3/9/2023 8:26 PM] atro_atro
https://discord.com/channels/809205711778480158/1018508714178781184/1043929141919109260


[3/9/2023 8:27 PM] szybet
oh - its replaced by the new c init, i think alex has rewritten it to the new one already


[3/9/2023 8:27 PM] atro_atro
Nice, one patch down :)


[3/9/2023 8:28 PM] atro_atro
I've opened the PR as well, should I also tag tux-linux?


[3/9/2023 8:28 PM] szybet
i mean for what


[3/9/2023 8:29 PM] szybet
tag alex and andi for sure


[3/9/2023 8:38 PM] atro_atro
🥳 
https://github.com/Kobo-InkBox/kernel/pull/3
https://github.com/Kobo-InkBox/inkbox-os-init/pull/1


[3/9/2023 8:38 PM] atro_atro
@alex(O_o) I couldn't find you on GitHub


[3/9/2023 8:38 PM] szybet
cool!


[3/9/2023 8:58 PM] cieldautomne
i don't remember my github account T.T


[3/9/2023 8:58 PM] cieldautomne
maybe i don't have one anymore


[3/9/2023 8:59 PM] cieldautomne
ill create one


[3/9/2023 10:36 PM] tux_linux
So what do I need to do


[3/9/2023 10:37 PM] szybet
accept it and give me permissions to do your work


[3/9/2023 10:37 PM] tux_linux
Ok, will look at them when I come home
~1h


[3/11/2023 12:17 PM] andi15701
i have sent a PR to that kobo clara hd documentation


[3/11/2023 12:24 PM] szybet
oh yea @atro you should have links for that in your guide, helpfull stuff


[3/11/2023 1:05 PM] andi15701
or just accept the PR


[3/11/2023 1:07 PM] szybet
wait, you dont mean a inkbox repo?


[3/11/2023 1:10 PM] andi15701
https://github.com/aartoni/n249/pull/1

{Embed}
https://github.com/aartoni/n249/pull/1
u-boot clarifications and fixes by akemnade · Pull Request #1 · aar...
auto-generate environment, fix led name
/mnt/data/projects/git/conversations/media/1-1B57A


[3/11/2023 1:10 PM] andi15701
that one


[3/11/2023 1:21 PM] szybet
oh this


[3/11/2023 1:21 PM] szybet
you made it


[3/11/2023 1:21 PM] szybet
coool


[3/12/2023 12:33 PM] atro_atro
@andi Merged! Thanks for contributing

{Reactions}
😄 (2) 

[3/12/2023 12:34 PM] andi15701
if we also use sfdisk instead of fdisk, things can be fully automated


[3/12/2023 12:35 PM] andi15701
and you can specify the last partition as "open-end"


[3/12/2023 12:35 PM] atro_atro
Nice, I'll do that today then


[3/12/2023 1:05 PM] andi15701
btw: is there any reason  for tha -O^meta_csum thing there?


[3/12/2023 1:06 PM] andi15701
I have experienced the need for -O ^64bit for some older u-boots


[3/12/2023 1:06 PM] tux_linux
Old kernels


[3/12/2023 1:06 PM] tux_linux
No real ext4 support


[3/12/2023 1:06 PM] tux_linux
Compatibility reasons


[3/12/2023 1:07 PM] atro_atro
n249 is using Linux 5.16, does that mean that I can remove it?


[3/12/2023 1:07 PM] andi15701
so just copy & paste


[3/12/2023 1:08 PM] andi15701
so it was just copy & paste from some documentation for devices with older kernels


[3/12/2023 1:08 PM] andi15701
so it can be removed

{Reactions}
👍 

[3/12/2023 2:22 PM] tux_linux
No
The scripts are meant for all devices


[3/12/2023 2:22 PM] tux_linux
Unless you add an if somewhere


[3/12/2023 2:47 PM] andi15701
in a common script, yes, but then also add ^64bit


[3/12/2023 2:47 PM] andi15701
but in a specific documentation for this device, it is something else


[3/12/2023 6:02 PM] atro_atro
@tux-linux, sorry for the misunderstanding I was talking about this specific guide I wrote for this model
https://github.com/aartoni/n249

{Embed}
https://github.com/aartoni/n249
GitHub - aartoni/n249: Kobo Clara HD and InkBox notes
Kobo Clara HD and InkBox notes. Contribute to aartoni/n249 development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/n249-57308


[3/12/2023 10:45 PM] tux_linux
np


[3/12/2023 11:02 PM] andi15701
just was curios: ^64bit is required for pre 2.6.20 kernels


[3/12/2023 11:03 PM] andi15701
but newer u-boots (if you read files from filesystem)


[3/12/2023 11:04 PM] andi15701
definitively the 2009.08 u-boot


[3/12/2023 11:13 PM] andi15701
the 2016.03 factory u-boot found in kobos with 4.1.15 kernel needs that ^64bit too


[3/12/2023 11:14 PM] andi15701
just in june in that year, u-boot starts to refuse to access filesystems with that 64bit activated, before is just did nonsene


[3/12/2023 11:17 PM] andi15701
... to be just implemented in September of that year


[3/12/2023 11:18 PM] andi15701
I am using some 2020.10 u-boot


[3/12/2023 11:19 PM] andi15701
that meta_csum is a bit different, the stuff can be ignored if things are just read


[3/12/2023 11:21 PM] andi15701
so proper filesystem implementations not supporting that just find: "oh there is something additional I do not understand, but reading is ok"


[3/12/2023 11:21 PM] atro_atro
@Szybet finished compiling everythng, will install tomorrow


[3/12/2023 11:22 PM] andi15701
ok, my curiosity is satisfied


[3/12/2023 11:45 PM] szybet
Great


[3/13/2023 12:49 AM] tux_linux
@atro your docs are quality work, congratulations


[3/13/2023 2:04 AM] tux_linux
merged both


[3/13/2023 2:04 AM] tux_linux
thank you


[3/13/2023 8:19 PM] atro_atro
Thank you for the appreciation, I used Szybet's niAudio guide as a starting point

{Reactions}
😄 👍 

[3/13/2023 8:20 PM] atro_atro
Was unable to do it today, will do it tomorrow

{Reactions}
👍 (2) 

[3/16/2023 9:37 PM] atro_atro
*next week

{Reactions}
👍 

[3/16/2023 9:57 PM] szybet
cool that you are giving updated


[3/16/2023 9:57 PM] szybet
it gives hopes


[3/21/2023 1:56 PM] .ccache
I've went through most of this thread, what (if any) are we missing at this point to be able to publish an image for the Clara HD along with the other ones?


[3/21/2023 1:57 PM] szybet
I think mostly testing / debbuging the rest of the system


[3/21/2023 1:58 PM] szybet
And what other ones?


[3/21/2023 1:59 PM] .ccache
the inkbox websites provides some image downloads for some older devices


[3/21/2023 1:59 PM] szybet
Yes, and?


[3/21/2023 2:00 PM] szybet
You mean to the latest version, 1.9?


[3/21/2023 2:00 PM] szybet
So therr are older?


[3/21/2023 2:01 PM] .ccache
No, I'm not saying the images are old, I meant they are for older devices


[3/21/2023 2:01 PM] szybet
Yes, and?


[3/21/2023 2:01 PM] szybet
I miss the point


[3/21/2023 2:02 PM] .ccache
You asked for clarification on what "other ones" meant, I provided it


[3/21/2023 2:02 PM] .ccache
I don't know why do you keep saying and?


[3/21/2023 2:02 PM] szybet
.


[3/21/2023 2:03 PM] szybet
For other devices that are supported you can create images with a script, if you ask for thar


[3/21/2023 2:03 PM] .ccache
So I guess Clara HD can be considered as "officially supported" at this point?


[3/21/2023 2:04 PM] szybet
No, half of the system is not tested, support for it in software is missing, the image creator cant create an image for it


[3/21/2023 2:06 PM] .ccache
Yes, that was exactly what I was asking for

{Reactions}
👍 

[3/21/2023 2:06 PM] .ccache
I don't want to assume bad intentions but keep asking people and? comes off as _very_ passive-aggressive


[3/21/2023 2:07 PM] .ccache
and the more I try to explain the worse the confusion got


[3/21/2023 2:07 PM] szybet
Um... Sorry? English is not my first language, i just tried to understand


[3/21/2023 2:08 PM] .ccache
As I said, I don't want to assume bad intentions, I'm just saying this is a passive-aggressive behavior in the English language that you probably want to avoid.


[3/21/2023 2:09 PM] szybet
Okay thanks, i will not repeat that


[3/21/2023 2:09 PM] .ccache
No worries


[3/21/2023 2:10 PM] .ccache
I'll try to see what I can do about these during the weekend.

{Reactions}
👍 

[3/21/2023 2:16 PM] .ccache
these notes are pretty good so far


[4/1/2023 10:16 AM] sizeof.void
I installed it to my reader using the guide.  @andi mentioned that I should be able to use just the usb interface to interact with the reader.  Can I help with testing/porting?


[4/1/2023 11:06 AM] szybet
wow, yea, of course


[4/1/2023 11:06 AM] szybet
at what point are you


[4/1/2023 11:40 AM] sizeof.void
@Szybet I installed it according to the guide 1:1.  Don't know what to do now.


[4/1/2023 11:40 AM] szybet
do you have a shell?


[4/1/2023 11:42 AM] sizeof.void
No.  But if you could tell me how can I get access to it though usb, then I can.  Maybe @andi knows better?


[4/1/2023 11:46 AM] szybet
https://inkbox.ddns.net/wiki/index.php?title=Boot_flags

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Boot_flags
Index.php


[4/1/2023 11:46 AM] szybet
try INITRD_DEBUG


[4/1/2023 11:50 AM] sizeof.void
@Szybet I'm just gonna mount my tf card partition #1 and edit some files under flags/?


[4/1/2023 11:50 AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-7DE87.png


[4/1/2023 11:51 AM] sizeof.void
Yes, that's exactly what I'm asking.  The notation of `[sd-p1]` isn't quite clear.


[4/1/2023 11:58 AM] szybet
sd card, partiton 1


[4/1/2023 12:24 PM] sizeof.void
Just to confirm, I've executed the following and now will try to connect and boot the reader:
```
mount /dev/sdb1 /mnt
mkdir -p /mnt/flags
echo true >/mnt/flags/INITRD_DEBUG
umount /mnt
```


[4/1/2023 12:27 PM] szybet
yep


[4/1/2023 12:27 PM] szybet
connect usb to it, you should register a new usb - network device


[4/1/2023 12:27 PM] szybet
ip a should show a new device


[4/1/2023 12:33 PM] sizeof.void
Okay, the led of the power button down on the board is lit for a while.  But, I don't see any new messages under dmesg (`dmesg -Hw`), neither I see any new interfaces under `ip a`.


[4/1/2023 12:34 PM] szybet
well


[4/1/2023 12:34 PM] szybet
crap


[4/1/2023 12:34 PM] szybet
do you have a UART to USB converter


[4/1/2023 12:36 PM] sizeof.void


{Attachments}
/mnt/data/projects/git/conversations/media/rn_image_picker_lib_temp_c34d90a7-2ac8-4b5-8E7CC.jpg
/mnt/data/projects/git/conversations/media/rn_image_picker_lib_temp_ef85ef10-58e8-49a-B74DD.jpg


[4/1/2023 12:36 PM] sizeof.void
no.


[4/1/2023 12:37 PM] szybet
can you get one, those are cheap, a fev $


[4/1/2023 12:37 PM] sizeof.void
Lemme see if I can get it here.


[4/1/2023 12:38 PM] szybet
@atro @alex(O_o) did you used usb network connections? its propably not working?


[4/1/2023 12:38 PM] sizeof.void
is this it: https://www.amazon.com.tr/dp/B09KFT8FTP

{Embed}
https://www.amazon.com.tr/dp/B09KFT8FTP
CH340G USB to RS232 TTL UART Çevirici Modül Seri Port
CH340G USB to RS232 TTL UART Çevirici Modül Seri Port
/mnt/data/projects/git/conversations/media/41dmhx4-O0L._SR600%252c315_PIWhiteStrip%25-C8844.jpg


[4/1/2023 12:39 PM] szybet
yes, and its a pretty good one


[4/1/2023 12:39 PM] sizeof.void
can get it next week.


[4/1/2023 12:40 PM] sizeof.void
I'm not in my hometown right now, and with the time I have left here, no curriers can deliver it in time.  Once I'm back in my hometown, I'll order it.


[4/1/2023 12:40 PM] szybet
sure, we can wait


[4/1/2023 12:40 PM] szybet
btw any good electronic store has those


[4/1/2023 12:41 PM] sizeof.void
well, I got one really close by, but I'm pretty sure he doesn't have it.


[4/1/2023 12:42 PM] sizeof.void
It is more of a plug socket cables, lambs kinda place than an electronic store, so to speak.


[4/1/2023 12:42 PM] szybet
yea, electronic as in resistors, capacitors arduinos etc


[4/1/2023 12:42 PM] sizeof.void
yep.


[4/1/2023 12:47 PM] sizeof.void
Do I need anything else, so I can order them?


[4/1/2023 12:47 PM] szybet
well, can you solder?


[4/1/2023 12:50 PM] sizeof.void
No, but got a friend who can, and who has soldering iron back in my hometown.


[4/1/2023 12:50 PM] szybet
is he good at it? can he solder the cables to the clara?


[4/1/2023 12:51 PM] sizeof.void
Can't really speak for him, but I'd say yes.


[4/1/2023 12:51 PM] andi15701
Maybe I should check what is wrong/missing


[4/1/2023 12:51 PM] andi15701
I have some spare sd cards left


[4/1/2023 12:52 PM] sizeof.void
I'd be glad if I can help.


[4/1/2023 12:53 PM] sizeof.void
I got 8GB original SanDisk tf card and 64GB Samsung tf card.


[4/1/2023 12:53 PM] andi15701
but your usb socket is working?


[4/1/2023 12:53 PM] andi15701
so with stock firmware you can access files?


[4/1/2023 12:53 PM] sizeof.void
It is, because I was able to sqlite into some file back when I was tryina use the stock os.


[4/1/2023 12:53 PM] andi15701
and as you say: does pmOS shouw up


[4/1/2023 12:54 PM] sizeof.void
I don't have pmos installed rn.


[4/1/2023 12:54 PM] andi15701
ok


[4/1/2023 12:54 PM] sizeof.void
got only two tf cards.


[4/1/2023 5:15 PM] andi15701
the power led is turned on by u-boot


[4/1/2023 5:15 PM] andi15701
boot.scr


[4/1/2023 5:15 PM] andi15701
then something fails


[4/1/2023 5:58 PM] sizeof.void
@andi Want me to work on something?


[4/1/2023 6:03 PM] andi15701
I will probably check the stuff myself


[4/1/2023 6:30 PM] sizeof.void
As you wish.


[4/1/2023 7:11 PM] cieldautomne
never tried it


[4/1/2023 9:39 PM] andi15701
Last time I tried it was working, but that was with the older init system


[4/8/2023 1:31 PM] sizeof.void
I think my UART to USB converter is gonna arrive today,  Though, I don't think I will be able to hack on it today, but I sure will let you all know.

{Reactions}
👍 

[4/11/2023 10:28 PM] andi15701
I was away the weekend and back only today


[4/11/2023 10:28 PM] andi15701
and now I am too tired


[4/11/2023 10:29 PM] andi15701
perhaps your role should be a documentation tester, everything is known, it just need to be documented or partially documented in such a way that a computer can understand it directly (=scripts, etc.)


[6/25/2023 4:12 AM] tux_linux
So I bought one. I think I have waited enough and since pretty much no one seems available enough or has the will to port it, I will try to


[6/25/2023 4:12 AM] tux_linux
It should arrive next week hopefully

{Reactions}
🔥 (2) 

[7/13/2023 1:51 AM] tux_linux
On the operating table

{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230712_235028483-BBDCB.jpg


[7/13/2023 3:41 AM] tux_linux
@andi  is there a way to speed up ext4 loading size in u-boot? waiting 35s for an 11mb kernel is a bit long... thanks
```
U-Boot 2016.03-00038-g4a92f9d (Jun 04 2018 - 14:20:13 +0800)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 43C
Reset cause: POR
Board: MX6SLL LPDDR2 NTX
I2C:   ready
DRAM:  512 MiB
__get_sd_number(),cfg23=1,cfg24=0 
force_idle_bus: sda=1 scl=0 sda.gp=0x4d scl.gp=0x4c
force_idle_bus: sda=0 scl=0 sda.gp=0x4f scl.gp=0x4e
force_idle_bus: sda=1 scl=0 sda.gp=0x56 scl.gp=0x55
MMC:   board_mmc_init() : isd=1 
board_mmc_init() : wifi=2 
FSL_SDHC: 0, FSL_SDHC: 1
In:    serial
Out:   serial
Err:   serial
ntx_hw_early_init() 0
ram p=80000000,size=536870912
switch to partitions #0, OK
mmc0 is current device
mmc read 0x9ffffe00 0x3ff 0x1

MMC read: dev # 0, block # 1023, count 1 ... 1 blocks read: OK
mmc read 0x9ffffe00 0x400 0x1

MMC read: dev # 0, block # 1024, count 1 ... 1 blocks read: OK
ntx_hw_late_init()
mmc read 0x9ffffc00 0x1 0x1

MMC read: dev # 0, block # 1, count 1 ... 1 blocks read: OK
NTXSN not avalible !
ntx_gpio_get_value(402) : error parameter ! null ptr !
ntx_config_fastboot_layout():10 binaries partition added
ntx_config_fastboot_layout():3 mbr partition added
check_and_clean: reg 0, flag_set 0
Fastboot: Normal
Net:   CPU Net Initialization Failed
No ethernet found.
Hit any key to stop autoboot:  0 
eBR-1A # ext4load mmc 0 0x80800000 zImage-root
11220072 bytes read in 35976 ms (303.7 KiB/s)
eBR-1A #
```


[7/13/2023 8:30 AM] andi15701
hmm,  that is odd


[7/13/2023 8:31 AM] andi15701
does not take that long here


[7/13/2023 8:31 AM] szybet
sd card is old?


[7/13/2023 8:31 AM] andi15701
Does the 2020.10 uboot show the same behavior?


[7/13/2023 8:32 AM] andi15701
yes, sdcard (semi)-broken might be the problem


[7/13/2023 8:32 AM] szybet
@tux-linux check with gnome disks the speed of the sd card


[7/13/2023 8:37 AM] andi15701
https://github.com/aartoni/n249/blob/main/installation.md

{Embed}
https://github.com/aartoni/n249/blob/main/installation.md
n249/installation.md at main · aartoni/n249
Kobo Clara HD and InkBox notes. Contribute to aartoni/n249 development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/n249-E2A58


[7/13/2023 8:38 AM] andi15701
do not forget that bootloader description given there


[7/13/2023 2:19 PM] tux_linux
I will try 2020.10 U-Boot, thanks


[7/13/2023 3:23 PM] tux_linux
also, is that normal?
with stock kernel


[7/13/2023 3:24 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/message-48006.txt


[7/13/2023 3:44 PM] tux_linux
```
U-Boot 2020.10-inkbox (Jul 13 2023 - 09:41:17 -0400)

CPU:   Freescale i.MX6SLL rev1.1 996 MHz (running at 792 MHz)
CPU:   Commercial temperature grade (0C to 95C) at 48C
Reset cause: WDOG
Model: Kobo Clara HD
Board: MX6SLL Kobo Clara HD
DRAM:  512 MiB
MMC:   FSL_SDHC: 0, FSL_SDHC: 1
Loading Environment from MMC... OK
In:    serial
Out:   serial
Err:   serial
Normal Boot
Hit any key to stop autoboot:  0 
kobo => ext4ls mmc 0  
<DIR>       1024 .
<DIR>       1024 ..
<DIR>      12288 lost+found
        11220072 zImage-root
kobo => ext4load mmc 0 0x80800000 zImage-root
11220072 bytes read in 550 ms (19.5 MiB/s)
kobo =>
```
Well, this U-Boot is better


[7/13/2023 4:58 PM] andi15701
looks like something really messed up, never seen that


[7/13/2023 5:38 PM] andi15701
Installing the bootloader
Write the bootloader on the whole device.

dd if=bootloader/out/u-boot_inkbox.n249.imx of=/dev/<microsd> bs=1K seek=1
Create an environment u-boot-env.txt for the bootloader.

mkenvimage -p 0 -s 8192 -o u-boot-env.bin u-boot-env.txt
dd if=u-boot-env.bin of=/dev/<microsd> bs=4096 seek=192
Formatting the microSD
Run the partition script as follows.

sudo sfdisk /dev/<microsd> < partition-script.txt


[7/13/2023 5:38 PM] andi15701
mount /dev/<microsd>1 /mnt
cp kernel/kernel/out/n249/zImage-root /mnt
cp kernel/kernel/linux-5.16-n249/arch/arm/boot/dts/imx6sll-kobo-clarahd.dtb /mnt
cp boot.scr /mnt


[7/13/2023 5:38 PM] andi15701
that are the main bits probably differ in the process


[7/13/2023 5:39 PM] andi15701
the wiki has links to the files


[7/13/2023 6:19 PM] tux_linux
Yes, I did that


[7/13/2023 6:19 PM] tux_linux
the 5.16 kernel doesn't show the i2c error


[7/13/2023 7:11 PM] tux_linux
Where is the brightness sysfs file in the 5.16 kernel?


[7/13/2023 7:16 PM] andi15701
/sys/class/backlight/backlight_{cold,warm}/brightness


[7/13/2023 7:16 PM] tux_linux
i don't have anything in there


[7/13/2023 7:16 PM] tux_linux
```
~ # ls /sys/class/backlight/
~ # 
```


[7/13/2023 7:16 PM] andi15701
modprobe lm3630_bl?


[7/13/2023 7:16 PM] tux_linux
oh ok


[7/13/2023 7:17 PM] tux_linux
clara has a warm light?


[7/13/2023 7:17 PM] tux_linux
didn't even know


[7/13/2023 7:18 PM] szybet
it hurts me that the nia doesnt have one


[7/13/2023 7:18 PM] szybet
:(


[7/13/2023 7:19 PM] szybet
maybe i can swap the leds? if the screen is even a bit open


[7/13/2023 7:22 PM] andi15701
every ebookreader in mainline either has one dir in /sys/class/backlight -> then it has one backlight


[7/13/2023 7:41 PM] tux_linux
how to start the wifi inteface


[7/13/2023 7:41 PM] tux_linux
i modprobed brcmfmac but nothing shows up in ifconfig


[7/13/2023 7:41 PM] tux_linux
nothing on dmesg either


[7/13/2023 7:42 PM] tux_linux
```
~ # lsmod
brcmfmac 217088 0 - Live 0xbf058000
brcmutil 20480 1 brcmfmac, Live 0xbf052000
usb_f_ecm 16384 1 - Live 0xbf04d000
g_ether 16384 0 - Live 0xbf043000
usb_f_rndis 24576 2 g_ether, Live 0xbf03c000
u_ether 24576 3 usb_f_ecm,g_ether,usb_f_rndis, Live 0xbf035000
libcomposite 53248 3 usb_f_ecm,g_ether,usb_f_rndis, Live 0xbf027000
configfs 36864 4 usb_f_ecm,usb_f_rndis,libcomposite, Live 0xbf01d000
lm3630a_bl 16384 0 - Live 0xbf018000
mxc_epdc_v2_fb 53248 1 - Live 0xbf00a000
tps6518x_regulator 16384 3 - Live 0xbf005000
tps6518x_hwmon 16384 0 - Live 0xbf000000
~ #
```
I have this


[7/13/2023 7:45 PM] andi15701
you need


[7/13/2023 7:45 PM] andi15701
8189fs


[7/13/2023 7:45 PM] andi15701
and only that one


[7/13/2023 7:45 PM] tux_linux
why is it not in my modules.sqsh file


[7/13/2023 7:45 PM] tux_linux
hmm whatever


[7/13/2023 7:45 PM] tux_linux
then why is brcmfmac there?


[7/13/2023 7:46 PM] andi15701
because needed for other devices compatible with that kernel

{Reactions}
👍 

[7/13/2023 7:46 PM] tux_linux
does it have to be built out of tree? or that's just an old nightmare now?


[7/13/2023 7:46 PM] andi15701
needs to be built out of tree, but needs no fancy firmware


[7/13/2023 7:47 PM] tux_linux
ok


[7/13/2023 7:47 PM] tux_linux
do you have a ko file you could share?


[7/13/2023 7:47 PM] tux_linux
could save some time


[7/13/2023 7:47 PM] tux_linux
thanks


[7/13/2023 7:47 PM] tux_linux
```
[   12.722796] Console: switching to colour frame buffer device 181x67
[   12.735778] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with error -2
[   12.743079] imx_epdc_v2_fb 20f4000.epdc:  --- Extra Waveform Data length: 29 bytes---
[   12.743199] imx_epdc_v2_fb 20f4000.epdc:      Extra Waveform Data: 320_R217_AJ0801_ED060KH6C1_TC
[   12.773310] imx_epdc_v2_fb 20f4000.epdc: Unable to get an accurate EPDC pix clkdesired = 80000000, actual = 72605042
[   12.833919] _tps6518x_vcom_get_voltage() : vcom=2750000uV
```
also is that normal


[7/13/2023 7:48 PM] andi15701
that is normal


[7/13/2023 7:48 PM] tux_linux
ok


[7/13/2023 7:48 PM] andi15701
inaccurate clk is also with vendor kernel


[7/13/2023 7:48 PM] andi15701
wifi is:


[7/13/2023 7:48 PM] andi15701
https://github.com/jwrdegoede/rtl8189ES_linux.git

{Embed}
https://github.com/jwrdegoede/rtl8189ES_linux.git
GitHub - jwrdegoede/rtl8189ES_linux
Contribute to jwrdegoede/rtl8189ES_linux development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/rtl8189ES_linux-8C48E

{Reactions}
👍 

[7/13/2023 7:48 PM] andi15701
branch 8189fs


[7/13/2023 7:49 PM] andi15701
cd "$WLANSRC"
makearm KSRC=$KSRC CONFIG_RTW_DEBUG=n CONFIG_RTW_SDIO_PM_KEEP_POWER=n


[7/13/2023 7:49 PM] andi15701
KSRC=kernel build dir


[7/13/2023 7:49 PM] tux_linux
```
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.000000] clk: failed to reparent pll4_audio_div to osc: -22
[    0.204835] debugfs: Directory 'dummy-iomuxc-gpr@20e4000' with parent 'regmap' already present!
[    1.606861] cyttsp5_i2c_adapter 1-0024: cyttsp5_get_hid_descriptor_: failed to get HID descriptor length and version, rc=-6
[    1.630987] cyttsp5_i2c_adapter 1-0024: cyttsp5_startup_: Error on getting HID descriptor r=-6
[    1.852741] cyttsp5_i2c_adapter 1-0024: cyttsp5_read_input: Error getting report, r=-6
```
I get this on boot with 5.16 kernel


[7/13/2023 7:49 PM] tux_linux
ok thanks


[7/13/2023 7:50 PM] andi15701
it retries


[7/13/2023 7:50 PM] andi15701
and makearm:


[7/13/2023 7:50 PM] andi15701
alias makearm='make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf-'


[7/13/2023 7:51 PM] andi15701
something similar


[7/13/2023 7:51 PM] tux_linux
nice


[7/13/2023 7:51 PM] andi15701
according to your setup


[7/13/2023 7:51 PM] tux_linux
what compiler


[7/13/2023 7:51 PM] tux_linux
i used koxtoolchain for kernel


[7/13/2023 7:51 PM] andi15701
the one you use for the kernel


[7/13/2023 7:51 PM] tux_linux
ok


[7/13/2023 7:52 PM] tux_linux
actually i used the musl one


[7/13/2023 7:52 PM] tux_linux
but anyways


[7/13/2023 9:04 PM] tux_linux
how do i do to make it work with modprobe


[7/13/2023 9:04 PM] tux_linux
replace whole modules tree in initrd?


[7/13/2023 9:05 PM] andi15701
the 8189fs itself? or backlight?


[7/13/2023 9:06 PM] tux_linux
8189es


[7/13/2023 9:06 PM] tux_linux
I compiled the module and stripped it


[7/13/2023 9:06 PM] andi15701
8189fs


[7/13/2023 9:06 PM] tux_linux
i don't know much what to do with that file


[7/13/2023 9:06 PM] tux_linux
the repo you sent me is 8189es


[7/13/2023 9:06 PM] andi15701
did you select the right branch?


[7/13/2023 9:07 PM] tux_linux
oh ok


[7/13/2023 9:08 PM] tux_linux
well, if I have it


[7/13/2023 9:08 PM] tux_linux
where does that module go


[7/13/2023 9:08 PM] andi15701
amoung the other ones


[7/13/2023 9:08 PM] tux_linux
i just drop it in `/lib/modules`?


[7/13/2023 9:08 PM] tux_linux
no change to anything else?


[7/13/2023 9:09 PM] andi15701
cp "$WLANSRC/8189fs.ko" "dst/lib/modules/$KVER/drivers/net/wireless/"


[7/13/2023 9:09 PM] andi15701
depmod needs to be rerun


[7/13/2023 9:10 PM] tux_linux
ok


[7/13/2023 9:10 PM] tux_linux
run from pc?


[7/13/2023 9:10 PM] andi15701
might be easier


[7/13/2023 9:10 PM] andi15701
the results need to be stored


[7/13/2023 9:12 PM] tux_linux
ok, so I can run depmod -n on the device and then copy what I get to my sqsh archive?


[7/13/2023 9:14 PM] andi15701
or ordinary depmod on the device


[7/13/2023 9:14 PM] andi15701
and copy the stuff back

{Reactions}
👍 

[7/13/2023 9:14 PM] tux_linux
well, `/lib/modules` is ro on the device
I think


[7/13/2023 9:14 PM] tux_linux
thanks


[7/13/2023 9:28 PM] andi15701
you can also use -b


[7/13/2023 9:28 PM] andi15701
depmod -b


[7/13/2023 9:29 PM] andi15701
andi@aktux:~/kobo/kernel/dst$ /sbin/depmod -b . 6.4.0-00146-g888f6f03fba3
andi@aktux:~/kobo/kernel/dst$ ls lib/modules/6.4.0-00146-g888f6f03fba3
build              modules.builtin.alias.bin  modules.order
drivers            modules.builtin.bin        modules.softdep
kernel             modules.builtin.modinfo    modules.symbols
modules.alias      modules.dep                modules.symbols.bin
modules.alias.bin  modules.dep.bin            source
modules.builtin    modules.devname


[7/13/2023 9:29 PM] andi15701
so this way


[7/13/2023 9:30 PM] tux_linux
i have the busybox version


[7/13/2023 9:30 PM] andi15701
so the pc


[7/13/2023 9:30 PM] tux_linux
on kobo


[7/13/2023 9:30 PM] tux_linux
ok


[7/13/2023 9:31 PM] andi15701
that directory tree was created by makearm modules_install INSTALL_MOD_PATH=$PWD/dst INSTALL_MOD_STRIP=1

{Reactions}
👍 

[7/13/2023 9:34 PM] tux_linux
of course it had to do that


[7/13/2023 9:34 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/message-57C89.txt


[7/13/2023 9:34 PM] tux_linux
is it something to worry about?


[7/13/2023 9:37 PM] andi15701
well, seems still to work


[7/13/2023 9:37 PM] tux_linux
does it do that on your device?


[7/13/2023 9:37 PM] andi15701
yes


[7/13/2023 9:37 PM] tux_linux
ok


[7/13/2023 9:37 PM] tux_linux
good


[7/13/2023 9:38 PM] andi15701
should of course better be fixed

{Reactions}
👍 

[7/13/2023 9:38 PM] andi15701
I did not have the courage yet to upstream a driver for that chip


[7/13/2023 9:39 PM] tux_linux
well, if it works


[7/13/2023 9:39 PM] tux_linux
i can live with it


[7/13/2023 9:40 PM] andi15701
I guess we might get WPA3 if the 8188fu driver in the kernel gets extended to also support the 8189fs

{Reactions}
👍 

[7/15/2023 6:55 PM] tux_linux
is it normal that in fastboot mode nothing works and everything seems to hang?


[7/15/2023 6:56 PM] tux_linux
i can't boot a kernel or even resume booting


[7/15/2023 6:56 PM] tux_linux
also in terminal it shows itself like this:
```
nicolasmailloux@Nicolass-MacBook-Pro ~/Music [SIGINT]> sudo fastboot devices
????????????     fastboot
nicolasmailloux@Nicolass-MacBook-Pro ~/Music>
```


[7/15/2023 7:24 PM] szybet
Welp on the nia yes


[7/15/2023 7:24 PM] tux_linux
that is with vendor u-boot?


[7/15/2023 7:24 PM] tux_linux
i.e. kobo one


[7/15/2023 7:29 PM] szybet
Welp yes


[7/15/2023 7:30 PM] szybet
But by observing porting threads with mainline, i didnt saw something really succesfull with it


[7/15/2023 8:00 PM] andi15701
well, I am using fastboot all the time


[7/15/2023 8:00 PM] andi15701
when testing out new kernels and stuff


[7/15/2023 8:01 PM] andi15701
especially with some nfsroot behind it


[7/15/2023 8:04 PM] andi15701
often without sd card


[7/15/2023 8:05 PM] andi15701
and using nfsroot


[7/15/2023 8:05 PM] andi15701
most of the time the 2020.10-based u-boot


[7/15/2023 8:15 PM] tux_linux
When I want to load a kernel, it hangs and takes forever to send it


[7/15/2023 8:29 PM] andi15701
so with 2020.10-based u-boot?


[7/15/2023 8:30 PM] andi15701
what I have sometimes seen: when running as normal user


[7/15/2023 8:30 PM] andi15701
some udev rule takes ages


[7/15/2023 8:30 PM] andi15701
until it finally was allowed for nomal users to use


[7/15/2023 8:53 PM] andi15701
standard scenario for unresponsive fastboot: if u-boot does not run anymore but usb is not reset


[7/15/2023 8:53 PM] andi15701
so the computer still sees a fasboot device


[7/15/2023 10:27 PM] tux_linux
I am running it as root


[7/15/2023 10:31 PM] szybet
Mac?


[7/15/2023 10:31 PM] tux_linux
Yes


[7/15/2023 10:31 PM] tux_linux
It works for other devices


[7/15/2023 10:31 PM] tux_linux
I am able to boot the Libra with it


[7/15/2023 10:31 PM] szybet
Hmmm weird


[7/16/2023 9:08 AM] andi15701
I will probably be not on discord for the next three weeks

{Reactions}
👍 

[7/16/2023 5:24 PM] tux_linux
[FBInk] [refresh_kobo] MXCFB_SEND_UPDATE_V1_NTX: Invalid argument!
[FBInk] update_region={top=647, left=416, width=220, height=75}!
[FBInk] [fbink_refresh] Failed to refresh the screen!
[FBInk] [refresh_kobo] MXCFB_SEND_UPDATE_V1_NTX: Invalid argument!
[FBInk] update_region={top=647, left=416, width=220, height=75}!
[FBInk] [fbink_refresh] Failed to refresh the screen!
[FBInk] [refresh_kobo] MXCFB_SEND_UPDATE_V1_NTX: Invalid argument!
[FBInk] update_region={top=17, left=706, width=71, height=68}!
[FBInk] [fbink_refresh] Failed to refresh the screen!

great


[7/16/2023 5:24 PM] szybet
https://tenor.com/view/xqc-xqc-confused-xqc-reaction-confused-confused-look-gif-20183973

{Embed}
https://tenor.com/view/xqc-xqc-confused-xqc-reaction-confused-confused-look-gif-20183973
/mnt/data/projects/git/conversations/media/xqc-xqc-confused-3B1B0.png


[7/16/2023 5:25 PM] szybet
blank?


[7/16/2023 5:27 PM] tux_linux
idk


[7/17/2023 7:13 PM] tux_linux
```
/ # ssh root@127.0.0.1
Connection closed by 127.0.0.1 port 22
/ #
```
Nice nonsense


[7/17/2023 7:13 PM] szybet
makes sense


[7/17/2023 7:13 PM] szybet
what you are trying to do


[7/17/2023 7:14 PM] tux_linux
ssh


[7/17/2023 7:14 PM] tux_linux
sshd is started


[7/17/2023 7:14 PM] tux_linux
i'm on the kobo


[7/17/2023 7:16 PM] szybet
show me if the port is open


[7/17/2023 7:16 PM] szybet
also logs from sshd


[7/17/2023 7:17 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/message-96A1E.txt


[7/17/2023 7:18 PM] szybet
i cant see here anything usefull


[7/17/2023 7:20 PM] tux_linux
hm yea thanks nmap


[7/17/2023 7:20 PM] tux_linux
```
nicolasmailloux@MacBook-Pro /tmp [SIGINT]> nmap 192.168.2.2
Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-17 13:20 EDT
Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn
Nmap done: 1 IP address (0 hosts up) scanned in 3.04 seconds
nicolasmailloux@MacBook-Pro /tmp>
```


[7/17/2023 7:20 PM] tux_linux
```
nicolasmailloux@MacBook-Pro /tmp> ping 192.168.2.2
PING 192.168.2.2 (192.168.2.2): 56 data bytes
64 bytes from 192.168.2.2: icmp_seq=0 ttl=64 time=3.861 ms
64 bytes from 192.168.2.2: icmp_seq=1 ttl=64 time=3.889 ms
^C
--- 192.168.2.2 ping statistics ---
2 packets transmitted, 2 packets received, 0.0% packet loss
round-trip min/avg/max/stddev = 3.861/3.875/3.889/0.014 ms
nicolasmailloux@MacBook-Pro /tmp>
```


[7/17/2023 7:21 PM] szybet
try nmap -T4 -A -v


[7/17/2023 7:22 PM] tux_linux
```
nicolasmailloux@MacBook-Pro /tmp> nmap -T4 -A -v 192.168.2.2
Starting Nmap 7.94 ( https://nmap.org ) at 2023-07-17 13:22 EDT
NSE: Loaded 156 scripts for scanning.
NSE: Script Pre-scanning.
Initiating NSE at 13:22
Completed NSE at 13:22, 0.00s elapsed
Initiating NSE at 13:22
Completed NSE at 13:22, 0.00s elapsed
Initiating NSE at 13:22
Completed NSE at 13:22, 0.00s elapsed
Initiating Ping Scan at 13:22
Scanning 192.168.2.2 [2 ports]
Completed Ping Scan at 13:22, 2.01s elapsed (1 total hosts)
Nmap scan report for 192.168.2.2 [host down]
NSE: Script Post-scanning.
Initiating NSE at 13:22
Completed NSE at 13:22, 0.00s elapsed
Initiating NSE at 13:22
Completed NSE at 13:22, 0.00s elapsed
Initiating NSE at 13:22
Completed NSE at 13:22, 0.00s elapsed
Read data files from: /opt/homebrew/bin/../share/nmap
Note: Host seems down. If it is really up, but blocking our ping probes, try -Pn
Nmap done: 1 IP address (0 hosts up) scanned in 2.45 seconds
nicolasmailloux@MacBook-Pro /tmp> 
```


[7/17/2023 7:23 PM] szybet
try the Pn then


[7/17/2023 7:23 PM] tux_linux
i did


[7/17/2023 7:23 PM] tux_linux
nothing


[7/17/2023 7:23 PM] szybet
try to ping 1.1.1.1 from the kobo


[7/17/2023 7:24 PM] tux_linux
well now it detects ports


[7/17/2023 7:24 PM] tux_linux
nonsense


[7/17/2023 7:24 PM] tux_linux
unplug/plug solved it


[7/17/2023 7:24 PM] tux_linux
not the ssh problem though


[7/17/2023 7:24 PM] szybet
usbnet?


[7/17/2023 7:24 PM] tux_linux
yes


[7/17/2023 7:24 PM] szybet
and mac?


[7/17/2023 7:24 PM] tux_linux
yes


[7/17/2023 7:25 PM] szybet
https://tenor.com/view/mari-hehe-omori-hehe-omori-sus-omori-sussy-gif-24613170

{Embed}
https://tenor.com/view/mari-hehe-omori-hehe-omori-sus-omori-sussy-gif-24613170
/mnt/data/projects/git/conversations/media/mari-hehe-omori-hehe-A4C60.png


[7/17/2023 9:45 PM] tux_linux
@andi if you are on discord sometime soon, I would like your help on this


[7/17/2023 9:48 PM] szybet
try telnet


[7/17/2023 9:48 PM] szybet
also, write to him on matrix


[7/17/2023 9:48 PM] szybet
he said "discord"


[7/17/2023 9:49 PM] tux_linux
telnet works
that's not a problem


[7/17/2023 9:50 PM] szybet
hmm


[7/17/2023 9:50 PM] szybet
idea


[7/17/2023 9:50 PM] szybet
try 0.0.0.0


[7/17/2023 9:51 PM] szybet
also show me /etc/hosts


[7/17/2023 9:52 PM] tux_linux
```
/ # cat /mnt/etc/hosts
127.0.0.1       localhost localhost.localdomain
::1             localhost localhost.localdomain
/ #
```


[7/17/2023 9:53 PM] tux_linux
```
/ # ssh root@0.0.0.0
Connection closed by 127.0.0.1 port 22
/ #
```


[7/17/2023 9:53 PM] szybet
how do you launch sshd


[7/17/2023 9:53 PM] tux_linux
the only thing I see would be a changed kernel option because nothing has changed about the rootfs and it works on other devices


[7/17/2023 9:53 PM] tux_linux
same way


[7/17/2023 9:54 PM] szybet
you can see the port from outside?


[7/17/2023 9:54 PM] szybet
try dropbear ssh maybe


[7/17/2023 9:54 PM] szybet
for the sake of trying the protocol


[7/17/2023 9:55 PM] tux_linux
well of course i can see it


[7/17/2023 9:55 PM] tux_linux
otherwise how would i be able to connect


[7/17/2023 9:55 PM] szybet
collect reasonable logs


[7/17/2023 9:57 PM] tux_linux
i already showed them to you


[7/17/2023 9:57 PM] szybet
worthless, there is nothing


[7/17/2023 9:57 PM] szybet
ask chatgpt


[7/17/2023 9:57 PM] szybet
it can read not reasonable logs


[7/17/2023 9:57 PM] szybet
i cant


[7/17/2023 9:57 PM] tux_linux
it wasn't useful at all


[7/17/2023 10:06 PM] szybet
can you see the ports with netstat?


[7/17/2023 10:06 PM] szybet
locally


[7/17/2023 10:15 PM] tux_linux
```
/overlaymount-rootfs/mnt/rootfs/overlay/boot # netstat
Active Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       
tcp        0      0 ::ffff:192.168.3.2:23   ::ffff:192.168.3.1:52806 ESTABLISHED 
tcp        0      0 ::ffff:192.168.3.2:23   ::ffff:192.168.3.1:52817 ESTABLISHED 
Active UNIX domain sockets (w/o servers)
Proto RefCnt Flags       Type       State         I-Node Path
unix  3      [ ]         DGRAM      CONNECTED      11711 
unix  3      [ ]         DGRAM      CONNECTED      11710 
unix  2      [ ]         DGRAM                     11431 
unix  2      [ ]         DGRAM                      9956
```


[7/17/2023 10:20 PM] szybet
so, no?


[7/17/2023 10:21 PM] tux_linux
idk


[7/17/2023 10:21 PM] tux_linux
this is the output


[7/17/2023 10:21 PM] szybet
try with 23 port


[7/17/2023 10:21 PM] szybet
-p 23 to ssh


[7/17/2023 10:21 PM] tux_linux
```
evdevtouch: /dev/input/event1: Invalid ABS limits, behavior unspecified
```
oh not that now


[7/17/2023 10:25 PM] szybet
event1 is?


[7/17/2023 10:25 PM] szybet
touchscreen?


[7/17/2023 10:25 PM] szybet
and you are trying to run?


[7/17/2023 10:26 PM] szybet
well anyway, now you understand why i went with kobolabs kernel?


[7/17/2023 10:26 PM] szybet
simply easier, i know i know but yea


[7/18/2023 3:38 AM] tux_linux
Hmm ok fbink

{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_013811996-FB1A1.jpg


[7/18/2023 4:06 AM] tux_linux
yay?

{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_020617648-B1924.jpg


[7/18/2023 4:06 AM] tux_linux
🥴


[7/18/2023 4:08 AM] tux_linux
```
/ # fbink hello
[FBInk] Couldn't find a Kobo version tag (onboard unmounted or not running on a Kobo?)!
[FBInk] Detected a Kobo Clara HD (376 => Nova @ Mark 7)
[FBInk] Enabled Kobo Mark 7 quirks
[FBInk] Clock tick frequency appears to be 100 Hz
[FBInk] Screen density set to 300 dpi
[FBInk] Variable fb info: 1072x1448, 8bpp @ rotation: 3 (Counter Clockwise, 270°)
[FBInk] Fixed fb info: ID is "mxc_epdc_fb", length of fb mem: 6782976 bytes & line length: 1088 bytes
[FBInk] Canonical rotation: 0 (Upright, 0°)
[FBInk] Fontsize set to 24x24 (IBM base glyph size: 8x8)
[FBInk] Line length: 44 cols, Page size: 60 rows
[FBInk] Vertical fit isn't perfect, shifting rows down by 4 pixels
[FBInk] Pen colors set to #000000 for the foreground and #FFFFFF for the background
Printing string 'hello' @ column 0 + 0px, row 0 + 0px (overlay: N, no BG: N, no FG: N, inverted: N, flashing: N, centered: N, halfway: N, left padded: N, right padded: N, clear screen: N, waveform: AUTO, dithering: PASSTHROUGH, nightmode: N, skip refresh: N, font: 0, font scaling: x0)
Next line should start @ row 1
/ #
```


[7/18/2023 4:08 AM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_020734016-EED65.jpg


[7/18/2023 4:09 AM] tux_linux
@NiLuJe any ideas?
This is on mainline 5.16.0 kernel
thanks


[7/18/2023 4:09 AM] tux_linux
Also @andi you might be interested


[7/18/2023 4:14 AM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_021425694-B8E07.jpg


[7/18/2023 4:14 AM] tux_linux
when invoking `fbink -Y 74 hello` with this value or with values around 74, it prints it at the top left of the screen where it should normally be


[7/18/2023 4:18 AM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_021832727-A9522.jpg


[7/18/2023 4:19 AM] tux_linux
after a reboot without changes it looks like this


[7/18/2023 4:21 AM] tux_linux
after reboot, `fbink hello` prints this:
```
/ # fbink hello
[FBInk] Couldn't find a Kobo version tag (onboard unmounted or not running on a Kobo?)!
[FBInk] Detected a Kobo Clara HD (376 => Nova @ Mark 7)
[FBInk] Enabled Kobo Mark 7 quirks
[FBInk] Clock tick frequency appears to be 100 Hz
[FBInk] Screen density set to 300 dpi
[FBInk] Variable fb info: 1072x1448, 8bpp @ rotation: 3 (Counter Clockwise, 270°)
[FBInk] Fixed fb info: ID is "mxc_epdc_fb", length of fb mem: 6782976 bytes & line length: 1088 bytes
[FBInk] Canonical rotation: 0 (Upright, 0°)
[FBInk] Fontsize set to 24x24 (IBM base glyph size: 8x8)
[FBInk] Line length: 44 cols, Page size: 60 rows
[FBInk] Vertical fit isn't perfect, shifting rows down by 4 pixels
[FBInk] Pen colors set to #000000 for the foreground and #FFFFFF for the background
Printing string 'hello' @ column 0 + 0px, row 0 + 0px (overlay: N, no BG: N, no FG: N, inverted: N, flashing: N, centered: N, halfway: N, left padded: N, right padded: N, clear screen: N, waveform: AUTO, dithering: PASSTHROUGH, nightmode: N, skip refresh: N, font: 0, font scaling: x0)
Next line should start @ row 1
/ #
```


[7/18/2023 4:21 AM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_022136256-D475D.jpg


[7/18/2023 4:22 AM] tux_linux
and shows this


[7/18/2023 6:12 AM] ninuje
Is something panning, perhaps?


[7/18/2023 6:12 AM] ninuje
FBInk assumes the first screen and no panning (and also no offsets)


[7/18/2023 6:13 AM] ninuje
Also, add a -v to that to describe the offsets


[7/18/2023 6:15 AM] ninuje
Get me the verbose output from my fbgrab build: https://svn.ak-team.com/svn/Configs/trunk/Kindle/Misc/FBGrab/


[7/18/2023 6:15 AM] ninuje
That'll dump the panning offsets if any (i.e., `fbgrab -v /dev/null`) although you can point that at a real file for funsies, as that one *will* honor the offsets (but still only dump the first screen)


[7/18/2023 1:11 PM] tux_linux
```
/ # fbgrab -v /tmp/test.png
Fixed framebuffer info:
id: "mxc_epdc_fb"
start of fb mem: 0x9a900000
length of fb mem: 6782976 bytes
type: packed pixels
interleave for interleaved planes: 0
visual: pseudo color readonly
hw panning x step: 1
hw panning y step: 1
hw y wrap: 0
line length: 1088 bytes (1088 pixels)
start of mmio: 0
length of mmio: 0
accel chip/card: 0
capabilities: undefined! (0)

Variable framebuffer info:
visible resolution: 1072x1448
virtual resolution: 1088x3072
offset from virtual to visible resolution: 0x0
bits per pixel: 8
grayscale: true
red:   bitfield offset: 0, bitfield length: 8, MSB is right: no
green: bitfield offset: 0, bitfield length: 8, MSB is right: no
blue:  bitfield offset: 0, bitfield length: 8, MSB is right: no
alpha: bitfield offset: 0, bitfield length: 0, MSB is right: no
pixel format: standard
activate: 0
height: 4294967295 mm
width: 4294967295 mm
obsolete accel_flags: 0
pixel clock: 80000000 ps
time from sync to picture (left margin): 16 pixclocks
time from picture to sync (right margin): 102 pixclocks
time from sync to picture (upper margin): 4 pixclocks
time from picture to sync (lower margin): 4 pixclocks
length of horizontal sync: 28 pixclocks
length of vertical sync: 2 pixclocks
sync: undefined! (0)
vmode: non interlaced
rotate: 3
colorspace for FOURCC-based modes: 0

Color map info:
start: 0, len: 256
  N      #R      #G      #B
00-03   0000    AAAA    AAAA
04-07   AAAA    AAAA    AAAA
08-0B   5555    FFFF    FFFF
0C-0F   FFFF    FFFF    FFFF
10-FF   0000    0000    0000

Pixel format details:
B: 8 >> 0
G: 8 >> 0
R: 8 >> 0
A: 0 >> 0
Should alpha be honored? No.

** Couldn't find a Kobo version tag (not running on a Kobo?)! **
Skipping 0 bytes
Resolution: 1088x1448 -> 1072x1448 (cropping: 16 rightmost pixels) @ depth 8 (invert: no)
No conversion needed
Now writing PNG file (compression 4)
/ #
```


[7/18/2023 1:11 PM] tux_linux
@NiLuJe


[7/18/2023 1:29 PM] tux_linux
strangely, it displays it correctly there on the grabbed picture

{Attachments}
/mnt/data/projects/git/conversations/media/test-031E0.png


[7/18/2023 1:30 PM] szybet
isint your screen just shifted?


[7/18/2023 1:31 PM] tux_linux
yes


[7/18/2023 1:31 PM] szybet
um really?


[7/18/2023 1:31 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_113113117.MP-76EF7.jpg


[7/18/2023 1:31 PM] tux_linux
see


[7/18/2023 1:31 PM] szybet
so it is


[7/18/2023 1:31 PM] szybet
you can propably readjust it & some glue


[7/18/2023 1:32 PM] szybet
but dissasembling it is hard


[7/18/2023 1:32 PM] tux_linux
Also, in this grabbed picture, there is a small black block that is there; I don't know if you know what it is and whether it can be removed or not (NiLuJe)


[7/18/2023 1:32 PM] szybet
why is the status bar on the bottom


[7/18/2023 1:32 PM] tux_linux
?


[7/18/2023 1:32 PM] tux_linux
?!?


[7/18/2023 1:32 PM] tux_linux
the screen is shifted


[7/18/2023 1:33 PM] szybet
not psyhically? inside the case?


[7/18/2023 1:33 PM] tux_linux
since it is too much leaning towards the top


[7/18/2023 1:33 PM] tux_linux
it throws what was there to the bottom


[7/18/2023 1:33 PM] szybet
oh lol


[7/18/2023 1:33 PM] szybet
screen overflow :D


[7/18/2023 1:33 PM] tux_linux
technically no because everything is still printed


[7/18/2023 1:33 PM] tux_linux
just not at the right place


[7/18/2023 1:34 PM] szybet
techincally yes


[7/18/2023 1:35 PM] szybet
uint 0 - 1 = 3275873298573829 ( a lot )


[7/18/2023 1:35 PM] tux_linux
i still have that ssh problem


[7/18/2023 1:36 PM] tux_linux
looks like it's going to be hard


[7/18/2023 1:36 PM] tux_linux
i think i have to load a kernel module for input


[7/18/2023 3:31 PM] tux_linux
well, actually, no
@andi do you know how i could move cyttsp5 to event1 and gpio-keys to event0? thanks


[7/18/2023 6:47 PM] ninuje
It's 8x16 which is... conspicuous.


[7/18/2023 6:48 PM] ninuje
In any case, no offsets, so nothing we can do in userland


[7/18/2023 6:48 PM] ninuje
Probably a kernel snafu


[7/18/2023 6:48 PM] ninuje
Possibly involving the PxP


[7/18/2023 7:14 PM] tux_linux
Nice


[7/18/2023 7:20 PM] tux_linux
Could you look at the kernel source if you have time? It's there: https://github.com/Kobo-InkBox/kernel/tree/master/kernel%2Flinux-5.16-n249

{Embed}
https://github.com/Kobo-InkBox/kernel/tree/master/kernel%2Flinux-5.16-n249
kernel/kernel/linux-5.16-n249 at master · Kobo-InkBox/kernel
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-9BC40


[7/18/2023 7:20 PM] tux_linux
Huge thanks


[7/18/2023 7:20 PM] ninuje
I don',t and PxP is nightmare fuel, so, hard pass


[7/18/2023 7:20 PM] tux_linux
Ok no problem


[7/18/2023 7:21 PM] tux_linux
Could you point me to a directory that I could look in at least?


[7/18/2023 7:34 PM] tux_linux
https://github.com/Kobo-InkBox/kernel/tree/master/kernel/linux-5.16-n249/drivers/dma/pxp
this i would guess

{Embed}
https://github.com/Kobo-InkBox/kernel/tree/master/kernel/linux-5.16-n249/drivers/dma/pxp
kernel/kernel/linux-5.16-n249/drivers/dma/pxp at master · Kobo-InkB...
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-9BC40


[7/18/2023 7:37 PM] tux_linux
at initial module load it says this
```
[   12.901562] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with error -2
[   12.907471] imx_epdc_v2_fb 20f4000.epdc:  --- Extra Waveform Data length: 29 bytes---
[   12.907589] imx_epdc_v2_fb 20f4000.epdc:      Extra Waveform Data: 320_R217_AJ0801_ED060KH6C1_TC
[   12.931828] imx_epdc_v2_fb 20f4000.epdc: Unable to get an accurate EPDC pix clkdesired = 80000000, actual = 72605042
[   12.975502] lm3630a_bl 0-0036: LM3630A backlight register OK.
[   12.995212] _tps6518x_vcom_get_voltage() : vcom=2750000uV
[   14.301296] imx_epdc_v2_fb 20f4000.epdc: Direct firmware load for imx/epdc/epdc_PENG060D.fw failed with error -2
[   14.307886] imx_epdc_v2_fb 20f4000.epdc:  --- Extra Waveform Data length: 29 bytes---
[   14.307931] imx_epdc_v2_fb 20f4000.epdc:      Extra Waveform Data: 320_R217_AJ0801_ED060KH6C1_TC
[   14.348936] imx_epdc_v2_fb 20f4000.epdc: Unable to get an accurate EPDC pix clkdesired = 80000000, actual = 72605042
[   14.383173] imx_epdc_v2_fb 20f4000.epdc: Update region is outside bounds of framebuffer.Aborting update.
```


[7/18/2023 7:40 PM] tux_linux
seems it's not reading the waveform at the right place


[7/18/2023 7:40 PM] tux_linux
would be strange if this was the problem


[7/18/2023 7:40 PM] szybet
its reading from the file, right?


[7/18/2023 7:40 PM] szybet
right?


[7/18/2023 10:28 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230718_202506780.MP-EBB44.jpg


[7/18/2023 10:28 PM] tux_linux
a different compiler worked?


[7/18/2023 10:28 PM] tux_linux
what nonsense


[7/18/2023 10:29 PM] szybet
https://tenor.com/view/mac-trash-gif-26503253

{Embed}
https://tenor.com/view/mac-trash-gif-26503253
/mnt/data/projects/git/conversations/media/mac-trash-1BA04.png


[7/18/2023 10:29 PM] tux_linux
ok


[7/18/2023 10:30 PM] szybet
run all things through rosetta and stop wasting your time


[7/18/2023 10:30 PM] szybet
there is a reason i hop on docker the moment i have a problem with anything


[7/18/2023 10:30 PM] tux_linux
it is a linux vm


[7/18/2023 10:30 PM] tux_linux
i compiled with an aarch64 compiler this time


[7/18/2023 10:30 PM] szybet
diffrent arch


[7/18/2023 10:30 PM] tux_linux
not with my remote x86_64 machine


[7/18/2023 10:30 PM] szybet
so its in reverse?


[7/18/2023 10:30 PM] tux_linux
?


[7/18/2023 10:31 PM] szybet
also, what did you compiled?


[7/18/2023 10:31 PM] tux_linux
clara kernel


[7/18/2023 10:31 PM] szybet
oh


[7/18/2023 10:31 PM] szybet
i thought qt


[7/18/2023 10:31 PM] szybet
oops


[7/18/2023 10:31 PM] szybet
well anyway, it sometimes really happens


[7/18/2023 10:31 PM] szybet
randomly


[7/18/2023 10:32 PM] tux_linux
🥴


[7/18/2023 10:32 PM] tux_linux
how do you make inkbox display 'sleeping' without pressing the power button?


[7/18/2023 10:32 PM] tux_linux
i'm talking about qt


[7/18/2023 10:32 PM] szybet
@Kitkat / Szybet ( sometimes ) also has arch, before i hopped to docker i had problems with kernel, i compiled on his machine and it was fine. both arch, nearly identical hardware


[7/18/2023 10:32 PM] tux_linux
not the splash screen


[7/18/2023 10:32 PM] tux_linux
ok


[7/18/2023 10:33 PM] szybet
um


[7/18/2023 10:33 PM] szybet
the


[7/18/2023 10:33 PM] szybet
pipe


[7/18/2023 10:33 PM] szybet
in


[7/18/2023 10:33 PM] szybet
dev


[7/18/2023 10:33 PM] szybet
sleep


[7/18/2023 10:33 PM] szybet
something


[7/18/2023 10:33 PM] tux_linux
ok


[7/18/2023 10:33 PM] szybet
cant remember


[7/18/2023 10:33 PM] tux_linux
start


[7/18/2023 10:33 PM] szybet
its not really needed in user apps


[7/18/2023 10:33 PM] szybet
i hadnt had problems on the nia at least


[7/18/2023 10:33 PM] tux_linux
no i just want to make qt refresh the screen


[7/18/2023 10:33 PM] tux_linux
i don't have a touchscreen


[7/18/2023 10:33 PM] tux_linux
so


[7/18/2023 10:33 PM] tux_linux
it work


[7/18/2023 10:33 PM] tux_linux
s


[7/18/2023 10:34 PM] szybet
ye


[7/18/2023 10:34 PM] szybet
s


[7/18/2023 10:34 PM] tux_linux
echo start > /run/ipd/fifo


[7/18/2023 10:34 PM] szybet
this should be a unix socket


[7/18/2023 10:34 PM] szybet
anyway


[7/18/2023 10:34 PM] szybet
;p


[7/18/2023 10:34 PM] tux_linux
well, now on to touch screen


[7/19/2023 4:01 AM] tux_linux
Well, SSH problem is fixed


[7/19/2023 4:01 AM] tux_linux
with dropbear


[7/19/2023 4:02 AM] tux_linux
🥴


[7/19/2023 4:02 AM] tux_linux
now on to that again


[7/19/2023 4:52 AM] tux_linux
https://photos.app.goo.gl/Xgq6vpQbFuuF9HCe7

{Embed}
https://photos.app.goo.gl/Xgq6vpQbFuuF9HCe7
New video by Nicolas Mailloux
/mnt/data/projects/git/conversations/media/AIL4fc8CIAL6KlMRCIvmTSwq_uk16fSB4gsl1dCA2Q-FBB06


[7/19/2023 4:54 AM] tux_linux
@andi @NiLuJe 
Sorry for pinging again, here's some display output with the Qt platform plugin
Mostly works fine but behaves strangely when it comes to cleaning some refreshes (like when pressing on a button)
Any idea of what would be causing it? Thanks


[7/19/2023 4:55 AM] tux_linux
And also btw, even if I didn't find how to move event0 to event1 and just `mv`'d them in userland manually, hey, we have a working InkBox GUI on Clara HD! 🥳


[7/19/2023 6:10 AM] ninuje
If those are A2 updates, try w/o FORCE_MONOCHROME


[7/19/2023 6:11 AM] ninuje
Depends how many of the "standard" quirks the kernel picked up, but flags going haywire on i.MX6SLL is a thing that happens


[7/19/2023 6:11 AM] ninuje
c.f., https://github.com/NiLuJe/FBInk/blob/af2d852ac16dc6871203eb1eb171f8155b329964/fbink.c#L2551-L2583

{Embed}
https://github.com/NiLuJe/FBInk/blob/af2d852ac16dc6871203eb1eb171f8155b329964/fbink.c
FBInk/fbink.c at af2d852ac16dc6871203eb1eb171f8155b329964 · NiLuJe/...
FrameBuffer eInker, a small tool & library to print text & images to an eInk Linux framebuffer - NiLuJe/FBInk
/mnt/data/projects/git/conversations/media/FBInk-903C7


[7/19/2023 6:11 AM] ninuje
IIRC, we even repro'd that on Kindles


[7/19/2023 6:11 AM] ninuje
This... doesn't usually look *quite* like that, though; but it's hard to tell without knowing quite what's actually sent


[7/19/2023 6:11 AM] ninuje
But since I saw a lot of broken buttons, that's worth looking into


[7/19/2023 6:13 AM] ninuje
And also quite likely stop using A2 altogether on those


[7/19/2023 6:13 AM] ninuje
(we did)


[7/19/2023 6:14 AM] ninuje
https://github.com/koreader/koreader-base/blob/b0f7e99845b16fc4176d3d29e4ffc258baa53cca/ffi/framebuffer_mxcfb.lua#L911-L914

{Embed}
https://github.com/koreader/koreader-base/blob/b0f7e99845b16fc4176d3d29e4ffc258baa53cca/ffi/framebuffer_mxcfb.lua
koreader-base/ffi/framebuffer_mxcfb.lua at b0f7e99845b16fc4176d3d29...
Base framework offering a Lua scriptable environment for creating document readers - koreader/koreader-base
/mnt/data/projects/git/conversations/media/koreader-base-A8F69


[7/19/2023 12:45 PM] tux_linux
Ok, thanks a lot, I will look into it


[7/19/2023 12:45 PM] szybet
thats sad


[7/19/2023 12:46 PM] szybet
A2 behaves like that on the nia sometimes too, like i force it on full screen refreshes in sanki ;p


[7/19/2023 12:46 PM] szybet
if you add such option to disable A2, make it optional and always able to turn it off using an argument


[7/19/2023 12:47 PM] tux_linux
Well it's not usable with it


[7/19/2023 12:47 PM] szybet
in sanki it is


[7/19/2023 12:48 PM] szybet
even when the text is buggy, sometimes you iterate over that many cards you dont notice, and the speed of the screen is more important


[7/19/2023 12:48 PM] szybet
so, please make it default but eassly turn it off


[7/19/2023 12:48 PM] tux_linux
No


[7/19/2023 12:48 PM] tux_linux
It's not usable


[7/19/2023 12:49 PM] tux_linux
Buttons never refresh properly


[7/19/2023 12:49 PM] szybet
you dont read what i say


[7/19/2023 12:49 PM] tux_linux
Also message boxes don't print


[7/19/2023 12:49 PM] tux_linux
I read


[7/19/2023 12:49 PM] szybet
in this example, it will


[7/19/2023 12:50 PM] tux_linux
What will


[7/19/2023 12:50 PM] szybet
work and be good


[7/19/2023 12:50 PM] tux_linux
The speed of the screen isn't more important if you can't even see what it is printing


[7/19/2023 12:51 PM] szybet
just launch sanki and set A2, then play some decks -_-

also, disabling A2 is good for screen life, someone could prefer that option

so dont hard code things.


[7/19/2023 12:52 PM] tux_linux
And this might not even need disabling a2


[7/19/2023 12:52 PM] szybet
maybe


[7/19/2023 12:52 PM] szybet
im talking about the worse option


[7/19/2023 3:51 PM] tux_linux
Would you do it in the platform plugin code itself or in the FBInk submodule's code that goes along with it?


[7/19/2023 3:51 PM] szybet
try platform plugin


[7/19/2023 3:51 PM] szybet
for the sake of using pure fbink from the source


[7/19/2023 3:53 PM] tux_linux
where


[7/19/2023 3:54 PM] szybet
thats an excelent question


[7/19/2023 5:23 PM] tux_linux
test, what is this going to do on matrix


[7/19/2023 5:23 PM] tux_linux
well, nothing, probably


[7/19/2023 8:15 PM] ninuje
Platform, definitely


[7/19/2023 8:15 PM] ninuje
And, yeah, the Nia would be affected


[7/19/2023 8:15 PM] ninuje
I wouldn't worry much about performance, though, A2 is barely any faster than DU on those


[7/19/2023 8:16 PM] ninuje
But I do agree that is *can* be useful nonetheless


[7/19/2023 8:16 PM] ninuje
(e.g., A2 + hw dithering == fun times)


[7/20/2023 12:33 AM] tux_linux
Display shifting has started again (new kernel, almost no modifications...)
```
[  122.093353] imx_epdc_v2_fb 20f4000.epdc: Flush updates timeout! ret = 0x0
[  157.933225] imx_epdc_v2_fb 20f4000.epdc: Flush updates timeout! ret = 0x0
[  166.253699] imx_epdc_v2_fb 20f4000.epdc: Flush updates timeout! ret = 0x0
```
Now I also get those things sometimes


[7/20/2023 12:39 AM] tux_linux
now qt throws this and doesn't display anything
```
[FBInk] [refresh_kobo] MXCFB_SEND_UPDATE_V1_NTX: Invalid argument!
[FBInk] update_region={top=25, left=498, width=549, height=69}!
[FBInk] [fbink_refresh] Failed to refresh the screen!
```


[7/20/2023 12:39 AM] tux_linux
calling blank works
```
[  267.874295] cyttsp5_i2c_adapter 1-0024: fb_notifier_callback: UNBLANK!
```


[7/20/2023 12:39 AM] tux_linux
but only makes fbink -k -f work, qt fbink still prints these errors


[7/20/2023 12:39 AM] tux_linux
and screen is still shifted


[7/20/2023 12:39 AM] tux_linux
what a mess


[7/20/2023 12:40 AM] tux_linux
the worst thing is that the degree of shifting seems to change randomly in-between reboots


[7/20/2023 12:40 AM] tux_linux
haunted kobo?


[7/20/2023 12:53 AM] tux_linux
now fbink spits out this


[7/20/2023 12:53 AM] tux_linux
```
[FBInk] Unidentified Kobo device code (76)!
```


[7/20/2023 12:53 AM] tux_linux
strange because ```kobo:~# cat /kobo/mnt/onboard/.kobo/version 
N249000000000,5.16.0,2.0,5.16.0,5.16.0,00000000-0000-0000-0000-000000000376
kobo:~#```


[7/20/2023 12:58 AM] tux_linux
well, the newline caused the bug


[7/20/2023 1:21 AM] tux_linux
for the shifting thing, it seems that refreshing the screen at boot once was causing it


[7/20/2023 2:21 AM] tux_linux
nice, power button doesn't wake the device from sleep


[7/20/2023 6:32 PM] tux_linux
@Szybet Clara HD is using wlan0 interface. How do I tell `inkbox-list-networks` to switch to it if it finds it


[7/20/2023 6:33 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/image-919A5.png


[7/20/2023 6:33 PM] tux_linux
do it because you will yell at me again if i try changing rust code


[7/20/2023 6:46 PM] szybet
later


[7/20/2023 6:46 PM] szybet
ok?


[7/20/2023 6:46 PM] tux_linux
ok
sorry


[7/20/2023 6:51 PM] szybet
look up wlarm_le_wrapper.rs?


[7/20/2023 6:51 PM] szybet
white mode what the fu


[7/20/2023 6:53 PM] szybet
its choosed in main.rs


[7/20/2023 6:53 PM] szybet
lols


[7/20/2023 7:02 PM] tux_linux
i am in a living room with a lot of outdoor light coming


[7/20/2023 7:02 PM] tux_linux
and reflective screen


[7/20/2023 7:02 PM] tux_linux
so i see better in light mode


[7/20/2023 7:03 PM] tux_linux
comparison

{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230720_170302280-7621B.jpg


[7/20/2023 7:57 PM] szybet
this makes sense, its the only explanation i accept, understandable

{Reactions}
🥴 

[7/20/2023 7:57 PM] szybet
oh yeah thats bad
thats half the reason i port things to kobo


[7/20/2023 7:58 PM] szybet
is this a view on a lake?


[7/20/2023 8:08 PM] tux_linux
Yes


[7/20/2023 8:09 PM] szybet
awesome


[7/20/2023 8:10 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230720_180507630-AD4CE.jpg


[7/20/2023 8:10 PM] szybet
a w e s o m e


[7/20/2023 8:11 PM] tux_linux
you have lakes in poland
right


[7/20/2023 8:11 PM] tux_linux
maybe not as much as here


[7/20/2023 8:11 PM] szybet
not so many, and even if not so wide ones


[7/20/2023 8:12 PM] tux_linux
well

{Attachments}
/mnt/data/projects/git/conversations/media/image-E42DA.png


[7/20/2023 8:13 PM] szybet
the one big river that enables kayaking and is near me got exposed to chemicals, so welp


[7/20/2023 8:13 PM] szybet
nice

{Reactions}
👍 

[7/20/2023 8:13 PM] tux_linux
sad


[7/20/2023 8:14 PM] szybet
no one took responsibility for this


[7/20/2023 8:14 PM] szybet
i do hate this country


[7/20/2023 8:14 PM] tux_linux
well, fine


[7/20/2023 8:15 PM] tux_linux
um yea sure

{Attachments}
/mnt/data/projects/git/conversations/media/brightness-9A320.png


[7/20/2023 8:17 PM] szybet
https://tenor.com/view/cat-cat-flash-bang-gif-24943684

{Embed}
https://tenor.com/view/cat-cat-flash-bang-gif-24943684
/mnt/data/projects/git/conversations/media/cat-cat-flash-bang-9A978.png


[7/20/2023 8:17 PM] tux_linux
welp


[7/20/2023 8:17 PM] tux_linux
it's because of the kernel module


[7/20/2023 8:18 PM] tux_linux
i have corrected it but somehow it still doesn't want to work


[7/20/2023 8:18 PM] szybet
unrelated
I programmed a arduino clock 5 years ago, and i couldnt  make the battery stop go above 100% even if i used many if's, its still shows 125% to this day when a new battery is plugged in


[7/20/2023 8:19 PM] szybet
so hehe


[7/20/2023 8:22 PM] tux_linux
hmm
n i c e


[7/20/2023 8:22 PM] tux_linux
🥴


[7/20/2023 8:22 PM] tux_linux
not dangerous?


[7/20/2023 8:23 PM] szybet
its only the display
also its propably because some manufacturers have like 9.5V not 9, and my math with voltage was messed up
+ voltage tolerance to the win


[7/20/2023 8:23 PM] tux_linux
hm ok


[7/20/2023 8:32 PM] tux_linux
sd card speed is... terrible

{Attachments}
/mnt/data/projects/git/conversations/media/image-A72BD.png


[7/20/2023 9:01 PM] szybet
replace it


[7/20/2023 9:22 PM] tux_linux
```
20 Jul 19:22:01 ntpdate[2073]: step time server 206.108.0.131 offset +1689880524.907773 sec
hwclock: can't open '/dev/misc/rtc': No such file or directory
```
🥴


[7/20/2023 9:23 PM] tux_linux
at least it can connect to wifi


[7/21/2023 4:02 PM] tux_linux
@NiLuJe how would you set update.flags outside of FBInk's code? From what I have seen it is not modifiable from the outside
thanks


[7/21/2023 4:51 PM] ninuje
You don't, you do stuff that doesn't require flags


[7/21/2023 4:52 PM] ninuje
(i.e., not using A2, dithering & use_nightmode)


[7/21/2023 4:53 PM] tux_linux
I tried not using a2 but it still displays things wrong


[7/21/2023 5:09 PM] szybet
How did you tried


[7/21/2023 5:09 PM] szybet
Its easy to do in platform plugin


[7/21/2023 5:09 PM] szybet
+ did you tried monochrome something?


[7/21/2023 5:14 PM] tux_linux
Explain


[7/21/2023 5:14 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/image-A802B.png


[7/21/2023 5:14 PM] tux_linux
i only did that


[7/21/2023 5:14 PM] tux_linux
i can't


[7/21/2023 5:14 PM] tux_linux
.


[7/21/2023 5:15 PM] szybet
waveform fast at default is A2


[7/21/2023 5:15 PM] szybet
if(clara and A2) ->use something else


[7/21/2023 5:16 PM] szybet
set it?


[7/21/2023 5:17 PM] tux_linux
where


[7/21/2023 5:17 PM] tux_linux
in the platform plugin the default was not a2


[7/21/2023 5:17 PM] tux_linux
this is after `git reset --hard`


[7/21/2023 5:17 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/image-756FF.png


[7/21/2023 5:17 PM] szybet
what was it then


[7/21/2023 5:18 PM] tux_linux
DU


[7/21/2023 5:21 PM] szybet
AUTO can choose A2


[7/21/2023 5:21 PM] szybet
logicacally


[7/21/2023 5:22 PM] szybet
replace partial and fast with WaveForm_GC16 for the test


[7/21/2023 5:23 PM] tux_linux
it doesn't work


[7/21/2023 5:23 PM] szybet
dont use DU either, its similar to A2


[7/21/2023 5:23 PM] tux_linux
i tried almost every one of them


[7/21/2023 5:24 PM] szybet
replace everything with GC16 then


[7/21/2023 5:24 PM] szybet
if this doesnt change anything, you are running the wrong platform plugin


[7/21/2023 5:25 PM] tux_linux
like there is another one we can use?


[7/21/2023 5:25 PM] szybet
i mean the old unchanged one


[7/21/2023 5:26 PM] tux_linux
hm


[7/21/2023 5:30 PM] szybet
also check for dithering for your clara


[7/21/2023 5:33 PM] szybet
also check your fbink_state.device_platform


[7/21/2023 5:33 PM] szybet
from what i understand, making sure that fbink thinks it runs on mk7 will se the force monochrome flag


[7/21/2023 5:35 PM] szybet
otherwise, i dont see where the update flag even is


[7/21/2023 5:36 PM] tux_linux
in fbink source


[7/21/2023 5:36 PM] tux_linux
`update.flags`


[7/21/2023 5:37 PM] szybet
i know, but you dont modify fbink


[7/21/2023 5:37 PM] tux_linux
yes, that's the point


[7/21/2023 5:37 PM] szybet
.


[7/21/2023 5:38 PM] tux_linux
i will try using the mxc_epdc_fb.ko module instead of the mxc_epdc_v2_fb.ko module


[7/21/2023 5:38 PM] szybet
v2 exists for a reason


[7/21/2023 5:39 PM] tux_linux
i know


[7/21/2023 5:39 PM] tux_linux
well, it doesn't work
i didn't have much hope


[7/21/2023 5:40 PM] szybet
try the things i said


[7/21/2023 5:40 PM] tux_linux
i disabled dithering, sw and hw


[7/21/2023 5:40 PM] tux_linux
same thing


[7/21/2023 5:40 PM] tux_linux
i will check the device_platform


[7/21/2023 5:41 PM] tux_linux
but from what i have tested it knows it is on a mark 7 device


[7/21/2023 5:41 PM] tux_linux
because i could see that some things slightly changed when setting different waveform modes


[7/21/2023 6:56 PM] tux_linux
well, older platform plugin doesn't work


[7/21/2023 6:56 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/message-39892.txt


[7/21/2023 7:02 PM] ninuje
that looks good


[7/21/2023 7:02 PM] ninuje
No it can't 😉


[7/21/2023 7:03 PM] tux_linux
I found the issue


[7/21/2023 7:03 PM] tux_linux
this was set to false

{Attachments}
/mnt/data/projects/git/conversations/media/image-6995D.png


[7/21/2023 7:03 PM] tux_linux
somehow


[7/21/2023 7:04 PM] ninuje
That would imply that the driver has some issues with collision handling, though


[7/21/2023 7:04 PM] ninuje
Waiting essentially prevents you from issuing colliding updates


[7/21/2023 7:05 PM] ninuje
But it shouldn't be stricly necessary


[7/21/2023 7:05 PM] ninuje
We do it to fence full updates to prevent the driver from coalescing stuff in weird ways, but it shouldn't screw up to the extent I saw


[7/21/2023 7:05 PM] tux_linux
oh, then that's why when I click on the brightness slider it is so much slower to change it


[7/21/2023 7:05 PM] tux_linux
well, any way to partially enable it sometimes?


[7/21/2023 7:05 PM] ninuje
That's a platform plugin issue


[7/21/2023 7:06 PM] ninuje
I don't know how that flag is used


[7/21/2023 7:06 PM] ninuje
But ideally it would need to be used with a bit of heuristics instead of blindly everywhere


[7/21/2023 7:07 PM] ninuje
c.f., https://github.com/koreader/koreader-base/blob/b0f7e99845b16fc4176d3d29e4ffc258baa53cca/ffi/framebuffer_mxcfb.lua#L243-L389

{Embed}
https://github.com/koreader/koreader-base/blob/b0f7e99845b16fc4176d3d29e4ffc258baa53cca/ffi/framebuffer_mxcfb.lua
koreader-base/ffi/framebuffer_mxcfb.lua at b0f7e99845b16fc4176d3d29...
Base framework offering a Lua scriptable environment for creating document readers - koreader/koreader-base
/mnt/data/projects/git/conversations/media/koreader-base-A8F69


[7/21/2023 7:07 PM] ninuje
Basically, around FULL updates should cover most of it


[7/21/2023 7:07 PM] ninuje
And if you're actually issuing FULL updates for a slider, that's a you issue 😉


[7/21/2023 7:07 PM] tux_linux
would it help if I updated fbink to a more recent commit?


[7/21/2023 7:07 PM] ninuje
No, it's irrelevant


[7/21/2023 7:08 PM] tux_linux
well, I don't know, with `waitForRefresh` set to `false` it was updating the screen blazingly fast


[7/21/2023 7:08 PM] ninuje
strace it


[7/21/2023 7:08 PM] tux_linux
ok


[7/21/2023 7:08 PM] ninuje
strace -fittvTyY -e trace=ioctl -p $(pidof whatever)


[7/21/2023 7:09 PM] ninuje
Err, assuming you've got a patched strace


[7/21/2023 7:09 PM] tux_linux
from what I have seen in the code, the platform plugin switches waveform mode if the region is `small` or needs `flashing`, elsewise it goes with `partial` wfm mode


[7/21/2023 7:09 PM] ninuje
http://files.ak-team.com/niluje/mrpub/Other/strace-kobo-r3.tar.gz


[7/21/2023 7:09 PM] tux_linux
i will use that one


[7/21/2023 7:10 PM] tux_linux
static glibc?


[7/21/2023 7:10 PM] ninuje
That's the mode selection heuristics, not the wait one


[7/21/2023 7:10 PM] ninuje
dynamic


[7/21/2023 7:10 PM] ninuje
static glibc is not a thing that exists


[7/21/2023 7:10 PM] ninuje
glibc doesn't support static linking


[7/21/2023 7:10 PM] tux_linux
well, then no


[7/21/2023 7:11 PM] tux_linux
i will run it in my glibc chroot


[7/21/2023 7:12 PM] ninuje
Oh, and I think I know why waiting was disabled on Mk.7 in the platform plugin


[7/21/2023 7:12 PM] ninuje
Because it's buggy on the Libra/Libra 2/Nia/Clara 2E


[7/21/2023 7:13 PM] tux_linux
this is when changing the brightness from 58% to 70% by clicking on the slider

{Attachments}
/mnt/data/projects/git/conversations/media/message-E6636.txt


[7/21/2023 7:13 PM] ninuje
Yup, you're getting a partial


[7/21/2023 7:13 PM] ninuje
Which, okay, why not, it's reagl anyway


[7/21/2023 7:13 PM] ninuje
But waiting for a partial is... not good


[7/21/2023 7:13 PM] tux_linux
so maybe I can disable waiting if it's a partial?


[7/21/2023 7:14 PM] ninuje
So, waiting heuristic needs to be rethought


[7/21/2023 7:14 PM] ninuje
Ideally, you wait *before* a full and *after* a full


[7/21/2023 7:14 PM] tux_linux
ok


[7/21/2023 7:14 PM] ninuje
c.f., that koreader excerpt


[7/21/2023 7:15 PM] ninuje
(Also, waiting for REAGL is slightly more expensive than waiting for a non-REAGL update, IIRC)


[7/21/2023 7:15 PM] ninuje
450ms for a 600x110 rect is fairly horrendous


[7/21/2023 7:16 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/image-7B6DB.png


[7/21/2023 7:16 PM] tux_linux
but even that will cause problems


[7/21/2023 7:16 PM] tux_linux
probably


[7/21/2023 7:17 PM] ninuje
Okay, it already honors the broken devices, so, no, it had no business being false on Mk. 7 ;D


[7/21/2023 7:17 PM] tux_linux
because with partial updates and wait disabled, screen content was already borked


[7/21/2023 7:17 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/Peek_2023-07-21_19-17-81342.gif


[7/21/2023 7:17 PM] szybet
@NiLuJe as you are here, am doing something wrong right?


[7/21/2023 7:17 PM] szybet
refreshing


[7/21/2023 7:18 PM] szybet
its using partial instead of A2, right?


[7/21/2023 7:18 PM] tux_linux
did you update your rootfs


[7/21/2023 7:18 PM] tux_linux
to account for the .kobo/version thing


[7/21/2023 7:18 PM] ninuje
It's a Nia, I'd go full-blown A2 + hw dithering


[7/21/2023 7:18 PM] tux_linux
https://github.com/Kobo-InkBox/rootfs/commit/aba86b1696ef18fd36c4f46f3c594367968de2d7#diff-5a6d9e713a85afbb9768ebdbd916e3f36526d1ff4386b709b5f51a64b8d607c6R219

{Embed}
https://github.com/Kobo-InkBox/rootfs/commit/aba86b1696ef18fd36c4f46f3c594367968de2d7
N249: GUI apps improvements · Kobo-InkBox/rootfs@aba86b1
/mnt/data/projects/git/conversations/media/aba86b1696ef18fd36c4f46f3c594367968de2d7-E9DA0


[7/21/2023 7:18 PM] szybet
so im doing something wrong


[7/21/2023 7:18 PM] szybet
well thanks


[7/21/2023 7:19 PM] szybet
will improve it


[7/21/2023 7:19 PM] ninuje
Depends on how you want it to look


[7/21/2023 7:19 PM] szybet
https://www.youtube.com/watch?v=QOPZrVsCEHg

{Embed}
Андрей Савчук
https://www.youtube.com/watch?v=QOPZrVsCEHg
Doom 2 on PocketBook 360 Plus
Doom II port started in prototype of PocketBook 360 Plus.
It game port based in PrBoom.
SoundTrack:  The Demon's Dead
/mnt/data/projects/git/conversations/media/maxresdefault-6D776.jpg


[7/21/2023 7:19 PM] szybet
not worse than this


[7/21/2023 7:19 PM] ninuje
A2 means B&W


[7/21/2023 7:19 PM] szybet
its 12 years ago


[7/21/2023 7:19 PM] ninuje
dithering will make it less terrible, but it's still essentially B&W


[7/21/2023 7:19 PM] tux_linux
yeah, screen is borked once again


[7/21/2023 7:19 PM] ninuje
If you want a bit more depth, you'll have to go with PARTIAL


[7/21/2023 7:19 PM] ninuje
You don't really have any other choice on NTX boards


[7/21/2023 7:20 PM] szybet
will it be a bit better or really make a diffrence?


[7/21/2023 7:20 PM] ninuje
if this were a Kindle you'd have 4 color modes, or some more specific waveform chains available to you


[7/21/2023 7:20 PM] ninuje
But you don't


[7/21/2023 7:20 PM] ninuje
Check out the FBInk doom fire demo for an example


[7/21/2023 7:22 PM] ninuje
Regardless of that, dithering will be your friend, and on the Nia, you can offload that to the PxP and it's relatively decent at it


[7/21/2023 7:22 PM] ninuje
That'll at least save you some CPU cycles for other stuff


[7/21/2023 7:48 PM] tux_linux
hm yea, clara hd's Qt performance is pretty much as slow as the mini's


[8/9/2023 11:53 PM] andi15701
that should be fixed in some newer fbink


[8/9/2023 11:54 PM] andi15701
background: the kobo kernel contains only the ioctls introduced by nxp


[8/9/2023 11:54 PM] andi15701
resp. freescale


[8/9/2023 11:56 PM] andi15701
ok, I see, you are beyound that that


[8/10/2023 12:03 AM] andi15701
there is a fallback


[8/10/2023 12:04 AM] andi15701
it then defaults to /lib/firmware/imx/epdc/epdc.fw


[8/10/2023 12:06 AM] andi15701
hmm, which ssh problem?


[8/10/2023 12:06 AM] szybet
from what i remember he ended up using a diffrent ssh server


[8/10/2023 12:26 AM] andi15701
ssh -v?


[8/10/2023 3:12 AM] tux_linux
yes, I tried but nothing
ended up using dropbear on this device only
works perfectly


[8/10/2023 3:12 AM] tux_linux
good that you are back


[8/10/2023 7:39 AM] andi15701
/dev/rtc0


[8/10/2023 7:39 AM] andi15701
it should have an option for that


[8/10/2023 7:41 AM] andi15701
you can for FBInk remove that file, it will analyze /sys/firmware/devicetree/base/compatible instead

{Reactions}
👍 

[8/10/2023 12:01 PM] tux_linux
Yeah, I found the module


[8/10/2023 6:23 PM] andi15701
I have added some review comments


[8/10/2023 9:07 PM] tux_linux
yes, thanks


[8/17/2023 8:05 PM] andi15701
fastboot did not work in combination with macOS?


[8/17/2023 8:05 PM] andi15701
which version? Ventura?


[8/17/2023 8:06 PM] andi15701
did you understand the idea behind my review comments?


[8/17/2023 8:40 PM] tux_linux
Latest


[8/17/2023 8:40 PM] tux_linux
Yes I did


[8/17/2023 8:41 PM] andi15701
latest release or latest beta?


[8/17/2023 8:42 PM] tux_linux
Latest brew release I think


[8/17/2023 8:42 PM] andi15701
Version of macOS, not of fastboot


[8/17/2023 8:42 PM] tux_linux
It worked with USB passthrough and Linux vm


[8/17/2023 8:42 PM] tux_linux
Then, latest macos stable


[8/17/2023 8:42 PM] andi15701
ok, I have access o macos, too


[8/17/2023 8:43 PM] andi15701
I will have a look

{Reactions}
👍 

[8/17/2023 10:01 PM] andi15701
Most of the review comments I gave are with the idea of simplifying porting inkbox to new devices.


[8/17/2023 10:01 PM] andi15701
btw: build instructions for the clara port are still the same?


[8/17/2023 10:56 PM] tux_linux
Well, what instructions are you talking about exactly
Not much changed I think


[8/17/2023 11:12 PM] andi15701
https://github.com/aartoni/n249/blob/main/installation.md

{Embed}
https://github.com/aartoni/n249/blob/main/installation.md
n249/installation.md at main · aartoni/n249
Kobo Clara HD and InkBox notes. Contribute to aartoni/n249 development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/n249-DDDD9


[8/17/2023 11:12 PM] andi15701
that one


[8/17/2023 11:16 PM] tux_linux
Well, yeah, but there are a few more steps for gui


[8/17/2023 11:16 PM] tux_linux
If you want I can share with you my SD image when I get home today


[8/17/2023 11:22 PM] andi15701
yes, would be nice

{Reactions}
👍 

[8/20/2023 4:37 PM] tux_linux
@andi sorry for the delay, here is an image
http://pkgs-inkbox.duckdns.org:25560/misc/clarahd.xz


[8/20/2023 4:37 PM] tux_linux
i ran dd and it copied about 4G of the sd card, i don't think anything was written on it beyond that even if the last partition is an 8g one


[8/20/2023 4:37 PM] szybet
thanks god you used the right server for this


[8/20/2023 9:03 PM] andi15701
```root@aktux:/home/andi/kobo# truncate -s $[15523840*512] /home/andi/kobo/inkbox-clara 
root@aktux:/home/andi/kobo# l^C
root@aktux:/home/andi/kobo# losetup -P -f /home/andi/kobo/inkbox-clara 
root@aktux:/home/andi/kobo# cd
root@aktux:~# mount /dev/loop0p4 /mnt
root@aktux:~# ls -l /mnt/
ls: cannot access '/mnt/update': Structure needs cleaning
ls: cannot access '/mnt/X11': Structure needs cleaning
total 289148
drwxr-xr-x 27 root root      4096 Jan  1  1970 config
-rw-r--r--  1 root root         0 Aug 19 23:11 dhcpcd_duid
drwxr-xr-x  5 root root      4096 Jan  1  1970 gui_rootfs
-rw-r--r--  1 root root  26505216 Jan  1  1970 gui_rootfs.isa
-rw-r--r--  1 root root       256 Jan  1  1970 gui_rootfs.isa.dgst
drwxr-xr-x  2 root root      4096 Jul 22 03:01 gutenberg
drwx------  2 root root     16384 Jul 13 18:56 lost+found
-rw-r--r--  1 root root   1110016 Jan  1  1970 modules.sqsh
-rw-r--r--  1 root root 268435456 Aug 19 23:14 onboard
drwxr-xr-x  2 root root      4096 Jan  1  1970 ssh
d?????????  ? ?    ?            ?            ? update
d?????????  ? ?    ?            ?            ? X11
```


[8/20/2023 9:04 PM] tux_linux
Well, ok


[8/20/2023 9:04 PM] tux_linux
Is the unpartitioned space ok at least?


[8/20/2023 9:04 PM] tux_linux
I will send you squashfs of the partitions


[8/20/2023 9:05 PM] tux_linux
Then you can extract them


[8/20/2023 9:06 PM] andi15701
well, only the last one


[8/20/2023 9:07 PM] tux_linux
Ok, good


[8/20/2023 9:07 PM] andi15701
what should be in the unpartitioned space? u-boot, what else?


[8/20/2023 9:07 PM] tux_linux
You should have it in two hours, no real internet access rn


[8/20/2023 9:07 PM] tux_linux
Uboot


[8/20/2023 9:07 PM] andi15701
no need to hurry

{Reactions}
👍 

[8/20/2023 9:08 PM] tux_linux
Kernel is in p1


[8/20/2023 9:08 PM] tux_linux
And Dtb


[8/20/2023 9:08 PM] andi15701
what is at 0x200?


[8/20/2023 9:08 PM] tux_linux
Idk


[8/20/2023 9:08 PM] andi15701
offset from beginning of image


[8/20/2023 9:08 PM] tux_linux
Can you write this in decimal


[8/20/2023 9:09 PM] andi15701
512 bytes


[8/20/2023 9:09 PM] szybet
start of uboot binary


[8/20/2023 9:09 PM] szybet
yep im sure


[8/20/2023 9:09 PM] tux_linux
Ok


[8/20/2023 9:10 PM] andi15701
u-boot starts at 0x400/1024


[8/20/2023 9:10 PM] tux_linux
Maybe it’s the device uid


[8/20/2023 9:10 PM] tux_linux
SN


[8/20/2023 9:10 PM] tux_linux
Whatever


[8/20/2023 9:10 PM] szybet
imx file extension something?


[8/20/2023 9:10 PM] tux_linux
What is in it


[8/20/2023 9:10 PM] szybet
for uboot binary


[8/20/2023 9:11 PM] andi15701
then there can be the rooted mark?


[8/20/2023 9:11 PM] tux_linux
79872


[8/22/2023 2:29 PM] tux_linux
@andi p4 is up
http://pkgs-inkbox.duckdns.org:25560/misc/p4.sqsh


[8/22/2023 3:48 PM] tux_linux
x11 was not tested to this point, it is something i will do in the future


[8/22/2023 10:54 PM] andi15701
ok, downloaded that

{Reactions}
👍 

[8/23/2023 10:38 PM] andi15701
ok, downloaded that, put things onto an sd card


[8/23/2023 10:38 PM] andi15701
and activated inkbox self-destruction mode


[8/23/2023 10:41 PM] szybet
there is one?


[8/23/2023 10:41 PM] andi15701
apparently


[8/23/2023 10:41 PM] szybet
what


[8/23/2023 10:42 PM] andi15701
I have a 128GB sd card here and wanted to replace nickel with inkbox on it


[8/23/2023 10:42 PM] andi15701
but before that I tried on  another sd card


[8/23/2023 10:42 PM] andi15701
thankfully


[8/23/2023 10:42 PM] szybet
what is even going on in inkbox


[8/23/2023 10:42 PM] szybet
reset or what


[8/23/2023 10:42 PM] szybet
lockdown?


[8/23/2023 10:44 PM] andi15701
I partitioned the device myself (same starting point for the partitions), copied over stuff


[8/23/2023 10:44 PM] andi15701
it booted once


[8/23/2023 10:44 PM] andi15701
into full ui


[8/23/2023 10:44 PM] andi15701
but I had choosen GPT as partition table


[8/23/2023 10:45 PM] szybet
um... yea im not sure about that


[8/23/2023 10:45 PM] andi15701
and inkbox destroyed the partition table


[8/23/2023 10:45 PM] andi15701
yes, i did not fully follow the book...


[8/23/2023 10:46 PM] szybet
how?...


[8/23/2023 10:46 PM] andi15701
if [ "${UID_FLAG}" != "1" ]; then
        echo -n "${UID}" | dd of=/dev/mmcblk0 bs=512 seek=1
        exit 0
fi


[8/23/2023 10:49 PM] szybet
?


[8/23/2023 10:50 PM] andi15701
the idea behind gpt was just that on that 128GB sd card I will have more partitions and with dos table I would need to fiddle with extended partions, so there would be no /dev/mmcblk0p4 and I did not want to touch inkbox to change that number


[8/23/2023 10:50 PM] andi15701
gpt: you have usually one partition in the  mbr, type 0xee spanning the whole disk


[8/23/2023 10:50 PM] andi15701
starting on 512


[8/23/2023 10:51 PM] andi15701
where then some header is


[8/23/2023 10:54 PM] andi15701
root@aktux:~# busybox fdisk -l /dev/sdb
Disk /dev/sdb: 29 GB, 31266439168 bytes, 61067264 sectors
3786 cylinders, 256 heads, 63 sectors/track
Units: sectors of 1 * 512 = 512 bytes

Device  Boot StartCHS    EndCHS        StartLBA     EndLBA    Sectors  Size Id Type
/dev/sdb1    0,0,2       1023,255,63          1   61067263   61067263 29.1G ee EFI GPT
root@aktux:~# fdisk -l /dev/sdb
Disk /dev/sdb: 29.12 GiB, 31266439168 bytes, 61067264 sectors
Disk model: UMS disk 0      
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: FDADF9B8-A3B6-4199-9151-6127D81F1B56

Device       Start      End  Sectors  Size Type
/dev/sdb1    49152    79872    30721   15M Linux filesystem
/dev/sdb2   104448  1128447  1024000  500M Linux filesystem
/dev/sdb3  1128448  1390591   262144  128M Linux filesystem
/dev/sdb4  1390592 18167807 16777216    8G Linux filesystem


[8/23/2023 11:25 PM] andi15701
00000200: 4546 4920 5041 5254 0000 0100 5c00 0000  EFI PART....\...
00000210: 7b5e 5f71 0000 0000 0100 0000 0000 0000  {^_q............
00000220: ffcf a303 0000 0000 2008 0000 0000 0000  ........ .......


[8/23/2023 11:25 PM] andi15701
and that dd overwrites exactly that area


[8/24/2023 12:14 AM] tux_linux
Wot


[8/24/2023 12:14 AM] tux_linux
Well yea ok


[8/24/2023 12:15 AM] tux_linux
Gpt...


[8/24/2023 12:31 AM] andi15701
and now I removed the sd card


[8/24/2023 12:31 AM] andi15701
and turned on


[8/24/2023 12:31 AM] andi15701
uuu did not work on macOS


[8/24/2023 12:31 AM] andi15701
detach_kernel_driver failed


[8/24/2023 12:31 AM] andi15701
so I ran uuu on my linux machine


[8/24/2023 12:32 AM] andi15701
u-boot boots and fastboot is available on usb


[8/24/2023 12:32 AM] andi15701
went back to macOS, fastboot devices also lists it


[8/24/2023 12:17 PM] andi15701
but what I have seen: you seem to have learnt a lot about u-boot


[8/24/2023 1:56 PM] tux_linux
meaning?


[8/24/2023 2:53 PM] andi15701
well, you modified the u-boot env so that after longer press of the button, the mass storage mode is enabled


[8/24/2023 2:53 PM] tux_linux
well, yea, i mean, it's shell commands
also, the button command was easy to understand


[8/24/2023 2:54 PM] tux_linux
it sure is an useful modification


[8/24/2023 2:56 PM] szybet
long press is usb mass storage and spam clicking is diagnostics?


[8/24/2023 2:56 PM] szybet
on all devices?


[8/24/2023 2:56 PM] tux_linux
no
only on clara


[8/24/2023 2:57 PM] szybet
oh


[8/24/2023 2:57 PM] szybet
;p


[8/24/2023 2:57 PM] tux_linux
if you hold the power button on u-boot startup it goes to ums mode


[8/24/2023 2:57 PM] andi15701
well, you could have that on nia too


[8/24/2023 2:57 PM] tux_linux
probably


[8/24/2023 2:57 PM] andi15701
take the newer u-boot


[8/24/2023 2:57 PM] tux_linux
did you get inkbox to boot?


[8/24/2023 2:57 PM] andi15701
yes


[8/24/2023 2:57 PM] tux_linux
good


[8/24/2023 2:57 PM] tux_linux
qt and eink is slow?


[8/24/2023 3:00 PM] andi15701
from first expression: yes, but i only booted it once, until I attached usb

{Reactions}
👍 

[8/24/2023 3:00 PM] andi15701
and selected msd mode


[8/24/2023 3:00 PM] andi15701
so it was just a few clicks


[8/24/2023 3:00 PM] andi15701
and then almost nothing worked


[8/24/2023 3:00 PM] szybet
maybe we need a newer toolchain for a newer kernel


[8/24/2023 3:04 PM] andi15701
I do not think so, well, I have killed one of my two claras. I had the chance to combine a clara with a broken mainboard with a mainboard replacement, so I always have one for experimenting, but now I want everything on my main working horse


[8/24/2023 3:05 PM] andi15701
so my plan is to first solve that partition problem


[8/24/2023 3:06 PM] andi15701
well, it was a surprise rainshower while camping and I had to quickly get everything out of the rain


[8/24/2023 3:06 PM] andi15701
so I just throw my  clara right into the tent


[8/24/2023 3:07 PM] andi15701
and while going in, I put my elbow onto the display...


[8/24/2023 3:22 PM] tux_linux
ouch


[8/24/2023 3:23 PM] tux_linux
msd mode?


[8/24/2023 3:23 PM] tux_linux
oh, partition table


[8/24/2023 3:23 PM] tux_linux
well, idk if we can change the uid location in sd card


[8/24/2023 3:31 PM] andi15701
mass storage mode, probably something is unmounted then and due to non-existent partition table never remounted


[8/24/2023 3:38 PM] tux_linux
hmm


[8/24/2023 4:41 PM] andi15701
is the uid there something widespread or just a single place to change?


[8/24/2023 7:05 PM] tux_linux
probably 2 or 3 files


[8/24/2023 7:05 PM] tux_linux
not much


[8/27/2023 10:49 AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-A3DDB.png


[8/27/2023 10:50 AM] szybet
well, anything for him to do?


[8/27/2023 12:59 PM] tux_linux
where was this


[8/27/2023 1:01 PM] szybet
read todays #chat


[8/27/2023 1:02 PM] tux_linux
write doc


[8/27/2023 1:03 PM] tux_linux
dev doc maybe


[8/27/2023 1:03 PM] tux_linux
idk


[9/21/2023 8:42 AM] andi15701
so probably just recompiling kernel/initramfs?


[9/21/2023 8:43 AM] andi15701
well, I was away the last two weekends, so did not want to touch my clara too much


[9/21/2023 1:16 PM] tux_linux
Yes


[9/21/2023 1:17 PM] tux_linux
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/uidgen

{Embed}
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/uidgen
kernel/initrd/common/uidgen at master · Kobo-InkBox/kernel
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-5A1D7


[10/18/2023 9:00 AM] andi15701
ok. I finally did it, so I could play around a bit


[10/19/2023 12:55 AM] tux_linux
It boots? Thanks


[10/20/2023 5:59 PM] andi15701
now I can compare a bit


[10/20/2023 5:59 PM] andi15701
the is some trouble with usb mode


[10/20/2023 6:00 PM] andi15701
connecting to computer


[10/20/2023 6:00 PM] andi15701
bu what I am wondering: What about using MTP?


[10/20/2023 6:00 PM] andi15701
instead of mass storage mode


[10/20/2023 6:01 PM] andi15701
should avoid the mess with remounting/unmounting stuff


[10/21/2023 12:31 AM] szybet
issues with old kernel, propably


[10/21/2023 12:31 AM] szybet
+ there have been issues with that always


[10/21/2023 12:31 AM] szybet
it works once, breaks out of nowhere


[10/21/2023 12:32 AM] andi15701
so probably it would be helpful to investigate the MTP route


[10/21/2023 12:32 AM] andi15701
what is the limit there


[10/21/2023 12:32 AM] andi15701
in kernel requirements


[10/21/2023 12:33 AM] andi15701
maybe if that is device-specific you will have to go both routes


[11/11/2023 9:53 PM] andi15701
bad news:


[11/11/2023 9:54 PM] andi15701
there is a rev b with apparently just different regulator bootup configurations


[11/11/2023 9:54 PM] andi15701
and wiring


[11/11/2023 9:54 PM] andi15701
to a dangerous amount


[11/11/2023 9:54 PM] andi15701
good chance of smoke


[11/11/2023 9:55 PM] andi15701
https://gitlab.com/postmarketOS/pmaports/-/issues/2356

{Embed}
https://gitlab.com/postmarketOS/pmaports/-/issues/2356
Kobo Clara not booting with mainline kernel (#2356) · Issues · post...
Describe your issue  What's the expected behaviour? On pressing the power button the device...
/mnt/data/projects/git/conversations/media/icon_mobile-9A834.png


[11/11/2023 9:57 PM] andi15701
same for some board called e70k14


[11/11/2023 9:57 PM] andi15701
e70k02 is Kobo Libra, so I would expect something in the same format


[11/11/2023 10:01 PM] andi15701
I do not easily find what e70k14 really is


[11/11/2023 10:06 PM] andi15701
libra2 is marked as e70k1m


[11/11/2023 10:07 PM] andi15701
the most similar dtb name is e70k14 is the libra2 kernel sources


[11/11/2023 10:07 PM] andi15701
NOIKBN418


[11/11/2023 10:07 PM] andi15701
is the FCCID


[11/12/2023 7:34 PM] tux_linux
Nice


[11/12/2023 7:35 PM] tux_linux
n249b


[11/12/2023 8:48 PM] andi15701
well, everywhere should be a big fat warning

{Reactions}
👍 

[11/12/2023 8:48 PM] andi15701
about checking board versions


[11/12/2023 8:48 PM] andi15701
that is worse than the nia c vs. nia a


[11/18/2023 12:34 PM] mistapinku
hello guys

{Reactions}
🫡 

[11/18/2023 12:34 PM] mistapinku
any image for testing on this "cursed" device?


[11/18/2023 12:35 PM] szybet
you are lucky


[11/18/2023 12:35 PM] szybet
indeed


[11/18/2023 12:35 PM] mistapinku
nice


[11/18/2023 12:35 PM] szybet
but read this chat


[11/18/2023 12:35 PM] mistapinku
hope i dont let the magic smoke out


[11/18/2023 12:35 PM] szybet
there are more claras than 1


[11/18/2023 12:35 PM] szybet
read this chat


[11/18/2023 12:35 PM] szybet
and ask andi1 for things


[11/18/2023 12:36 PM] mistapinku
good. i need to open mine up now and see my actual hardware


[11/18/2023 12:37 PM] szybet
the project now is in hibernation so dont expect much from me and the creator nicolas, sadly


[11/18/2023 12:37 PM] szybet
i hope andi1 helps you a bit


[11/18/2023 12:37 PM] mistapinku
well,  if it reads books, its good enough for now


[11/18/2023 12:38 PM] szybet
we have koreader for that


[11/18/2023 12:38 PM] mistapinku
i have that already


[11/18/2023 12:38 PM] szybet
well for now the preferred method to read on inkbox is koreader


[11/18/2023 12:38 PM] mistapinku
but would like to see it running a free firmware


[11/18/2023 12:38 PM] mistapinku
great


[11/18/2023 12:38 PM] szybet
the currect reader is bad and the new is in works


[11/18/2023 12:39 PM] szybet
yep we have that


[11/18/2023 1:50 PM] mistapinku
Is it normal to stay here for a long time?

{Attachments}
/mnt/data/projects/git/conversations/media/rn_image_picker_lib_temp_6a1df584-387b-423-BFA2B.jpg


[11/18/2023 1:50 PM] mistapinku
I checked that I have the old revision of the board


[11/18/2023 1:52 PM] tux_linux
how much time


[11/18/2023 1:52 PM] mistapinku
3 mins now


[11/18/2023 2:00 PM] tux_linux
prob not normal


[11/18/2023 2:02 PM] mistapinku
device boots normally with original sd


[11/18/2023 2:02 PM] mistapinku
coonects to fastboot with usb


[11/18/2023 2:03 PM] tux_linux
it's an old test image, maybe you'd have to connect it to serial to know why it doesn't work


[11/18/2023 2:10 PM] mistapinku
light on the button also goes out when it reaches that point


[11/18/2023 2:10 PM] mistapinku
guess i need to whip out the soldering iron later


[11/18/2023 2:10 PM] mistapinku
any newer test images in the meanwhile?


[11/18/2023 2:10 PM] tux_linux
no


[11/18/2023 2:11 PM] tux_linux
sorry


[11/18/2023 2:11 PM] mistapinku
nvm


[11/18/2023 2:11 PM] mistapinku
its a good exercise i guess


[11/18/2023 2:11 PM] mistapinku
need to find that ttl adapter


[11/18/2023 3:36 PM] mistapinku
Managed to boot to error code 6


[11/18/2023 4:16 PM] szybet
https://inkbox.ddns.net/wiki/index.php?title=Boot_error_codes

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Boot_error_codes
Index.php


[11/18/2023 4:17 PM] szybet
copy inside of this to partition 4


[11/18/2023 6:07 PM] tux_linux
oh it was this


[11/18/2023 6:09 PM] szybet
@tux-linux share the keys for clara


[11/18/2023 6:10 PM] szybet
so people can tinker without issues on it


[11/18/2023 6:10 PM] szybet
there is no official image anyways


[11/18/2023 6:12 PM] szybet
and do other things like with the readme...


[11/18/2023 11:36 PM] mistapinku
Tried copying the p4.sqsh to partition 4


[11/18/2023 11:36 PM] mistapinku
Same error


[11/19/2023 1:32 AM] szybet
`copy inside of this to partition 4`


[11/19/2023 1:32 AM] szybet
its a sqashfs


[11/19/2023 1:32 AM] szybet
https://pl.wikipedia.org/wiki/SquashFS

{Embed}
https://pl.wikipedia.org/wiki/SquashFS
SquashFS
SquashFS (.sfs) – skompresowany system plików tylko do odczytu, przeznaczony dla systemu operacyjnego Linux i wydany na wolnej licencji. SquashFS kompresuje pliki, i-węzły oraz katalogi. W celu poprawy stopnia kompresji, rozmiar jednostki alokacji został ograniczony do maksymalnie 1024 kB.
SquashFS projektowany był z myślą o ogólnym użytku tylko...


[11/19/2023 6:59 AM] mistapinku
Yeah, you are right, i'll unpack this properly to p4


[11/19/2023 7:53 AM] mistapinku
Unfortunately, now it gets stuck in the splash screen after loading


[11/19/2023 7:53 AM] mistapinku
It can go to sleep mode though


[11/19/2023 7:53 AM] mistapinku
Still no UI


[11/19/2023 11:41 AM] szybet
this means openrc boots


[11/19/2023 11:41 AM] szybet
so you can gather logs and log in via serial


[11/21/2023 12:19 AM] andi15701
ok, I was away the weekend, I will have a look again


[11/21/2023 9:27 AM] andi15701
first of all check the board revision


[11/21/2023 6:33 PM] mistapinku
Board revision is 37nb-e60k00+4a4


[11/21/2023 6:33 PM] mistapinku
I thought that was the compatible one


[11/21/2023 7:37 PM] andi15701
yes


[11/21/2023 7:37 PM] andi15701
it is


[11/21/2023 8:15 PM] mistapinku
Can I pull logs through USB? Cant find my serial adapter and kinda bored of soldering stuff


[11/21/2023 8:21 PM] andi15701
if the device shows up, you might get logs via usb


[11/21/2023 8:22 PM] andi15701
Probably I should retry the install


[11/21/2023 8:22 PM] andi15701
to check things again


[11/21/2023 8:30 PM] szybet
While botting try to click the power buttons a few times to enter recovery mode


[11/21/2023 8:30 PM] szybet
Then we can talk about pulling logs via usb


[11/21/2023 8:31 PM] szybet
Or idk andi, does usbnet work on the clara with inkbox yet?


[11/21/2023 8:58 PM] andi15701
I have used i


[11/21/2023 8:58 PM] andi15701
it


[11/21/2023 9:16 PM] andi15701
I had trouble with usb mass storage


[11/21/2023 10:22 PM] szybet
https://inkbox.ddns.net/wiki/index.php?title=Boot_flags

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Boot_flags
Index.php


[11/21/2023 10:22 PM] szybet
USBNET_ENABLE


[11/21/2023 10:22 PM] szybet
for logs over usb


[11/21/2023 10:25 PM] mistapinku
what are the default ip for the ssh?


[11/21/2023 10:35 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-87F74.png


[11/21/2023 10:35 PM] szybet
below


[11/21/2023 10:36 PM] szybet
set 192.168.2.3/24 on your interface


[11/21/2023 10:36 PM] szybet
and ssh to 2.2


[11/21/2023 10:40 PM] szybet
if you have a shell post dmesg obviously


[11/21/2023 10:41 PM] szybet
and


[11/21/2023 10:41 PM] szybet
```
killall inkbox inkbox-bin
inkbox.sh
```


[11/21/2023 10:41 PM] szybet
and post logs


[11/21/2023 10:54 PM] mistapinku


{Attachments}
/mnt/data/projects/git/conversations/media/dmesg-B32AC


[11/21/2023 10:55 PM] mistapinku
killall failed to kill anything, because nothing was running


[11/21/2023 10:55 PM] mistapinku
Got permission denied at running inkbox.sh


[11/21/2023 11:04 PM] szybet
wtf


[11/21/2023 11:04 PM] szybet
good


[11/21/2023 11:04 PM] szybet
find inkbox.sh and chmod +x it


[11/21/2023 11:04 PM] szybet
thats for andi to see


[11/21/2023 11:05 PM] szybet
usr local bin


[11/21/2023 11:05 PM] szybet
or usr bin


[11/21/2023 11:20 PM] mistapinku
Same error


[11/21/2023 11:21 PM] mistapinku
Cannot run command /mnt/onboard/.adds/inkbox/inkbox.sh


[11/21/2023 11:21 PM] mistapinku
Permission denied


[11/21/2023 11:21 PM] szybet
can you... `chroot /kobo`?


[11/21/2023 11:23 PM] mistapinku
chroot: failed to run command ‘/bin/ash’: Permission denied


[11/21/2023 11:23 PM] szybet
this is bad


[11/21/2023 11:23 PM] szybet
on /kobo is mounted another filesystem that uses glibc


[11/21/2023 11:24 PM] szybet
the one you are using now is using musl


[11/21/2023 11:24 PM] szybet
and the glibc is for qt, so the gui


[11/21/2023 11:24 PM] andi15701
somehow +x got lost?


[11/21/2023 11:24 PM] szybet
impossible


[11/21/2023 11:25 PM] szybet
its a squashfs, made reproductible from a script


[11/21/2023 11:25 PM] szybet
this message appaers too if glibc problems / other compability problems


[11/21/2023 11:25 PM] mistapinku
i just mounted it and copied the contents to p4


[11/21/2023 11:25 PM] mistapinku
dont know if something got lost there


[11/21/2023 11:25 PM] szybet
https://stackoverflow.com/questions/29675285/c-program-compiling-with-glibc-and-not-the-default-libraries-permission-denied

{Embed}
https://stackoverflow.com/questions/29675285/c-program-compiling-with-glibc-and-not-the-default-libraries-permission-denied
C program compiling with glibc and not the default libraries: Permi...
it's my first question on stackoverflow, so I will try to do it well.

Context:

I would like to deliver a program who could run on every Linux distribution (for example, a program who will use C++...
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[11/21/2023 11:26 PM] szybet
what?


[11/21/2023 11:26 PM] mistapinku
the p4 file


[11/21/2023 11:26 PM] andi15701
well, you can you unsquashfs


[11/21/2023 11:26 PM] andi15701
maybe links got lost?


[11/21/2023 11:26 PM] mistapinku
isnt it kinda the same?


[11/21/2023 11:26 PM] mistapinku
i can try that


[11/21/2023 11:26 PM] andi15701
so did you cp -a


[11/21/2023 11:26 PM] szybet
what are you


[11/21/2023 11:27 PM] szybet
we mount that squashfs inside of p4


[11/21/2023 11:27 PM] szybet
my god


[11/21/2023 11:27 PM] szybet
nicolas made a mess now you have problems


[11/21/2023 11:27 PM] szybet
wait


[11/21/2023 11:27 PM] mistapinku
well, you send an squashfs file, telling me to unpack it to p4


[11/21/2023 11:27 PM] mistapinku
did that, now it boots to ssh


[11/21/2023 11:28 PM] mistapinku
not further than that


[11/21/2023 11:28 PM] szybet
```
kobo:~# ls /mnt
X11                  dhcpcd_duid          gui_rootfs.isa       lost+found           ssh                  update
config               gui_rootfs           gui_rootfs.isa.dgst  onboard              tmpfs
```
this is how p4 should look like


[11/21/2023 11:28 PM] mistapinku
it does


[11/21/2023 11:28 PM] szybet
no further unsquashing


[11/21/2023 11:28 PM] szybet
good


[11/21/2023 11:28 PM] mistapinku
maybe the symlinks got lost


[11/21/2023 11:28 PM] szybet
impossible


[11/21/2023 11:28 PM] mistapinku
i can try unsquashfs


[11/21/2023 11:28 PM] szybet
those symlinks are still inside another squashfs, the `gui_rootfs.isa`


[11/21/2023 11:29 PM] mistapinku
i thought so as well


[11/21/2023 11:29 PM] szybet
run `service inkbox_gui restart`


[11/21/2023 11:29 PM] szybet
and look for logs


[11/21/2023 11:29 PM] mistapinku
running now


[11/21/2023 11:30 PM] mistapinku
* Stopping InkBox GUI ...                                                [ ok ]
 * Starting InkBox GUI ...
 * Starting InkBox Daemon (ibxd) ...                                      [ ok ]
 * WARNING: you are stopping a sysinit service
 * Stopping udev ...                                                      [ ok ]
 * Starting udev ...                                                      [ ok ]
 * Setting up GUI user applications
 * Successfully set up application 'ITerm'                                [ ok ]
kobo:~# chroot: failed to run command ‘/mnt/onboard/.adds/inkbox/inkbox.sh’: Permission denied
 * ERROR: sshd failed to start


[11/21/2023 11:30 PM] mistapinku
same as before


[11/21/2023 11:30 PM] szybet
later
```
mount /dev/mmcblk0p4 /mnt
sha1sum /mnt/gui_rootfs.isa
```


[11/21/2023 11:31 PM] szybet
mine is `6cf16b58c4a623b15a132f3a8fdaff09b278a1b2`


[11/21/2023 11:31 PM] mistapinku
dfcf205d9ae40f7d869b807cdc0e2a1991fc96f7  /mnt/gui_rootfs.isa


[11/21/2023 11:31 PM] szybet
no more logs? are you sure?


[11/21/2023 11:31 PM] mistapinku
guess i need another file


[11/21/2023 11:31 PM] szybet
did nicolas do something


[11/21/2023 11:31 PM] mistapinku
you can send me you file i guess


[11/21/2023 11:32 PM] szybet
its signed


[11/21/2023 11:32 PM] szybet
i dont have the keys


[11/21/2023 11:32 PM] mistapinku
ok


[11/21/2023 11:32 PM] andi15701
so nicolas reuploaded things?!


[11/21/2023 11:32 PM] szybet
nicolas is a dragon that is sitting on the keys


[11/21/2023 11:32 PM] szybet
i have no idea what he did


[11/21/2023 11:32 PM] szybet
maybe its old 1.9


[11/21/2023 11:32 PM] szybet
i have 2.0


[11/21/2023 11:33 PM] szybet
well whot i propose


[11/21/2023 11:33 PM] andi15701
I am checking hashes


[11/21/2023 11:34 PM] mistapinku
maybe an image from a working sd would be easier in the long run


[11/21/2023 11:34 PM] mistapinku
i flashed my sd a million time, then had to unpack a file to a partition, and then still not working


[11/21/2023 11:34 PM] szybet
create your own image? or reflash the kernel, re-sign everything
or
ask nicolas for keys


the first option is better - we need to know the changes, to make the image reproductible


[11/21/2023 11:35 PM] andi15701
well, there was one good instruction set


[11/21/2023 11:35 PM] andi15701
I am checking what I have


[11/21/2023 11:36 PM] szybet
well your decission


[11/21/2023 11:37 PM] mistapinku
well, im curious to see this working


[11/21/2023 11:37 PM] mistapinku
it got the better of me


[11/21/2023 11:37 PM] szybet
@Mista Pinku i propose you read the chat above - maybe you will learn what nicolas did
and the guide from the guy named... arco? idk its valuable to understand things


[11/21/2023 11:37 PM] andi15701
$ sha256sum p4.sqsh clarahd.xz 
d7d5760e19927cee1aeabbb707c1252cd04e57f92da7e82d8bac3072730417f3  p4.sqsh
8d7c9d9c7e8810b028a36512fcc578be65385877141ab086d32ca526da4cac5f  clarahd.xz


[11/21/2023 11:38 PM] andi15701
that is what I have used


[11/21/2023 11:38 PM] andi15701
and it went to the main screen


[11/21/2023 11:38 PM] andi15701
I even could play 2048


[11/21/2023 11:39 PM] szybet
???


[11/21/2023 11:39 PM] andi15701
the game 2048 included in inkbox


[11/21/2023 11:40 PM] szybet
i know, i dont understand what is going on


[11/21/2023 11:40 PM] andi15701
I guess I have time in 2 days


[11/21/2023 11:40 PM] mistapinku
could you link your p4.sqsh?


[11/21/2023 11:40 PM] mistapinku
i can try that


[11/21/2023 11:41 PM] szybet
check if you have the same thing


[11/21/2023 11:41 PM] szybet
shasum


[11/21/2023 11:41 PM] szybet
sha256sum\


[11/21/2023 11:41 PM] mistapinku
i know, let me find


[11/21/2023 11:41 PM] mistapinku
the file


[11/21/2023 11:42 PM] mistapinku
its the same


[11/21/2023 11:43 PM] szybet
well then


[11/21/2023 11:43 PM] szybet
read the chat


[11/21/2023 11:43 PM] szybet
its weird


[11/22/2023 6:25 PM] tux_linux
No


[11/22/2023 6:26 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/public-57899.pem
/mnt/data/projects/git/conversations/media/private-76F2D.pem


[11/22/2023 6:26 PM] tux_linux
maybe i will change them for final release


[11/22/2023 6:26 PM] tux_linux
but for now these are the keys that work


[11/22/2023 8:05 PM] szybet
at least


[11/22/2023 8:05 PM] szybet
http://pkgs-inkbox.duckdns.org:25560/misc/gui_rootfs.isa


[11/22/2023 8:06 PM] szybet
here is mine


[11/22/2023 8:06 PM] szybet
sign it something like `sudo openssl dgst -sha256 -sign /home/szybet/inkbox-keys/rootfs.pem -out rootfs.squashfs.dgst rootfs.squashfs`


[11/22/2023 8:06 PM] szybet
and replace the files in partition 4


[11/22/2023 8:07 PM] szybet
+ check with the sha i sended earlier


[11/22/2023 8:07 PM] szybet
i propose you do it on the sd card directly, not in inkbox shell


[11/22/2023 8:08 PM] szybet
then try the chroot and service command again


[11/22/2023 8:08 PM] szybet
and show logs


[11/22/2023 8:08 PM] szybet
🫡


[11/22/2023 8:08 PM] szybet
@Mista Pinku


[11/22/2023 8:15 PM] tux_linux
last

{Reactions}
🫡 

[11/22/2023 8:47 PM] szybet
yea you need to

{Reactions}
👍 

[11/29/2023 10:26 PM] andi15701
tried it again


[11/29/2023 10:27 PM] andi15701
xzcat clarahd.xz >/dev/sdX


[11/29/2023 10:27 PM] andi15701
mkfs.ext4 /dev/sdb4


[11/29/2023 10:27 PM] andi15701
mount /dev/sdb4 /mnt


[11/29/2023 10:27 PM] andi15701
cd /mnt


[11/29/2023 10:28 PM] andi15701
unsquashfs -ig -d . /path/to/p4.sqsh


[11/29/2023 10:28 PM] andi15701
cd


[11/29/2023 10:28 PM] andi15701
umount /mnt


[11/29/2023 10:29 PM] andi15701
sync


[11/29/2023 10:29 PM] andi15701
and eject sd and place it into kobo clara


[11/29/2023 10:30 PM] andi15701
existing lost+found can be a pitfall when unsquashing


[11/29/2023 10:30 PM] andi15701
hence -ig


[11/29/2023 10:52 PM] andi15701
at least I get into full graphical surface


[11/30/2023 11:21 AM] andi15701
btw: if at least the inkbox bootloader is there: you can press the button longer to get full sd card access


[11/30/2023 1:32 PM] tux_linux
Good


[12/20/2023 9:24 PM] thelinuxpirate
Following this thread with both the clarahd.xz & p4.sqsh I now have my Clara HD booted into InkBox. 

There were some quirks with the first boot but everything appears to be in order. My larger microSD card will be here tomorrow.

Edit: Not sure what I'm doing wrong but no matter what format my books are I get "There are no books in your eReader yet."

Edit2: Downloading a free book from the library UI seems to have resolved this, my files now appear.


[12/23/2023 7:43 AM] thelinuxpirate
My sleep cover wakes my Clara HD on open but fails to put it to sleep when closed. Expected?


[12/23/2023 10:27 AM] szybet
Yea


[12/23/2023 10:27 AM] szybet
It isint supported


[12/23/2023 10:27 AM] szybet
Ipd wasnt modified for the clara yet

{Reactions}
👍 

[12/23/2023 6:16 PM] thelinuxpirate
Just checking as I dig through the repos to understand the project more.

{Reactions}
🫡 

[12/24/2023 3:27 AM] tux_linux
you passed the first test


[12/24/2023 3:28 AM] tux_linux
still being interested in the project after a week

{Reactions}
🤣 (2) 

[12/24/2023 3:30 AM] tux_linux
just look at the number of people that say hello in #chat and disappear like ghosts after two days


[12/24/2023 6:02 AM] the.mightydill
and me showing up after months :p

{Reactions}
🤣 

[12/24/2023 6:02 AM] the.mightydill
hi


[12/24/2023 6:41 AM] thelinuxpirate
What is the most powerful device supported (with expandable/removable storage) by Inkbox? 

I'll admit my interest in the Kobo Clara HD was sparked by the postmarketos port to that device but I'm happy to have found this project which is a bit more "ready to go" and tailored for what I want out of my Kobo. 

My initial goal is to see about building the latest LTS kernel(s) 6.6/6.1 for my clara hd and going from there.

{Reactions}
👍 

[12/24/2023 10:16 AM] szybet
glo hd


[12/24/2023 10:17 AM] szybet
but i mean you have the clara already, if you will be the person to finally port it you will have the only device with a mainline kernel soo


[12/24/2023 5:14 PM] tux_linux
i have it too
but apparently there is a clara hd model b and model a


[12/24/2023 5:14 PM] tux_linux
we seem to have model a both


[12/25/2023 9:29 PM] andi15701
it  should not


[12/25/2023 9:29 PM] andi15701
sleep cover is reported the same way as a laptop cover is


[12/25/2023 9:31 PM] andi15701
and I usually do not need to modify anything for a laptop lid close to work


[12/25/2023 9:31 PM] andi15701
so it is not about modifying things *for the clara*


[12/25/2023 9:47 PM] andi15701
pmOS uses 6.6 at the moment


[12/25/2023 9:48 PM] andi15701
I can merge together the fbdev driver variant


[12/25/2023 9:48 PM] andi15701
as pmOS uses drm


[12/25/2023 9:50 PM] szybet
we rely on old header evdev names for that


[12/25/2023 9:50 PM] andi15701
I know


[12/25/2023 9:51 PM] andi15701
the point is that in the long run having the code like


[12/25/2023 9:53 PM] andi15701
if (device == some_device) { do_something() } else if(device == some_other_device) { do_something_else() }  is hard to maintain


[12/25/2023 9:54 PM] andi15701
so I think the better approach is to limit these ifs to odd things


[12/25/2023 9:55 PM] andi15701
and SW_LID is here the more standard way


[12/26/2023 1:01 PM] andi15701
regarding kernels, I regularly update kernels


[12/26/2023 1:02 PM] andi15701
for pmOS purposes


[12/26/2023 1:02 PM] andi15701
so as soon as inkbox uses submodules for the kernel source

{Reactions}
🙏 

[12/26/2023 1:02 PM] andi15701
things can be kept up to date easily


[12/26/2023 1:02 PM] andi15701
if needed

{Reactions}
❤️ 

[1/8/2024 11:07 PM] tux_linux
@andi this is what happened before i changed the platform plugin code so that it waited for every refresh


[1/9/2024 11:27 PM] ninuje
Not sure if same, because we never got the board id off it, but we've also seen reports of a brand new one with a whole different panel, too...


[1/9/2024 11:28 PM] tux_linux
Um yea


[1/9/2024 11:28 PM] tux_linux
Maybe I should add a warning


[1/9/2024 11:28 PM] tux_linux
Do you know after what time they appeared?


[1/10/2024 12:19 AM] ninuje
No idea, that one came up last week, but I don't even remember where ;D

{Reactions}
👍 

[1/10/2024 9:01 AM] andi15701
the b issue is analyzed in a pmOS ticket


[1/10/2024 9:01 AM] andi15701
and in the source


[1/10/2024 9:01 AM] andi15701
there might be a c


[1/10/2024 9:03 AM] andi15701
there are hints in the clara2e sources for it


[1/10/2024 9:03 AM] andi15701
and then there are more differences


[1/11/2024 1:39 AM] tux_linux
seems we got a first suspect

{Attachments}
/mnt/data/projects/git/conversations/media/image-DAAAA.png


[1/11/2024 1:39 AM] tux_linux
i asked him his board ID


[1/11/2024 10:03 AM] andi15701
and he should stop trying if it is board id b


[1/11/2024 10:03 AM] andi15701
board c is probably not that harmless


[1/11/2024 10:03 AM] andi15701
but b vs a is the worst I ever have heard


[1/11/2024 10:03 AM] andi15701
just rewiring regulators...


[1/11/2024 12:35 PM] tux_linux
ouch


[1/11/2024 12:36 PM] tux_linux
great


[1/11/2024 12:36 PM] tux_linux
hopefully not a d


[1/11/2024 12:56 PM] szybet
you haven't put any info on which clara to use


[1/11/2024 12:56 PM] szybet
that there are 3


[1/11/2024 12:56 PM] szybet
my god ;_;


[1/11/2024 12:56 PM] szybet
he could have burned the device


[1/11/2024 12:56 PM] tux_linux
i dont even know how to differentiate them


[1/11/2024 12:56 PM] szybet
oh


[1/11/2024 12:56 PM] szybet
well then, andis fault ;p


[1/11/2024 12:56 PM] tux_linux
we dont know


[1/11/2024 12:56 PM] szybet
and how are you awake


[1/11/2024 12:56 PM] tux_linux
i said in the message we are not responsible for device brick


[1/11/2024 12:56 PM] tux_linux
its 7am


[1/11/2024 12:56 PM] szybet
makes sense


[1/11/2024 12:57 PM] szybet
welp half the good message


[1/11/2024 12:57 PM] tux_linux
what is the good message


[1/11/2024 12:59 PM] szybet
the second one how to diffrentiate the clara


[1/11/2024 12:59 PM] szybet
but we dont know yet


[1/11/2024 12:59 PM] szybet
so


[1/11/2024 12:59 PM] szybet
¯\_(ツ)_/¯


[1/11/2024 1:00 PM] andi15701
well, look at the pmOS ticket


[1/11/2024 1:00 PM] andi15701
every information is there


[1/11/2024 1:00 PM] andi15701
I just have to do some u-boot scripting


[1/11/2024 1:00 PM] andi15701
we can check in u-boot


[1/11/2024 1:02 PM] andi15701
that is still on my to do list


[1/11/2024 1:02 PM] andi15701
and for now we can just list board revisions supported


[1/11/2024 1:03 PM] andi15701
37NB-E60K00+4A4 = ok


[1/11/2024 1:03 PM] andi15701
something with  +.B. = dangerours


[1/11/2024 1:04 PM] tux_linux
ok, thanks


[1/11/2024 1:04 PM] andi15701
probably something with +.C. = just not fully working


[1/11/2024 1:24 PM] andi15701
I think in general we should list board versions for each device which are sucessfully tested

{Reactions}
👍 

[1/11/2024 1:29 PM] tux_linux
where is the pmos issue
do you have a link?


[1/11/2024 1:31 PM] tux_linux
found it


[1/11/2024 1:32 PM] tux_linux
i posted a warning message

{Attachments}
/mnt/data/projects/git/conversations/media/image-30622.png


[1/11/2024 5:10 PM] zoli111
how can I decide which hardware revision I own?


[1/11/2024 5:56 PM] szybet
read the warning message and the link in it

{Reactions}
👍 

[1/11/2024 6:48 PM] thelinuxpirate
General inkbox question: 

If we have the previous "alpha" or testing image for the Clara is there an update path to get the changes in the beta? (I.e. does the built-in updater work in this case?)


[1/11/2024 7:27 PM] szybet
nope, full image flash is needed


[1/11/2024 7:27 PM] szybet
you can eassly copy your books from one inkbox image to another


[1/11/2024 7:27 PM] szybet
( its not worth our time making those online updates for 1 user )


[1/11/2024 8:20 PM] tux_linux
easily


[1/11/2024 8:20 PM] szybet
https://tenor.com/view/crying-emoji-dies-gif-21956120

{Embed}
https://tenor.com/view/crying-emoji-dies-gif-21956120
/mnt/data/projects/git/conversations/media/crying-emoji-dies-BD302.png


[1/11/2024 8:20 PM] tux_linux
no, you need to install the full version
i hope it will work on your device!


[1/11/2024 8:21 PM] tux_linux
that and 'different'
also, i didn't see, not i didn't saw

that was my rant
nothing against you


[1/11/2024 8:21 PM] tux_linux
just trying to help you if someday you get a job in an IT department where people only speak english


[1/11/2024 8:22 PM] szybet
i need to learn those things


[1/11/2024 8:22 PM] szybet
yea thanks

{Reactions}
👍 

[1/11/2024 8:24 PM] tux_linux
@andi you can tell me once you have finished the u-boot scripting thing
i will forward it to this guy
thanks

{Attachments}
/mnt/data/projects/git/conversations/media/image-D3E37.png


[1/11/2024 9:29 PM] thelinuxpirate
Copying the `onboard` image from one to the other should be all that's required right? I'd previously created a 100GB filesystem image.


[1/11/2024 9:30 PM] tux_linux
probably


[1/11/2024 9:30 PM] tux_linux
don't do it while it's turned on though

{Reactions}
👍 

[1/11/2024 9:33 PM] szybet
setting maybe too?


[1/11/2024 9:36 PM] tux_linux
what setting


[1/11/2024 9:36 PM] tux_linux
oh yes, if you had some settings


[1/11/2024 9:36 PM] tux_linux
they are located in /opt/storage/config iirc


[1/11/2024 9:36 PM] tux_linux
or /data/config if you are in an ssh session


[1/11/2024 9:37 PM] thelinuxpirate
Noted. Not too worried about settings atm.

{Reactions}
👍 

[1/12/2024 8:36 PM] ninuje
Yay for code comments, found the xref to that other rev guy: https://www.mobileread.com/forums/showpost.php?p=4383629&postcount=997

{Embed}
https://www.mobileread.com/forums/showpost.php?p=4383629&postcount=997
MobileRead Forums - View Single Post -  One-Click Install Packages ...
MobileRead - the resource for mobile geeks seeking information and advice for keeping their gadgets happy.

{Reactions}
👍 

[1/24/2024 9:58 PM] cieldautomne
hey 👋

I've tested a bit the beta image. It is still a bit unstable but I don't have my raspi with me to look at the serial console :/

Sometimes it freezes and I have to long press the power button to power off, then wait and power on, sometimes I can't boot, I have to unplug the battery wait a bit and try again, sometimes it boots only when plugged in usb and charging.

But overall it's ok. Still some screen glitches but only during boot.

The most annoying is that the library is never generated... I tried to download a book as suggested above, delete library database to regenerate but still no books are showing. What's weird is that the thumbnail folder is full of cover of my books.

I can read some book by searching them but the function is buggy sometimes. Also cover are missing on recently read books tab...


[1/24/2024 10:03 PM] cieldautomne
I have about 2gb in my library maybe it's too much


[1/29/2024 5:09 PM] tux_linux
sorry for not answering
probably that a 2gb library is a bit too much, yea


[1/29/2024 5:09 PM] tux_linux
maybe try with fewer books and delete database `rm /data/onboard/.database/LocalLibrary.db`


[1/31/2024 11:12 PM] andi15701
at the moment I am trying to enable console via usb


[1/31/2024 11:12 PM] andi15701
in u-boot


[1/31/2024 11:12 PM] tux_linux
Cool


[1/31/2024 11:12 PM] tux_linux
Clara?


[1/31/2024 11:12 PM] andi15701
at least in the 2022.10 one I use for BT200 there are two non-working drivers


[1/31/2024 11:12 PM] andi15701
clara is next


[1/31/2024 11:13 PM] andi15701
so any i2c hacking is easier

{Reactions}
👍 

[2/1/2024 9:51 PM] andi15701
tried to port and boot 2023.10 ... uuu gives timeout


[2/1/2024 9:51 PM] andi15701
same with 2022.10


[2/1/2024 9:52 PM] andi15701
recompiled 2020.10, still works...


[2/1/2024 10:06 PM] tux_linux
Sad


[2/1/2024 10:07 PM] tux_linux
Well, 2020 is better than 2016


[2/12/2024 1:25 PM] szybet
When will fbink work on the mainline kernel? any progress on this issue?
 @andi @NiLuJe @tux-linux


[2/12/2024 1:26 PM] tux_linux
no idea


[2/12/2024 1:36 PM] ninuje
It already does?


[2/12/2024 1:36 PM] ninuje
(on kernels w/ the mxcfb APIs, at least)


[2/12/2024 1:36 PM] andi15701
well, we have two roads: the drm-based driver, it gets refresh from standard api


[2/12/2024 1:36 PM] andi15701
no fbink needed in that case, but no fine-tuning possible


[2/12/2024 1:37 PM] tux_linux
kind of


[2/12/2024 1:37 PM] andi15701
and then we have the fbdev based one with nxp


[2/12/2024 1:37 PM] tux_linux
it has some severe refresh problems with qt


[2/12/2024 1:37 PM] andi15701
api


[2/12/2024 1:37 PM] ninuje
None of it is an fbink issue there, is what I mean 😉


[2/12/2024 1:37 PM] tux_linux
probably not


[2/12/2024 1:37 PM] andi15701
for refeshes


[2/12/2024 1:37 PM] andi15701
could we have test sequences?


[2/12/2024 1:37 PM] tux_linux
wdym


[2/12/2024 1:38 PM] szybet
Qt uses bare Fbink refreshes


[2/12/2024 1:38 PM] andi15701
so a sequence of fbink calls causing a problem


[2/12/2024 1:38 PM] szybet
If it's not fbink issue, only Qt implementation of it tell me - I will fix that


[2/12/2024 1:39 PM] tux_linux
you will probably need to buy a clara


[2/12/2024 1:39 PM] tux_linux
yes, it isn't handling fbink_wait_for_complete right


[2/12/2024 1:39 PM] szybet
you propably want a strace showing which waveform updates it does?


[2/12/2024 1:39 PM] tux_linux
if you dont set it to true, screen becomes all mangled up


[2/12/2024 1:40 PM] szybet
get a camera, SSH access and serial access over network and I will do it that way


[2/12/2024 1:40 PM] szybet
Quess who deleted the option for when fbink_wait_for_complete isin't available? you


[2/12/2024 1:40 PM] andi15701
so test sequence would be just two fbink calls


[2/12/2024 1:40 PM] tux_linux
?


[2/12/2024 1:40 PM] szybet
thats propably not ther solution but hey


[2/12/2024 1:40 PM] tux_linux
the code was messed up
i had to make it work on clara


[2/12/2024 1:41 PM] szybet
it was not


[2/12/2024 1:41 PM] tux_linux
im sorry but i had to modify it for that


[2/12/2024 1:41 PM] tux_linux
it didn't work when i compiled it


[2/12/2024 1:41 PM] szybet
you made something wrong or worse


[2/12/2024 1:41 PM] szybet
.


[2/12/2024 1:41 PM] tux_linux
it was already not working


[2/12/2024 1:41 PM] szybet
¯\_(ツ)_/¯


[2/12/2024 1:41 PM] andi15701
so a minimal test setup for reproducing


[2/12/2024 1:42 PM] andi15701
would be calling fbink two times in a row with wait_for_complete in use, right?


[2/12/2024 1:42 PM] tux_linux
https://photos.app.goo.gl/Xgq6vpQbFuuF9HCe7

{Embed}
https://photos.app.goo.gl/Xgq6vpQbFuuF9HCe7
New video by Nicolas Mailloux
/mnt/data/projects/git/conversations/media/ABLVV86tK7q2-V7f_2t5LqStFgzyAOScGj20fywAFw-72684


[2/12/2024 1:42 PM] tux_linux
see here for a very accurate representation of the problem


[2/12/2024 1:42 PM] tux_linux
maybe, I don't know if that would work with only 2 refresh calls


[2/12/2024 1:43 PM] tux_linux
also I remember the git history was just weird, some parts of the code that was in your pr was not there in the final commit


[2/12/2024 1:43 PM] szybet
https://github.com/Kobo-InkBox/qt5-kobo-platform-plugin/blob/304766ef5c0dacc4a1eee00db97e5bde8ce34628/src/kobofbscreen.cpp#L366-L373

{Embed}
https://github.com/Kobo-InkBox/qt5-kobo-platform-plugin/blob/304766ef5c0dacc4a1eee00db97e5bde8ce34628/src/kobofbscreen.cpp
qt5-kobo-platform-plugin/src/kobofbscreen.cpp at 304766ef5c0dacc4a1...
A Qt5 platform backend plugin for Kobo and Kindle E-Ink devices. - Kobo-InkBox/qt5-kobo-platform-plugin
/mnt/data/projects/git/conversations/media/qt5-kobo-platform-plugin-265DF


[2/12/2024 1:43 PM] szybet
and that also your fault for not accepting the pm immediately


[2/12/2024 1:44 PM] tux_linux
i was almost dead


[2/12/2024 1:44 PM] tux_linux
hello


[2/12/2024 1:44 PM] tux_linux
school


[2/12/2024 1:44 PM] szybet
that's your fault but not your fault


[2/12/2024 1:44 PM] szybet
if you know what i mean


[2/12/2024 1:44 PM] szybet
well anyway


[2/12/2024 1:45 PM] szybet
here first check what it's choosing to do, if it's fbink wait then it propably doesnt work, if it's usleep then propably smaller usleep?


[2/12/2024 1:45 PM] szybet
or no usleep


[2/12/2024 1:45 PM] szybet
¯\_(ツ)_/¯


[2/12/2024 1:45 PM] szybet
also knowing if it does that would be helpfull
https://github.com/Kobo-InkBox/qt5-kobo-platform-plugin/blob/304766ef5c0dacc4a1eee00db97e5bde8ce34628/src/kobofbscreen.cpp#L358-L364


[2/12/2024 1:47 PM] szybet
also related


[2/12/2024 1:47 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-BE274.png


[2/12/2024 1:47 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-061B9.png


[2/12/2024 1:47 PM] szybet
it doesnt have hasReliableMxcWaitFor set to false


[2/12/2024 1:47 PM] szybet
thats first


[2/12/2024 1:48 PM] szybet
```

    if (koboDevice->isREAGL)
    {
        this->waveFormPartial = WFM_REAGLD;
        this->waveFormFast = WFM_DU;
    }
    else if (koboDevice->mark == 7)
    {
        this->waveFormPartial = WFM_REAGL;
        this->waveFormFast = WFM_DU;
    }
    else if (koboDevice->isSunxi)
    {
        this->waveFormPartial = WFM_REAGL;
        this->waveFormFast = WFM_DU;
    }
}
```
this could be also adjusted.


[2/12/2024 1:48 PM] szybet
Launching sanki, there you can change it dynamically and choose the best configuration


[2/12/2024 1:49 PM] szybet
that's my ideas, now:

{Attachments}
/mnt/data/projects/git/conversations/media/download-5F054.png


[2/12/2024 1:49 PM] szybet
or nicolas send me the clara via cheap slow post, It will arrive till late may then i will have more time


[2/12/2024 7:38 PM] andi15701
so I guess I will first handle the a/b difference


[2/12/2024 7:38 PM] andi15701
in bootloader


[2/12/2024 7:38 PM] andi15701
then update the kernel


[2/12/2024 8:31 PM] ninuje
Because that doesn't apply to the Clara HD (and hopefully doesn't apply at all *anywhere* on mainline kernels)


[2/12/2024 8:32 PM] ninuje
Even if it did, that's not how the issue related to that flag manifests


[2/12/2024 8:32 PM] ninuje
(which, for reference, is the WAIT_FOR_UPDATE_COMPLETE ioctl throwing a timeout on perfectly valid use-cases. See the virtual keyboard in Nickel when entering a WiFi password for example.)


[2/12/2024 8:33 PM] ninuje
Applies to a bunch of imx6sll devices (libra/nia/libra 2/clara 2e)


[2/12/2024 8:44 PM] ninuje
TL;DR: That's got nothing to do with what Nicolas experiences


[2/12/2024 8:58 PM] szybet
How to debug it then?


[2/12/2024 8:59 PM] andi15701
just made 2023.10 u-boot working with usb consoe


[2/12/2024 8:59 PM] andi15701
console


[2/12/2024 8:59 PM] andi15701
on the clara


[2/12/2024 8:59 PM] szybet
Cool


[2/12/2024 8:59 PM] andi15701
should work on the nia, too


[2/12/2024 9:00 PM] andi15701
https://github.com/akemnade/u-boot-fslc branch kobo-2023-10

{Embed}
https://github.com/akemnade/u-boot-fslc
GitHub - akemnade/u-boot-fslc: U-Boot tree to host pending fixes an...
U-Boot tree to host pending fixes and improvements - akemnade/u-boot-fslc
/mnt/data/projects/git/conversations/media/u-boot-fslc-D5BF1


[2/12/2024 9:01 PM] andi15701
make ARCH=arm CROSS_COMPILE=....... mx6ullnia_defconfig


[2/12/2024 9:01 PM] szybet
Should? @Kuratius do you want to test it :)?


[2/12/2024 9:01 PM] andi15701
make ARCH=arm CROSS_COMPILE=.......


[2/12/2024 9:12 PM] tux_linux
Wooooooooo


[2/12/2024 9:28 PM] andi15701
what needs to be done: setenv stdout usbacm ; setenv stdin usbacm


[2/12/2024 9:28 PM] andi15701
either in the bootcmd


[2/12/2024 9:29 PM] andi15701
or the serial console


[2/12/2024 9:38 PM] tux_linux
This is great


[2/12/2024 9:39 PM] tux_linux
Does it behave like a regular serial console after boot ? Like can you see the kernel booting and etc.?


[2/12/2024 9:40 PM] tux_linux
well, thinking about it, probably not


[2/12/2024 9:40 PM] tux_linux
but still great


[2/12/2024 9:40 PM] andi15701
there is CONFIG_NETCONSOLE


[2/12/2024 9:40 PM] andi15701
in the kernel


[2/12/2024 9:40 PM] andi15701
which might help

{Reactions}
👍 

[2/12/2024 9:41 PM] andi15701
so have that over usb


[2/12/2024 9:41 PM] tux_linux
maybe you could set ttyUSB0/ttyACM0 in the boot args


[2/12/2024 9:41 PM] tux_linux
but not sure it would work right away


[2/12/2024 9:41 PM] tux_linux
esp. with drivers and stuff


[2/12/2024 9:42 PM] andi15701
/dev/ttyGS0

{Reactions}
👍 

[2/12/2024 9:42 PM] andi15701
I guess


[2/12/2024 9:42 PM] tux_linux
you don't need a module for it to work ?


[2/12/2024 9:42 PM] andi15701
well, you can have it compiled in


[2/12/2024 9:42 PM] tux_linux
ok


[2/12/2024 9:43 PM] andi15701
the real downside is that you need to have more things working to have the console working


[2/12/2024 9:44 PM] andi15701
and if you want to use the usb device otherwise things become a bit tricky

{Reactions}
👍 

[2/12/2024 9:44 PM] tux_linux
well, u-boot alone is awesome


[2/12/2024 9:46 PM] ninuje
The testcase idea is not a bad one, at least it'd make it easier for other people to repro to investigate


[2/12/2024 9:46 PM] kuratius
weekend maybe, I want to enjoy helldivers 2, I went through a lot of trouble to bypass the region restriction on the JP voice pack


[2/12/2024 9:47 PM] kuratius
or tomorrow


[2/12/2024 11:53 PM] andi15701
I guess I will tomorrow play a bit around with a clara versiondetect

{Reactions}
👍 

[2/14/2024 3:27 PM] tux_linux
Did you have the time to?


[2/14/2024 3:49 PM] szybet
im lost in the situation with the fbink, tldr: can i do anything or not?


[2/14/2024 5:40 PM] andi15701
I think today

{Reactions}
👍 

[2/14/2024 9:26 PM] andi15701
ok, added a detect_clara_rev command


[2/14/2024 9:27 PM] andi15701
which then sets the corresponding devicetree


[2/14/2024 9:30 PM] andi15701
same branch


[2/14/2024 9:30 PM] tux_linux
good


[2/14/2024 9:30 PM] andi15701
now I need someone with rev b to test the detection


[2/14/2024 9:30 PM] tux_linux
elinkser on mobileread has rev b


[2/14/2024 9:30 PM] andi15701
I added the info to the pmos ticket

{Reactions}
👍 

[2/14/2024 9:31 PM] tux_linux
but i dont think he will want to test it


[2/14/2024 9:31 PM] andi15701
well, no risk until now


[2/14/2024 9:31 PM] szybet
detection should be safe


[2/14/2024 9:31 PM] andi15701
he can test without a system


[2/14/2024 9:31 PM] andi15701
so pull out sd


[2/14/2024 9:31 PM] andi15701
and do uuu


[2/14/2024 9:32 PM] tux_linux
well, you can ask him


[2/14/2024 9:32 PM] szybet
invite him finalyl to this discord server


[2/14/2024 9:32 PM] szybet
so i can leave this forum finally


[2/14/2024 9:32 PM] tux_linux
i already invited him


[2/14/2024 9:32 PM] tux_linux
he didnt come


[2/14/2024 9:33 PM] tux_linux
maybe he doesnt like instant messaging


[2/14/2024 9:41 PM] szybet
mobileread forum is the worst


[2/14/2024 9:41 PM] szybet
there is nothing worse


[2/14/2024 9:41 PM] szybet
kia fanboy forum from 2003 looks better


[2/14/2024 9:51 PM] andi15701
ok, lets wait


[2/14/2024 9:53 PM] andi15701
I tried to message him on mobileread and appended the information to the ticket

{Reactions}
👍 

[2/14/2024 10:01 PM] sado1
maybe some people on postmarketos side will be more helpful there... somebody on pmos github also had one of the unlucky revisions


[2/14/2024 10:01 PM] andi15701
yes, that is the primary information source


[2/14/2024 10:02 PM] andi15701
https://gitlab.com/postmarketOS/pmaports/-/issues/2356

{Embed}
https://gitlab.com/postmarketOS/pmaports/-/issues/2356
Kobo Clara not booting with mainline kernel (#2356) · Issues · post...
Describe your issue  What's the expected behaviour? On pressing the power button the device...
/mnt/data/projects/git/conversations/media/icon_mobile-9A834.png


[2/14/2024 10:02 PM] sado1
ah, I see you posted there, nevermind then


[2/14/2024 10:16 PM] tux_linux
what is your mr account


[2/14/2024 10:16 PM] tux_linux
is it me or you never post anything


[2/14/2024 10:17 PM] tux_linux
well, found you


[2/14/2024 10:17 PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/image-5A90D.png


[2/14/2024 10:18 PM] tux_linux
<recent visitors>


[2/14/2024 10:19 PM] andi15701
andi45


[2/14/2024 10:21 PM] tux_linux
yes
well, no wonder i didn't find you since you haven't posted since 2022


[2/14/2024 10:21 PM] tux_linux
anyway, i hope he replies and joins


[2/14/2024 11:41 PM] andi15701
the guy who opened the ticket will try it out


[2/14/2024 11:42 PM] tux_linux
Good


[2/14/2024 11:42 PM] andi15701
so there is a detect_clara_rev command


[2/14/2024 11:42 PM] andi15701
setting $fdt_file


[2/14/2024 11:43 PM] andi15701
so if inkbox uses that u-boot


[2/14/2024 11:43 PM] andi15701
and uses the full name for the devicetree file


[2/14/2024 11:43 PM] andi15701
it will simply not boot


[2/14/2024 11:43 PM] tux_linux
Ok


[2/14/2024 11:43 PM] andi15701
in the rev b case

{Reactions}
👍 

[2/24/2024 11:16 PM] andi15701
ok, pinged there a bit


[2/24/2024 11:17 PM] tux_linux
Did he try it?


[2/24/2024 11:17 PM] andi15701
apparently not yet

{Reactions}
👍 

[2/24/2024 11:17 PM] andi15701
Geoffrey Tearle
@GeoffTearle
· 1 week ago
Author
￼
￼
More actions
Fantastic, no problem at all.

Is there anything once its booted into the uboot console that you want me to run or record?


[2/24/2024 11:17 PM] andi15701
lst message from him


[2/26/2024 8:12 AM] andi15701
ok, seems to work


[2/26/2024 8:12 AM] andi15701
so for inkbox, that means: upgrade u-boot to kobo-2023-10


[2/26/2024 8:12 AM] andi15701
do not change the devicetree name (as done now)


[2/26/2024 8:13 AM] andi15701
run detect_clara_rev in u-boot


[2/26/2024 8:14 AM] andi15701
use ${fdt_file} to select the correct devicetree


[2/26/2024 8:14 AM] andi15701
a future kernel then brings a tree for b


[2/28/2024 3:24 AM] tux_linux
good, will try it when i have time, thanks


[2/28/2024 3:24 AM] tux_linux
btw why did your profile picture turn blue?


[2/28/2024 8:32 AM] andi15701
well, there was something about unique nicknames

{Reactions}
👍 

[2/28/2024 8:32 AM] andi15701
somehowe that caused the change


[3/10/2024 6:45 PM] szybet
Fbink command line has an option for "wait for previous thing to draw" you could test with a simple script if it works, if yes i can handle the rest in the platform plugin


[3/10/2024 11:14 PM] ninuje
That's the current workaround being enforced in the QPA, IIRC.


[3/10/2024 11:15 PM] ninuje
But, yeah, a testcase can be written in shell, everything's exposed in the CLI tool


[3/12/2024 1:21 PM] andi15701
ok, just made 6.8 work on the clara in drm mode


[3/12/2024 1:21 PM] andi15701
so next step is to rebase the fbdev branch

{Reactions}
👍 

[3/12/2024 1:27 PM] andi15701
so what about the u-boot issue: I think it will be easier if u-boot would be a submodule


[3/12/2024 1:27 PM] andi15701
and let that point to the kobo-2023-10 branch


[3/13/2024 8:50 PM] andi15701
so, at least the fbdev stuff compiles again,...


[3/13/2024 8:50 PM] andi15701
with 6.8 kernel


[3/13/2024 9:01 PM] tux_linux
Nice


[3/16/2024 12:20 PM] andi15701
./fbink -x 1 -y 2 "Hallo Welt!" ; ./fbink -x 2 -y 2 "ello World!"


[3/16/2024 12:21 PM] andi15701
alternating English/German output


[3/16/2024 12:22 PM] andi15701
what is expected? Should the first fbink wait for things to be completed?


[3/16/2024 12:22 PM] andi15701
or the second fbink wait for things to be completed before touching the framebuffer


[3/16/2024 12:25 PM] andi15701
after fbset -depth 8


[3/16/2024 12:25 PM] andi15701
fbset -depth true


[3/16/2024 12:25 PM] andi15701
this has a stronger english preference


[3/16/2024 12:25 PM] szybet
You dont use the option to wait


[3/16/2024 12:26 PM] szybet
--help should tell you


[3/16/2024 12:26 PM] szybet
As for the question, idk , @NiLuJe


[3/16/2024 12:26 PM] szybet
Probably wait before exiting


[3/16/2024 12:31 PM] andi15701
/fbink -w -x 1 -y 2 "Hallo Welt!" ; ./fbink -w -x 2 -y 2 "ello World!"


[3/16/2024 12:31 PM] andi15701
that seems to work


[3/16/2024 12:37 PM] andi15701
ok, -w waits on exit


[3/16/2024 12:56 PM] andi15701
fbset -depth 8 -grayscale true toggles rotation for some reason


[3/16/2024 12:56 PM] andi15701
interesting


[3/16/2024 12:57 PM] andi15701
fbset -depth 16 -grayscale false


[3/16/2024 12:57 PM] andi15701
back again


[3/16/2024 1:40 PM] andi15701
playing around with fbink -s and writing directly to /dev/fb0: that all does not seem to affect rotation on the framebuffer


[3/16/2024 1:48 PM] szybet
Um so, conclusions?


[3/16/2024 1:48 PM] szybet
-w works?


[3/16/2024 1:48 PM] andi15701
yes


[3/16/2024 1:49 PM] andi15701
in my tests


[3/16/2024 2:57 PM] szybet
I will compare the code then


[3/16/2024 3:15 PM] andi15701
btw: does inkbox use grayscale mode now?


[3/16/2024 3:17 PM] szybet
What do you mean by that


[3/16/2024 3:17 PM] andi15701
operate the framebuffer in 8bit grayscale mode


[3/16/2024 3:18 PM] andi15701
and not in some >=16bpp color mode (where color ->bw conv is done by pxp)


[3/16/2024 3:21 PM] andi15701
# fbset -i

mode "1448x1072-0"
    # D: 0.013 MHz, H: 0.008 kHz, V: 0.007 Hz
    geometry 1448 1072 1472 2304 8
    timings 80000000 16 102 4 4 28 2
    grayscale true
    rgba 8/0,8/0,8/0,0/0
endmode


[3/16/2024 3:26 PM] tux_linux
It depends on the device


[3/16/2024 3:26 PM] tux_linux
It's that much messed up


[3/16/2024 3:29 PM] szybet
Where is it set


[3/16/2024 3:29 PM] szybet
Not in qpa for sure


[3/16/2024 3:29 PM] tux_linux
In xorg mess


[3/16/2024 3:29 PM] szybet
Some part of it in ipd for sure


[3/16/2024 3:29 PM] tux_linux
Also for nia


[3/16/2024 3:29 PM] tux_linux
Yes


[3/16/2024 3:29 PM] szybet
Where


[3/16/2024 3:29 PM] tux_linux
I don't remember


[3/16/2024 3:29 PM] tux_linux
Probably ipd


[3/16/2024 3:30 PM] szybet
😬


[3/16/2024 3:39 PM] szybet
Btw you could just try the newer platform plugin


[3/16/2024 3:39 PM] szybet
It has a over 2 years newer fbink


[3/16/2024 3:39 PM] szybet
Maybe it would change anythibg


[3/16/2024 3:40 PM] andi15701
I just compiled fbink separately


[3/16/2024 3:41 PM] szybet
We use static fbink in qpa


[3/16/2024 3:41 PM] szybet
And the problem is qpa


[3/16/2024 3:42 PM] szybet
Sooo


[3/16/2024 3:42 PM] szybet
https://discord.com/channels/809205711778480158/972252738362695710/1216058536702771340


[3/16/2024 3:44 PM] szybet
To test it, look up scripts repo and qt platform plugin deploy script


[3/16/2024 4:21 PM] ninuje
That's... interesting, but try with FBInk's `fbdepth` instead. IIRC (and I think I double-checked your kernel), that shouldn't happen on a Clara.


[3/16/2024 4:22 PM] ninuje
I would also try with displaying a mix of full-screen images *and* small text strings, vs. just two "hello worlds" only 😉


[3/16/2024 4:22 PM] ninuje
small refreshes and/or write/ioctls storms can have... fun consequences.


[3/16/2024 4:24 PM] ninuje
(TL;DR: Throw a *lot* of crap at the kernel and see how it copes)


[3/16/2024 4:25 PM] szybet
Yes, that would be helpfull too


[3/16/2024 4:25 PM] ninuje
And, yeah, the bitdepth question was a good one. I would assume 32bpp, because Qt5 still doesn't think Y8 is a first-class QPainter citizen, so I don't think InkBox would ever be running at 8bpp


[3/16/2024 4:25 PM] ninuje
(sadly)


[3/16/2024 4:25 PM] ninuje
Same reason why Nickel runs at 32bpp


[3/16/2024 4:26 PM] ninuje
So, also do that at the same bitdepth the issues are reproduced (because I know for a fact than on vendor kernels, the Clara is especially finicky at 8bpp)


[3/16/2024 4:26 PM] ninuje
(technically, at 8bpp + rota 0)


[3/16/2024 4:27 PM] ninuje
(which isn't the native Portrait, so that's less of a problem than it could have been)


[3/16/2024 4:30 PM] szybet
I wonder where its set


[3/16/2024 4:30 PM] szybet
In qpa


[3/16/2024 4:30 PM] szybet
I didnt saw it anywhere


[3/16/2024 4:31 PM] szybet
Its probably not, so you need to manually check before launching inkbox and what is used at default


[3/16/2024 4:52 PM] ninuje
If nobody touches it, rgb565 (i.e., 16bpp), which is the absolute fucking worst. So I hope *somebody* does something about it ;p.


[3/16/2024 4:53 PM] ninuje
Waveform mode might also play a part. If you don't specify anything, FBInk defaults to AUTO, but I expect most real-world uses-cases either use REAGL or GC16, with a bit of DU


[3/16/2024 4:59 PM] andi15701
kernel has set some default bpp


[3/16/2024 4:59 PM] andi15701
variable


[3/16/2024 4:59 PM] andi15701
static unsigned long default_bpp = 16;


[3/16/2024 4:59 PM] andi15701
mxc_epdc_v2_fb.c probably


[3/16/2024 5:01 PM] andi15701
well, 16bit, it consumes less memory than 32bpp


[3/16/2024 5:01 PM] andi15701
but yes otherwise ugly


[3/16/2024 5:01 PM] andi15701
all in all we are a grayscale alien in a colorful world


[3/16/2024 10:27 PM] andi15701
well, 8bit has a better chance for alignment issues with the pxp, esp. with rotation involved,


[3/16/2024 10:30 PM] andi15701
tested drawing something with fbi, and then fbink -s, no rotation surprises that time, so 8bit is not out of order


[3/16/2024 10:30 PM] andi15701
so back to >=16bpp


[3/16/2024 10:32 PM] andi15701
so there was a snippet setting waitForRefresh  = true specially for the clara as a workaround shown in #dev


[3/16/2024 10:32 PM] andi15701
so that is equal to adding -w to fbink?


[3/16/2024 10:33 PM] andi15701
but it is supposed to work without that?


[3/16/2024 10:47 PM] szybet
It was stupid ignore it


[3/16/2024 10:47 PM] szybet
Probably not, i hope so


[3/16/2024 10:48 PM] szybet
There always should be a way for waitong for it


[3/16/2024 10:49 PM] szybet
Nicolas just fprced a 1s delay...


[3/16/2024 10:49 PM] andi15701
yes, 1s is long


[3/16/2024 10:50 PM] szybet
I will look in the code tommorow to cook something new out of it


[3/16/2024 10:51 PM] szybet
For now ypu can try the qpa i sended


[3/16/2024 10:51 PM] andi15701
what might be interesting is not catched in my simple tests: multiple refresh areas at the same time


[3/16/2024 10:54 PM] andi15701
for the u-boot issue: you can just replace the u-boot code with a submodule pointing to my new branch, and then maybe I try to do something about the rest


[3/16/2024 10:55 PM] andi15701
so that as a first step nohing dangerous happens with rev b


[3/20/2024 6:28 PM] andi15701
btw: that branch should work on nia


[3/20/2024 6:28 PM] andi15701
too


[3/20/2024 6:28 PM] andi15701
that merged-6.8


[3/20/2024 6:30 PM] szybet
which nia


[3/20/2024 6:36 PM] andi15701
a and with limitations c


[3/20/2024 6:40 PM] szybet
limitations as of "should not burn it"


[3/20/2024 6:40 PM] szybet
does kuratius postmarket os already run on the mainline kernel?


[3/20/2024 6:40 PM] szybet
was the touch thing fixed?


[3/20/2024 6:43 PM] andi15701
about c: regulators are not touched


[3/20/2024 6:43 PM] szybet
oof


[3/20/2024 6:43 PM] szybet
it will not burn for sure


[3/20/2024 6:43 PM] szybet
but input will be messed up


[3/20/2024 6:44 PM] andi15701
so limitation is a) no battery state b) if anything needs more regulators enabled, it will not work


[3/20/2024 6:44 PM] andi15701
input: I would expect the power button to work


[3/20/2024 6:45 PM] andi15701
and generally, if refreshes are more sane, maybe input distortion is not that worse


[3/20/2024 6:45 PM] andi15701
pmOS was using some near-mainline 6.x


[3/20/2024 6:46 PM] szybet
so the input thing was fixed?


[3/20/2024 6:46 PM] szybet
kuratius fighted with it


[3/20/2024 6:50 PM] andi15701
the basic problem was that touch refreshes are disturbing the input, not sure about it state now, but maybe the effect is neglectible if refreshes are done in a more sane way like it is done in an eink-optimized ui


[3/20/2024 6:51 PM] szybet
well no, you need to ignore touchscreen when eink is doing something


[3/20/2024 6:52 PM] szybet
probably depends on the size / eink refresh to where to ignore the touchscreen


[3/20/2024 6:56 PM] kuratius
screen refreshes, but yes probly if your ui only uses buttons and taps and no dragging of elements (like a scroll bar) and you dont have anything that's animated it probably can be neglected


[3/20/2024 6:56 PM] kuratius
I still dont think it was actually tested if the original driver has the same issue, or if the eink ui just hides it


[3/20/2024 6:58 PM] kuratius
I saw some sleep stuff that looked like it was designed to put the touch screen reads to sleep if a refresh was happening, but I might be misremembering


[3/20/2024 6:58 PM] kuratius
might've not even been used


[3/20/2024 7:15 PM] kuratius
this sort of thing

{Attachments}
/mnt/data/projects/git/conversations/media/image-0C93D.png


[3/23/2024 10:28 AM] andi15701
so back to the refresh problem: so if I understand correctly fbink -w *seems* to work and Inkbox is doing 1s delays instead, so next thing is finding out whether there are some corner cases with troubles and whether Inkbox is doing something else


[3/23/2024 10:42 AM] andi15701
so that means: putting inkbox onto an sd card and replace the files?


[3/23/2024 10:43 AM] szybet
Not really, a few commands


[3/23/2024 10:43 AM] szybet
To mount bind the file


[3/23/2024 3:19 PM] tux_linux
I will try to setup the clara hd real-time testing platform soon


[3/23/2024 4:31 PM] andi15701
what about that u-boot issue?


[3/23/2024 9:25 PM] andi15701
if clara-uboot is replaced by a submodule pointing to my github fork, I will send patches for the rest


[3/23/2024 9:34 PM] szybet
I would prefer if things would point to the github org only


[3/23/2024 9:34 PM] szybet
so create a fork in the org


[3/23/2024 9:34 PM] szybet
can you do it? if not i can do it for you


[3/23/2024 9:35 PM] andi15701
I don't think so


[3/23/2024 9:35 PM] szybet
give me the repo link, i will fork it


[3/23/2024 9:36 PM] andi15701
https://github.com/akemnade/u-boot-fslc

{Embed}
https://github.com/akemnade/u-boot-fslc
GitHub - akemnade/u-boot-fslc: U-Boot tree to host pending fixes an...
U-Boot tree to host pending fixes and improvements - akemnade/u-boot-fslc
/mnt/data/projects/git/conversations/media/u-boot-fslc-D5BF1


[3/23/2024 9:36 PM] andi15701
kobo-2023-10


[3/23/2024 9:37 PM] szybet
Github gives an api to backup repos in an org without the repo history, only the code which is the way i backup it on more devices than only 2


[3/23/2024 9:37 PM] szybet
so that's the reason


[3/23/2024 9:37 PM] szybet
is it only for the clara?


[3/23/2024 9:37 PM] szybet
if its so i will rename the fork


[3/23/2024 9:37 PM] andi15701
no


[3/23/2024 9:38 PM] andi15701
works with clara, shine2, shine3, libra h2o, vision5, nia a+c


[3/23/2024 9:38 PM] szybet
https://github.com/Kobo-InkBox/u-boot-fslc

{Embed}
https://github.com/Kobo-InkBox/u-boot-fslc
GitHub - Kobo-InkBox/u-boot-fslc: U-Boot tree to host pending fixes...
U-Boot tree to host pending fixes and improvements - Kobo-InkBox/u-boot-fslc
/mnt/data/projects/git/conversations/media/u-boot-fslc-AB47C


[3/23/2024 9:38 PM] szybet
done


[3/23/2024 9:38 PM] szybet
you should have access?


[3/23/2024 9:48 PM] andi15701
that fork contains only 1 branch


[3/23/2024 9:48 PM] andi15701
and that is the wrong one


[3/23/2024 9:48 PM] andi15701
kobo-2023-10


[3/23/2024 9:48 PM] andi15701
is correct


[3/23/2024 9:49 PM] szybet
wtf


[3/23/2024 9:49 PM] szybet
give me a minute


[3/23/2024 9:49 PM] szybet
ah


[3/23/2024 9:49 PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/image-2F04C.png


[3/23/2024 9:50 PM] szybet
now


[3/23/2024 9:53 PM] andi15701
yes, looks good now


[3/23/2024 10:30 PM] andi15701
and if I remember correctly also with Kobo Glo HD


[3/23/2024 10:41 PM] andi15701
but as a drop-in-replacement in inkbox it will work only for the clara at the moment


[3/23/2024 10:51 PM] andi15701
generally it is possible to boot 4.1.15 kobo kernels and load all the blobs needed from files using that bootloader


[3/23/2024 10:51 PM] andi15701
so it could be a starting point to any revision autodetection work


[3/26/2024 7:20 PM] tux_linux
i am setting up Online Clara Debugger™️


[3/26/2024 7:35 PM] andi15701
that uboot repo is not linked in the https://github.com/Kobo-InkBox/kernel repo

{Embed}
https://github.com/Kobo-InkBox/kernel
GitHub - Quill-OS/kernel: Kernel sources for Quill OS
Kernel sources for Quill OS. Contribute to Quill-OS/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-CD733


[3/26/2024 7:38 PM] andi15701
which epd pmic does your libra2 have? jd9930 or sy7636?


[3/28/2024 11:47 PM] andi15701
if I do not need inkbox, what should I use the libkobo.so with. I have now enough spare sd cards so that I can prepare one for inkbox again


[3/28/2024 11:53 PM] andi15701
env INIT_STRIP=/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/bin/armv7l-linux-musleabihf-strip INIT_GCC=/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/bin/armv7l-linux-musleabihf-gcc GITDIR=/home/build/inkbox/kernel TOOLCHAINDIR=/home/build/inkbox/kernel/toolchain/armv7l-linux-musleabihf-cross/ THREADS=8 TARGET=armv7l-linux-musleabihf scripts/build_kernel.sh n249 root


[3/28/2024 11:53 PM] andi15701
had that in my shell history


[3/28/2024 11:53 PM] andi15701
to build the kernel


[3/28/2024 11:54 PM] andi15701
what is the correct one now?


[3/28/2024 11:56 PM] szybet
dont update your kernel repo


[3/28/2024 11:58 PM] szybet
i dont remember but something like in /lib/qt-plugins ( just run find / | grep libkobo to find what im talking about ) are three files libkobo.so.x replace all of them then then service inkbox_gui restart

or this:
https://github.com/Quill-OS/scripts/blob/main/repos/qt-platform-plugin/deploy_qt_platform_plugin.sh

{Embed}
https://github.com/Quill-OS/scripts/blob/main/repos/qt-platform-plugin/deploy_qt_platform_plugin.sh
scripts/repos/qt-platform-plugin/deploy_qt_platform_plugin.sh at ma...
Build and deploy scripts for other repos for Quill OS - Quill-OS/scripts
/mnt/data/projects/git/conversations/media/scripts-1FAFD


[3/29/2024 12:01 AM] andi15701
I wanted to have the autodetection working, or at least the stopgap for refusing to boot kernel  b, so I need to do something there


[3/29/2024 12:03 AM] andi15701
so the toolchain directory is gone. Which toolchains are now the "approved" ones?


[3/29/2024 12:05 AM] szybet
in toolchains repo


[3/29/2024 12:05 AM] szybet
i just moved them to make things modular and sensible


[3/29/2024 12:06 AM] szybet
i mean if you want you can

1. use kernel-older repo for now which will add some problems for me later

2. move the build scripts to scripts repo following what i have been doing there and building the kernel there


[3/30/2024 2:33 PM] tux_linux
@andi or @Szybet if you are available i can enable clara online debugger for you


[3/30/2024 2:34 PM] tux_linux
current implementation uses teamviewer and live youtube stream so its a bit junk but the best i could do with limited time


[3/30/2024 2:36 PM] szybet
do you have serial


[3/30/2024 2:36 PM] szybet
or usbnet


[3/30/2024 2:36 PM] tux_linux
usbnet


[3/30/2024 2:36 PM] tux_linux
its a linux system plugged into the ereader


[3/30/2024 2:36 PM] tux_linux
so basically all usual goodies


[3/30/2024 2:36 PM] tux_linux
even kde


[3/30/2024 2:36 PM] szybet
well i have other things to do


[3/30/2024 2:37 PM] tux_linux
ok


[3/30/2024 2:37 PM] szybet
i could twest the platform plugin but everyone else can do it too


[3/30/2024 2:37 PM] szybet
so i wont touch it


[3/30/2024 2:37 PM] tux_linux
it hasnt been updated to latest system since you broke platform plugin with your update


[3/30/2024 2:37 PM] tux_linux
so i left it as is for now


[3/30/2024 2:37 PM] tux_linux
until solution is found


[3/30/2024 2:37 PM] szybet
exactly, test the new one


[3/30/2024 2:38 PM] tux_linux
well, it will be even worse


[3/30/2024 2:38 PM] tux_linux
but ok


[3/30/2024 2:38 PM] szybet
just test it


[4/1/2024 12:27 PM] adichan8327
hi, I was wondering if there's a rough estimate for the clara hd image?


[4/1/2024 1:40 PM] szybet
there is a experimental image which sucks


[4/1/2024 1:40 PM] szybet
we need testers


[4/3/2024 12:31 AM] andi15701
setting EPDC_V2_MAX_NUM_UPDATES to 1 might be interesting


[4/3/2024 1:01 AM] ninuje
I don't recall collision handling ever being truly awful on mxc (like it can be on sunxi), but that's an interesting theory


[4/3/2024 1:02 AM] ninuje
As well as switching to a different update scheme (snapshot?)


==============================================================
Exported 4,314 message(s)
==============================================================
