==============================================================
Guild: Quill OS
Channel: Development / porting / Kobo Nia model A (N306A)
==============================================================

[2/17/2022 4:32â€¯AM] tux_linux
@Szybet , here's a porting thread to get your Nia set up properly. I usually don't have much time for InkBox except on week-ends, but you can checkout the Libra H2O porting thread to have an idea of what will need to be done.


[2/17/2022 4:34â€¯AM] tux_linux
I do not know if @andi has done anything with mx6ull yet (Nia's SoC), but it sure could be interesting to have mainline there too, if it's not too much work.


[2/17/2022 8:26â€¯AM] szybet
I have already the backup of the SD card


[2/17/2022 8:26â€¯AM] szybet
i dont understand the openssl thing that was there talked about


[2/17/2022 8:26â€¯AM] szybet
i will get to u-boot today


[2/17/2022 8:27â€¯AM] szybet
and it would be great to make a 5.x kernel work


[2/17/2022 12:17â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/overlay-mount
Maybe look here, it's how the rootfs is verified and mounted at boot (it's a squashfs archive)

{Embed}
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/overlay-mount
kernel/overlay-mount at master Â· Kobo-InkBox/kernel
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-8A7AF


[2/17/2022 3:05â€¯PM] szybet
hmm i understand the script


[2/17/2022 3:05â€¯PM] szybet
but i dont know how it could help


[2/17/2022 3:43â€¯PM] tux_linux
How what could help?


[2/17/2022 3:43â€¯PM] szybet
this


[2/17/2022 4:20â€¯PM] szybet
lets focus on the kernel / bootloader first?


[2/17/2022 4:20â€¯PM] szybet
or there doesnt need to be anything changed in them?


[2/17/2022 5:02â€¯PM] tux_linux
Um yeah


[2/17/2022 5:02â€¯PM] tux_linux
U-Boot kernel sector
Change it to 81920
And change kernel load size to 18432


[2/17/2022 5:03â€¯PM] szybet
hmm why is it needed to change?


[2/17/2022 5:03â€¯PM] szybet
so i need to compile u-boot?


[2/17/2022 5:06â€¯PM] szybet
and, is it all?


[2/17/2022 5:19â€¯PM] tux_linux
Kernel is too big


[2/17/2022 5:19â€¯PM] szybet
why is it too big?


[2/17/2022 5:19â€¯PM] tux_linux
Do something like this https://github.com/Kobo-InkBox/kernel/commit/a6754443ad14f9033d7e328426c9ad4451f516b7

{Embed}
https://github.com/Kobo-InkBox/kernel/commit/a6754443ad14f9033d7e328426c9ad4451f516b7
N437: Change kernel load sector & size Â· Kobo-InkBox/kernel@a675444
/mnt/data/projects/git/conversations/media/a6754443ad14f9033d7e328426c9ad4451f516b7-12D83


[2/17/2022 5:19â€¯PM] szybet
whot would change that it would be big?


[2/17/2022 5:19â€¯PM] tux_linux
It can't fit in the default unpartitioned space


[2/17/2022 5:19â€¯PM] tux_linux
Initrd is embedded


[2/17/2022 5:20â€¯PM] szybet
it would be better to understand if you would provide the full sd card partition / place plan


[2/17/2022 5:21â€¯PM] tux_linux
Download factory image and look


[2/17/2022 5:21â€¯PM] tux_linux
23.163.0.39


[2/17/2022 5:24â€¯PM] szybet
where is it


[2/17/2022 5:49â€¯PM] szybet
and, maybe we try to update the kernel to a newer version?


[2/17/2022 6:34â€¯PM] tux_linux
See here for example
http://23.163.0.39/bundles/inkbox/native/n905b/inkbox-1.7-n905b.xz


[2/17/2022 6:56â€¯PM] szybet
i will look at it


[2/17/2022 7:04â€¯PM] szybet
how do i generate the u-boot config?


[2/17/2022 7:04â€¯PM] szybet
or even get the board name


[2/17/2022 7:28â€¯PM] szybet
```
inkbox-1.7-n905b: DOS/MBR boot sector; partition 1 : ID=0x83, start-CHS (0x2,140,10), end-CHS (0x4,247,51), startsector 40959, 38913 sectors; partition 2 : ID=0x83, start-CHS (0x6,127,58), end-CHS (0x46,61,55), startsector 104448, 1024000 sectors; partition 3 : ID=0x83, start-CHS (0x46,61,56), end-CHS (0x56,142,56), startsector 1128448, 262144 sectors; partition 4 : ID=0x83, start-CHS (0x56,142,57), end-CHS (0x1d5,242,17), startsector 1390592, 6159156 sectors
```


[2/17/2022 7:28â€¯PM] szybet
i used file to show this


[2/17/2022 7:28â€¯PM] szybet
do i need to mount this, or use another app to open this?


[2/17/2022 7:29â€¯PM] szybet
the easiest and fastest way would be if you shared resources / links how to do those steps


[2/17/2022 7:30â€¯PM] szybet
maybe write a guide / documentation?


[2/17/2022 7:33â€¯PM] tux_linux
fdisk img


[2/17/2022 7:38â€¯PM] tux_linux
Or xzcat img > InkBox.img


[2/17/2022 7:39â€¯PM] tux_linux
losetup -P -f --show InkBox.img


[2/17/2022 7:39â€¯PM] tux_linux
fdisk -l /dev/loop<x>


[2/17/2022 7:46â€¯PM] tux_linux
I don't know the kernel sources or U-Boot sources for this model, but look in `include/configs` for U-Boot


[2/17/2022 7:46â€¯PM] tux_linux
Maybe `imx_v7_defconfig`


[2/17/2022 7:58â€¯PM] szybet
thats whot i thought, that i need to mount it


[2/17/2022 7:59â€¯PM] szybet
ok i will have a look at it

{Reactions}
ğŸ‘ 

[2/18/2022 12:19â€¯AM] tux_linux
Maybe you can set up the emulator in a Debian VM to have an idea of what you will be dealing with


[2/18/2022 12:20â€¯AM] tux_linux
https://github.com/Kobo-InkBox/emu

{Embed}
https://github.com/Kobo-InkBox/emu
GitHub - Kobo-InkBox/emu: InkBox OS emulator
InkBox OS emulator. Contribute to Kobo-InkBox/emu development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/emu-884F6


[2/18/2022 1:18â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-2792A.png


[2/18/2022 1:19â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-0C029.txt


[2/18/2022 1:19â€¯PM] szybet
this looks promising


[2/18/2022 1:20â€¯PM] tux_linux
What filename?


[2/18/2022 1:20â€¯PM] szybet
auto.conf


[2/18/2022 1:23â€¯PM] tux_linux
Doubt it will work


[2/18/2022 5:55â€¯PM] szybet
it isin't there


[2/18/2022 5:55â€¯PM] szybet
but i have a idea


[2/18/2022 5:55â€¯PM] szybet
the cpu is mx6ull


[2/18/2022 5:55â€¯PM] tux_linux
yes


[2/18/2022 5:55â€¯PM] szybet
```
% ls | grep mx6ull
mx6ull_14x14_ddr3_arm2_defconfig
mx6ull_14x14_ddr3_arm2_emmc_defconfig
mx6ull_14x14_ddr3_arm2_epdc_defconfig
mx6ull_14x14_ddr3_arm2_nand_defconfig
mx6ull_14x14_ddr3_arm2_qspi1_defconfig
mx6ull_14x14_ddr3_arm2_spinor_defconfig
mx6ull_14x14_ddr3_arm2_tsc_defconfig
mx6ull_14x14_evk_defconfig
mx6ull_14x14_evk_emmc_defconfig
mx6ull_14x14_evk_nand_defconfig
mx6ull_14x14_evk_qspi1_defconfig
mx6ull_9x9_evk_defconfig
mx6ull_9x9_evk_qspi1_defconfig
mx6ull_ntx_lpddr2_256m_defconfig
mx6ull_ntx_lpddr2_256m_mfg_defconfig
mx6ull_ntx_lpddr2_512m_defconfig
mx6ull_ntx_lpddr3_512m_defconfig
mx6ull_ntx_lpddr3_512m_mfg_defconfig
```


[2/18/2022 5:56â€¯PM] tux_linux
How much RAM do you have in the Nia?


[2/18/2022 5:56â€¯PM] szybet
wait, i will check


[2/18/2022 5:56â€¯PM] szybet
RAMType='LPDDR2


[2/18/2022 5:57â€¯PM] szybet
RamSize='256MB'


[2/18/2022 5:57â€¯PM] szybet
so its only
```
mx6ull_ntx_lpddr2_256m_defconfig
mx6ull_ntx_lpddr2_256m_mfg_defconfig
```


[2/18/2022 5:58â€¯PM] szybet
whot does mfg mean


[2/18/2022 5:58â€¯PM] tux_linux
Kobo still has done the mistake
to put
256MB
of
RAM
in a 2 years old
device


[2/18/2022 5:58â€¯PM] tux_linux
Don't use mfg


[2/18/2022 5:58â€¯PM] szybet
whot does mfg mean


[2/18/2022 5:58â€¯PM] tux_linux
mfg=manufacturing I guess


[2/18/2022 5:58â€¯PM] tux_linux
I never use them


[2/18/2022 5:58â€¯PM] szybet
you know, nia is cheap


[2/18/2022 5:58â€¯PM] tux_linux
Just take `mx6ull_ntx_lpddr2_256m_defconfig`


[2/18/2022 5:58â€¯PM] szybet
and why would it need more?


[2/18/2022 5:58â€¯PM] tux_linux
I do know


[2/18/2022 5:58â€¯PM] szybet
its a ereader


[2/18/2022 5:59â€¯PM] tux_linux
Well, Elipsa (2021) has 1G, Glo HD (2015) has 512M, Libra (2019) has 512M, Clara (2018) has 512M, so


[2/18/2022 5:59â€¯PM] tux_linux
Also there is a substantial speed increase with InkBox devices which have 512M of RAM


[2/18/2022 5:59â€¯PM] tux_linux
But anyways, end of the rant


[2/18/2022 6:00â€¯PM] szybet
nia is just cheap


[2/18/2022 6:02â€¯PM] szybet
it just writted it to the config?


[2/18/2022 6:02â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-9467F.png


[2/18/2022 6:02â€¯PM] szybet
now i need to select whot i need? ohn o...


[2/18/2022 6:02â€¯PM] tux_linux
Yes


[2/18/2022 6:02â€¯PM] tux_linux
No


[2/18/2022 6:02â€¯PM] szybet
whot no


[2/18/2022 6:02â€¯PM] tux_linux
Remove the mx6ull bit


[2/18/2022 6:02â€¯PM] szybet
?


[2/18/2022 6:02â€¯PM] tux_linux
And it will compile `u-boot.bin`


[2/18/2022 6:03â€¯PM] tux_linux
`make -j6 CROSS_COMPILE=arm-linux-gnueabihf- ARCH=arm`


[2/18/2022 6:03â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-79A3A.txt


[2/18/2022 6:03â€¯PM] szybet
hahahaha...


[2/18/2022 6:04â€¯PM] tux_linux
Try with a different compiler


[2/18/2022 6:04â€¯PM] tux_linux
I cannot help you on those errors


[2/18/2022 6:04â€¯PM] tux_linux
But you can build this code somehow


[2/18/2022 6:04â€¯PM] tux_linux
Sometimes just changing compiler will solve the issue


[2/18/2022 6:04â€¯PM] szybet
like which one? i have the 4.9


[2/18/2022 6:04â€¯PM] szybet
i dont think changing to a older one will help


[2/18/2022 6:04â€¯PM] tux_linux
Did you clone the InkBox kernel repo?


[2/18/2022 6:04â€¯PM] tux_linux
it did for me


[2/18/2022 6:05â€¯PM] tux_linux
changing to a newer one


[2/18/2022 6:05â€¯PM] szybet
im using the compiler from kobo reader repo


[2/18/2022 6:05â€¯PM] tux_linux
Ok; clone InkBox kernel repo


[2/18/2022 6:05â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel

{Embed}
https://github.com/Kobo-InkBox/kernel
GitHub - Kobo-InkBox/kernel: Kernel sources for InkBox OS
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-8A7AF


[2/18/2022 6:05â€¯PM] tux_linux
And use `arm-nickel-linux-gnueabihf-`
If it doesn't work, try `armv7l-linux-musleabihf-`


[2/18/2022 6:06â€¯PM] tux_linux
Or maybe you will have more luck with bootstrapping this one https://github.com/koreader/koxtoolchain

{Embed}
https://github.com/koreader/koxtoolchain
GitHub - koreader/koxtoolchain: Build script for various toolchains...
Build script for various toolchains used by KOReader - GitHub - koreader/koxtoolchain: Build script for various toolchains used by KOReader
/mnt/data/projects/git/conversations/media/koxtoolchain-55113


[2/18/2022 6:07â€¯PM] szybet
i will

{Reactions}
ğŸ‘ 

[2/18/2022 6:07â€¯PM] tux_linux
If you really aren't lucky, I'll try to compile it myself


[2/18/2022 6:08â€¯PM] tux_linux
Sometimes there are Unexplainable Build Errorsâ„¢ï¸ that are solved just by compiling on another machine or distro


[2/18/2022 6:27â€¯PM] szybet
C and other c are something shitty


[2/18/2022 6:27â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-2967E.png


[2/18/2022 6:27â€¯PM] szybet
but i got it


[2/18/2022 6:28â€¯PM] tux_linux
Nice!!


[2/18/2022 6:28â€¯PM] tux_linux
What toolchain?


[2/18/2022 6:28â€¯PM] szybet
mine, 4.9


[2/18/2022 6:28â€¯PM] szybet
yours doesn't worked


[2/18/2022 6:28â€¯PM] szybet
but the problem was a package i have installed


[2/18/2022 6:28â€¯PM] tux_linux
Ah


[2/18/2022 6:28â€¯PM] szybet
https://github.com/openbmc/openbmc/issues/3274

{Embed}
https://github.com/openbmc/openbmc/issues/3274
Build error using Debian testing in libfdt Â· Issue #3274 Â· openbmc/...
Hi, I&#39;m attempting to build OpenBMC on Debian testing. This is the command that fails: ocp-bluecmd:~/openbmc/build/tmp/work/x86_64-linux/u-boot-mkimage-native/1_2017.09-r0/git$ gcc -isystem...
/mnt/data/projects/git/conversations/media/3274-B44D4


[2/18/2022 6:28â€¯PM] szybet
can i write it using dd in kobo or do i need to get the sd card from inside?


[2/18/2022 6:29â€¯PM] szybet
and write it using the PC


[2/18/2022 6:29â€¯PM] tux_linux
you can use the Kobo


[2/18/2022 6:29â€¯PM] tux_linux
`dd if=u-boot.bin of=/dev/mmcblk0 bs=1K seek=1 skip=1`


[2/18/2022 6:49â€¯PM] szybet
actually im not sure if this is the correct command


[2/18/2022 6:49â€¯PM] szybet
here is a part of the script from the device, the update script
```
if [ `echo $UBOOT | grep -c imx` == 1 ]; then
        dd if=$UBOOT of=/dev/$DEVICE bs=1K seek=1
    else
        dd if=$UBOOT of=/dev/$DEVICE bs=1K seek=1 skip=1
```


[2/18/2022 6:49â€¯PM] szybet
i think imx is a procesor type


[2/18/2022 6:49â€¯PM] tux_linux
Maybe omit the skip then


[2/18/2022 6:49â€¯PM] tux_linux
Look in the update zips from Kobo


[2/18/2022 6:49â€¯PM] tux_linux
See what it's called


[2/18/2022 6:49â€¯PM] szybet
mine nia has mx6ull


[2/18/2022 6:50â€¯PM] szybet
it called using cpu names


[2/18/2022 6:50â€¯PM] szybet
so i will not use skip


[2/18/2022 6:50â€¯PM] szybet
no, i think wrong


[2/18/2022 6:50â€¯PM] szybet
i will, there is a else


[2/18/2022 6:51â€¯PM] tux_linux
backup the boot sector


[2/18/2022 6:51â€¯PM] tux_linux
what's `fdisk -l` on your device?


[2/18/2022 6:52â€¯PM] szybet
i have backup of the whole sd card


[2/18/2022 6:52â€¯PM] szybet
like, i bricked my ereader 5 times already


[2/18/2022 6:52â€¯PM] tux_linux
ok, well flashing only the boot sector would probably be better for the sd


[2/18/2022 6:53â€¯PM] szybet
i can copy only the boot sector from the sd card


[2/18/2022 6:53â€¯PM] tux_linux
Ok


[2/18/2022 6:53â€¯PM] tux_linux
Well, do that if you brick it


[2/18/2022 6:55â€¯PM] szybet
its dead


[2/18/2022 6:55â€¯PM] szybet
D:


[2/18/2022 6:55â€¯PM] szybet
even the led doesn't work


[2/18/2022 6:55â€¯PM] tux_linux
then probably skip=1


[2/18/2022 6:55â€¯PM] szybet
XD


[2/18/2022 6:58â€¯PM] szybet
my pc doesn't list partitions?


[2/18/2022 6:59â€¯PM] szybet
um...


[2/18/2022 6:59â€¯PM] tux_linux
You probably just have overwritten the DOS boot sector!


[2/18/2022 6:59â€¯PM] tux_linux
Congrats


[2/18/2022 6:59â€¯PM] tux_linux
So fdisk is like what in the world has happened to this thing


[2/18/2022 6:59â€¯PM] szybet
??? how


[2/18/2022 6:59â€¯PM] tux_linux
Just reflash the unpartitioned space, you'll get it back


[2/18/2022 7:00â€¯PM] tux_linux
Did you include skip or seek?


[2/18/2022 7:00â€¯PM] szybet
i included seek


[2/18/2022 7:00â€¯PM] tux_linux
strange then


[2/18/2022 7:00â€¯PM] tux_linux
idk


[2/18/2022 7:06â€¯PM] szybet
partitions are back


[2/18/2022 7:06â€¯PM] szybet
u-boot works


[2/18/2022 7:07â€¯PM] szybet
but the kernel does not boot


[2/18/2022 7:07â€¯PM] tux_linux
Oh...


[2/18/2022 7:07â€¯PM] szybet
oh i know


[2/18/2022 7:07â€¯PM] tux_linux
Strange


[2/18/2022 7:07â€¯PM] szybet
i had a custom one


[2/18/2022 7:07â€¯PM] tux_linux
Ah


[2/18/2022 7:07â€¯PM] szybet
i randomly copied 5 Mb of the boot sector


[2/18/2022 7:07â€¯PM] szybet
i think i cut the kernel in half


[2/18/2022 7:07â€¯PM] szybet
and the other half is the custom one


[2/18/2022 7:08â€¯PM] tux_linux
Whoops


[2/18/2022 7:08â€¯PM] szybet
30 Mb will be good then :D


[2/18/2022 7:20â€¯PM] szybet
the second option does not work either, but now i see the partition table


[2/18/2022 7:20â€¯PM] szybet
so u-boot does not work


[2/18/2022 7:20â€¯PM] szybet
hmm, maybe the config?


[2/18/2022 7:39â€¯PM] szybet
I the cmd in the oryginal u-boot, there were those commands, in the config they are off, so the config is wrong


[2/18/2022 7:39â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-2A0C9.png


[2/18/2022 7:40â€¯PM] tux_linux
config might be wrong, yes
Kobo doesn't always release the atomic copy of their sources trees


[2/18/2022 7:40â€¯PM] szybet
this is not cool


[2/18/2022 7:40â€¯PM] szybet
its very bad


[2/18/2022 7:40â€¯PM] tux_linux
yes it is


[2/18/2022 7:41â€¯PM] szybet
can i launch u-boot from u-boot?


[2/18/2022 7:41â€¯PM] tux_linux
yes


[2/18/2022 7:41â€¯PM] szybet
so i dont need to rewrite it every time


[2/18/2022 7:41â€¯PM] tux_linux
I think you need to load it to memory first, then `go <memory address>`


[2/18/2022 7:41â€¯PM] tux_linux
But maybe you can use download mode


[2/18/2022 7:41â€¯PM] szybet
i will download it using tftp


[2/18/2022 7:42â€¯PM] tux_linux
Is there a `download_mode` command in your U-Boot?


[2/18/2022 7:42â€¯PM] szybet
i checked the command


[2/18/2022 7:42â€¯PM] szybet
there were many of them, like tftp, usb, i2c, boot from usb etc


[2/18/2022 7:42â€¯PM] tux_linux
You have to use `uuu` to download U-Boot


[2/18/2022 7:42â€¯PM] tux_linux
https://github.com/NXPmicro/mfgtools

{Embed}
https://github.com/NXPmicro/mfgtools
GitHub - NXPmicro/mfgtools: Freescale/NXP I.MX Chip image deploy to...
Freescale/NXP I.MX Chip image deploy tools. Contribute to NXPmicro/mfgtools development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/mfgtools-4AE60


[2/18/2022 7:43â€¯PM] szybet
whots that?


[2/18/2022 7:43â€¯PM] tux_linux
An USB downloader


[2/18/2022 7:43â€¯PM] tux_linux
Takes U-Boot and writes it into the Nia's RAM


[2/18/2022 7:43â€¯PM] tux_linux
Then starts it


[2/18/2022 7:44â€¯PM] szybet
which command does this to ram?


[2/18/2022 7:44â€¯PM] tux_linux
`uuu u-boot.imx`


[2/18/2022 7:44â€¯PM] tux_linux
with sudo if required


[2/18/2022 7:44â€¯PM] szybet
and i think i can fastboot boot img?


[2/18/2022 7:45â€¯PM] tux_linux
Yes, but that is for the kernel only AFAIK


[2/18/2022 7:46â€¯PM] szybet
this command has not a good description


[2/18/2022 7:46â€¯PM] tux_linux
If there is no `download_mode` command in U-Boot, then you could enter this:
```
eBR-1A # mw 20d8040 30
eBR-1A # mw 20d8044 10000000
eBR-1A # reset
```
But I suggest you wait a bit; @andi might have some warnings since it's a different platform


[2/18/2022 7:47â€¯PM] tux_linux
Basically does "Take `u-boot.imx` file and load it in IMX USB device plugged in, then start it"


[2/18/2022 7:47â€¯PM] szybet
?... whots that


[2/18/2022 7:47â€¯PM] tux_linux
Basically `download_mode` without the actual command


[2/18/2022 7:47â€¯PM] szybet
:|


[2/18/2022 7:47â€¯PM] tux_linux
Writes to memory addresses


[2/18/2022 7:48â€¯PM] szybet
if it fails, it will reset?


[2/18/2022 7:48â€¯PM] szybet
i mean the u-boot


[2/18/2022 7:48â€¯PM] szybet
or i can just reboot it


[2/18/2022 7:48â€¯PM] szybet
nevermind


[2/18/2022 7:48â€¯PM] tux_linux
So that the SoC thinks there's a download mode pin activated until a complete hardware reset is done (power down, power up, not just `reset` in U-Boot)


[2/18/2022 7:49â€¯PM] tux_linux
No, you have to do the power-down-up sequence described before


[2/18/2022 7:49â€¯PM] tux_linux
But I suggest we wait for andi1 to give some advice
Maybe it could physically damage your device, I don't know


[2/18/2022 7:49â€¯PM] tux_linux
Otherwise, if you have the `download_mode` command, you can try that


[2/18/2022 7:49â€¯PM] szybet
i will not use those command, they feel dangerous


[2/18/2022 7:50â€¯PM] tux_linux
Well, we have to know if we're writing the right thing at the right place, after that we don't have to worry


[2/18/2022 7:50â€¯PM] tux_linux
Maybe you can try the tftp thing you were talking about


[2/18/2022 7:51â€¯PM] szybet
i dont know if a u-boot kernel will boot when it expects a normal kernel


[2/18/2022 7:51â€¯PM] szybet
but u-boot is linux too


[2/18/2022 7:51â€¯PM] szybet
Â¯\_(ãƒ„)_/Â¯


[2/18/2022 7:53â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-E78F5.png


[2/18/2022 7:53â€¯PM] szybet
does u-boot have wifi support?


[2/18/2022 7:53â€¯PM] szybet
nope


[2/18/2022 7:55â€¯PM] tux_linux
no


[2/18/2022 7:56â€¯PM] tux_linux
maybe you can load it on serial


[2/18/2022 7:56â€¯PM] tux_linux
loady


[2/18/2022 7:56â€¯PM] tux_linux
loadx


[2/18/2022 7:56â€¯PM] tux_linux
loadb


[2/18/2022 7:56â€¯PM] tux_linux
whatever


[2/18/2022 7:57â€¯PM] szybet
i readed smth in a wrong way


[2/18/2022 7:59â€¯PM] szybet
i tryied booting it using fastboot


[2/18/2022 7:59â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-D9638.png


[2/18/2022 7:59â€¯PM] szybet
data abort


[2/18/2022 7:59â€¯PM] szybet
whot does it mean


[2/18/2022 8:12â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-52EFB.png


[2/18/2022 8:13â€¯PM] szybet
and this hangs


[2/18/2022 8:26â€¯PM] tux_linux
I honestly don't know


[2/18/2022 8:26â€¯PM] tux_linux
Is the Kobo put in download mode?


[2/18/2022 8:26â€¯PM] tux_linux
(not fastboot)


[2/18/2022 8:27â€¯PM] szybet
you mean a command named download_mode


[2/18/2022 8:27â€¯PM] szybet
?


[2/18/2022 8:33â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-B7C8B.png


[2/18/2022 8:34â€¯PM] szybet
now, how do i launch it


[2/18/2022 8:34â€¯PM] tux_linux
yes


[2/18/2022 8:35â€¯PM] szybet
this command is missing


[2/18/2022 8:35â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-60CB0.png


[2/18/2022 8:35â€¯PM] szybet
i have those options


[2/18/2022 8:36â€¯PM] tux_linux
Honestly, I do not know for sure
Maybe `go 0x80800000`, assuming it's the address where it put the U-Boot


[2/18/2022 8:36â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-48C5E.png


[2/18/2022 8:36â€¯PM] szybet
its there


[2/18/2022 8:36â€¯PM] szybet
i will try it


[2/18/2022 8:36â€¯PM] tux_linux
ok, good address at least


[2/18/2022 8:37â€¯PM] tux_linux
I highly doubt it will work but you can try anyway


[2/18/2022 8:37â€¯PM] szybet
how do i know if its working


[2/18/2022 8:37â€¯PM] szybet
when my u-boot image is not working


[2/18/2022 8:37â€¯PM] tux_linux
you should see a log


[2/18/2022 8:38â€¯PM] szybet
where


[2/18/2022 8:38â€¯PM] tux_linux
Try with factory U-Boot


[2/18/2022 8:38â€¯PM] tux_linux
on serial


[2/18/2022 8:38â€¯PM] szybet
you mean?


[2/18/2022 8:38â€¯PM] tux_linux
Download the latest update zip from Kobo, and take the U-Boot in `upgrade/`


[2/18/2022 8:40â€¯PM] tux_linux
Try `0x17800000` maybe instead


[2/18/2022 8:41â€¯PM] tux_linux
https://stackoverflow.com/questions/45631141/u-boot-start-addressand-u-boot-imx-file-contains
According to this

{Embed}
https://stackoverflow.com/questions/45631141/u-boot-start-addressand-u-boot-imx-file-contains
U-boot start address?and u-boot.imx file contains?
I'm trying to understand embedded Linux principles and can't figure out addresses at u-boot output.

How can i find the starting address of U-boot?

For example, I have MX6-SabreSD board based on i...
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[2/18/2022 8:47â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-2942C.png


[2/18/2022 8:47â€¯PM] szybet
well, no


[2/18/2022 8:48â€¯PM] tux_linux
I guess the only option now would be to try the `mw` commands above
Or just flash U-Boot to the MMC with `skip=1`


[2/18/2022 8:51â€¯PM] szybet
1 i need to be sure thats this is safe*
2 i could, but i dont think getting it to work will be easy and fast, and unplugging the sd card from the inside many many times is not a good idea. the sd port could be damaged, the battery plug after many plug-unplug cykles too, and just tinkering with the inside is risky, there are ribbons, voltage to short


[2/18/2022 8:52â€¯PM] tux_linux
Well, once you get a working U-Boot, you can boot the kernel or flash it with fastboot


[2/18/2022 8:53â€¯PM] tux_linux
The goal is just to get it booting and have it loading the kernel at sector 81920 with 18432 load size


[2/18/2022 8:53â€¯PM] tux_linux
Ooooh


[2/18/2022 8:53â€¯PM] tux_linux
Maybe


[2/18/2022 8:53â€¯PM] tux_linux (pinned)
`ums 0 mmc 0`


[2/18/2022 8:53â€¯PM] tux_linux
Does that work?


[2/18/2022 8:53â€¯PM] tux_linux
Should export entire MMC over USB as a block device


[2/18/2022 8:54â€¯PM] szybet
and maybee adding some features to it to make usb to work

{Reactions}
ğŸ‘ 

[2/18/2022 8:55â€¯PM] szybet
yes


[2/18/2022 8:55â€¯PM] szybet
but


[2/18/2022 8:55â€¯PM] szybet
whot now?


[2/18/2022 8:56â€¯PM] szybet
if i overwrite the bootloader and its bircked i will need to open the device


[2/18/2022 9:19â€¯PM] szybet
it isin't possible?


[2/18/2022 9:19â€¯PM] szybet
https://stackoverflow.com/questions/31248779/boot-u-boot-from-ram-using-u-boot

{Embed}
https://stackoverflow.com/questions/31248779/boot-u-boot-from-ram-using-u-boot
Boot U-boot from RAM using U-boot
I would like to boot an U-boot image from RAM using another U-boot. I loaded the U-boot image in the RAM using tftp tftp 0x90000000 u-boot.img and tried to run it with go 0x90000000 but nothing hap...
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[2/18/2022 9:20â€¯PM] tux_linux
Welp, maybe not


[2/18/2022 9:20â€¯PM] tux_linux
yes


[2/18/2022 9:20â€¯PM] tux_linux
But once you have a working bootloader you won't need to open it ever again


[2/18/2022 9:22â€¯PM] szybet
i writed here


[2/18/2022 9:22â€¯PM] szybet
i would like to avoid that...


[2/18/2022 9:22â€¯PM] szybet
https://stackoverflow.com/questions/53058002/imx6-get-u-boot-to-temporarily-boot-another-u-boot

{Embed}
https://stackoverflow.com/questions/53058002/imx6-get-u-boot-to-temporarily-boot-another-u-boot
iMX6 get U-Boot to temporarily boot another U-Boot
First some background:
We have the following setup in our iMX6-based embedded system. There are two U-Boot partitions and two system (Linux) partitions. Currently we use only the first U-Boot parti...
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[2/18/2022 9:22â€¯PM] szybet
maybe it is possible?


[2/18/2022 9:22â€¯PM] szybet
bruh


[2/18/2022 9:23â€¯PM] tux_linux
sunxi boards have an U-Boot which loads another U-Boot, it's called U-Boot SPL.
I don't know if it is possible on i.MX though...


[2/18/2022 9:24â€¯PM] szybet
couldn't i write a second u-boot somewhere on the sd card and boot it then?


[2/18/2022 9:24â€¯PM] tux_linux
no


[2/18/2022 9:24â€¯PM] szybet
i dont need the partition, i want to get the bootloader to work


[2/18/2022 9:24â€¯PM] tux_linux
The load address is hardcoded in the SoC


[2/18/2022 9:24â€¯PM] szybet
and i could't boot from uboot then?


[2/18/2022 9:25â€¯PM] tux_linux
Did you try to flash it with `dd if=u-boot.bin of=/dev/mmcblk0 bs=1K seek=1 skip=1`?


[2/18/2022 9:25â€¯PM] tux_linux
When it is powered on, the SoC searches for something at sector 0x400 of the MMC, which is 1K. If it doesn't find anything there, it won't boot.


[2/18/2022 9:26â€¯PM] szybet
i think yes


[2/18/2022 9:26â€¯PM] szybet
thats not the problem


[2/18/2022 9:26â€¯PM] tux_linux
Ok, so compiler/source/other issue then


[2/18/2022 9:27â€¯PM] szybet
to resolve it i would prefer not to unplug the sd card every time


[2/18/2022 9:28â€¯PM] tux_linux
On all my Kobos, I have plugged/unplugged the SD card countless times (like, really a lot, 5-10 times/day for 6 months) and they still work


[2/18/2022 9:28â€¯PM] tux_linux
I don't know how the Nia's slot is, but on the ones I have it is quite sturdy


[2/18/2022 9:28â€¯PM] szybet
shorting / a capacitor could fell off


[2/18/2022 9:28â€¯PM] szybet
:/


[2/18/2022 9:29â€¯PM] tux_linux
It never happened to me either


[2/18/2022 9:29â€¯PM] szybet
good, but its a risk


[2/18/2022 9:29â€¯PM] szybet
i dont like risk


[2/18/2022 9:29â€¯PM] tux_linux
And the number of times I've let my serial line, or my VCC line fall on the Kobo mainboard is quite high too, all works fine after that though


[2/18/2022 9:30â€¯PM] szybet
its risk too


[2/18/2022 9:30â€¯PM] szybet
hmm, now look at this


[2/18/2022 9:30â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-EF189.png


[2/18/2022 9:30â€¯PM] szybet
i used the dd there


[2/18/2022 9:30â€¯PM] tux_linux
You can take Clay Tack and create a small patch of it, then take out the SD with it


[2/18/2022 9:31â€¯PM] szybet
it hanged after it


[2/18/2022 9:31â€¯PM] szybet
bruh


[2/18/2022 9:31â€¯PM] tux_linux
I guess it really didn't know how to handle that file, so it just reset instead of outputting data abort errors


[2/18/2022 9:32â€¯PM] szybet
then there would be data error, or smth like that


[2/18/2022 9:32â€¯PM] szybet
and this looks like it booted but then hang


[2/18/2022 9:32â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20220218_203224660-8078B.jpg


[2/18/2022 9:32â€¯PM] tux_linux
Maybe not


[2/18/2022 9:33â€¯PM] szybet
We know this is the newer UBoot simply because the normal one we're using outputs an October date rather than a November one.

Unfotunately, it hangs at that point, with the watchdog timer eventually kicking in and rebooting back to the original UBoot but I suspect that has to do with UBoot not liking the current state of the device (i.e., it doesn't like initialising it twice).

So we'll have to figure out how to convince it to do so but at least we've gotten it booting another copy of itself, which is what the question was about.


[2/18/2022 9:33â€¯PM] tux_linux
Clay Tack really works well to attach/detach MMC


[2/18/2022 9:33â€¯PM] szybet
oh no... ;/


[2/18/2022 9:33â€¯PM] tux_linux
Then download mode is really the last option


[2/18/2022 9:34â€¯PM] szybet
well yes the sd card isin't that much of a problem


[2/18/2022 9:34â€¯PM] szybet
but look at this


[2/18/2022 9:34â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-B777E.png


[2/18/2022 9:34â€¯PM] szybet
this connector with a chip on it


[2/18/2022 9:34â€¯PM] szybet
eassly to damage


[2/18/2022 9:35â€¯PM] szybet
i would really really prefer not to open it every time


[2/18/2022 9:35â€¯PM] tux_linux
Maybe you can just leave the back over off?


[2/18/2022 9:35â€¯PM] tux_linux
Once I open my Kobos they don't get closed before a long time ;p


[2/18/2022 9:36â€¯PM] szybet
its risky to the connector


[2/18/2022 9:37â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220218_213615-B40D7.jpg


[2/18/2022 9:37â€¯PM] szybet
i dont close it for now, just some rubber bands


[2/18/2022 9:38â€¯PM] szybet
lets try from the other site, why does inkbox need to change those memory locations


[2/18/2022 9:38â€¯PM] szybet
if its bigger, then why? could't it fit?


[2/18/2022 9:38â€¯PM] szybet
maybe do some kernel options as modules, they are stored in the initframs


[2/18/2022 9:38â€¯PM] tux_linux
Because otherwise it overwrites the waveform


[2/18/2022 9:39â€¯PM] szybet
whots waveform in the kobo


[2/18/2022 9:39â€¯PM] tux_linux
= display completely stops working


[2/18/2022 9:39â€¯PM] szybet
and this idea?


[2/18/2022 9:39â€¯PM] tux_linux
What do you mean?


[2/18/2022 9:40â€¯PM] szybet
the kernel is too big, right?


[2/18/2022 9:40â€¯PM] tux_linux
yes


[2/18/2022 9:40â€¯PM] szybet
then compile more modules, the are stored in the initframs


[2/18/2022 9:40â€¯PM] tux_linux
~8MB on a Wi-Fi device


[2/18/2022 9:41â€¯PM] szybet
?


[2/18/2022 9:41â€¯PM] tux_linux
The thing is that the modules are embedded in the initramfs


[2/18/2022 9:41â€¯PM] tux_linux
in a squashfs


[2/18/2022 9:41â€¯PM] szybet
thats the point


[2/18/2022 9:41â€¯PM] tux_linux
So that I don't have to mess up on the rootfs to setup the right modules for each devices


[2/18/2022 9:41â€¯PM] tux_linux
yes


[2/18/2022 9:41â€¯PM] tux_linux
If I compile more modules, it will only make matters worse


[2/18/2022 9:42â€¯PM] szybet
i mean


[2/18/2022 9:42â€¯PM] szybet
compile things in the kernel as modules


[2/18/2022 9:42â€¯PM] szybet
the kernel will be smaller


[2/18/2022 9:42â€¯PM] tux_linux
no


[2/18/2022 9:42â€¯PM] tux_linux
because the initramfs is embedded in the kernel


[2/18/2022 9:43â€¯PM] szybet
whot... how... why...


[2/18/2022 9:43â€¯PM] tux_linux
Because it is possible


[2/18/2022 9:44â€¯PM] szybet
if it wasn't like that it could work without modyfication


[2/18/2022 9:44â€¯PM] szybet
i dont know if it must be like that


[2/18/2022 9:44â€¯PM] tux_linux
Maybe another option would be to load the kernel from a partition
But I think the vendor U-Boot prevents that and loads it from the unpartitioned space anyway


[2/18/2022 9:45â€¯PM] tux_linux
You can try


[2/18/2022 9:45â€¯PM] tux_linux
`extload` command


[2/18/2022 9:45â€¯PM] tux_linux
But at this point, there's got to be a way to compile U-Boot
I mean, it's not possible that it can't work


[2/18/2022 9:46â€¯PM] tux_linux
Did you try flashing Kobo's provided U-Boot to your MMC? Does that work?


[2/18/2022 9:46â€¯PM] szybet
i think yes, but i will try it one more time to be sure


[2/18/2022 9:47â€¯PM] tux_linux
Be sure to flash this file
`upgrade/mx6ull-ntx/u-boot-mx6ull-E60U20-LPDDR2-256MB.imx`


[2/18/2022 9:47â€¯PM] tux_linux
`dd if=u-boot-mx6ull-E60U20-LPDDR2-256MB.imx of=/dev/mmcblk0 bs=1K seek=1 skip=1`


[2/18/2022 9:47â€¯PM] szybet
yes i use this


[2/18/2022 9:47â€¯PM] tux_linux
And it doesn't work?


[2/18/2022 9:49â€¯PM] szybet
i think it worked, i will try it now

{Reactions}
ğŸ‘ 

[2/18/2022 9:56â€¯PM] szybet
it does not work?


[2/18/2022 9:57â€¯PM] szybet
thats... weird?


[2/18/2022 9:57â€¯PM] tux_linux
Yes it is


[2/18/2022 9:57â€¯PM] tux_linux
So maybe what you compiled was good


[2/18/2022 9:57â€¯PM] szybet
no, i restored it to work by dd 30M of the sd image


[2/18/2022 9:58â€¯PM] szybet
so the old is working


[2/18/2022 9:58â€¯PM] tux_linux
Yes, but if the provided official one does not work, there is a problem


[2/18/2022 9:58â€¯PM] szybet
but if i try to flash it kills himself


[2/18/2022 9:58â€¯PM] szybet
https://github.com/Szybet/kobo-nia-audio/blob/main/files-from-device/init.d/upgrade-generic.sh

{Embed}
https://github.com/Szybet/kobo-nia-audio/blob/main/files-from-device/init.d/upgrade-generic.sh
kobo-nia-audio/upgrade-generic.sh at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/18/2022 9:58â€¯PM] tux_linux
what--


[2/18/2022 9:58â€¯PM] szybet
here is literally the update script


[2/18/2022 9:58â€¯PM] szybet
it just bricks


[2/18/2022 9:58â€¯PM] tux_linux
oh the device


[2/18/2022 9:59â€¯PM] tux_linux
when you reboot it you mean?


[2/18/2022 9:59â€¯PM] szybet
yes


[2/18/2022 10:00â€¯PM] tux_linux
that's really strange


[2/18/2022 10:03â€¯PM] szybet
i will copy the bricked fragment and look at the hex

{Reactions}
ğŸ‘ 

[2/18/2022 10:15â€¯PM] szybet
i dont know how to show this to you

{Attachments}
/mnt/data/projects/git/conversations/media/Peek_2022-02-18_22-14-C9E7D.gif


[2/18/2022 10:15â€¯PM] szybet
but in the working one there is some data before the u-boot


[2/18/2022 10:15â€¯PM] szybet
and the not working one does not


[2/18/2022 10:16â€¯PM] szybet
click watch oryginal for better wiev


[2/18/2022 10:16â€¯PM] tux_linux
I don't really know what to say


[2/18/2022 10:16â€¯PM] tux_linux
There seem to be differences between the two


[2/18/2022 10:16â€¯PM] tux_linux
But I can't interpret them


[2/18/2022 10:18â€¯PM] szybet
there are maybe diffrent u-boot versions, but the concerning thing is the data that isin't in the bricked


[2/18/2022 10:18â€¯PM] szybet
its maybe a header for the cpu, to check for something


[2/18/2022 10:19â€¯PM] szybet
like, android devices kernels need special headers to boot


[2/18/2022 10:28â€¯PM] szybet
hmm... @andi  so whot about the download mode?


[2/18/2022 10:29â€¯PM] szybet
i mean this


[2/18/2022 11:23â€¯PM] szybet
im dumb


[2/18/2022 11:23â€¯PM] szybet
i figured it out


[2/18/2022 11:23â€¯PM] szybet
i can now write using dd


[2/18/2022 11:23â€¯PM] szybet
the command is dd if=$UBOOT of=/dev/$DEVICE bs=1K seek=1 without skip


[2/18/2022 11:59â€¯PM] szybet
**the custom kernel is working, i needed to use the .imx file**


[2/19/2022 12:39â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-16E8A.png


[2/19/2022 4:49â€¯AM] tux_linux
So what was the problem?


[2/19/2022 4:49â€¯AM] tux_linux
Nice!


[2/19/2022 11:04â€¯AM] szybet
1 the command was wrong, **without skip, not with it**
2 idk, why when i tested without skip it erased the dos, maybe the sd card reader was faulty this one time
3 i needed to use the compiled .imx file, not been like you said

{Reactions}
ğŸ‘ 

[2/19/2022 1:40â€¯PM] szybet
ok, now im waiting for instructions whot to change in the kernel and bootloader


[2/19/2022 1:40â€¯PM] szybet
and how to install inkbox


[2/19/2022 3:50â€¯PM] andi15701
generally abut uboot and skip: if the uboot.imx binary starts with  zeros, you need the skip


[2/19/2022 3:50â€¯PM] andi15701
if not, you do not need it


[2/19/2022 3:50â€¯PM] szybet
? its working now


[2/19/2022 3:51â€¯PM] szybet
it is working


[2/19/2022 3:51â€¯PM] szybet
thats the point now


[2/19/2022 3:51â€¯PM] szybet
maybe the bin file would work too


[2/19/2022 3:51â€¯PM] szybet
idk


[2/19/2022 3:51â€¯PM] andi15701
no


[2/19/2022 3:51â€¯PM] szybet
good to notice


[2/19/2022 3:52â€¯PM] andi15701
that download mode needs the uboot.imx without all that leading zeros


[2/19/2022 3:52â€¯PM] szybet
i dont have the command for download mode


[2/19/2022 3:55â€¯PM] szybet
and i didn't saw a option for it in the config by menuconfig?


[2/19/2022 3:55â€¯PM] andi15701
that stone-age 2009.08 kobo-patched uboot prepends the zeros in the build process, and fastboot flash bootloader strips them. Later uboots do not prepend that zeros.

{Reactions}
ğŸ‘ 

[2/19/2022 3:55â€¯PM] andi15701
seems not to be there in newer uboots


[2/19/2022 3:56â€¯PM] szybet
okay


[2/19/2022 3:56â€¯PM] andi15701
but you can do the two magic mw commands


[2/19/2022 3:56â€¯PM] szybet
are they safe?***


[2/19/2022 3:56â€¯PM] andi15701
i will check for the 6ull


[2/19/2022 3:56â€¯PM] szybet
hm? how?


[2/19/2022 3:57â€¯PM] andi15701
I will check the data sheet of the SoC

{Reactions}
ğŸ‘ 

[2/19/2022 3:57â€¯PM] szybet
oh, cool


[2/19/2022 3:57â€¯PM] andi15701
for the 6sl and 6sll they are safe


[2/19/2022 3:57â€¯PM] andi15701
just writing to some volatile registers


[2/19/2022 3:57â€¯PM] andi15701
which get reset on some power cycle


[2/19/2022 3:57â€¯PM] szybet
@tux-linux you could describe the steps to install inkbox, I can now compile the kernel and u-boot


[2/19/2022 3:59â€¯PM] tux_linux
It's really more like doing it as we go, there isn't a premade manual or anything
You can look at the Libra H2O porting thread to get an idea


[2/19/2022 3:59â€¯PM] szybet
hmm, okay


[2/19/2022 4:00â€¯PM] tux_linux
I'll guide you
I'll be ready in some 10mins


[2/19/2022 4:00â€¯PM] szybet
sure i will wait


[2/19/2022 4:09â€¯PM] tux_linux
So you got a kernel compiled, and it works, right?


[2/19/2022 4:09â€¯PM] szybet
i have compiled many kernels, the work


[2/19/2022 4:10â€¯PM] szybet
so yes


[2/19/2022 4:10â€¯PM] tux_linux
in the kobo you mean?


[2/19/2022 4:10â€¯PM] tux_linux
because sometimes they are finicky about compiler used


[2/19/2022 4:10â€¯PM] szybet
for the kobo, yes


[2/19/2022 4:10â€¯PM] szybet
i tryied to make usb host to work, so i compiled many of them


[2/19/2022 4:10â€¯PM] tux_linux
ok nice


[2/19/2022 4:11â€¯PM] tux_linux
So what I'll first do will be to integrate the vendor sources into InkBox kernel tree


[2/19/2022 4:12â€¯PM] szybet
hmm okay


[2/19/2022 4:12â€¯PM] tux_linux
Did you modify anything to get it working, or it compiled and started fine out of the box?


[2/19/2022 4:12â€¯PM] szybet
look here


[2/19/2022 4:12â€¯PM] szybet
https://github.com/Szybet/kobo-nia-audio/blob/main/links.md

{Embed}
https://github.com/Szybet/kobo-nia-audio/blob/main/links.md
kobo-nia-audio/links.md at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/19/2022 4:12â€¯PM] szybet
Fixes first 2 points


[2/19/2022 4:13â€¯PM] szybet
maybe your toolchains are also ok, idk


[2/19/2022 4:13â€¯PM] tux_linux
Does it work if you try to compile with `armv7l-linux-musleabihf`?


[2/19/2022 4:13â€¯PM] szybet
i didn't tryied it


[2/19/2022 4:13â€¯PM] szybet
i can now if you want


[2/19/2022 4:14â€¯PM] tux_linux
yes, sometimes they compile fine but they don't boot


[2/19/2022 4:14â€¯PM] tux_linux
so ideally try to start it on the Kobo too


[2/19/2022 4:27â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-96C9B.txt


[2/19/2022 4:27â€¯PM] szybet
it does not work


[2/19/2022 4:31â€¯PM] tux_linux
You said it is Linux 4.1.15?


[2/19/2022 4:31â€¯PM] szybet
yes


[2/19/2022 4:33â€¯PM] tux_linux
Can you try with `arm-nickel-linux-gnueabihf`?


[2/19/2022 4:33â€¯PM] szybet
one sec


[2/19/2022 4:33â€¯PM] tux_linux
I know it is GCC 4.9, but it seems to compile fine my Libra's kernel which is also 4.1.15


[2/19/2022 4:35â€¯PM] tux_linux
Also, does your Nia have any other physical buttons somewhere or do you only have the power button?


[2/19/2022 4:35â€¯PM] szybet
ony the power button


[2/19/2022 4:37â€¯PM] tux_linux
ok


[2/19/2022 4:37â€¯PM] tux_linux
The Wi-Fi device uses 8189fs module I guess


[2/19/2022 4:38â€¯PM] tux_linux
Do you have a picture of the PCB?


[2/19/2022 4:38â€¯PM] szybet
something like this, look here to be sure https://github.com/Szybet/kobo-nia-audio/tree/main/logs

{Embed}
https://github.com/Szybet/kobo-nia-audio/tree/main/logs
kobo-nia-audio/logs at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/19/2022 4:39â€¯PM] szybet
i have, i will upload them to github, one sec


[2/19/2022 4:39â€¯PM] szybet
it compiled with nickel, i will flash it and try


[2/19/2022 4:40â€¯PM] tux_linux
it is, thanks
the `RTL871X` gives it away


[2/19/2022 4:46â€¯PM] szybet
https://github.com/Szybet/kobo-nia-audio/tree/main/images/nia

{Embed}
https://github.com/Szybet/kobo-nia-audio/tree/main/images/nia
kobo-nia-audio/images/nia at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/19/2022 4:46â€¯PM] szybet
here are the images


[2/19/2022 4:46â€¯PM] szybet
why do you need them?


[2/19/2022 4:51â€¯PM] tux_linux
well it was to verify the wi-fi chip but actually the dmesg logs were convincing enough


[2/19/2022 4:51â€¯PM] tux_linux
But it will be useful anyway for future reference


[2/19/2022 4:52â€¯PM] tux_linux
@andi will probably be interested to look at them


[2/19/2022 4:52â€¯PM] szybet
maybe andi1 could help me with usb host? :D


[2/19/2022 4:52â€¯PM] szybet
actually who is andi1


[2/19/2022 4:52â€¯PM] tux_linux
Andreas Kemnade


[2/19/2022 4:53â€¯PM] tux_linux
https://github.com/akemnade/linux

{Embed}
https://github.com/akemnade/linux
GitHub - akemnade/linux: Linux kernel source tree
Linux kernel source tree. Contribute to akemnade/linux development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/linux-36D55


[2/19/2022 4:53â€¯PM] szybet
like, he has the datasheets of cpus


[2/19/2022 4:53â€¯PM] tux_linux
He ported Linux 5.16 to other Kobos


[2/19/2022 4:53â€¯PM] szybet
wow, really :O?


[2/19/2022 4:54â€¯PM] szybet
It would be nice if nia would have the kernel 5.16


[2/19/2022 4:54â€¯PM] szybet
i could do that, but i dont know how


[2/19/2022 4:54â€¯PM] szybet
i dont know cpp or c, so im out propably


[2/19/2022 4:55â€¯PM] tux_linux
He's already made a test branch for Aura SE (vendor kernel initially at 3.0.35) which I didn't have the time to try yet...
Hopefully today


[2/19/2022 5:00â€¯PM] szybet
@tux-linux nickel booted


[2/19/2022 5:00â€¯PM] szybet
from where did you get this toolchain? why is it named nickel


[2/19/2022 5:01â€¯PM] tux_linux
It's from @pgaskin


[2/19/2022 5:01â€¯PM] tux_linux
nice


[2/19/2022 5:01â€¯PM] szybet
and he is?


[2/19/2022 5:01â€¯PM] tux_linux
https://github.com/pgaskin/NickelTC

{Embed}
https://github.com/pgaskin/NickelTC
GitHub - pgaskin/NickelTC: A dockerized, deterministic, automated, ...
A dockerized, deterministic, automated, fixed, and fully-relocatable build of @NiLuJe&#39;s toolchain for Kobo eReaders. - GitHub - pgaskin/NickelTC: A dockerized, deterministic, automated, fix...
/mnt/data/projects/git/conversations/media/NickelTC-144E0


[2/19/2022 5:01â€¯PM] szybet
oh this


[2/19/2022 5:01â€¯PM] tux_linux
He created NickelMenu


[2/19/2022 5:01â€¯PM] szybet
wow :O


[2/19/2022 5:01â€¯PM] szybet
nickelmenu is awesome, like how did he hacked into kobo program


[2/19/2022 5:02â€¯PM] tux_linux
Patch the binary


[2/19/2022 5:02â€¯PM] szybet
?


[2/19/2022 5:02â€¯PM] tux_linux
Well, instead of writing code, patching in binary data


[2/19/2022 5:02â€¯PM] szybet
??...


[2/19/2022 5:02â€¯PM] tux_linux
I don't know more, my knowledge of binary patching stops here ğŸ˜„


[2/19/2022 5:02â€¯PM] szybet
binary patching


[2/19/2022 5:03â€¯PM] szybet
i hear it first time


[2/19/2022 5:03â€¯PM] tux_linux
Take a hex editor and replace bits


[2/19/2022 5:03â€¯PM] szybet
oh no


[2/19/2022 5:03â€¯PM] szybet
no no


[2/19/2022 5:03â€¯PM] tux_linux
And you can change the behavior of a program I guess


[2/19/2022 5:03â€¯PM] szybet
yes but... its nearly impossible


[2/19/2022 5:03â€¯PM] szybet
like, some variables ok


[2/19/2022 5:03â€¯PM] szybet
but not an entire menu


[2/19/2022 5:04â€¯PM] tux_linux
Well, ask him, he will probably have more info than me on this


[2/19/2022 5:04â€¯PM] szybet
if he reads it, he can answer


[2/19/2022 5:04â€¯PM] szybet
ok, the toolchain works, now whot


[2/19/2022 5:04â€¯PM] tux_linux
`git pull` the kernel repo


[2/19/2022 5:05â€¯PM] tux_linux
Added Nia sources and scripts to make it work with InkBox build https://github.com/Kobo-InkBox/kernel/commit/069fc2fb3f7544d7b93bd07489af071961d8f958


[2/19/2022 5:05â€¯PM] tux_linux
```env GITDIR=/home/build/inkbox/kernel TOOLCHAINDIR=/home/build/inkbox/kernel/toolchain/arm-nickel-linux-gnueabihf/ THREADS=16 TARGET=arm-nickel-linux-gnueabihf scripts/build_kernel.sh n306 root```


[2/19/2022 5:05â€¯PM] tux_linux
Change env vars depending on where you cloned the repo


[2/19/2022 5:06â€¯PM] tux_linux
I strongly suggest you simply put the repo in `/home/build/inkbox/kernel`


[2/19/2022 5:06â€¯PM] pgaskin
the entity replying to your message


[2/19/2022 5:07â€¯PM] szybet
:D


[2/19/2022 5:07â€¯PM] pgaskin
naa, that's kobopatch


[2/19/2022 5:07â€¯PM] tux_linux
Oh sorry then
But kobopatch must be related to NickelMenu in some way, right?


[2/19/2022 5:07â€¯PM] pgaskin
he didn't (except for when he worked on the dictionary encryption in dictutil)


[2/19/2022 5:08â€¯PM] pgaskin
completely separate


[2/19/2022 5:08â€¯PM] tux_linux
Well, NickelHook does hack into the program


[2/19/2022 5:08â€¯PM] tux_linux
hmm ok


[2/19/2022 5:08â€¯PM] pgaskin
technically


[2/19/2022 5:09â€¯PM] szybet
whot is this program doing


[2/19/2022 5:09â€¯PM] tux_linux
Is it like an LD_PRELOAD trick that hijacks the QPA and Nickel?


[2/19/2022 5:10â€¯PM] tux_linux
This should give you a small kernel that can still boot Nickel in `kernel/out/n306/zImage-root`
Try it and report back if it boots


[2/19/2022 5:11â€¯PM] szybet
do i need to change n306 and root at the end to smth else?


[2/19/2022 5:11â€¯PM] tux_linux
no


[2/19/2022 5:11â€¯PM] tux_linux
just `dd if=zImage-root of=/dev/mmcblk0 bs=512 seek=2048`


[2/19/2022 5:12â€¯PM] tux_linux
I'll also grab U-Boot sources and put them into the tree as well


[2/19/2022 5:12â€¯PM] szybet
n306 is nia codename?


[2/19/2022 5:14â€¯PM] tux_linux
yes


[2/19/2022 5:15â€¯PM] szybet
@tux-linux how many changes were needed for the kernel aside from the oryginal? are there enabled chipidea controllers, and usb host support? is it the same kernel version?


[2/19/2022 5:16â€¯PM] tux_linux
For InkBox?
Nothing, usually


[2/19/2022 5:16â€¯PM] tux_linux
I only modify the kernel config


[2/19/2022 5:16â€¯PM] tux_linux
not the code


[2/19/2022 5:16â€¯PM] szybet
i mean the kernel config


[2/19/2022 5:16â€¯PM] tux_linux
unless there's something really messed up


[2/19/2022 5:16â€¯PM] szybet
whot was there edited


[2/19/2022 5:16â€¯PM] tux_linux
oh; well namely, you have to enable loopback device support, FUSE, squashFS and other things


[2/19/2022 5:18â€¯PM] tux_linux
i'll do that for you


[2/19/2022 5:18â€¯PM] tux_linux
But once I set up the config, Nickel won't boot anymore since InkBox is a completely different infrastructure


[2/19/2022 5:18â€¯PM] szybet
i dont care


[2/19/2022 5:18â€¯PM] szybet
inkbox has usbutils by default, i think


[2/19/2022 5:18â€¯PM] szybet
thats more important


[2/19/2022 5:20â€¯PM] szybet
linux booted, kernel too

{Reactions}
ğŸ‘ 

[2/19/2022 5:27â€¯PM] tux_linux
No?


[2/19/2022 5:28â€¯PM] szybet
whots this


[2/19/2022 5:28â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-8A252.png


[2/19/2022 5:29â€¯PM] tux_linux
Alpine default


[2/19/2022 5:29â€¯PM] tux_linux
Well maybe you can do something with it


[2/19/2022 5:29â€¯PM] tux_linux
`mx6ull_ntx_lpddr2_256m_defconfig` so that U-Boot config worked?


[2/19/2022 5:30â€¯PM] pgaskin
yes


[2/19/2022 5:31â€¯PM] tux_linux
oh nice


[2/19/2022 5:31â€¯PM] szybet
yes


[2/19/2022 5:31â€¯PM] szybet
well.... it will be easier to install libusb on your open source system that on kobo's default one


[2/19/2022 5:32â€¯PM] tux_linux
maybe not


[2/19/2022 5:32â€¯PM] tux_linux
Have you looked on how InkBox OS root filesystem is mounted at boot?


[2/19/2022 5:32â€¯PM] tux_linux
It's a read-only squashFS archive


[2/19/2022 5:32â€¯PM] tux_linux
It can be made read-write with overlayfs-fuse though


[2/19/2022 5:33â€¯PM] tux_linux
So actually yes, according to your recent enough kernel version you should be able to install things without issue


[2/19/2022 5:33â€¯PM] szybet
yea, and most imporant, kobo is making some weird udev parkour with usb, i tryied to disable it but with no success i think


[2/19/2022 5:33â€¯PM] tux_linux
You have to use the `--no-cache` option of `apk` to install packages though, otherwise it won't work


[2/19/2022 5:33â€¯PM] szybet
on your system i can see everything

{Reactions}
ğŸ‘ 

[2/19/2022 5:33â€¯PM] szybet
does it have a package manager???


[2/19/2022 5:34â€¯PM] tux_linux
yes, it's based on Alpine Linux


[2/19/2022 5:34â€¯PM] szybet
oh god thanks


[2/19/2022 5:34â€¯PM] szybet
and oh god no


[2/19/2022 5:34â€¯PM] tux_linux
But it's an outdated version


[2/19/2022 5:34â€¯PM] tux_linux
Alpine 3.10 from 2019


[2/19/2022 5:34â€¯PM] szybet
i installed alpine on my tablet and use it as a small server


[2/19/2022 5:34â€¯PM] szybet
and installing software on it was pain


[2/19/2022 5:34â€¯PM] szybet
why no cache?


[2/19/2022 5:35â€¯PM] tux_linux
If I used more recent versions of Alpine on devices with 2.6.35.3 kernels (>70% of supported devices), all (literally) binaries segfaulted and I couldn't get the system to work


[2/19/2022 5:35â€¯PM] tux_linux
no idea


[2/19/2022 5:35â€¯PM] tux_linux
It doesn't work if I omit it


[2/19/2022 5:36â€¯PM] szybet
weird


[2/19/2022 5:36â€¯PM] szybet
do you know why?


[2/19/2022 5:37â€¯PM] tux_linux
well, running a 2021 system on a 12 year old kernel isn't a good idea from the start


[2/19/2022 5:37â€¯PM] szybet
true


[2/19/2022 5:37â€¯PM] tux_linux
Interestingly enough, when you compiled latest musl and busybox yourself, it ran without issue


[2/19/2022 5:37â€¯PM] tux_linux
So I tried to recompile all the Alpine packages on a Raspberry Pi but it ended up being waaaay too much work


[2/19/2022 5:38â€¯PM] szybet
also, why squashfs filesyste?


[2/19/2022 5:38â€¯PM] szybet
true, its too much effort. 2019 is good


[2/19/2022 5:38â€¯PM] tux_linux
1. Saves space
2. Read-only, if you set it to read-write you just delete the overlayfs cache to have a clean rootfs again
3. No MMC writes unless you have read-write enabled (well, read-only mount on standard partition works too, but squashfs is even better)


[2/19/2022 5:39â€¯PM] szybet
right


[2/19/2022 5:39â€¯PM] tux_linux
Also, it is oh-so-helpful for updates


[2/19/2022 5:39â€¯PM] szybet
the only downside is that is not so easy to install software on it


[2/19/2022 5:39â€¯PM] tux_linux
You just put a rootfs.squashfs file in the update package and scripts handle this for you


[2/19/2022 5:40â€¯PM] tux_linux
Well, overlayfs on newer devices like the Nia, Clara HD, Libra, makes this painless


[2/19/2022 5:40â€¯PM] tux_linux
`ifsctl mnt rootfs rw` and you're good to go


[2/19/2022 5:40â€¯PM] szybet
whot about running somethink like this? https://github.com/baskerville/plato

{Embed}
https://github.com/baskerville/plato
GitHub - baskerville/plato: Document reader
Document reader. Contribute to baskerville/plato development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/plato-BAE91


[2/19/2022 5:41â€¯PM] szybet
i think without issue?


[2/19/2022 5:41â€¯PM] tux_linux
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/update.sh
Update script

{Embed}
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/update.sh
rootfs/update.sh at master Â· Kobo-InkBox/rootfs
InkBox OS root filesystem. Contribute to Kobo-InkBox/rootfs development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/rootfs-50853


[2/19/2022 5:41â€¯PM] tux_linux
why would you want to do that?


[2/19/2022 5:41â€¯PM] szybet
i can program in rust, and its written in rust


[2/19/2022 5:41â€¯PM] szybet
and its super fast


[2/19/2022 5:41â€¯PM] tux_linux
But InkBox **already** has a built-in ebook reader!


[2/19/2022 5:42â€¯PM] tux_linux
I did not make InkBox so that people could install KOReader and Plato on it


[2/19/2022 5:42â€¯PM] szybet
if it will be realy good i will need to learn cpp!


[2/19/2022 5:42â€¯PM] szybet
thats true


[2/19/2022 5:42â€¯PM] tux_linux
It's not that hard


[2/19/2022 5:43â€¯PM] szybet
for whot are we waiting for?


[2/19/2022 5:43â€¯PM] szybet
to install inkbox on nia


[2/19/2022 5:43â€¯PM] szybet
i programmed some arduinos, stm32 with cpp and it was sometimes pain, rust is easier


[2/19/2022 5:43â€¯PM] tux_linux
compile u-boot


[2/19/2022 5:43â€¯PM] tux_linux
will be there in a moment


[2/19/2022 5:43â€¯PM] tux_linux
with modified code


[2/19/2022 5:44â€¯PM] szybet
i need to do it?


[2/19/2022 5:44â€¯PM] szybet
compile u-boot with nickel?


[2/19/2022 5:45â€¯PM] tux_linux
yes, to change kernel sector to 81920 and load size to 18432


[2/19/2022 5:45â€¯PM] tux_linux
`git pull` and compile U-Boot in `bootloader/mx6ull-n306/`


[2/19/2022 5:49â€¯PM] szybet
it isin't in the config, right?


[2/19/2022 5:49â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel/commit/eee6be472914973e15dc6edbb7de4dd20ae0cc1f

{Embed}
https://github.com/Kobo-InkBox/kernel/commit/eee6be472914973e15dc6edbb7de4dd20ae0cc1f
N306: Change kernel load sector & size Â· Kobo-InkBox/kernel@eee6be4
/mnt/data/projects/git/conversations/media/eee6be472914973e15dc6edbb7de4dd20ae0cc1f-BFFF7


[2/19/2022 5:49â€¯PM] tux_linux
No, in `ntx_comm.c`


[2/19/2022 5:49â€¯PM] szybet
okay


[2/19/2022 5:50â€¯PM] szybet
now i need to flash it?


[2/19/2022 5:50â€¯PM] tux_linux
yes


[2/19/2022 5:50â€¯PM] tux_linux
And it should fail to boot


[2/19/2022 5:50â€¯PM] tux_linux
But you should at least see a boot log


[2/19/2022 5:50â€¯PM] tux_linux
Something saying that it can't find the kernel image


[2/19/2022 5:51â€¯PM] szybet
okay


[2/19/2022 5:53â€¯PM] tux_linux
Would be nice if you posted the boot log too


[2/19/2022 5:54â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-C2F2B.txt


[2/19/2022 5:54â€¯PM] szybet
here


[2/19/2022 5:54â€¯PM] szybet
it booted, no linux kernel


[2/19/2022 5:54â€¯PM] tux_linux
Awesome


[2/19/2022 5:54â€¯PM] tux_linux
Now, we'll partition the SD card


[2/19/2022 5:57â€¯PM] tux_linux
```
Disk /dev/nbd0: 4 GiB, 4294967296 bytes, 8388608 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x25c915c4

Device      Boot   Start     End Sectors  Size Id Type
/dev/nbd0p1        49152   79871   30720   15M 83 Linux
/dev/nbd0p2       104448 1128447 1024000  500M 83 Linux
/dev/nbd0p3      1128448 1390591  262144  128M 83 Linux
/dev/nbd0p4      1390592 8388607 6998016  3.3G 83 Linux
```


[2/19/2022 5:57â€¯PM] tux_linux
Make it look like this (start/end sectors are **very important**)


[2/19/2022 5:57â€¯PM] tux_linux
(the first partition starts at `49152`, right?)


[2/19/2022 5:57â€¯PM] szybet
so i need to plug it into pc?


[2/19/2022 5:58â€¯PM] tux_linux
Well, yeah, `ums 0 mmc 0` from U-Boot if you want


[2/19/2022 5:59â€¯PM] szybet
whot tool to use? fdisk?


[2/19/2022 5:59â€¯PM] tux_linux
yes


[2/19/2022 6:00â€¯PM] tux_linux
You can clear all the partition table with `o`


[2/19/2022 6:00â€¯PM] szybet
?


[2/19/2022 6:01â€¯PM] tux_linux
in fdisk cmd


[2/19/2022 6:01â€¯PM] szybet
okay


[2/19/2022 6:01â€¯PM] szybet
i havent used fdisk, always cfdisk, gparted and other


[2/19/2022 6:06â€¯PM] szybet
whyyyy has it 15Mb


[2/19/2022 6:06â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-C3D0F.png


[2/19/2022 6:07â€¯PM] tux_linux
It's the boot partition


[2/19/2022 6:07â€¯PM] tux_linux
Only contains flags


[2/19/2022 6:07â€¯PM] tux_linux
http://inkbox.ddns.net:40//wiki/index.php?title=Boot_flags

{Embed}
http://inkbox.ddns.net:40//wiki/index.php?title=Boot_flags
Boot flags


[2/19/2022 6:08â€¯PM] szybet
so its okay?


[2/19/2022 6:08â€¯PM] szybet
your has 19 M mine 15


[2/19/2022 6:08â€¯PM] tux_linux
yes


[2/19/2022 6:08â€¯PM] szybet
weird


[2/19/2022 6:08â€¯PM] tux_linux
Well my bad


[2/19/2022 6:08â€¯PM] tux_linux
I tried to edit the fdisk output but forgot to change the size


[2/19/2022 6:09â€¯PM] tux_linux
Done


[2/19/2022 6:09â€¯PM] tux_linux
Because the emulator's MMC first partition starts at 40959


[2/19/2022 6:09â€¯PM] tux_linux
But I modified it so it could match your Nia's layout


[2/19/2022 6:09â€¯PM] szybet
oh okay


[2/19/2022 6:09â€¯PM] szybet
just some confusion


[2/19/2022 6:09â€¯PM] tux_linux
yeah


[2/19/2022 6:10â€¯PM] szybet
my sd card is bigger, can i make the last partition to the end or is after ir some data?


[2/19/2022 6:11â€¯PM] tux_linux
yes


[2/19/2022 6:11â€¯PM] tux_linux
you can extend it


[2/19/2022 6:13â€¯PM] szybet
14 gb for books


[2/19/2022 6:13â€¯PM] szybet
i had 6,9 using kobo


[2/19/2022 6:13â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-A33CA.png


[2/19/2022 6:13â€¯PM] tux_linux
not only for books


[2/19/2022 6:14â€¯PM] szybet
yes i know


[2/19/2022 6:14â€¯PM] tux_linux
all good


[2/19/2022 6:14â€¯PM] szybet
good, i will save it


[2/19/2022 6:15â€¯PM] szybet
fdisk without sudo worked?


[2/19/2022 6:15â€¯PM] szybet
it worked


[2/19/2022 6:15â€¯PM] szybet
whot now?


[2/19/2022 6:15â€¯PM] tux_linux
strange


[2/19/2022 6:15â€¯PM] tux_linux
are you sure it did?


[2/19/2022 6:15â€¯PM] szybet
lsblk shows yes


[2/19/2022 6:15â€¯PM] tux_linux
hmm ok


[2/19/2022 6:16â€¯PM] szybet
unplugged, plugged back and its there


[2/19/2022 6:16â€¯PM] szybet
so its ok


[2/19/2022 6:16â€¯PM] tux_linux
fine
now, clone the rootfs repo


[2/19/2022 6:17â€¯PM] szybet
done


[2/19/2022 6:18â€¯PM] tux_linux (pinned)
`env GITDIR="${PWD}" ./release.sh`


[2/19/2022 6:18â€¯PM] tux_linux
Should create you a nice rootfs squashfs


[2/19/2022 6:18â€¯PM] tux_linux
run it as root


[2/19/2022 6:18â€¯PM] tux_linux
you can look at the script if you want to be sure it's safe


[2/19/2022 6:19â€¯PM] szybet
there isin't anything that could be harmfull


[2/19/2022 6:19â€¯PM] szybet
done


[2/19/2022 6:19â€¯PM] szybet
really fast


[2/19/2022 6:19â€¯PM] tux_linux
Ok, so now in parent directory you should have `rootfs.squashfs`


[2/19/2022 6:20â€¯PM] tux_linux
right?


[2/19/2022 6:21â€¯PM] szybet
no...


[2/19/2022 6:21â€¯PM] tux_linux
what's the script output?


[2/19/2022 6:21â€¯PM] szybet
```
[root@ArchSzybet rootfs]# env GITDIR="${PWD}" ./release.sh
Parallel mksquashfs: Using 8 processors
Creating 4.0 filesystem on ../rootfs.squashfs, block size 1048576.
[============================================================================\] 6979/6979 100%

Exportable Squashfs 4.0 filesystem, gzip compressed, data block size 1048576
        compressed data, compressed metadata, compressed fragments,
        compressed xattrs, compressed ids
        duplicates are removed
Filesystem size 73621.37 Kbytes (71.90 Mbytes)
        34.22% of uncompressed filesystem size (215152.91 Kbytes)
Inode table size 74379 bytes (72.64 Kbytes)
        25.76% of uncompressed inode table size (288710 bytes)
Directory table size 79735 bytes (77.87 Kbytes)
        46.50% of uncompressed directory table size (171486 bytes)
Number of duplicate files found 666
Number of inodes 8427
Number of files 6899
Number of fragments 131
Number of symbolic links 904
Number of device nodes 0
Number of fifo nodes 0
Number of socket nodes 0
Number of directories 624
Number of ids (unique uids + gids) 2
Number of uids 2
        root (0)
        szybet (1002)
Number of gids 2
        root (0)
        szybet (1002)
Root filesystem has been compressed.

```


[2/19/2022 6:21â€¯PM] tux_linux
This looks alright


[2/19/2022 6:22â€¯PM] tux_linux
`ls ../rootfs.squashfs`?


[2/19/2022 6:22â€¯PM] szybet
yes


[2/19/2022 6:22â€¯PM] szybet
something is wrong with the script


[2/19/2022 6:22â€¯PM] szybet
oh, parent directory


[2/19/2022 6:22â€¯PM] tux_linux
is it there or not?


[2/19/2022 6:22â€¯PM] szybet
right


[2/19/2022 6:22â€¯PM] szybet
yes it is


[2/19/2022 6:22â€¯PM] tux_linux
ok; I saw you have uid 1002 there; this will cause problems


[2/19/2022 6:23â€¯PM] tux_linux
delete the whole repo and clone it as root this time


[2/19/2022 6:23â€¯PM] tux_linux
so that the files will be owned by root


[2/19/2022 6:23â€¯PM] tux_linux
then redo that


[2/19/2022 6:24â€¯PM] szybet
okay


[2/19/2022 6:25â€¯PM] szybet
maybe add to the script chown -R root:root * for the future?


[2/19/2022 6:25â€¯PM] tux_linux
maybe yeah


[2/19/2022 6:25â€¯PM] tux_linux
I was thinking about fakeroot


[2/19/2022 6:25â€¯PM] tux_linux
but didn't take the time to do it yet


[2/19/2022 6:25â€¯PM] szybet
maybe too


[2/19/2022 6:25â€¯PM] szybet
done with root


[2/19/2022 6:25â€¯PM] tux_linux
compressed too?


[2/19/2022 6:26â€¯PM] szybet
`Root filesystem has been compressed.`

{Reactions}
ğŸ‘ 

[2/19/2022 6:27â€¯PM] tux_linux
Now do this in an empty directory
```
openssl genrsa -out private.pem 2048
openssl rsa -in private.pem -out public.pem -outform PEM -pubout
```
Then
```
tar cJvf ../keys-n306.tar.xz .
```
And send me `keys-n306.tar.xz` via PM


[2/19/2022 6:27â€¯PM] tux_linux
Never ever share the private key with anyone else


[2/19/2022 6:28â€¯PM] szybet
thats the part i didn't understand


[2/19/2022 6:28â€¯PM] tux_linux
I put my trust in you
This set of keys will be used to sign all packages in InkBox


[2/19/2022 6:29â€¯PM] szybet
okay, is it so important to sign them?


[2/19/2022 6:29â€¯PM] tux_linux
Yes, to ensure integrity


[2/19/2022 6:29â€¯PM] tux_linux
Also InkBox OS won't boot if it can't validate the signatures


[2/19/2022 6:30â€¯PM] szybet
it would be easier to do like kobo does, with a md5sum file


[2/19/2022 6:30â€¯PM] szybet
this could be turned off


[2/19/2022 6:30â€¯PM] tux_linux
there's an option to do that


[2/19/2022 6:30â€¯PM] tux_linux
install a developer key


[2/19/2022 6:31â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/developer-key

{Embed}
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/developer-key
kernel/developer-key at master Â· Kobo-InkBox/kernel
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-8A7AF


[2/19/2022 6:31â€¯PM] szybet
does alpine require that?


[2/19/2022 6:31â€¯PM] tux_linux
But InkBox was designed for security


[2/19/2022 6:31â€¯PM] szybet
well, sure


[2/19/2022 6:31â€¯PM] tux_linux
So I won't change my position on the subject


[2/19/2022 6:31â€¯PM] szybet
good security is always good

{Reactions}
ğŸ‘ 

[2/19/2022 6:31â€¯PM] szybet
but on the other side its a ereader


[2/19/2022 6:31â€¯PM] tux_linux
Look at Kindles


[2/19/2022 6:32â€¯PM] tux_linux
Newer ones have an even more strict security policy and implement HAB (verified boot in-SoC) to ensure kernel is signed correctly


[2/19/2022 6:33â€¯PM] szybet
its only becouse to ensure that DRM will work corectly


[2/19/2022 6:33â€¯PM] szybet
it does not have much to do with security


[2/19/2022 6:33â€¯PM] szybet
and why do you need those private keys? could't i do it myself?


[2/19/2022 6:35â€¯PM] tux_linux
Yes, too, but it is easier for some tasks (GUI bundle)
Also if somehow you decide not to contribute at some point, I won't be able to sign the packages without you


[2/19/2022 6:36â€¯PM] szybet
Gui bundle?


[2/19/2022 6:36â€¯PM] szybet
I dont understand the second point


[2/19/2022 6:36â€¯PM] szybet
like sure, private keys are needed


[2/19/2022 6:37â€¯PM] szybet
Will i build the filesystem with those keys, and then upload them to inkbox repo?


[2/19/2022 6:37â€¯PM] tux_linux
Only public key


[2/19/2022 6:37â€¯PM] tux_linux
You'll be the only person with me that will know the private key


[2/19/2022 6:38â€¯PM] tux_linux
update.isa file in update packages
Contains qt, python and inkbox


[2/19/2022 6:38â€¯PM] tux_linux
It isn't versioned yet, so it's local work currently


[2/19/2022 6:39â€¯PM] szybet
okay


[2/19/2022 6:39â€¯PM] tux_linux
Now you can sign the rootfs


[2/19/2022 6:39â€¯PM] tux_linux (pinned)
`openssl dgst -sha256 -sign private.pem -out rootfs.squashfs.dgst rootfs.squashfs`


[2/19/2022 6:39â€¯PM] tux_linux
public keys are embedded in the initrd


[2/19/2022 6:39â€¯PM] tux_linux
let me put the one you shared in there


[2/19/2022 6:40â€¯PM] szybet
done


[2/19/2022 6:41â€¯PM] tux_linux
now, copy those files into partition 3 of sd card


[2/19/2022 6:42â€¯PM] szybet
when we speak about security, whot about encrypting files ( books ). they could be easly accesed when unplugging the sd card


[2/19/2022 6:42â€¯PM] szybet
and the lock screen would not help


[2/19/2022 6:43â€¯PM] szybet
some books are expensive, it would be nice if the thiev of the ereader could't get them


[2/19/2022 6:43â€¯PM] tux_linux
already done


[2/19/2022 6:43â€¯PM] szybet
really?


[2/19/2022 6:43â€¯PM] tux_linux
hehe


[2/19/2022 6:43â€¯PM] tux_linux
yes


[2/19/2022 6:43â€¯PM] tux_linux
Look at the features list


[2/19/2022 6:43â€¯PM] szybet
oh here i see


[2/19/2022 6:43â€¯PM] szybet
- Encrypted storage with EncFS


[2/19/2022 6:43â€¯PM] tux_linux
That was a wild ride


[2/19/2022 6:43â€¯PM] szybet
you mean ootfs.squashfs.dgst rootfs.squashfs private.pem?


[2/19/2022 6:44â€¯PM] tux_linux
Probably the most complicated script I ever made https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/encfs

{Embed}
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/encfs
rootfs/encfs at master Â· Kobo-InkBox/rootfs
InkBox OS root filesystem. Contribute to Kobo-InkBox/rootfs development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/rootfs-50853


[2/19/2022 6:44â€¯PM] tux_linux
not private.pem
only rootfs.squashfs*


[2/19/2022 6:44â€¯PM] szybet
so 2 files?


[2/19/2022 6:44â€¯PM] tux_linux
yes


[2/19/2022 6:44â€¯PM] szybet
this looks terrifyingly


[2/19/2022 6:45â€¯PM] tux_linux
I know right


[2/19/2022 6:45â€¯PM] tux_linux
it works so i'm happy


[2/19/2022 6:45â€¯PM] szybet
does it impact performance?


[2/19/2022 6:45â€¯PM] tux_linux
no


[2/19/2022 6:45â€¯PM] tux_linux
Well, creating the encrypted storage archive can take a lot of time


[2/19/2022 6:45â€¯PM] tux_linux
5 mins on extreme cases


[2/19/2022 6:45â€¯PM] tux_linux
But once it's done it is fast to mount


[2/19/2022 6:46â€¯PM] szybet
i did ums 0 mmc 0 and i try to mount the partition and i cant


[2/19/2022 6:46â€¯PM] szybet
do i need to format it?


[2/19/2022 6:46â€¯PM] tux_linux
This is the function in InkBox GUI
https://github.com/Kobo-InkBox/inkbox/blob/master/encryptionmanager.cpp


[2/19/2022 6:47â€¯PM] tux_linux
yes


[2/19/2022 6:47â€¯PM] szybet
also, why only one partition is showing in dolphin


[2/19/2022 6:47â€¯PM] szybet
ext4?


[2/19/2022 6:47â€¯PM] tux_linux
`mkfs.ext4 -O "^metadata_csum" /dev/mmcblk0p3`


[2/19/2022 6:47â€¯PM] tux_linux
do the same for p1, p2 and p4


[2/19/2022 6:47â€¯PM] tux_linux
because the other ones aren't formatted


[2/19/2022 6:47â€¯PM] szybet
this one isin't too


[2/19/2022 6:48â€¯PM] tux_linux
And partition 1 is the only one that still starts at the same sector


[2/19/2022 6:48â€¯PM] szybet
is it with the size 128 Mb?


[2/19/2022 6:48â€¯PM] tux_linux
yes


[2/19/2022 6:50â€¯PM] szybet
whot is in the 500 Mb partition stored?


[2/19/2022 6:50â€¯PM] tux_linux
After that:
Clone the emu repo
Grab `overlaymount-rootfs.squashfs` from `sd/` directory, sign it the same way you did with `rootfs.squashfs` and put the two files in p3 as well


[2/19/2022 6:50â€¯PM] tux_linux
recoveryfs


[2/19/2022 6:51â€¯PM] szybet
okay


[2/19/2022 6:52â€¯PM] tux_linux
https://youtu.be/KaBj7acHRHk?t=2010
See here, it's a serial log from the Touch C, the recovery partition is featured in the middle of the section

{Embed}
Nicolas Mailloux
https://www.youtube.com/watch?v=KaBj7acHRHk&start=2010
InkBox OS 1.5
InkBox OS is a complete operating system replacement for Kobo eReader devices. It currently runs on the Glo, Touch and Mini models. It is built around Qt 5.15.2 and namely features ePUB rendering. Along that, full KoBox/X11 support is integrated, allowing the user to run X apps natively on the device.
InkBox OS is built around a core concept: se...
/mnt/data/projects/git/conversations/media/hqdefault-A6FF0.jpg


[2/19/2022 6:52â€¯PM] szybet
where is the sd directory? in which repo?


[2/19/2022 6:52â€¯PM] tux_linux
emu repo


[2/19/2022 6:52â€¯PM] tux_linux
https://github.com/Kobo-InkBox/emu


[2/19/2022 6:54â€¯PM] szybet
okay, it takes some time to launch it


[2/19/2022 6:54â€¯PM] szybet
wait, does it run on the kobo using the emulator?


[2/19/2022 6:56â€¯PM] tux_linux
No


[2/19/2022 6:56â€¯PM] tux_linux
It's just that the file I want you to put there is available in this repo


[2/19/2022 6:57â€¯PM] szybet
confusing


[2/19/2022 6:57â€¯PM] szybet
whot is this file?


[2/19/2022 6:58â€¯PM] tux_linux
It's a helper which provides squashfuse, unionfs-fuse and overlayfs-fuse binaries


[2/19/2022 6:58â€¯PM] tux_linux
Was too big to put in the initrd


[2/19/2022 6:58â€¯PM] szybet
"helper"?


[2/19/2022 6:58â€¯PM] tux_linux
Basically a mini Alpine chroot


[2/19/2022 6:59â€¯PM] szybet
oh okay


[2/19/2022 6:59â€¯PM] tux_linux
you can mount it if you want, to see


[2/19/2022 6:59â€¯PM] tux_linux
`mount overlaymount-rootfs.squashfs /mnt`


[2/19/2022 6:59â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-DE91F.png


[2/19/2022 6:59â€¯PM] szybet
already looked into it

{Reactions}
ğŸ‘ 

[2/19/2022 6:59â€¯PM] szybet
so its done


[2/19/2022 6:59â€¯PM] tux_linux
alright


[2/19/2022 7:00â€¯PM] tux_linux
I'll set up the kernel config and we can have a try with what you have inside currently


[2/19/2022 7:01â€¯PM] tux_linux
Meanwhile
```
cat sd/user.sqsh.* > sd/user.sqsh
sudo unsquashfs -f -d [location-of-p4]/ sd/user.sqsh
```


[2/19/2022 7:02â€¯PM] tux_linux
It's nice, the Nia has the same PPI as the Glo and Aura SE, so supporting it will be easier since all the configs are there for devices of 1024x768 resolution


[2/19/2022 7:02â€¯PM] szybet
cat?


[2/19/2022 7:02â€¯PM] tux_linux
Assemble multiple files
user.sqsh was too big for GitHub


[2/19/2022 7:02â€¯PM] szybet
weird way to do that


[2/19/2022 7:02â€¯PM] tux_linux
I know


[2/19/2022 7:02â€¯PM] tux_linux
I didn't find another one


[2/19/2022 7:02â€¯PM] tux_linux
But it works no problem


[2/19/2022 7:03â€¯PM] szybet
whot is p4?


[2/19/2022 7:03â€¯PM] tux_linux
userdata


[2/19/2022 7:03â€¯PM] tux_linux
Also, X11/KoBox images as well as GUI bundle


[2/19/2022 7:03â€¯PM] tux_linux
and other things


[2/19/2022 7:04â€¯PM] szybet
from where i get it


[2/19/2022 7:04â€¯PM] szybet
i dont really understand


[2/19/2022 7:04â€¯PM] tux_linux
In the emu repo?


[2/19/2022 7:05â€¯PM] tux_linux
Same place where you found `overlaymount-rootfs.squashfs`


[2/19/2022 7:05â€¯PM] szybet
sudo unsquashfs -f -d sd/user.sqsh sd/user.sqsh


[2/19/2022 7:05â€¯PM] szybet
this doesn't see, right


[2/19/2022 7:06â€¯PM] tux_linux
what


[2/19/2022 7:06â€¯PM] tux_linux
`sudo unsquashfs -f -d /run/media/szybet/wherever/is/your/p4/mounted sd/user.sqsh`


[2/19/2022 7:06â€¯PM] szybet
partition 4?


[2/19/2022 7:07â€¯PM] tux_linux
yes


[2/19/2022 7:07â€¯PM] szybet
now i understand


[2/19/2022 7:15â€¯PM] szybet
its done


[2/19/2022 7:15â€¯PM] szybet
but sync takes time now


[2/19/2022 7:15â€¯PM] tux_linux
normal


[2/19/2022 7:15â€¯PM] tux_linux
it's like 3G of data


[2/19/2022 7:15â€¯PM] szybet
the sd card is 7Mb/s max


[2/19/2022 7:15â€¯PM] szybet
thats big


[2/19/2022 7:15â€¯PM] tux_linux
yes


[2/19/2022 7:16â€¯PM] tux_linux
I'm setting up the kernel config now


[2/19/2022 7:16â€¯PM] szybet
would you like to have the default one and modify it?


[2/19/2022 7:20â€¯PM] tux_linux
i already have it


[2/19/2022 7:20â€¯PM] szybet
from where?


[2/19/2022 7:21â€¯PM] tux_linux
in the kernel source


[2/19/2022 7:21â€¯PM] szybet
there was it?...


[2/19/2022 7:21â€¯PM] tux_linux
`arch/arm/configs/imx_v7_kobo_defconfig`


[2/19/2022 7:21â€¯PM] szybet
oh...


[2/19/2022 7:21â€¯PM] szybet
i used the config from /proc/config.gz


[2/19/2022 7:21â€¯PM] tux_linux
oh; i need one thing


[2/19/2022 7:22â€¯PM] szybet
?


[2/19/2022 7:22â€¯PM] tux_linux
where were the dmesg logs?


[2/19/2022 7:22â€¯PM] tux_linux
I have to get the cmdline


[2/19/2022 7:22â€¯PM] szybet
https://github.com/Szybet/kobo-nia-audio/tree/main/logs

{Embed}
https://github.com/Szybet/kobo-nia-audio/tree/main/logs
kobo-nia-audio/logs at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/19/2022 7:22â€¯PM] szybet
hm? whots that


[2/19/2022 7:22â€¯PM] tux_linux
ok I have it


[2/19/2022 7:23â€¯PM] tux_linux
`console=ttymxc0,115200 rootwait rw no_console_suspend hwcfg_p=0x8ffffe00 hwcfg_sz=110 waveform_p=0x8ff71a00 waveform_sz=582529 ntxfw_p=0x8ff71400 ntxfw_sz=1034 mem=255M boot_port=1 rootfstype=ext4 root=/dev/mmcblk0p1 quiet`
Args passed to the kernel at boot


[2/19/2022 7:23â€¯PM] szybet
ah those


[2/19/2022 7:27â€¯PM] szybet
could you enable usb options? usb otg, chipidea controller


[2/19/2022 7:32â€¯PM] tux_linux
Well, not in InkBox default config
But you can change it
It's quite easy


[2/19/2022 7:33â€¯PM] szybet
okay, i will do it later


[2/19/2022 7:34â€¯PM] tux_linux
it seems already enabled btw


[2/19/2022 7:35â€¯PM] tux_linux
Maybe you can look into `USB_AUDIO`


[2/19/2022 7:35â€¯PM] szybet
sounds good


[2/19/2022 7:35â€¯PM] szybet
first i need it to register any usb device as host


[2/19/2022 7:36â€¯PM] szybet
you can look at dmesg-usb at whot I have achieved  already and whots the problem


[2/19/2022 7:44â€¯PM] tux_linux
Ok, it's ready


[2/19/2022 7:44â€¯PM] tux_linux
pull the repo


[2/19/2022 7:44â€¯PM] tux_linux
And redo this


[2/19/2022 7:45â€¯PM] tux_linux
Make sure this time that your kernel repo is in `/home/build/inkbox/kernel`


[2/19/2022 7:47â€¯PM] szybet
must this be the exact same path?


[2/19/2022 7:50â€¯PM] szybet
fakeroot is a good idea to implement in the future


[2/19/2022 7:51â€¯PM] szybet
well yes it must
```
  AS      arch/arm/vfp/vfphw.o
  ./scripts/gen_initramfs_list.sh: Cannot open '/home/build/inkbox/kernel/initrd/busybox-1.32.1/_install-n306'
make[1]: *** [usr/Makefile:73: usr/initramfs_data.cpio.xz] BÅ‚Ä…d 1
make: *** [Makefile:947: usr] BÅ‚Ä…d 2
make: *** Oczekiwanie na niezakoÅ„czone zadania....
```


[2/19/2022 7:51â€¯PM] szybet
i will do a symlink


[2/19/2022 7:55â€¯PM] szybet
done


[2/19/2022 8:00â€¯PM] szybet
propably now flash it?


[2/19/2022 8:01â€¯PM] tux_linux
yes


[2/19/2022 8:01â€¯PM] szybet
already compiled


[2/19/2022 8:01â€¯PM] tux_linux
`dd if=zImage-root of=/dev/mmcblk0 bs=512 seek=81920`


[2/19/2022 8:02â€¯PM] szybet
done


[2/19/2022 8:03â€¯PM] tux_linux
Well, now try to boot


[2/19/2022 8:03â€¯PM] tux_linux
Please post boot log


[2/19/2022 8:03â€¯PM] tux_linux
There will be errors


[2/19/2022 8:04â€¯PM] tux_linux
I just want to know if kernel/initrd works fine


[2/19/2022 8:04â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-CB627.txt


[2/19/2022 8:04â€¯PM] szybet
bootloop


[2/19/2022 8:04â€¯PM] tux_linux
shit


[2/19/2022 8:04â€¯PM] tux_linux
welp


[2/19/2022 8:04â€¯PM] tux_linux
we have a problem


[2/19/2022 8:05â€¯PM] szybet
i dont know whot you changed so i cant really help


[2/19/2022 8:05â€¯PM] szybet
maybe i have done something wrong


[2/19/2022 8:06â€¯PM] tux_linux
no


[2/19/2022 8:06â€¯PM] tux_linux
probably related to load size


[2/19/2022 8:06â€¯PM] szybet
hmm


[2/19/2022 8:07â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/2022-02-19_14.07.04_www.google.com_f69a706-D61CE.png


[2/19/2022 8:07â€¯PM] tux_linux
it is


[2/19/2022 8:07â€¯PM] tux_linux
kernel weighs 9.5M right?


[2/19/2022 8:07â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-E9A18.png


[2/19/2022 8:07â€¯PM] szybet
yes


[2/19/2022 8:07â€¯PM] tux_linux
ok so it's load size


[2/19/2022 8:08â€¯PM] szybet
its bad that it could't be more


[2/19/2022 8:08â€¯PM] szybet
new devices, more hardware features ad the kernel will be bigger


[2/19/2022 8:08â€¯PM] tux_linux
Delete `kernel/initrd/n306/opt/firmware.sqsh`


[2/19/2022 8:08â€¯PM] tux_linux
And recompile the kernel


[2/19/2022 8:08â€¯PM] tux_linux
It can be more


[2/19/2022 8:08â€¯PM] szybet
so why it is not working?


[2/19/2022 8:09â€¯PM] tux_linux
Max kernel size we could have would be 11.5M


[2/19/2022 8:09â€¯PM] tux_linux
Because load size was set to 18432 = 9.4M


[2/19/2022 8:10â€¯PM] szybet
whot is load size


[2/19/2022 8:10â€¯PM] tux_linux
I want to try to strip down the kernel before increasing load size


[2/19/2022 8:10â€¯PM] tux_linux
Number of sectors/bytes U-Boot reads from MMC to load kernel


[2/19/2022 8:10â€¯PM] szybet
okay


[2/19/2022 8:10â€¯PM] szybet
oh


[2/19/2022 8:10â€¯PM] szybet
and it cant be more than actual file size?


[2/19/2022 8:11â€¯PM] szybet
done, flash it?


[2/19/2022 8:12â€¯PM] tux_linux
yes


[2/19/2022 8:12â€¯PM] tux_linux
yes


[2/19/2022 8:12â€¯PM] tux_linux
what's its size?


[2/19/2022 8:13â€¯PM] szybet
9.4


[2/19/2022 8:13â€¯PM] tux_linux
wow that's tight


[2/19/2022 8:13â€¯PM] tux_linux
let's see


[2/19/2022 8:16â€¯PM] szybet
it stops at starting kernel


[2/19/2022 8:16â€¯PM] szybet
```
ntx_gpio_get_value(404) : error parameter ! null ptr !
ESDin=0,UPGKey=-1,PWRKey=0,USBin=0x1,BootESD=0,MenuKey=0
mmc read 0x8ffffc00 0x37ff 0x1

MMC read: dev # 0, block # 14335, count 1 ... 1 blocks read: OK
mmc read 0x8ff71a00 0x3800 0x472

MMC read: dev # 0, block # 14336, count 1138 ... 1138 blocks read: OK
mmc read 0x8ff71800 0x405 0x1

MMC read: dev # 0, block # 1029, count 1 ... 1 blocks read: OK
[WARNING] Binaries load sequence should Lo->Hi !
mmc read 0x8ff71400 0x406 0x3

MMC read: dev # 0, block # 1030, count 3 ... 3 blocks read: OK
Kernel RAM visiable size=255M->255M
ntx_gpio_init():R [ERROR] GPIO group number error (0)!!
ntx_gpio_init():B [ERROR] GPIO group number error (0)!!
hwcfg rootfstype : 2
hwcfg partition type : 2,bootmode=0
ntx_prebootm : cmd=setenv bootargs ${bootargs}  hwcfg_p=0x8ffffe00 hwcfg_sz=110 waveform_p=0x8ff71a00 waveform_sz=582529 ntxfw_p=0x8t
Kernel image @ 0x80800000 [ 0x000000 - 0x95e370 ]
## Flattened Device Tree blob at 83000000
   Booting using the fdt blob at 0x83000000
   Using Device Tree in place at 83000000, end 8300d274

Starting kernel ...
```


[2/19/2022 8:16â€¯PM] szybet
after a while its rebooting


[2/19/2022 8:16â€¯PM] szybet
but it stops for some secons at starting kernel


[2/19/2022 8:17â€¯PM] tux_linux
hmm


[2/19/2022 8:17â€¯PM] szybet
thats bad... changing the kernel will be pain


[2/19/2022 8:17â€¯PM] szybet
on the stock firmware it wasn't like that?


[2/19/2022 8:17â€¯PM] tux_linux
yes, it can be more than the actual file size


[2/19/2022 8:18â€¯PM] tux_linux
that's what I meant


[2/19/2022 8:18â€¯PM] szybet
oh


[2/19/2022 8:18â€¯PM] tux_linux
I forgot something


[2/19/2022 8:18â€¯PM] szybet
so just update u-boot?


[2/19/2022 8:18â€¯PM] szybet
whot?


[2/19/2022 8:18â€¯PM] tux_linux
`GITDIR="${PWD}" scripts/make_devicenodes.sh`


[2/19/2022 8:18â€¯PM] tux_linux
in kernel repo


[2/19/2022 8:18â€¯PM] tux_linux
then recompile kernel


[2/19/2022 8:18â€¯PM] tux_linux
maybe will it work


[2/19/2022 8:20â€¯PM] szybet
mknod


[2/19/2022 8:20â€¯PM] szybet
i first see something like this


[2/19/2022 8:21â€¯PM] tux_linux
yes


[2/19/2022 8:21â€¯PM] tux_linux
It's for making device nodes in `/dev`


[2/19/2022 8:21â€¯PM] tux_linux
Such as the console `ttymxc0`


[2/19/2022 8:21â€¯PM] tux_linux
Without that node, the kernel might hang


[2/19/2022 8:21â€¯PM] tux_linux
Which I think is what happened here


[2/19/2022 8:25â€¯PM] szybet
data abort

{Attachments}
/mnt/data/projects/git/conversations/media/message-43AAD.txt


[2/19/2022 8:30â€¯PM] tux_linux
Ok, don't know what to say


[2/19/2022 8:30â€¯PM] tux_linux
hang on


[2/19/2022 8:32â€¯PM] tux_linux
@andi , if you have a clue, I'm all ears


[2/19/2022 8:32â€¯PM] szybet
maybe i will write the stock kernel to that location to see if it boots?


[2/19/2022 8:32â€¯PM] tux_linux
you'd need to recompile u-boot


[2/19/2022 8:32â€¯PM] szybet
why


[2/19/2022 8:33â€¯PM] tux_linux
to change load sector


[2/19/2022 8:33â€¯PM] tux_linux
oh


[2/19/2022 8:33â€¯PM] tux_linux
yeah you could try the stock kernel


[2/19/2022 8:33â€¯PM] tux_linux
at sector 81920


[2/19/2022 8:33â€¯PM] szybet
that whot i said


[2/19/2022 8:33â€¯PM] szybet
i will try it


[2/19/2022 8:33â€¯PM] tux_linux
sure


[2/19/2022 8:35â€¯PM] szybet
a buetiful kernel panink


[2/19/2022 8:35â€¯PM] szybet
```
Starting kernel ...

/cpus/cpu@0 missing clock-frequency property
sy7636-pmic sy7636-pmic: request vcom gpio failed (-16)!
sy7636-pmic sy7636-pmic: request powerup gpio failed (-16)!
syscon-poweroff 20cc000.snvs:snvs-poweroff: pm_power_off already claimed 80021934 ntx_machine_poweroff
PMU: ricoh61x_battery_probe : version is RICOH61x_BATTERY_VERSION: 2014.02.21 V3.1.0.0-Solution1 2015/02/09
==== calc_soc_by_voltageMethod E60U22 ====
imx6ul-pinctrl 2290000.iomuxc-snvs: pin MX6ULL_PAD_SNVS_TAMPER3 already requested by 21f8000.i2c; cannot claim for gpio-keys
imx6ul-pinctrl 2290000.iomuxc-snvs: pin-5 (gpio-keys) status -22
imx6ul-pinctrl 2290000.iomuxc-snvs: could not request pin 5 (MX6ULL_PAD_SNVS_TAMPER3) from group gpio_snvs_keys_grp  on device 22900s
gpio-keys gpio-keys: Error applying setting, reverse things back
Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(179,1)
---[ end Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(179,1)
imx_epdc_v2_fb 228c000.epdc: Cleared LUT complete for init update
```


[2/19/2022 8:35â€¯PM] tux_linux
that's good


[2/19/2022 8:35â€¯PM] tux_linux
it makes sense


[2/19/2022 8:36â€¯PM] szybet
so the kernel is wrong


[2/19/2022 8:36â€¯PM] tux_linux
i don't know why it doesn't work with inkbox


[2/19/2022 8:36â€¯PM] szybet
maybe your kernel config was wrong?


[2/19/2022 8:37â€¯PM] szybet
compare your config without modyfication with this one that works in 100% https://github.com/Szybet/kobo-nia-audio/blob/main/kernels/self-compiled-oryginal/config-oryginal-kernel

{Embed}
https://github.com/Szybet/kobo-nia-audio/blob/main/kernels/self-compiled-oryginal/config-oryginal-kernel
kobo-nia-audio/config-oryginal-kernel at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/19/2022 8:37â€¯PM] tux_linux
I highly doubt it, never seen a wrong config that triggers a data abort in U-Boot


[2/19/2022 8:37â€¯PM] szybet
maybe the kernel has some wrong headers at beginning?


[2/19/2022 8:38â€¯PM] tux_linux
no idea


[2/19/2022 8:38â€¯PM] tux_linux
i'll concentrate on the aura 2 for some moments, I'll try andi1's kernel


[2/19/2022 8:38â€¯PM] tux_linux
will come back in a short time


[2/19/2022 8:39â€¯PM] szybet
okay, sure


[2/19/2022 8:39â€¯PM] szybet
does it mean today or in the nearest future?


[2/19/2022 8:40â€¯PM] tux_linux
today


[2/19/2022 8:40â€¯PM] tux_linux
won't take long


[2/19/2022 8:40â€¯PM] tux_linux
10mins


[2/19/2022 8:49â€¯PM] szybet
okay


[2/19/2022 8:55â€¯PM] tux_linux
what if you delete `initrd/n306/opt/splash-rootfs.tar.xz`?


[2/19/2022 8:57â€¯PM] szybet
one sec


[2/19/2022 9:00â€¯PM] szybet
yes, thats progress


[2/19/2022 9:00â€¯PM] szybet
```

{Attachments}
/mnt/data/projects/git/conversations/media/message-4881E.txt


[2/19/2022 9:01â€¯PM] tux_linux
yaaay


[2/19/2022 9:01â€¯PM] szybet
whot was the problem?


[2/19/2022 9:02â€¯PM] tux_linux
what's the size of your compiled kernel?


[2/19/2022 9:02â€¯PM] szybet
7.5


[2/19/2022 9:02â€¯PM] szybet
M


[2/19/2022 9:02â€¯PM] tux_linux
What's the latest commit that shows up in `git log`?


[2/19/2022 9:04â€¯PM] szybet
change kernel config


[2/19/2022 9:04â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-FE393.png


[2/19/2022 9:04â€¯PM] tux_linux
What's `git status`?


[2/19/2022 9:04â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-71466.png


[2/19/2022 9:05â€¯PM] szybet
it says its up to date


[2/19/2022 9:05â€¯PM] szybet
in master


[2/19/2022 9:05â€¯PM] tux_linux
oh


[2/19/2022 9:06â€¯PM] szybet
?


[2/19/2022 9:06â€¯PM] szybet
you forgot to push?


[2/19/2022 9:07â€¯PM] tux_linux
pull again and execute make_devicenodes again


[2/19/2022 9:07â€¯PM] szybet
done


[2/19/2022 9:08â€¯PM] szybet
have in mind the repo has some files deleted that you said before


[2/19/2022 9:08â€¯PM] tux_linux
So now there are nodes in `initrd/n306/dev`?


[2/19/2022 9:08â€¯PM] tux_linux
no problems, a `git reset --hard` will get them back


[2/19/2022 9:08â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-9B4D8.png


[2/19/2022 9:08â€¯PM] szybet
so i do it?


[2/19/2022 9:10â€¯PM] tux_linux
no (not yet)


[2/19/2022 9:10â€¯PM] szybet
okay


[2/19/2022 9:10â€¯PM] tux_linux
Nice, now recompile the kernel


[2/19/2022 9:12â€¯PM] szybet
and flash it?


[2/19/2022 9:12â€¯PM] tux_linux
yes


[2/19/2022 9:14â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-57A38.txt


[2/19/2022 9:15â€¯PM] szybet
now i noticed that the screen refreshed, i dont know if it was done before using inkbox kernel


[2/19/2022 9:18â€¯PM] tux_linux
pull again


[2/19/2022 9:18â€¯PM] tux_linux
recompile again


[2/19/2022 9:18â€¯PM] tux_linux
it should work


[2/19/2022 9:18â€¯PM] tux_linux
I added init argument to cmdline


[2/19/2022 9:19â€¯PM] tux_linux
good


[2/19/2022 9:24â€¯PM] szybet
```
Starting kernel ...

[    0.004763] /cpus/cpu@0 missing clock-frequency property
[    0.423820] sy7636-pmic sy7636-pmic: request vcom gpio failed (-16)!
[    0.423864] sy7636-pmic sy7636-pmic: request powerup gpio failed (-16)!
[    5.534496] syscon-poweroff 20cc000.snvs:snvs-poweroff: pm_power_off already claimed 80021c08 ntx_machine_poweroff
[    5.545643] PMU: ricoh61x_battery_probe : version is RICOH61x_BATTERY_VERSION: 2014.02.21 V3.1.0.0-Solution1 2015/02/09
[    5.610660] ==== calc_soc_by_voltageMethod E60U22 ====
[    5.841222] imx6ul-pinctrl 2290000.iomuxc-snvs: pin MX6ULL_PAD_SNVS_TAMPER3 already requested by 21f8000.i2c; cannot claim for gps
[    5.856657] imx6ul-pinctrl 2290000.iomuxc-snvs: pin-5 (gpio-keys) status -22
[    5.863820] imx6ul-pinctrl 2290000.iomuxc-snvs: could not request pin 5 (MX6ULL_PAD_SNVS_TAMPER3) from group gpio_snvs_keys_grp  s
[    5.878155] gpio-keys gpio-keys: Error applying setting, reverse things back
mount: mounting /dev/mmcblk0p1 on /mnt failed: Invalid argument
umount: can't unmount /mnt: Invalid argument
Linux inkbox 4.1.15 #1 SMP PREEMPT Sat Feb 19 21:21:19 CET 2022 armv7l GNU/Linux
InkBox OS, kernel build 3NMth0qo
Copyright (C) 2021-2022 Nicolas Mailloux <nicolecrivain@gmail.com>

Checking filesystems ...

e2fsck 1.46.2 (28-Feb-2021)
Error reading block 114689 (Invalid argument).  Ignore error? yes

Force rewrite? yes
```


[2/19/2022 9:25â€¯PM] szybet
now im waiting for something to happen


[2/19/2022 9:26â€¯PM] szybet
look at this specially:
```
mount: mounting /dev/mmcblk0p1 on /mnt failed: Invalid argument
umount: can't unmount /mnt: Invalid argument
```


[2/19/2022 9:27â€¯PM] tux_linux
did you format p1?


[2/19/2022 9:27â€¯PM] szybet
ğŸ‘€ 
one sec


[2/19/2022 9:29â€¯PM] szybet
this 15 Mb one?


[2/19/2022 9:29â€¯PM] tux_linux
yes


[2/19/2022 9:30â€¯PM] tux_linux
please tell me that it wasn't formatted


[2/19/2022 9:30â€¯PM] tux_linux
otherwise...


[2/19/2022 9:30â€¯PM] tux_linux
we have a really big problem


[2/19/2022 9:30â€¯PM] szybet
i did this now ._ .


[2/19/2022 9:30â€¯PM] szybet
bruh


[2/19/2022 9:30â€¯PM] szybet
soooo whots the problem


[2/19/2022 9:30â€¯PM] tux_linux
Are you able to mount it on your PC?


[2/19/2022 9:31â€¯PM] szybet
yes, becouse of this


[2/19/2022 9:33â€¯PM] szybet
now whot


[2/19/2022 9:34â€¯PM] tux_linux
Try to restart


[2/19/2022 9:34â€¯PM] tux_linux
The Kobo


[2/19/2022 9:35â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-E90DC.txt


[2/19/2022 9:36â€¯PM] tux_linux
YAY!


[2/19/2022 9:36â€¯PM] szybet
i see more errors then before


[2/19/2022 9:36â€¯PM] szybet
whots with that?


[2/19/2022 9:38â€¯PM] tux_linux
you did not format p2


[2/19/2022 9:38â€¯PM] tux_linux
nothing


[2/19/2022 9:38â€¯PM] tux_linux
doesn't matter


[2/19/2022 9:38â€¯PM] szybet
okay


[2/19/2022 9:38â€¯PM] szybet
whotnow


[2/19/2022 9:38â€¯PM] tux_linux
Now try `git reset --hard`


[2/19/2022 9:39â€¯PM] tux_linux
And recompile the full package


[2/19/2022 9:39â€¯PM] szybet
do the node thing one more time?


[2/19/2022 9:39â€¯PM] tux_linux
I don't think it will be needed


[2/19/2022 9:39â€¯PM] tux_linux
But it can't hurt


[2/19/2022 9:47â€¯PM] tux_linux
if it doesn't work and leads to data abord, we'll try increasing the load size


[2/19/2022 9:48â€¯PM] szybet
it stopped at starting kernel, now i wait but thats propably it


[2/19/2022 9:50â€¯PM] tux_linux
`git status`?


[2/19/2022 9:50â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-FDA69.png


[2/19/2022 9:50â€¯PM] szybet
up to date


[2/19/2022 9:51â€¯PM] tux_linux
Remove `quiet` from `CONFIG_CMDLINE` in `kernel/config/config-n306`


[2/19/2022 9:51â€¯PM] tux_linux
That will probably be somewhat helpful


[2/19/2022 10:01â€¯PM] szybet
i dont see anything after this change


[2/19/2022 10:01â€¯PM] szybet
starting kernel and nothing more


[2/19/2022 11:13â€¯PM] tux_linux
ok


[2/19/2022 11:13â€¯PM] tux_linux
Then very likely the load size


[2/19/2022 11:15â€¯PM] szybet
i think that too


[2/19/2022 11:15â€¯PM] tux_linux
Edit `bootloader/mx6ull-n306/board/freescale/mx6ull_ntx/ntx_comm.c`
Change `DEFAULT_KERNEL_LOAD_SZ` to `20480`


[2/19/2022 11:18â€¯PM] szybet
é€™å€‹æª”æ¡ˆå¯è¢«U-BOOT,é–‹ç™¼æ¿.c æ¿å¼•å…¥
um okay


[2/19/2022 11:19â€¯PM] szybet
there isin't somethink like that

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-CC301.png


[2/19/2022 11:19â€¯PM] szybet
didn't find


[2/19/2022 11:20â€¯PM] tux_linux
hmm


[2/19/2022 11:20â€¯PM] tux_linux
oh


[2/19/2022 11:20â€¯PM] tux_linux
`DEFAULT_LOAD_KERNEL_SZ`


[2/19/2022 11:22â€¯PM] szybet
done


[2/19/2022 11:22â€¯PM] szybet
how do i compile the bootloader?


[2/19/2022 11:23â€¯PM] szybet
it was somewhere in my history


[2/19/2022 11:23â€¯PM] tux_linux
Well, same way you compiled it yesterday


[2/19/2022 11:23â€¯PM] szybet
oh, just make -j 6 CROSS_COMPILE=arm-nickel-linux-gnueabihf- ARCH=arm


[2/19/2022 11:23â€¯PM] szybet
okay


[2/19/2022 11:30â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-CE5A1.txt


[2/19/2022 11:30â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220219_232927-2E708.png


[2/19/2022 11:31â€¯PM] the.mightydill
looks like fs error


[2/19/2022 11:31â€¯PM] the.mightydill
idk man im dumb...


[2/19/2022 11:32â€¯PM] szybet
i dont think there is anything in recovery partition


[2/19/2022 11:32â€¯PM] szybet
i dont remember putting anything there


[2/19/2022 11:32â€¯PM] the.mightydill


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-97EA9.png


[2/19/2022 11:32â€¯PM] the.mightydill
looks like the problem


[2/19/2022 11:36â€¯PM] szybet
invalid argument


[2/19/2022 11:36â€¯PM] tux_linux
awesome


[2/19/2022 11:36â€¯PM] tux_linux
format p2


[2/19/2022 11:36â€¯PM] tux_linux
copy overlaymount-rootfs.squashfs* files into it


[2/19/2022 11:39â€¯PM] tux_linux
Also
`echo rooted | dd of=/dev/mmcblk0 bs=512 seek=79872`


[2/19/2022 11:40â€¯PM] szybet
whots that


[2/19/2022 11:40â€¯PM] tux_linux
To allow the device to run a root kernel


[2/19/2022 11:40â€¯PM] szybet
whot does mean a root kernel


[2/19/2022 11:42â€¯PM] tux_linux
A kernel allowing SSH, root login, access to the device, etc.


[2/19/2022 11:43â€¯PM] tux_linux
See http://inkbox.ddns.net:40/wiki/index.php?title=General_information#Standard_and_Rooted

{Embed}
http://inkbox.ddns.net:40/wiki/index.php?title=General_information
General information


[2/19/2022 11:43â€¯PM] szybet
ah this


[2/19/2022 11:43â€¯PM] szybet
okay


[2/19/2022 11:46â€¯PM] szybet
and after 2s: NOOOOOOOOO IT CRASHED

{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220219_234501-146E9.png


[2/19/2022 11:46â€¯PM] szybet
```
Security policy not enforced; root access permitted.                                           
[   21.852131] EXT4-fs (mmcblk0p3): mounted filesystem with ordered data mode. Opts: (null)    
Verifying root filesystem's digital signature ...                                              
Done.                                                                                          
[   26.770665] EXT4-fs (mmcblk0p1): mounted filesystem with ordered data mode. Opts: (null)    
[   26.832827] EXT4-fs (mmcblk0p4): mounted filesystem with ordered data mode. Opts: (null)    
FATAL: InkBox GUI root filesystem's signature is invalid!                                      
Aborting boot and powering off ...                                                             
The system is going down NOW!                                                                  
Sent SIGTERM to all processes
```


[2/19/2022 11:46â€¯PM] szybet
:/


[2/19/2022 11:46â€¯PM] tux_linux
nice!


[2/19/2022 11:46â€¯PM] tux_linux
Now, you have to sign `gui_rootfs.isa` in p4


[2/19/2022 11:47â€¯PM] tux_linux
Important thing (as root):
```
unsquashfs -f -d g gui_rootfs.isa
cd g
echo "n306" > opt/device
rm ../gui_rootfs.isa
mksquashfs . ../gui_rootfs.isa -b 1048576 -comp xz -Xdict-size 100% -always-use-fragments
cd ..
rm -rf g
```
Then you can sign it
```
openssl dgst -sha256 -sign private.pem -out gui_rootfs.isa.dgst gui_rootfs.isa
```


[2/19/2022 11:48â€¯PM] tux_linux
Awesome!


[2/19/2022 11:48â€¯PM] szybet
error code 2


[2/19/2022 11:49â€¯PM] szybet
where is gui rootfs?


[2/19/2022 11:49â€¯PM] tux_linux
well, the splash


[2/19/2022 11:49â€¯PM] szybet
it isin't in emu


[2/19/2022 11:49â€¯PM] tux_linux
p4


[2/19/2022 11:49â€¯PM] szybet
OH


[2/19/2022 11:49â€¯PM] tux_linux
it was in user.sqsh


[2/19/2022 11:50â€¯PM] tux_linux
it isn't (typo correction ;p)


[2/19/2022 11:50â€¯PM] szybet
where did i unpack it...


[2/19/2022 11:50â€¯PM] tux_linux
you unpacked it to p4


[2/19/2022 11:50â€¯PM] szybet
oh right


[2/19/2022 11:50â€¯PM] tux_linux
It is `[p4]/gui_rootfs.isa`


[2/19/2022 11:50â€¯PM] szybet
god


[2/19/2022 11:51â€¯PM] szybet
its 23:50 and i dont think straight


[2/19/2022 11:51â€¯PM] tux_linux
np


[2/19/2022 11:52â€¯PM] szybet
can i do those steps not on the sd card?


[2/19/2022 11:52â€¯PM] tux_linux
yes


[2/19/2022 11:52â€¯PM] tux_linux
but you only unpack 40M worth of data


[2/19/2022 11:52â€¯PM] szybet
oh then


[2/19/2022 11:55â€¯PM] szybet
done, reboot?


[2/19/2022 11:55â€¯PM] szybet
and whot is opt/device


[2/19/2022 11:55â€¯PM] szybet
a identifier?


[2/19/2022 11:55â€¯PM] tux_linux
yes


[2/19/2022 11:55â€¯PM] tux_linux
to both


[2/19/2022 11:56â€¯PM] tux_linux
it shouldn't work right away, there should still be errors but it'll probably be better


[2/19/2022 11:58â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-68A9F.txt


[2/19/2022 11:58â€¯PM] szybet
so close...


[2/19/2022 11:59â€¯PM] szybet
modules are missing


[2/19/2022 11:59â€¯PM] szybet
i will be here for 20 more minutes, than i will go to sleep, tomorrow i should have some time but not so much that today


[2/20/2022 12:01â€¯AM] tux_linux
I am currently editing the scripts in rootfs to include the Nia


[2/20/2022 12:01â€¯AM] tux_linux
There is hope!


[2/20/2022 12:01â€¯AM] szybet
there is


[2/20/2022 12:03â€¯AM] tux_linux
i'll make you the missing ui bundle


[2/20/2022 12:03â€¯AM] tux_linux
then you could probably see inkbox gui working


[2/20/2022 12:03â€¯AM] tux_linux
uploading right now


[2/20/2022 12:04â€¯AM] szybet
? i thinked that the problem are modules


[2/20/2022 12:04â€¯AM] tux_linux
no


[2/20/2022 12:04â€¯AM] tux_linux
that's not essential


[2/20/2022 12:04â€¯AM] szybet
so whot failed?


[2/20/2022 12:05â€¯AM] tux_linux
ui bundle signature verification


[2/20/2022 12:05â€¯AM] tux_linux
also the fact that the ui bundle is not there currently


[2/20/2022 12:06â€¯AM] tux_linux
`wget 23.163.0.39/bundles/private/update-n306.isa`


[2/20/2022 12:06â€¯AM] szybet
um okay, why i can't sign it by myself?


[2/20/2022 12:06â€¯AM] szybet
using the key i generated


[2/20/2022 12:07â€¯AM] tux_linux
I signed them using the keys you sent me


[2/20/2022 12:07â€¯AM] tux_linux
So it will work


[2/20/2022 12:07â€¯AM] szybet
oh okay


[2/20/2022 12:07â€¯AM] szybet
whot did you need to update?


[2/20/2022 12:07â€¯AM] szybet
and whot should i do


[2/20/2022 12:10â€¯AM] tux_linux
oh


[2/20/2022 12:10â€¯AM] tux_linux
Actually it's called update.isa but it isn't really an update


[2/20/2022 12:11â€¯AM] tux_linux
`cp update.isa [p4]/update/update.isa`


[2/20/2022 12:11â€¯AM] szybet
its a sign


[2/20/2022 12:11â€¯AM] szybet
i know


[2/20/2022 12:11â€¯AM] tux_linux
contains inkbox binary, qt libs and python


[2/20/2022 12:15â€¯AM] tux_linux
don't forget to sync, then reboot and hopefully you should get an ui at some point


[2/20/2022 12:15â€¯AM] szybet
yea, i put it in the wrong directory


[2/20/2022 12:15â€¯AM] szybet
its hard to think


[2/20/2022 12:15â€¯AM] szybet
i always sync


[2/20/2022 12:16â€¯AM] szybet
so the update is actually a update, it updates the files


[2/20/2022 12:17â€¯AM] tux_linux
well, not really
but it doesn't really matter


[2/20/2022 12:17â€¯AM] szybet
```
 [ ok ]                                                                                        
/usr/bin/inkbox.sh: line 32: can't create /sys/class/leds/pmic_ledsb/brightness: nonexistent dy
 [ ok ]                                                                                        
                                                                                               
Welcome to InkBox OS 1.9                                                                       
Kernel 4.1.15 on armv7l (/dev/ttymxc0)                                                         
                                                                                               
inkbox login: [   64.246990] IRQ gpio=0, IN_TEN_SYS=0xd1,PWR_ON_TIMES=0x5b,int_sts=0x40,when ig
[   64.255851] PMU2: Watchdog timeout triggered. ===============                               
[   67.445394] PMU: ricoh61x_displayed_work Half-Clear CC, init_pswr(100), cc_delta(0)         

```


[2/20/2022 12:17â€¯AM] tux_linux
nice


[2/20/2022 12:17â€¯AM] tux_linux
so now look on the screen


[2/20/2022 12:17â€¯AM] szybet
i have no GUI but there is login


[2/20/2022 12:17â€¯AM] tux_linux
within some time you should see an ui appearing


[2/20/2022 12:17â€¯AM] szybet
oh, now it is


[2/20/2022 12:17â€¯AM] tux_linux
post a picture!!!


[2/20/2022 12:18â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220220_001746-472DB.jpg


[2/20/2022 12:18â€¯AM] tux_linux
very nice


[2/20/2022 12:18â€¯AM] tux_linux
So orientation will be to fix


[2/20/2022 12:19â€¯AM] tux_linux
Can you touch somewhere? does it appear to react?


[2/20/2022 12:19â€¯AM] tux_linux
Login as root


[2/20/2022 12:19â€¯AM] tux_linux
password is root


[2/20/2022 12:19â€¯AM] tux_linux
`echo 3 > /sys/class/graphics/fb0/rotate`
`killall inkbox-bin`


[2/20/2022 12:19â€¯AM] szybet
i think the touch is not correct


[2/20/2022 12:19â€¯AM] tux_linux
```env QT_QPA_PLATFORM=kobo:touchscreen_rotate=90:touchscreen_invert_x=auto:touchscreen_invert_y=auto:logicaldpitarget=0 chroot /kobo /mnt/onboard/.adds/inkbox/inkbox.sh```


[2/20/2022 12:20â€¯AM] tux_linux
because of that
try it and the last command above will restart inkbox


[2/20/2022 12:21â€¯AM] szybet
it does not launch


[2/20/2022 12:21â€¯AM] tux_linux
wait a bit?


[2/20/2022 12:21â€¯AM] tux_linux
what's the error?


[2/20/2022 12:22â€¯AM] szybet
now it worked?


[2/20/2022 12:22â€¯AM] szybet
i think wrong formatted from discord


[2/20/2022 12:22â€¯AM] tux_linux
so the touch is working?


[2/20/2022 12:23â€¯AM] szybet
it is


[2/20/2022 12:23â€¯AM] szybet
its working


[2/20/2022 12:23â€¯AM] tux_linux
yay!!


[2/20/2022 12:23â€¯AM] szybet
but i think it flickers too much


[2/20/2022 12:23â€¯AM] tux_linux
is your power led still blinking?


[2/20/2022 12:24â€¯AM] szybet
to much refreshers


[2/20/2022 12:24â€¯AM] szybet
yes it is


[2/20/2022 12:24â€¯AM] tux_linux
well inkbox is like that i guess?


[2/20/2022 12:24â€¯AM] tux_linux
do you have a video so I could see?


[2/20/2022 12:25â€¯AM] szybet
wait

{Reactions}
ğŸ‘ 

[2/20/2022 12:26â€¯AM] tux_linux
Does running `/opt/bin/shutdown_led` turns it off?


[2/20/2022 12:26â€¯AM] szybet
i entered library, snd there is sync in progress. for how long will it be like that


[2/20/2022 12:26â€¯AM] tux_linux
You aren't connected to Wi-Fi so it should fail shortly


[2/20/2022 12:26â€¯AM] szybet
it does not


[2/20/2022 12:26â€¯AM] tux_linux
Otherwise `killall inkbox-bin` and relaunch that env command above


[2/20/2022 12:27â€¯AM] tux_linux
the power light?


[2/20/2022 12:27â€¯AM] szybet
the sync


[2/20/2022 12:27â€¯AM] tux_linux
It does not fail?


[2/20/2022 12:27â€¯AM] szybet
and serial isin't working


[2/20/2022 12:27â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-FBA97.png


[2/20/2022 12:27â€¯AM] szybet
this is not good


[2/20/2022 12:27â€¯AM] szybet
oh now


[2/20/2022 12:28â€¯AM] tux_linux
bad serial connection


[2/20/2022 12:28â€¯AM] tux_linux
try rearranging the wires


[2/20/2022 12:28â€¯AM] szybet
yea, those wires are bad


[2/20/2022 12:28â€¯AM] szybet
no


[2/20/2022 12:29â€¯AM] tux_linux
hmm


[2/20/2022 12:29â€¯AM] tux_linux
`find /sys | grep led`


[2/20/2022 12:30â€¯AM] szybet
i could try a video


[2/20/2022 12:30â€¯AM] szybet
but it stopped responding in scrable


[2/20/2022 12:31â€¯AM] tux_linux
you can do it tomorrow otherwise


[2/20/2022 12:31â€¯AM] tux_linux
I'd just need that output


[2/20/2022 12:31â€¯AM] szybet
oh now it is


[2/20/2022 12:31â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-41735.txt


[2/20/2022 12:32â€¯AM] tux_linux
Ok;
`echo 1 > /sys/devices/platform/leds/leds/GLED; echo 0 > /sys/devices/platform/leds/leds/GLED`


[2/20/2022 12:33â€¯AM] szybet
yes, it turned off

{Reactions}
ğŸ‘ 

[2/20/2022 12:34â€¯AM] szybet
its hard to click the file button in the paint app and i cant exit so i will post some drawings


[2/20/2022 12:35â€¯AM] szybet
https://www.dropbox.com/s/mgoczd99ekv05yv/vid_20220220_003221.mp4?dl=0

{Embed}
https://www.dropbox.com/s/mgoczd99ekv05yv/vid_20220220_003221.mp4?dl=0
VID_20220220_003221.mp4
Shared with Dropbox
/mnt/data/projects/git/conversations/media/mgoczd99ekv05yv-D80BE


[2/20/2022 12:35â€¯AM] szybet
its slower than in plato, but yea its just a paint


[2/20/2022 12:36â€¯AM] szybet
oh goodnes how it flickers when i entered maps


[2/20/2022 12:36â€¯AM] szybet
thats not good


[2/20/2022 12:36â€¯AM] tux_linux
It does that with other Kobos too


[2/20/2022 12:37â€¯AM] szybet
thats not good, and not usable


[2/20/2022 12:37â€¯AM] tux_linux
But I was talking about a video showing the refresh


[2/20/2022 12:37â€¯AM] tux_linux
Well, light maps is not really the main purpose of InkBox


[2/20/2022 12:37â€¯AM] szybet
true


[2/20/2022 12:37â€¯AM] szybet
how do i exit this app


[2/20/2022 12:38â€¯AM] tux_linux
you can't


[2/20/2022 12:38â€¯AM] szybet
whot XD?


[2/20/2022 12:38â€¯AM] tux_linux
But relaunch InkBox from cmd


[2/20/2022 12:38â€¯AM] tux_linux
After `killall lightmaps lightmaps-bin`


[2/20/2022 12:39â€¯AM] szybet
done, but its stupid


[2/20/2022 12:39â€¯AM] tux_linux
I know


[2/20/2022 12:40â€¯AM] szybet
the touch is not working?


[2/20/2022 12:40â€¯AM] szybet
after i relaunched


[2/20/2022 12:40â€¯AM] tux_linux
Is there a dmesg random kernel trace?


[2/20/2022 12:40â€¯AM] szybet
the dmesg is really long...


[2/20/2022 12:41â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-CE8A8.txt


[2/20/2022 12:41â€¯AM] tux_linux
Are you sure it doesn't work?


[2/20/2022 12:42â€¯AM] szybet
yes


[2/20/2022 12:42â€¯AM] szybet
i forst launched inkbox and then killed maps, maybe becouse of this?


[2/20/2022 12:42â€¯AM] tux_linux
maybe


[2/20/2022 12:42â€¯AM] tux_linux
kill inkbox-bin and relaunch it


[2/20/2022 12:43â€¯AM] tux_linux
Maybe could you want to add `QT_LOGGING_RULES=qt.qpa.input` to `env` args


[2/20/2022 12:46â€¯AM] szybet
relaunched it, works


[2/20/2022 12:47â€¯AM] szybet
idk why but the serial connection isin't great, for example when i paste the command only the half goes there


[2/20/2022 12:47â€¯AM] szybet
and too much messages but that can be disabled


[2/20/2022 12:47â€¯AM] tux_linux
idk


[2/20/2022 12:47â€¯AM] tux_linux
Nice that it works


[2/20/2022 12:47â€¯AM] tux_linux
Almost finished updating my scripts


[2/20/2022 12:48â€¯AM] tux_linux
Then I'll update cpp code for GUI and it will be fully ported!


[2/20/2022 12:48â€¯AM] tux_linux
thanks for contributing


[2/20/2022 12:48â€¯AM] tux_linux
come back tomorrow, we can test further some things


[2/20/2022 12:49â€¯AM] szybet
i thank you too

{Reactions}
ğŸ‘ 

[2/20/2022 12:49â€¯AM] szybet
i will, but i wont have that much time than today

{Reactions}
ğŸ‘ 

[2/20/2022 12:49â€¯AM] szybet
https://www.dropbox.com/s/fpc5cbbm5vo2kna/vid_20220220_004759.mp4?dl=0

{Embed}
https://www.dropbox.com/s/fpc5cbbm5vo2kna/vid_20220220_004759.mp4?dl=0
VID_20220220_004759.mp4
Shared with Dropbox
/mnt/data/projects/git/conversations/media/fpc5cbbm5vo2kna-9BBDC


[2/20/2022 12:50â€¯AM] szybet
actually now it works good


[2/20/2022 12:50â€¯AM] szybet
maybe the first launch was faulty


[2/20/2022 12:51â€¯AM] tux_linux
thanks


[2/20/2022 12:51â€¯AM] tux_linux
if you want you can pull the rootfs repo


[2/20/2022 12:51â€¯AM] tux_linux
updated the scripts


[2/20/2022 12:51â€¯AM] szybet
im going to sleep now

{Reactions}
ğŸ‘ 

[2/20/2022 12:51â€¯AM] szybet
i will do it tomorrow


[2/20/2022 12:52â€¯AM] tux_linux
it flashes alright


[2/20/2022 12:52â€¯AM] tux_linux
no problem


[2/20/2022 11:29â€¯AM] szybet
now i have some time


[2/20/2022 11:37â€¯AM] szybet
@andi i have a question, its described here: https://github.com/kobolabs/Kobo-Reader/issues/116
in short, i think that the cpu handles usb support without any aditional chip, so could you check in the datasheet if it has support for host mode? not only gadget

{Embed}
https://github.com/kobolabs/Kobo-Reader/issues/116
[question] Kobo nia USB OTG as a host Â· Issue #116 Â· kobolabs/Kobo-...
First, I want to thank that this repository exists, I really appreciate that, It made kobo better than other ereaders on the market So here is my question, is it possible to use the kobo nia as a u...
/mnt/data/projects/git/conversations/media/116-3172C


[2/20/2022 12:00â€¯PM] szybet
In a random datasheet on the internet i see only usb otg and something about /dev/host


[2/20/2022 12:48â€¯PM] szybet
usb storage is not working


[2/20/2022 12:48â€¯PM] szybet
but i didn't updated


[2/20/2022 1:09â€¯PM] szybet
and i dont know how to add books?


[2/20/2022 1:09â€¯PM] szybet
i pasted them in gutenberg directory


[2/20/2022 1:09â€¯PM] szybet
and nothing


[2/20/2022 2:58â€¯PM] tux_linux
`mount [p4]/onboard /mnt`


[2/20/2022 2:58â€¯PM] tux_linux
Put your books in there


[2/20/2022 2:58â€¯PM] tux_linux
It's normal that USB storage isn't working yet
We didn't compile modules


[2/20/2022 3:09â€¯PM] szybet
you could just write the instructions for that, i will make it in the future


[2/20/2022 3:10â€¯PM] tux_linux
Basically `make ARCH=arm CROSS_COMPILE=arm-nickel-linux-gnueabihf- modules`


[2/20/2022 3:11â€¯PM] tux_linux
Then `make ARCH=arm CROSS_COMPILE=arm-nickel-linux-gnueabihf- INSTALL_MOD_PATH=/tmp/modules`
And make squashfs of this directory


[2/20/2022 3:13â€¯PM] tux_linux
But I'll make you the archive
It's located in the initrd, in `opt/modules.sqsh`


[2/20/2022 3:34â€¯PM] szybet
I checked quickly the pdf preview, its better than in plato and faster than in koreader but the sliders sometimes dont respond, and it makes it unusable

{Reactions}
ğŸ‘ 

[2/20/2022 3:34â€¯PM] szybet
the library didn't loaded correctly? idk


[2/20/2022 3:34â€¯PM] tux_linux
sometimes it's difficult to reach them


[2/20/2022 3:34â€¯PM] tux_linux
I pushed the modules to the kernel repo


[2/20/2022 3:35â€¯PM] tux_linux
Faster? Better? Wow, I thought my PDF engine was the worst


[2/20/2022 3:35â€¯PM] szybet
the file chooser is the worst part, its just not made for touchscreen, and especielly for eink

{Reactions}
ğŸ‘ 

[2/20/2022 3:36â€¯PM] szybet
koreader is written in lua, so yea. and plato uses gestures not silders, and those gestures didn't worked for me


[2/20/2022 3:36â€¯PM] tux_linux (pinned)
So now you can recompile it, mass storage won't work right away but you can try to see if usbnet works (when connecting your Kobo via USB to your computer, it should show up as an Ethernet device)
```
echo true > [p1]/flags/USBNET_ENABLE
```


[2/20/2022 3:36â€¯PM] tux_linux
Also, before doing that, pull the rootfs repo and make a rootfs.squashfs again, sign it and copy it into p3


[2/20/2022 3:37â€¯PM] tux_linux
I modified the CPP code yesterday, so I'll share a GUI bundle at 23.163.0.39 shortly


[2/20/2022 3:38â€¯PM] szybet
i will try those modyfication next week, and if not in the next month


[2/20/2022 3:38â€¯PM] tux_linux
oh


[2/20/2022 3:38â€¯PM] szybet
i dont have time for this in the nearest time, school sucks


[2/20/2022 3:39â€¯PM] tux_linux
Well, I can sure wait, but maybe I won't be able to support it in 1.9 directly


[2/20/2022 3:45â€¯PM] tux_linux
But anyways, thanks for your time and if you happen to have some this week, please try and report back!
P.S.: Updated GUI bundle now, available at http://23.163.0.39/bundles/private/update-n306.isa


[2/20/2022 3:48â€¯PM] tux_linux
I don't really have an alternative, but you can search books with the search button, in "Local storage"


[2/22/2022 9:55â€¯PM] szybet
If inkbox wants to be used by normal users than this must dissapear


[2/22/2022 10:26â€¯PM] tux_linux
Well, I mean, it isn't *that* bad


[2/22/2022 11:22â€¯PM] szybet
it is it is


[2/23/2022 3:57â€¯PM] szybet
In meantime when i dont have time to do anything, could you describe how Windows are working in inkbox? Is it xorg, is it fbink or combined?


[2/23/2022 5:18â€¯PM] tux_linux
What's "Windows"?


[2/23/2022 5:18â€¯PM] szybet
like the file chooser


[2/23/2022 5:18â€¯PM] szybet
thats a window


[2/23/2022 5:18â€¯PM] tux_linux
Main GUI is Qt+FBInk, and KoBox is X11


[2/23/2022 5:19â€¯PM] szybet
the whot


[2/23/2022 5:19â€¯PM] tux_linux
Well, KoBox is a way to run X11 in a Kobo


[2/23/2022 5:19â€¯PM] szybet
oh okay


[2/23/2022 5:20â€¯PM] szybet
so if i would develop an app, a seperate binary using fbink could it be launched as a window, like the file chooser?


[2/23/2022 5:29â€¯PM] tux_linux
No


[2/23/2022 5:30â€¯PM] tux_linux
Would need to be a cli, gtk or Qt app


[2/23/2022 5:30â€¯PM] szybet
why only gtk or qt? so i assume just a xorg app?


[2/23/2022 5:31â€¯PM] tux_linux
Yeah


[2/23/2022 5:31â€¯PM] tux_linux
Or Qt native


[2/23/2022 5:31â€¯PM] tux_linux
As InkBox GUI does


[2/23/2022 5:33â€¯PM] szybet
I have written some gui apps before, in https://github.com/emilk/egui so i think i could replace the file chooser with something bigger, nicer and more touch friendly

{Embed}
https://github.com/emilk/egui
GitHub - emilk/egui: egui: an easy-to-use immediate mode GUI in Rus...
egui: an easy-to-use immediate mode GUI in Rust that runs on both web and native - GitHub - emilk/egui: egui: an easy-to-use immediate mode GUI in Rust that runs on both web and native
/mnt/data/projects/git/conversations/media/egui-29879


[2/23/2022 5:33â€¯PM] tux_linux
The GUI is integrated in Qt and would be difficult to replace


[2/23/2022 5:33â€¯PM] tux_linux
See reader.cpp


[2/23/2022 5:34â€¯PM] szybet
i think that you call the file chooser, and get a path from it right?


[2/23/2022 5:34â€¯PM] tux_linux
Yes


[2/23/2022 5:35â€¯PM] szybet
so calling a external script and getting a string path from stdout would be easy too?


[2/23/2022 5:35â€¯PM] tux_linux
I guess?


[2/23/2022 5:35â€¯PM] tux_linux
But resources consuming too


[2/23/2022 5:36â€¯PM] szybet
not much, rust is good at performance


[2/23/2022 5:36â€¯PM] szybet
only the disk reading and some ram would be bad


[2/23/2022 5:36â€¯PM] szybet
plato is the fastest ereader software out there, and its written in rust


[2/23/2022 5:38â€¯PM] szybet
https://youtu.be/KaBj7acHRHk

{Embed}
Nicolas Mailloux
https://www.youtube.com/watch?v=KaBj7acHRHk
InkBox OS 1.5
InkBox OS is a complete operating system replacement for Kobo eReader devices. It currently runs on the Glo, Touch and Mini models. It is built around Qt 5.15.2 and namely features ePUB rendering. Along that, full KoBox/X11 support is integrated, allowing the user to run X apps natively on the device.
InkBox OS is built around a core concept: se...
/mnt/data/projects/git/conversations/media/hqdefault-A6FF0.jpg


[2/23/2022 5:39â€¯PM] szybet
you dont show here those maps that were glitching out on my device, are they even working on yours?


[2/23/2022 8:34â€¯PM] andi15701
i looked up in the datasheet, the magic mw commands in the bootloader should do the same thing as on imx6sl or 6sll


[2/23/2022 8:36â€¯PM] szybet
so whot it does?


[2/23/2022 8:37â€¯PM] szybet
can you share this datasheet? i want usb host get to work and the datasheets on the internet are bad


[2/23/2022 8:37â€¯PM] andi15701
usb host: probably just debugfs...


[2/23/2022 8:37â€¯PM] andi15701
mw magic: it overwrites the default configuration to boot from


[2/23/2022 8:38â€¯PM] andi15701
for the next resets until power down


[2/23/2022 8:38â€¯PM] szybet
no, i get these logs after echo host > role https://github.com/Szybet/kobo-nia-audio/blob/main/logs/dmesg-usb

{Embed}
https://github.com/Szybet/kobo-nia-audio/blob/main/logs/dmesg-usb
kobo-nia-audio/dmesg-usb at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/23/2022 8:38â€¯PM] andi15701
and in that case it is some kind of manufacturing mode where you boot from usb


[2/23/2022 8:38â€¯PM] szybet
oh nice


[2/23/2022 8:39â€¯PM] andi15701
you send uboot over usb


[2/23/2022 8:39â€¯PM] andi15701
so for devices with internal eMMC, it is the way to test a new u-boot before flashing


[2/23/2022 8:40â€¯PM] andi15701
cat /dev/zero >/dev/mmcblk0 also lets you end up in that mode


[2/23/2022 8:40â€¯PM] szybet
cool to know, in that way even more ereaders could run inkbox


[2/23/2022 8:40â€¯PM] andi15701
or removing the internatl sdcard


[2/23/2022 8:41â€¯PM] szybet
could you look at it? I would appreciate it


[2/23/2022 8:41â€¯PM] andi15701
hmm, did you apply external power supply?


[2/23/2022 8:41â€¯PM] szybet
i powered the external device, but not the kobo


[2/23/2022 8:41â€¯PM] andi15701
at least on the devices I needed some y-shaped cable


[2/23/2022 8:41â€¯PM] szybet
i ordered some usb ports to make a cable to power both of them, but i dont think thats the case?


[2/23/2022 8:42â€¯PM] szybet
y-shaped?


[2/23/2022 8:44â€¯PM] andi15701
that works for me

{Attachments}
/mnt/data/projects/git/conversations/media/IMG20220127180824-54FDA.jpg


[2/23/2022 8:44â€¯PM] szybet
does this power the kobo, and the device at the same time?


[2/23/2022 8:44â€¯PM] andi15701
yes


[2/23/2022 8:44â€¯PM] szybet
maybe thats it? why would it need it to be charged?


[2/23/2022 8:45â€¯PM] andi15701
there might be protection diodes letting stuff go to vbus, probably higher voltages at the data lines than on vbus might be a problem


[2/23/2022 8:46â€¯PM] szybet
thats a good explanation


[2/23/2022 8:46â€¯PM] szybet
does your cable also have the OTG ID pin wired to ground?


[2/23/2022 8:46â€¯PM] andi15701
no


[2/23/2022 8:47â€¯PM] andi15701
usual, that is the signal to provide power at vbus


[2/23/2022 8:48â€¯PM] andi15701
but if that does not work, I would leave it alone to not confuse other devices


[2/23/2022 8:48â€¯PM] szybet
and to detect to which mode to switch, host or gadget


[2/23/2022 8:49â€¯PM] andi15701
but there you have the debugfs for


[2/23/2022 8:49â€¯PM] szybet
yes, but some devices, and ic make it automaticly


[2/23/2022 8:50â€¯PM] andi15701
yes, correct, that is the way it *should* be


[2/23/2022 8:51â€¯PM] szybet
true


[2/23/2022 8:51â€¯PM] szybet
thanks, i will try it


[2/23/2022 8:52â€¯PM] andi15701
I am using a similar setup at my bicycle, it charges via hub dynamo my ebookreader


[2/23/2022 8:52â€¯PM] andi15701
and my bicycle is a usb gadget providing gps and some other sensor data


[2/23/2022 9:37â€¯PM] szybet
it actually works when its charging


[2/23/2022 9:37â€¯PM] szybet
thanks


[2/23/2022 9:37â€¯PM] szybet
:D


[2/23/2022 11:34â€¯PM] tux_linux
Yes they do


[2/24/2022 5:19â€¯PM] szybet
hmmm, good but why not on nia


[2/24/2022 5:19â€¯PM] tux_linux
No wifi yet?


[2/24/2022 5:20â€¯PM] szybet
that makes sense :D


[2/24/2022 5:20â€¯PM] szybet
where are they?


[2/24/2022 5:20â€¯PM] szybet
and do i need to use the openssl thing with modules too?


[2/24/2022 5:20â€¯PM] szybet
i maybe have some time now to do it


[2/24/2022 6:21â€¯PM] tux_linux
In `initrd/n306/opt/modules.sqsh`


[2/24/2022 6:21â€¯PM] tux_linux
No


[2/24/2022 6:21â€¯PM] tux_linux
Just recompile the kernel


[2/24/2022 6:22â€¯PM] tux_linux
It **should** work


[2/24/2022 6:22â€¯PM] szybet
why


[2/24/2022 6:22â€¯PM] tux_linux
Well, to have the new modules


[2/24/2022 6:22â€¯PM] tux_linux
They are embedded in initrd which is embedded in the kernel


[2/24/2022 6:22â€¯PM] tux_linux
They are mounted at boot at `/modules`


[2/24/2022 6:23â€¯PM] szybet
why the kernel that i use now cant be used


[2/24/2022 6:23â€¯PM] tux_linux
Because it has the old initrd


[2/24/2022 6:23â€¯PM] tux_linux
Which modules are not for this device


[2/24/2022 6:23â€¯PM] szybet
okay


[2/25/2022 9:26â€¯PM] szybet
@tux-linux  could i get privileges to pin messages in the chat?


[2/25/2022 9:26â€¯PM] szybet
i want to make a guide and it will help to track the steps


[2/25/2022 10:45â€¯PM] tux_linux
Will do, Discord preferences seem rather convoluted


[2/25/2022 11:42â€¯PM] szybet
Well, i had some time, to less to install the modules but i started creating the guide: 
https://github.com/Szybet/kobo-nia-audio/blob/main/inkbox.md

There are some points where @tux-linux could you please help? i writed there everything at the beginning to know
mine point is to make inkbox more *hacking* friendly, not only for mine project but for everyone. Also discord is such a horrible place where knowledge gets pulled in into a black hole.

{Embed}
https://github.com/Szybet/kobo-nia-audio/blob/main/inkbox.md
kobo-nia-audio/inkbox.md at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[2/25/2022 11:43â€¯PM] szybet
There is no point to hack into kobo's software when there is inkbox, i think that could be the main "feature" of inkbox, not only open source, secure but also easy to understand and make your ereader like you would like with some tinkerink and developer skills

{Reactions}
ğŸ‘ 

[2/26/2022 4:36â€¯AM] tux_linux
Thanks ğŸ¤©
Like, really, this is very useful
I'll address your points shortly (somewhere this weekend, might I hope) and send a PR to your repo


[2/26/2022 5:01â€¯AM] the.mightydill
oooooh nia audio :O


[2/26/2022 6:59â€¯AM] tux_linux
But I mean, Discord is not so bad for development. Since they introduced threads it's way easier to organize and sort things as we like so that they only focus on one subject.


[2/26/2022 11:23â€¯AM] szybet
But the knowledge is getting list in a long run


[2/26/2022 11:24â€¯AM] szybet
A magnet connected thin module with lithium polimer battery at the back, with jack and usb support


[2/26/2022 11:28â€¯AM] szybet
Thanks!

{Reactions}
ğŸ‘ 

[2/26/2022 5:30â€¯PM] tux_linux
Ok, done with it, what do you think?
https://github.com/Kobo-InkBox/kobo-nia-audio/blob/main/inkbox.md

{Embed}
https://github.com/Kobo-InkBox/kobo-nia-audio/blob/main/inkbox.md
kobo-nia-audio/inkbox.md at main Â· Kobo-InkBox/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Kobo-InkBox/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-E213A


[3/5/2022 8:12â€¯PM] szybet
And im back


[3/5/2022 8:14â€¯PM] szybet
why did you forked an entire repo just to edit one file... i will add some changes to my repo, with notes for you whot to add next


[3/5/2022 8:15â€¯PM] tux_linux
well. because that's the way it should be?


[3/5/2022 8:15â€¯PM] szybet
maybe make a pull request / push it to the repo then?


[3/5/2022 8:15â€¯PM] tux_linux
isn't that what I did?


[3/5/2022 8:16â€¯PM] szybet
oh, when you make a pull requests it forks the repo for you


[3/5/2022 8:16â€¯PM] szybet
okay, my bad

{Reactions}
ğŸ‘ 

[3/5/2022 8:50â€¯PM] szybet
i have added some points for you to clarify:
- https://github.com/Szybet/kobo-nia-audio/blob/main/inkbox.md

I will upgrade the guide with further instructions soon

{Embed}
https://github.com/Szybet/kobo-nia-audio/blob/main/inkbox.md
kobo-nia-audio/inkbox.md at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[3/5/2022 8:51â€¯PM] szybet
now i want to make my ereader to work


[3/5/2022 8:52â€¯PM] szybet
You could focus more on the "From sources" points, becouse it would be hard for me to write them, to reverse enginere your work


[3/5/2022 9:03â€¯PM] szybet
i will apply them


[3/5/2022 9:04â€¯PM] szybet
I pulled the repo, and pasted modules.sqsh into p3


[3/5/2022 9:08â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-E3A77.png


[3/5/2022 9:08â€¯PM] szybet
modules didn't work


[3/5/2022 9:09â€¯PM] szybet
the gui is still rotated wrong


[3/5/2022 9:10â€¯PM] szybet
i will try to recompile the kernel


[3/5/2022 9:21â€¯PM] szybet
now the brightness does not work:

{Attachments}
/mnt/data/projects/git/conversations/media/message-7E06C.txt


[3/5/2022 9:22â€¯PM] szybet
the same


[3/5/2022 9:24â€¯PM] szybet
The library button after sync gives me an error, i see only one book that I choosed earlier using the file manager


[3/5/2022 9:28â€¯PM] szybet
Why does a EPUB take like 1s to change a page... weird. And its REALLY hard to click the home button in option, while reading a book


[3/5/2022 9:29â€¯PM] szybet
Thats all i can do, im waiting for your instructions on how to make it work. I will have some time so i will apply your patches *faster* @tux-linux


[3/5/2022 9:34â€¯PM] szybet
another one... after i tryied to shutdown, it gives me this information in serial: `[  941.008667] imx_epdc_v2_fb 228c000.epdc: waiting for EPD power down ,current state=1...     `


[3/5/2022 10:41â€¯PM] tux_linux
i'm there


[3/5/2022 10:41â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel/commit/eee6be472914973e15dc6edbb7de4dd20ae0cc1f

{Embed}
https://github.com/Kobo-InkBox/kernel/commit/eee6be472914973e15dc6edbb7de4dd20ae0cc1f
N306: Change kernel load sector & size Â· Kobo-InkBox/kernel@eee6be4
/mnt/data/projects/git/conversations/media/eee6be472914973e15dc6edbb7de4dd20ae0cc1f-BFFF7


[3/5/2022 10:42â€¯PM] tux_linux
That's the commit related to kernel sector & load size in the bootloader


[3/5/2022 10:42â€¯PM] szybet
Okay, i will add it, thanks


[3/5/2022 10:44â€¯PM] tux_linux
and that one


[3/5/2022 10:44â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel/commit/98c6b9d9f11d52f496c693f3515dc2ad79588cdf

{Embed}
https://github.com/Kobo-InkBox/kernel/commit/98c6b9d9f11d52f496c693f3515dc2ad79588cdf
N306: Update scripts Â· Kobo-InkBox/kernel@98c6b9d
/mnt/data/projects/git/conversations/media/98c6b9d9f11d52f496c693f3515dc2ad79588cdf-B6A13


[3/5/2022 10:44â€¯PM] tux_linux
Basically I just changed the load size from `18432` to `20480`


[3/5/2022 10:45â€¯PM] tux_linux
Really? Usually it is pretty easy on my devices...


[3/5/2022 10:46â€¯PM] tux_linux
Did you connect to Wi-Fi?


[3/5/2022 10:46â€¯PM] tux_linux
If you recompiled and flashed the kernel


[3/5/2022 10:46â€¯PM] szybet
it clickes the info button


[3/5/2022 10:47â€¯PM] szybet
nope, i dind't see a option to do that


[3/5/2022 10:47â€¯PM] tux_linux
oooh


[3/5/2022 10:47â€¯PM] tux_linux
wait


[3/5/2022 10:47â€¯PM] szybet
the modules doesn't work


[3/5/2022 10:47â€¯PM] tux_linux
what?


[3/5/2022 10:47â€¯PM] tux_linux
define doesn't work


[3/5/2022 10:48â€¯PM] szybet
+ usb storage dosn't work too


[3/5/2022 10:49â€¯PM] tux_linux
ok, modules error then


[3/5/2022 10:49â€¯PM] tux_linux
what does `ls -shal /modules` output?


[3/5/2022 10:50â€¯PM] tux_linux
You don't paste `modules.sqsh` in p3, it's embedded in the initrd, at `opt/modules.sqsh`
But if you recompiled the kernel then idk
Did you pull the repo before?


[3/5/2022 10:52â€¯PM] szybet
yes, i pulled


[3/5/2022 10:53â€¯PM] szybet
one sec


[3/5/2022 10:55â€¯PM] szybet
now the kernel does not boot...

{Attachments}
/mnt/data/projects/git/conversations/media/message-F9866.txt


[3/5/2022 10:55â€¯PM] szybet
wtf?


[3/5/2022 10:56â€¯PM] tux_linux
With what command did you compile the kernel?


[3/5/2022 10:57â€¯PM] szybet
env GITDIR="${PWD}" TOOLCHAINDIR="${PWD}/toolchain/arm-nickel-linux-gnueabihf/" THREADS=$(($(nproc)*2)) TARGET=arm-nickel-linux-gnueabihf scripts/build_kernel.sh n306 root


[3/5/2022 10:57â€¯PM] szybet
hm... do i need to do it manually?


[3/5/2022 10:57â€¯PM] tux_linux
Ok, seems alright


[3/5/2022 10:57â€¯PM] tux_linux
No


[3/5/2022 10:57â€¯PM] tux_linux
Is it the first time you boot the kernel since


[3/5/2022 10:57â€¯PM] tux_linux
this happened?


[3/5/2022 10:58â€¯PM] szybet
look, its weird

1 flashed the kernel
2 booted from it, i described the problems above
3 poweroff
4 1 hour passes
5 its bricked


[3/5/2022 10:58â€¯PM] tux_linux
what if you reboot?


[3/5/2022 10:58â€¯PM] szybet
how?


[3/5/2022 10:59â€¯PM] tux_linux
Well, hold down the power buttton for some seconds


[3/5/2022 10:59â€¯PM] tux_linux
Also, what's the kernel's size?


[3/5/2022 10:59â€¯PM] szybet
i have tryied it, but i will try it one more time


[3/5/2022 10:59â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-7578C.png


[3/5/2022 11:00â€¯PM] tux_linux
Should be alright


[3/5/2022 11:00â€¯PM] szybet
look at this line:
```
[    7.824733] Modules linked in:                                                              
[    7.827893] CPU: 0 PID: 49 Comm: kworker/0:3 Not tainted 4.1.15 #1                          
[    7.834128] Hardware name: Freescale i.MX6 Ultralite (Device Tree)                          
[    7.840357] Workqueue: events epdc_firmware_work_func
```


[3/5/2022 11:01â€¯PM] szybet
something with modules


[3/5/2022 11:01â€¯PM] tux_linux
No, `Modules linked in:` only displays the loaded modules. If there were some, it would say:
`Modules linked in: g_ether sdio_wifi_pwr 8189fs` for example


[3/5/2022 11:02â€¯PM] szybet
then idk


[3/5/2022 11:02â€¯PM] tux_linux
So now it just says that no modules are loaded


[3/5/2022 11:02â€¯PM] tux_linux
me too


[3/5/2022 11:02â€¯PM] tux_linux
Can you boot Nickel? Do you have another SD card you could try Kobo factory image on?


[3/5/2022 11:03â€¯PM] szybet
okay i will try, but it will take time, like 1h to write the image


[3/5/2022 11:03â€¯PM] tux_linux
then wait


[3/5/2022 11:03â€¯PM] tux_linux
Does your screen flash when it boots the kernel?


[3/5/2022 11:03â€¯PM] tux_linux
Or it panics before?


[3/5/2022 11:03â€¯PM] szybet
nope


[3/5/2022 11:03â€¯PM] szybet
nope


[3/5/2022 11:04â€¯PM] tux_linux
Try flashing the Nickel kernel at sector 81920
And see if it flashes
It will panic (won't be able to find the rootfs) but it should flash iirc


[3/5/2022 11:07â€¯PM] szybet
```Starting kernel ...                                                                            
                                                                                               
/cpus/cpu@0 missing clock-frequency property                                                   
sy7636-pmic sy7636-pmic: request vcom gpio failed (-16)!                                       
sy7636-pmic sy7636-pmic: request powerup gpio failed (-16)!                                    
syscon-poweroff 20cc000.snvs:snvs-poweroff: pm_power_off already claimed 800217f0 ntx_machine_f
PMU: ricoh61x_battery_probe : version is RICOH61x_BATTERY_VERSION: 2014.02.21 V3.1.0.0-Solutio9
==== calc_soc_by_voltageMethod E60U22 ====                                                     
imx6ul-pinctrl 2290000.iomuxc-snvs: pin MX6ULL_PAD_SNVS_TAMPER3 already requested by 21f8000.is
imx6ul-pinctrl 2290000.iomuxc-snvs: pin-5 (gpio-keys) status -22                               
imx6ul-pinctrl 2290000.iomuxc-snvs: could not request pin 5 (MX6ULL_PAD_SNVS_TAMPER3) from gros
gpio-keys gpio-keys: Error applying setting, reverse things back                               
Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Li.
---[ end Kernel panic - not syncing: No working init found.  Try passing init= option to kerne.
```


[3/5/2022 11:07â€¯PM] szybet
nickel boots ok


[3/5/2022 11:07â€¯PM] tux_linux
so screen flashes?


[3/5/2022 11:08â€¯PM] szybet
no


[3/5/2022 11:09â€¯PM] tux_linux
Can you try reflashing InkBox kernel? Maybe something in the MMC was overwritten for whatever reason and it caused the error you posted before...


[3/5/2022 11:14â€¯PM] szybet
what is at 2048?


[3/5/2022 11:15â€¯PM] szybet
sector


[3/5/2022 11:15â€¯PM] szybet
in inkbox


[3/5/2022 11:15â€¯PM] tux_linux
81920


[3/5/2022 11:15â€¯PM] tux_linux
nothing, InkBox uses sector 81920 for kernel


[3/5/2022 11:16â€¯PM] szybet
there is *nothing*, really *nothing*?


[3/5/2022 11:16â€¯PM] tux_linux
well, probably remnants of old nickel kernels I guess?


[3/5/2022 11:16â€¯PM] szybet
hm, okay


[3/5/2022 11:16â€¯PM] tux_linux
but nothing is loaded from there at boot


[3/5/2022 11:16â€¯PM] szybet
after rewriting its the same


[3/5/2022 11:17â€¯PM] tux_linux
Welcome to the Mysterious and Incredibly Painful to Resolve Issues Worldâ„¢ï¸!
And if you remove `kernel/initrd/n306/opt/modules.sqsh`, then recompile it, what happens?


[3/5/2022 11:20â€¯PM] szybet
one sec

{Reactions}
ğŸ‘ 

[3/5/2022 11:20â€¯PM] szybet
could it be possible to skip the modules, like integrate them into the kernel ( i mean in menuconfig * not m )


[3/5/2022 11:21â€¯PM] tux_linux
No, because some can't always be loaded


[3/5/2022 11:21â€¯PM] tux_linux
e.g., wi-fi modules


[3/5/2022 11:21â€¯PM] tux_linux
otherwise battery would drain very fast


[3/5/2022 11:22â€¯PM] szybet
:/


[3/5/2022 11:23â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-65ED8.txt


[3/5/2022 11:23â€¯PM] szybet
not good


[3/5/2022 11:24â€¯PM] tux_linux
whatever that is


[3/5/2022 11:24â€¯PM] tux_linux
@andi , do you have some insight on this? I'm lost


[3/5/2022 11:24â€¯PM] tux_linux
hm


[3/5/2022 11:25â€¯PM] tux_linux
Did you, at some point, write InkBox kernel to sector 2048 of the MMC?


[3/5/2022 11:25â€¯PM] tux_linux
And there it could have overwritten some of the waveform, dtb, etc.


[3/5/2022 11:25â€¯PM] szybet
its possible, but you said there is nothing


[3/5/2022 11:25â€¯PM] szybet
:D


[3/5/2022 11:26â€¯PM] tux_linux
Well, after ~6MB of sector 2048, there are DTB, ntxfw, waveform and other blobs that allow the kernel to boot (that's why the kernel needs to be moved to sector 81920, otherwise there would be problems


[3/5/2022 11:26â€¯PM] szybet
so now we know


[3/5/2022 11:26â€¯PM] szybet
i will write 32 Mb of the old nickel image, and then write the inkbox bootloader


[3/5/2022 11:27â€¯PM] szybet
is that all that i need?


[3/5/2022 11:27â€¯PM] tux_linux
hmm


[3/5/2022 11:27â€¯PM] tux_linux
Be sure to save the partition layout


[3/5/2022 11:27â€¯PM] tux_linux
Writing the old nickel image on top of that will work, but it will overwrite the partition layout


[3/5/2022 11:28â€¯PM] tux_linux
However, if you go into fdisk after that and re-partition the MMC as it was before, you'll be able to mount partitions again and nothing will be lost (don't format them though, just re-partition the MMC)


[3/5/2022 11:28â€¯PM] szybet
where is the partition layout


[3/5/2022 11:28â€¯PM] szybet
oh, like that


[3/5/2022 11:28â€¯PM] tux_linux
Well, you can do `fdisk -l`


[3/5/2022 11:28â€¯PM] szybet
i will make a copy of the whole sd card, and then do this

{Reactions}
ğŸ‘ 

[3/5/2022 11:35â€¯PM] szybet
meantime you could look at the other problems, errors


[3/5/2022 11:38â€¯PM] tux_linux
Well, if porting InkBox to the Nia leads to a hardware brick, better to solve this first


[3/5/2022 11:39â€¯PM] tux_linux
(I don't say it's an hardware brick, but it might be for some obscure reason that I don't know about)


[3/5/2022 11:44â€¯PM] szybet
this would be sad


[3/5/2022 11:44â€¯PM] szybet
but whot module could brick it


[3/5/2022 11:46â€¯PM] szybet
if you think this could be a brick, i will simply flash the entire nickel image


[3/5/2022 11:47â€¯PM] szybet
also, can I dd the whole disk using ums from u-boot?


[3/5/2022 11:47â€¯PM] tux_linux
yeah, but I don't think ums is that stable for such a big write


[3/5/2022 11:47â€¯PM] tux_linux
I'd just take the SD out


[3/6/2022 12:54â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220306_005358-04B35.jpg


[3/6/2022 12:54â€¯AM] szybet
nickel booted


[3/6/2022 12:54â€¯AM] szybet
its not bricked


[3/6/2022 12:55â€¯AM] tux_linux
ok very nice


[3/6/2022 12:55â€¯AM] tux_linux
Maybe MMC corruption then?


[3/6/2022 12:55â€¯AM] szybet
tommorow i will restore inkbox, and the first 30Mb sector + flash the inkbox bootloader and we will see

{Reactions}
ğŸ‘ 

[3/6/2022 12:56â€¯AM] szybet
idk, tommorow we will see

{Reactions}
ğŸ‘ 

[3/6/2022 11:05â€¯AM] szybet
inkbox boots and shows error code 3


[3/6/2022 11:05â€¯AM] szybet
there are all partitions exept p1


[3/6/2022 11:05â€¯AM] szybet
and i cant create it
```
WybÃ³r (domyÅ›lnie e): p

Wybrano partycjÄ™ 4
Pierwszy sektor (2048-31116287, domyÅ›lnie 2048): 49152

Sector 49152 is already allocated.
```


[3/6/2022 11:06â€¯AM] szybet
hmmm


[3/6/2022 11:06â€¯AM] szybet
i will just clear the parition table


[3/6/2022 11:20â€¯AM] szybet
kernel without modules booted:

{Attachments}
/mnt/data/projects/git/conversations/media/message-5E8B7.txt


[3/6/2022 11:27â€¯AM] szybet
kernel with modules booted, but here are the errors again:
```
 [ ok ]                                                                                        
 * WARNING: clock skew detected!                                                               
insmod: ERROR: could not load module /modules/arcotg_udc.ko: No such file or directory         
 [ !! ]                                                                                        
 * ERROR: modules_init failed to start                                                         
 * Mounting onboard storage filesystem ...                                                     
 [ ok ]                                                                                        
 * Splash screen ...                                                                           
 [ ok ]                                                                                        
 * Starting USBNet ...                                                                         
 * USB networking is disabled. Please set the USBNET_ENABLE flag and try again.                
 [ ok ]                                                                                        
 * WARNING: clock skew detected!                                                               
insmod: ERROR: could not load module /modules/arcotg_udc.ko: No such file or directory         
 [ !! ]                                                                                        
 * ERROR: modules_init failed to start
```


[3/6/2022 11:28â€¯AM] szybet
here is the command that you requested:
```
kobo:~# ls -shal /modules                                                                      
total 1K                                                                                       
     0 drwxr-xr-x    5 user     user          52 Feb 20  2022 .                                
     1 drwxr-xr-x   29 root     root        1.0K Jan  1 00:16 ..                               
     0 drwxr-xr-x    4 user     user          37 Feb 20  2022 drivers                          
     0 drwxr-xr-x    3 user     user          31 Feb 20  2022 fs                               
     0 drwxr-xr-x    2 user     user          32 Feb 20  2022 wifi                             
kobo:~# 
```


[3/6/2022 11:29â€¯AM] szybet
i still need to do this :/


[3/6/2022 11:32â€¯AM] szybet
usb storage does not work


[3/6/2022 11:32â€¯AM] szybet
i dont know where is the wifi menu...


[3/6/2022 11:33â€¯AM] szybet
but brightness works back, thats good


[3/6/2022 11:33â€¯AM] szybet
system shutdown does not work


[3/6/2022 11:33â€¯AM] szybet
so we are in the start, everything works exept modules @tux-linux


[3/6/2022 2:56â€¯PM] tux_linux
Did you update the rootfs?


[3/6/2022 2:57â€¯PM] szybet
how exactly?


[3/6/2022 2:57â€¯PM] tux_linux
I added the Nia in all scripts


[3/6/2022 2:57â€¯PM] szybet
you mean making a squash and replacing the one on the ereader?


[3/6/2022 2:58â€¯PM] tux_linux
Yes


[3/6/2022 2:58â€¯PM] tux_linux
And pulling the repo


[3/6/2022 2:58â€¯PM] szybet
the rootfs is in the emu repo?


[3/6/2022 2:59â€¯PM] tux_linux
Kobo Nia support was added in this commit https://github.com/Kobo-InkBox/rootfs/commit/c9e39e40161ed82a616abf46686ec8edc2e4a8c5

{Embed}
https://github.com/Kobo-InkBox/rootfs/commit/c9e39e40161ed82a616abf46686ec8edc2e4a8c5
Kobo Nia (N306) support Â· Kobo-InkBox/rootfs@c9e39e4


[3/6/2022 2:59â€¯PM] tux_linux
In the rootfs repo


[3/6/2022 3:00â€¯PM] tux_linux
`env GITDIR="${PWD}" ./release.sh`
Does that remind you of something?


[3/6/2022 3:00â€¯PM] szybet
this compresses the rootfs


[3/6/2022 3:01â€¯PM] tux_linux
.


[3/6/2022 3:01â€¯PM] tux_linux
Sign it there
And copy the two files in p3


[3/6/2022 3:01â€¯PM] szybet
yea sure


[3/6/2022 3:01â€¯PM] szybet
will this fix the modules?


[3/6/2022 3:02â€¯PM] tux_linux
Yep


[3/6/2022 3:02â€¯PM] tux_linux
Well it should


[3/6/2022 3:03â€¯PM] tux_linux
I'll make you another GUI bundle too
I added quite a lot of things to InkBox since two weeks ago


[3/6/2022 3:03â€¯PM] szybet
the most important thing is the screen rotating


[3/6/2022 3:05â€¯PM] tux_linux
It will be fixed


[3/6/2022 3:06â€¯PM] tux_linux
https://github.com/Kobo-InkBox/gui-bundle
FYI, you can now generate the bundle yourself, but it requires you to compile InkBox Qt code before, which is painful to setup, so probably better if I just send it to you

{Embed}
https://github.com/Kobo-InkBox/gui-bundle
GitHub - Kobo-InkBox/gui-bundle: InkBox GUI bundle contents and gen...
InkBox GUI bundle contents and generation script. Contribute to Kobo-InkBox/gui-bundle development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/gui-bundle-0D0A1


[3/6/2022 3:07â€¯PM] szybet
qt is pain to setup..


[3/6/2022 3:08â€¯PM] tux_linux
Yes


[3/6/2022 3:08â€¯PM] tux_linux
But it's not impossible


[3/6/2022 3:09â€¯PM] szybet
its still pain


[3/6/2022 3:14â€¯PM] szybet
wow, everything works


[3/6/2022 3:14â€¯PM] szybet
wifi is there


[3/6/2022 3:14â€¯PM] szybet
brightness too


[3/6/2022 3:15â€¯PM] szybet
well usb storage does not work


[3/6/2022 3:15â€¯PM] tux_linux
Very nice
Let's see USB


[3/6/2022 3:15â€¯PM] tux_linux
What happens if you do `lsmod`?


[3/6/2022 3:16â€¯PM] tux_linux
It connects, really?


[3/6/2022 3:16â€¯PM] szybet
haven't tried yet, but wifi networks are showing up


[3/6/2022 3:16â€¯PM] tux_linux
It seems to be somewhat difficult to connect to some networks in InkBox for some reason


[3/6/2022 3:17â€¯PM] tux_linux
(There it should use `dhcpcd` I think)


[3/6/2022 3:17â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220306_151603-2E1BC.png


[3/6/2022 3:17â€¯PM] szybet
hmmm


[3/6/2022 3:17â€¯PM] tux_linux
Can you see something on your computer?


[3/6/2022 3:17â€¯PM] tux_linux
`dmesg | tail`?


[3/6/2022 3:17â€¯PM] szybet
isin't it just wpa-supplicant?


[3/6/2022 3:18â€¯PM] tux_linux
and dhcpcd


[3/6/2022 3:19â€¯PM] tux_linux
wpa_supplicant is used to actually connect to the network, and then dhcpcd is launched to obtain a DHCP lease


[3/6/2022 3:19â€¯PM] tux_linux
See scripts in https://github.com/Kobo-InkBox/rootfs/tree/master/usr/local/bin/wifi


[3/6/2022 3:20â€¯PM] szybet
on the pc in dmesg is nothing


[3/6/2022 3:21â€¯PM] szybet
here is from inkbox:

{Attachments}
/mnt/data/projects/git/conversations/media/message-8553C.txt


[3/6/2022 3:21â€¯PM] szybet
just usb plugged 1


[3/6/2022 3:21â€¯PM] tux_linux
And `lsmod`?


[3/6/2022 3:21â€¯PM] szybet
kobo:~# lsmod                                                                                  
Module                  Size  Used by                                                          
8189fs               1294344  0                                                                
sdio_wifi_pwr            593  0


[3/6/2022 3:21â€¯PM] tux_linux
strange


[3/6/2022 3:21â€¯PM] tux_linux
`find /modules`


[3/6/2022 3:23â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-62D22.txt


[3/6/2022 3:23â€¯PM] szybet
there is usb gadget


[3/6/2022 3:24â€¯PM] tux_linux
ok, seems I didn't update the script for mass storage


[3/6/2022 3:24â€¯PM] tux_linux
`insmod /modules/drivers/usb/gadget/legacy/g_mass_storage.ko`?


[3/6/2022 3:25â€¯PM] tux_linux
Will probably lead to an error


[3/6/2022 3:26â€¯PM] szybet
connection failed with wifi


[3/6/2022 3:26â€¯PM] tux_linux
I'll test on my Libra which has the same kernel


[3/6/2022 3:26â€¯PM] tux_linux
Now try `/usr/local/bin/wifi/connect_to_network.sh ssid_there passphrase_there`


[3/6/2022 3:26â€¯PM] tux_linux
And post output


[3/6/2022 3:26â€¯PM] szybet
```
[root@ArchSzybet resources]# insmod /modules/drivers/usb/gadget/legacy/g_mass_storage.ko
insmod: ERROR: could not load module /modules/drivers/usb/gadget/legacy/g_mass_storage.ko: No such file or directory
```


[3/6/2022 3:26â€¯PM] tux_linux
huh?


[3/6/2022 3:26â€¯PM] tux_linux
I meant, on the Kobo


[3/6/2022 3:26â€¯PM] tux_linux
Not on your host


[3/6/2022 3:27â€¯PM] szybet
the keyboard is horrible, or the touch is not accurate


[3/6/2022 3:27â€¯PM] szybet
wrong terminal...


[3/6/2022 3:28â€¯PM] tux_linux
There could be a solution, we'll try it
(newer platform plugin)
Though it comes with a cost, we need to change more files and we have to rely on VNC graphics in X11 instead of directly printing damage events on the framebuffer with fbink_xdamage


[3/6/2022 3:28â€¯PM] szybet
```
kobo:~# insmod /modules/drivers/usb/gadget/legacy/g_mass_storage.ko                            
insmod: ERROR: could not insert module /modules/drivers/usb/gadget/legacy/g_mass_storage.ko: Ue
kobo:~# 
```


[3/6/2022 3:28â€¯PM] tux_linux
Otherwise it displays very strangely, don't know why


[3/6/2022 3:28â€¯PM] tux_linux
What's the error? Can't read the rest


[3/6/2022 3:29â€¯PM] szybet
```
kobo:~# insmod /modules/drivers/usb/gadget/legacy/g_mass_storage.ko
insmod: ERROR: could not insert module /modules/drivers/usb/gadget/legacy/g_mass_storage.ko: Unknown symbol in module
kobo:~#
```


[3/6/2022 3:31â€¯PM] szybet
```
kobo:~# /usr/local/bin/wifi/connect_to_network.sh hotspotttssss 12345678
ifconfig: ioctl 0x8913 failed: No such device
Successfully initialized wpa_supplicant
rfkill: Cannot get wiphy information
ioctl[SIOCSIWAP]: Operation not permitted
no such user dhcpcd
dhcpcd-9.4.0 starting
eth0: waiting for carrier
timed out
dhcpcd exited
dhcpcd_fork_cb: truncated read 0 (expected 4)
DHCP request failed.
```


[3/6/2022 3:31â€¯PM] tux_linux
Ok, we'll try with udhcpc then


[3/6/2022 3:31â€¯PM] tux_linux
`udhcpc -i eth0`?


[3/6/2022 3:32â€¯PM] tux_linux (pinned)
I'll get you back with module deps after testing on my Libra, hang on


[3/6/2022 3:32â€¯PM] szybet
i dont understand, but in nickel the touchscreen was just a /dev/input/mouse1 device


[3/6/2022 3:32â€¯PM] szybet
this worked:
```
[root@ArchSzybet resources]# ssh root@10.42.0.28
The authenticity of host '10.42.0.28 (10.42.0.28)' can't be established.
ED25519 key fingerprint is SHA256:58MR3tZxGQMSKnyf5y6N6F2scXOG2wQ7IC33dMsJmDA.
This key is not known by any other names
Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
Warning: Permanently added '10.42.0.28' (ED25519) to the list of known hosts.
root@10.42.0.28's password: 
Welcome to InkBox!
* Warning *
Root filesystem is mounted read-only.
Invoke `ifsctl mnt rootfs rw' to make it read-write.
```
```
kobo:~# udhcpc -i eth0
udhcpc: started, v1.33.0
udhcpc: sending discover
udhcpc: sending select for 10.42.0.28
udhcpc: lease of 10.42.0.28 obtained, lease time 3600
kobo:~# 
```


[3/6/2022 3:33â€¯PM] tux_linux
ok so that works


[3/6/2022 3:33â€¯PM] tux_linux
I'll change it in the script


[3/6/2022 3:33â€¯PM] szybet
those damn small sliders


[3/6/2022 3:33â€¯PM] szybet
i simply cant use them


[3/6/2022 3:34â€¯PM] szybet
in brightness, wifi select, pfg reader


[3/6/2022 3:34â€¯PM] szybet
why cant those be bigger :/


[3/6/2022 3:34â€¯PM] tux_linux
Maybe they could be
It has to do with padding and DPI
On older devices, they are monstrous because of the low screen resolution


[3/6/2022 3:35â€¯PM] tux_linux
BTW, you can take screenshots with `chroot /kobo fbgrab /tmp/dump.png`


[3/6/2022 3:35â€¯PM] szybet
wait, maybe ui scalling


[3/6/2022 3:35â€¯PM] szybet
thats cool


[3/6/2022 3:35â€¯PM] tux_linux
What's `cat /data/config/09-dpi/config`?


[3/6/2022 3:35â€¯PM] szybet
187


[3/6/2022 3:35â€¯PM] tux_linux
whoops


[3/6/2022 3:36â€¯PM] tux_linux
hang on


[3/6/2022 3:36â€¯PM] szybet
ui scalling factor has a slider to set it, and its hard too ğŸ˜†


[3/6/2022 3:36â€¯PM] tux_linux
`echo 195 > /data/config/09-dpi/config`


[3/6/2022 3:36â€¯PM] tux_linux
Then `rc-service inkbox_gui restart`


[3/6/2022 3:37â€¯PM] tux_linux
^ should take ~1m to launch


[3/6/2022 3:37â€¯PM] szybet
UI scalling does not save


[3/6/2022 3:37â€¯PM] szybet
the arrows to change the settings site are hard to click too


[3/6/2022 3:39â€¯PM] szybet
still the same


[3/6/2022 3:39â€¯PM] tux_linux
Maybe are you on a build where I didn't actually support the Nia


[3/6/2022 3:39â€¯PM] tux_linux (pinned)
`cat /data/config/09-dpi/config`?


[3/6/2022 3:39â€¯PM] szybet
187 still


[3/6/2022 3:39â€¯PM] szybet
weird


[3/6/2022 3:40â€¯PM] tux_linux
`echo 195 > /data/config/09-dpi/config`
`killall inkbox-bin; env QT_QPA_PLATFORM=kobo chroot /kobo /mnt/onboard/.adds/inkbox/inkbox.sh`


[3/6/2022 3:40â€¯PM] szybet
```
kobo:~# echo 195 > /data/config/09-dpi/config
kobo:~# 
kobo:~# killall inkbox-bin; chroot /kobo /mnt/onboard/.adds/inkbox/inkbox.sh
Terminated
iniparser: cannot open /mnt/onboard/.kobo/nightmode.ini
cat: can't open '/mnt/onboard/.kobo/Kobo/Kobo eReader.conf': No such file or directory
qt.qpa.plugin: Could not find the Qt platform plugin "xcb" in ""
This application failed to start because no Qt platform plugin could be initialized. Reinstalling the application may fix this probl.

Available platform plugins are: kobo, vnc.

Aborted
kobo:~# 
```


[3/6/2022 3:41â€¯PM] tux_linux
oh


[3/6/2022 3:41â€¯PM] tux_linux
edited command above


[3/6/2022 3:43â€¯PM] szybet
well it worked


[3/6/2022 3:43â€¯PM] szybet
its better


[3/6/2022 3:43â€¯PM] tux_linux
ok, probably wrong build then


[3/6/2022 3:43â€¯PM] tux_linux
It will last that way until you re-open Settings I guess


[3/6/2022 3:43â€¯PM] szybet
but still i need to click hard to choose the 1 on the keyboard


[3/6/2022 3:43â€¯PM] tux_linux
strange


[3/6/2022 3:43â€¯PM] szybet
just maybe make a bigger keyboard


[3/6/2022 3:44â€¯PM] szybet
or the ui scalling could work for it


[3/6/2022 3:44â€¯PM] tux_linux
hmm


[3/6/2022 3:44â€¯PM] tux_linux
Have a screenshot?


[3/6/2022 3:44â€¯PM] szybet
of whot


[3/6/2022 3:44â€¯PM] szybet
keyboard?


[3/6/2022 3:46â€¯PM] tux_linux
yeah


[3/6/2022 3:49â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220306_154906-F639D.jpg


[3/6/2022 3:49â€¯PM] szybet
making a photo is faster


[3/6/2022 3:49â€¯PM] tux_linux
Don't you think that would be easier ;p?


[3/6/2022 3:49â€¯PM] tux_linux
ah


[3/6/2022 3:49â€¯PM] szybet
sending the image to pc is harder


[3/6/2022 3:50â€¯PM] tux_linux
scp?


[3/6/2022 3:50â€¯PM] szybet
usb storage doesn't work, wifi didn't wanted to connect
```
kobo:~# udhcpc -i eth0
udhcpc: started, v1.33.0
udhcpc: sending discover
udhcpc: sending discover
udhcpc: sending discover
udhcpc: sending discover
udhcpc: sending discover
udhcpc failed to get a DHCP lease
udhcpc: sending discover
udhcpc: sending discover
udhcpc: sending discover
udhcpc: sending discover
udhcpc: sending discover
udhcpc failed to get a DHCP lease
^C
kobo:~# 
```


[3/6/2022 3:51â€¯PM] tux_linux
ah


[3/6/2022 3:51â€¯PM] tux_linux
`echo true > /boot/flags/USBNET_ENABLE`


[3/6/2022 3:51â€¯PM] tux_linux
reboot


[3/6/2022 3:51â€¯PM] tux_linux
then the Kobo will show up as an Ethernet device when plugged in via USB to your computer


[3/6/2022 3:51â€¯PM] tux_linux
And you can do `ifconfig usb0 192.168.2.2`, then `ssh root@192.168.2.2` to connect


[3/6/2022 3:52â€¯PM] szybet
okay okay


[3/6/2022 3:52â€¯PM] szybet
i will know for the future

{Reactions}
ğŸ‘ 

[3/6/2022 3:52â€¯PM] tux_linux
Tried on my Glo which has the same screen resolution, no issues at all clicking "1"


[3/6/2022 3:53â€¯PM] tux_linux
At least I did document this (usbnet): https://inkbox.ddns.net/wiki/index.php?title=Boot_flags

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Boot_flags
Boot flags


[3/6/2022 3:58â€¯PM] szybet
well the keyboard is acceptable when the ereader is not placed horizontally on the table


[3/6/2022 3:58â€¯PM] szybet
so skip that problem for now


[3/6/2022 4:00â€¯PM] tux_linux
Probably touch input handler hardware issue


[3/6/2022 4:00â€¯PM] szybet
maybe


[3/6/2022 4:00â€¯PM] szybet
but its usable, needs some practice to use well


[3/6/2022 4:01â€¯PM] szybet
what's next? what do we need to make nia fully usable? usb storage, wifi and?


[3/6/2022 4:01â€¯PM] tux_linux
`insmod /modules/drivers/usb/gadget/function/usb_f_mass_storage.ko`
`insmod /modules/drivers/usb/gadget/legacy/g_mass_storage`


[3/6/2022 4:01â€¯PM] tux_linux
Does that work?


[3/6/2022 4:01â€¯PM] tux_linux
it's pretty much it ;D


[3/6/2022 4:02â€¯PM] tux_linux
Then I'll have to make the recoveryfs, but that will happen just before the release


[3/6/2022 4:02â€¯PM] szybet
the brightness slider works great when the dpi is set to 195

{Reactions}
ğŸ‘ 

[3/6/2022 4:04â€¯PM] szybet
sliders in pdf reader are acceptable

{Reactions}
ğŸ‘ 

[3/6/2022 4:05â€¯PM] tux_linux
?


[3/6/2022 4:05â€¯PM] szybet
```
kobo:~# insmod /modules/drivers/usb/gadget/function/usb_f_mass_storage.ko
insmod: ERROR: could not insert module /modules/drivers/usb/gadget/function/usb_f_mass_storage.ko: Unknown symbol in module
kobo:~# insmod /modules/drivers/usb/gadget/legacy/g_mass_storage
insmod: ERROR: could not load module /modules/drivers/usb/gadget/legacy/g_mass_storage: No such file or directory
kobo:~# 
```


[3/6/2022 4:07â€¯PM] tux_linux
ok, it's missing some deps


[3/6/2022 4:08â€¯PM] szybet
do other kobo ereader have audio support ( i mean integrated jacks )?


[3/6/2022 4:08â€¯PM] tux_linux
no


[3/6/2022 4:08â€¯PM] szybet
so if i want add audio support to inkbox i need to fork the entire project right?


[3/6/2022 4:09â€¯PM] tux_linux
```
insmod "/modules/fs/configfs/configfs.ko"
insmod "/modules/drivers/usb/gadget/libcomposite.ko"
insmod "/modules/drivers/usb/gadget/function/usb_f_mass_storage.ko
insmod /modules/g_mass_storage.ko file="/data/storage/onboard" removable=y stall=0
```


[3/6/2022 4:10â€¯PM] tux_linux
yeah, basically?


[3/6/2022 4:11â€¯PM] tux_linux
But you have the release private key, so you can do pretty much all you want


[3/6/2022 4:11â€¯PM] szybet
you wouldn't allow a switch in the settings that adds / dissables some 3 buttons in the ereader while reading, and a app to control playlists?


[3/6/2022 4:11â€¯PM] tux_linux
Why not?


[3/6/2022 4:12â€¯PM] szybet
becouse its bloat for most users


[3/6/2022 4:12â€¯PM] tux_linux
If I can disable/enable them based on the device, no problem


[3/6/2022 4:12â€¯PM] szybet
well, okay


[3/6/2022 4:12â€¯PM] szybet
are the apps list a json list or smth, or is it hard coded?


[3/6/2022 4:12â€¯PM] tux_linux
But make them in Qt


[3/6/2022 4:12â€¯PM] tux_linux
No, sorry ;p


[3/6/2022 4:12â€¯PM] tux_linux
Hardcoded


[3/6/2022 4:12â€¯PM] szybet
this needs to be changed


[3/6/2022 4:12â€¯PM] tux_linux
But it's not very difficult to add one


[3/6/2022 4:13â€¯PM] szybet
yes i know, but the app maybe not


[3/6/2022 4:13â€¯PM] tux_linux
Add a button and a label

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-BB955.png


[3/6/2022 4:13â€¯PM] szybet
it would be still easier to add a app without reinstalling the gui budle


[3/6/2022 4:13â€¯PM] tux_linux
If you do it in X11, it isn't hardcoded


[3/6/2022 4:13â€¯PM] tux_linux
You can make your extension


[3/6/2022 4:13â€¯PM] tux_linux
And it will show up automatically in KoBox apps


[3/6/2022 4:14â€¯PM] szybet
i think making it bare metal fbink would be better for performance?


[3/6/2022 4:14â€¯PM] tux_linux
yes


[3/6/2022 4:14â€¯PM] szybet
so i will do a bare metal


[3/6/2022 4:14â€¯PM] tux_linux
But Qt would be more flexible than FBInk honestly


[3/6/2022 4:14â€¯PM] tux_linux
It already has all the widgets you need


[3/6/2022 4:15â€¯PM] tux_linux
And don't even think of doing your app in Python, if that was what you were planning to


[3/6/2022 4:15â€¯PM] szybet
so there are automatically showed apps for x11 or how?


[3/6/2022 4:15â€¯PM] szybet
God forbid no python


[3/6/2022 4:15â€¯PM] tux_linux
Python in embedded device is a PITA, because first it isn't a compiled language
ok yeah you know the rest


[3/6/2022 4:15â€¯PM] szybet
rust


[3/6/2022 4:15â€¯PM] tux_linux
good choice


[3/6/2022 4:15â€¯PM] tux_linux
Though I won't help you in cross-compiling rust ;p


[3/6/2022 4:16â€¯PM] szybet
the plato project already made it


[3/6/2022 4:16â€¯PM] tux_linux
This handles user extensions https://github.com/Kobo-InkBox/kernel/blob/0fc7867d587b651f901756063d4c14417b344bb0/initrd/common/startx#L215-L298


[3/6/2022 4:16â€¯PM] tux_linux
Does that work?


[3/6/2022 4:19â€¯PM] szybet
```
kobo:~# insmod "/modules/fs/configfs/configfs.ko"
insmod: ERROR: could not insert module /modules/fs/configfs/configfs.ko: File exists
kobo:~# [ 3995.928562] ==== DISABLE ibat ====

kobo:~# insmod "/modules/drivers/usb/gadget/libcomposite.ko"
insmod: ERROR: could not insert module /modules/drivers/usb/gadget/libcomposite.ko: File exists
kobo:~# insmod "/modules/drivers/usb/gadget/function/usb_f_mass_storage.ko
> ^C
kobo:~# insmod "/modules/drivers/usb/gadget/function/usb_f_mass_storage.ko"
kobo:~# insmod "/modules/drivers/usb/gadget/legacy/g_mass_storage.ko"
[ 4013.100897] no file given for LUN0
[ 4013.104348] g_mass_storage ci_hdrc.0: failed to start g_mass_storage: -22
insmod: ERROR: could not insert module /modules/drivers/usb/gadget/legacy/g_mass_storage.ko: Invalid parameters
kobo:~# insmod "/modules/drivers/usb/gadget/legacy/g_mass_storage.ko"
[ 4021.057430] no file given for LUN0
[ 4021.062868] g_mass_storage ci_hdrc.0: failed to start g_mass_storage: -22
insmod: ERROR: could not insert module /modules/drivers/usb/gadget/legacy/g_mass_storage.ko: Invalid parameters
kobo:~# [ 4025.062738] ==== DISABLE ibat ====
 * WARNING: you are stopping a boot service
 * Unmounting onboard storage filesystem ...
 [ ok ]
 * WARNING: you are stopping a boot service
 * Stopping USBNet ...
rmmod: ERROR: Module /modules/g_ether is not currently loaded
 [ !! ]
 * ERROR: usbnet failed to stop
[ 4054.385494] ==== DISABLE ibat ====

```


[3/6/2022 4:19â€¯PM] szybet
no*** usb storage on the pc


[3/6/2022 4:21â€¯PM] tux_linux
ok nice


[3/6/2022 4:22â€¯PM] szybet
so it does not work


[3/6/2022 4:22â€¯PM] tux_linux
Well there's progress


[3/6/2022 4:22â€¯PM] szybet
yes


[3/6/2022 4:22â€¯PM] tux_linux
`rmmod` all the modules you have loaded now


[3/6/2022 4:22â€¯PM] szybet
can i just reboot?


[3/6/2022 4:22â€¯PM] tux_linux
no


[3/6/2022 4:22â€¯PM] tux_linux
because it will load them again with usbnet


[3/6/2022 4:23â€¯PM] tux_linux
I edited the commands there so that it can work


[3/6/2022 4:23â€¯PM] szybet
```
kobo:~# lsmod
Module                  Size  Used by
usb_f_mass_storage     38079  0
libcomposite           44430  1 usb_f_mass_storage
configfs               23581  3 libcomposite,usb_f_mass_storage
8189fs               1294344  0
sdio_wifi_pwr            593  0
kobo:~# 
```
so i:
rmod usb_f_mass_storage
rmod libcomposite
rmod configfs
right?


[3/6/2022 4:23â€¯PM] tux_linux
All of them


[3/6/2022 4:24â€¯PM] szybet
oh


[3/6/2022 4:24â€¯PM] tux_linux
But yeah, the ones you suggested are the most relevant


[3/6/2022 4:26â€¯PM] szybet
```
kobo:~# insmod "/modules/fs/configfs/configfs.ko"
kobo:~# insmod "/modules/drivers/usb/gadget/libcomposite.ko"
kobo:~# insmod "/modules/drivers/usb/gadget/function/usb_f_mass_storage.ko"
kobo:~# insmod /modules/g_mass_storage.ko file="/data/storage/onboard" removable
=y stall=0
insmod: ERROR: could not load module /modules/g_mass_storage.ko: No such file or directory
kobo:~# insmod /modules/g_mass_storage.ko file="/data/storage/onboard" removable
=y stall=0
insmod: ERROR: could not load module /modules/g_mass_storage.ko: No such file or directory
kobo:~# 
``` hmm


[3/6/2022 4:26â€¯PM] szybet
also, the 3 line miss a "

{Reactions}
ğŸ‘ 

[3/6/2022 4:26â€¯PM] tux_linux
oh


[3/6/2022 4:27â€¯PM] tux_linux
change `/modules/g_mass_storage.ko` to `/modules/drivers/usb/gadget/legacy/g_mass_storage.ko`


[3/6/2022 4:28â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-DC300.png


[3/6/2022 4:28â€¯PM] szybet
now it works


[3/6/2022 4:28â€¯PM] tux_linux
Nice!


[3/6/2022 4:28â€¯PM] szybet
could you describe what you needed to do?


[3/6/2022 4:31â€¯PM] tux_linux
Just load the necessary modules
When on newer kernels, there are dependencies to make the function itself more portable instead of just throwing everything into one module like on older devices


[3/6/2022 4:32â€¯PM] szybet
it adds more complecity


[3/6/2022 4:32â€¯PM] szybet
but okay

{Reactions}
ğŸ‘ 

[3/6/2022 4:33â€¯PM] tux_linux
Normally it's handled by `modprobe`


[3/6/2022 4:34â€¯PM] szybet
oh, okay


[3/6/2022 4:34â€¯PM] tux_linux
But when you have it scripted up it isn't a problem anymore


[3/6/2022 4:34â€¯PM] szybet
that makes sense


[3/6/2022 4:34â€¯PM] szybet
maybe the wifi choosing menu a little bigger? its smolllll


[3/6/2022 4:34â€¯PM] tux_linux
I know right


[3/6/2022 4:34â€¯PM] szybet
when i choose wifi, or a file i don't need to see anything else


[3/6/2022 4:34â€¯PM] tux_linux
There isn't any way I found to do this


[3/6/2022 4:34â€¯PM] szybet
good


[3/6/2022 4:35â€¯PM] tux_linux
Maybe it will be slightly bigger in the new UI bundle I made


[3/6/2022 4:35â€¯PM] szybet
its qt right?


[3/6/2022 4:35â€¯PM] tux_linux
I'll upload it now


[3/6/2022 4:35â€¯PM] tux_linux
yeah


[3/6/2022 4:35â€¯PM] tux_linux
sizePolicy things...


[3/6/2022 4:35â€¯PM] szybet
not good


[3/6/2022 4:35â€¯PM] szybet
but still


[3/6/2022 4:37â€¯PM] tux_linux
ok uploaded


[3/6/2022 4:37â€¯PM] tux_linux
http://23.163.0.39/bundles/private/update-n306.isa


[3/6/2022 4:37â€¯PM] tux_linux
Download this, copy it in `/data/firmware/update.isa`
`sync` and reboot


[3/6/2022 4:40â€¯PM] szybet
are you sure? on which partition is it?


[3/6/2022 4:41â€¯PM] tux_linux
p4


[3/6/2022 4:41â€¯PM] tux_linux
`/data/firmware` is a symlink to `[p4]/update`


[3/6/2022 4:43â€¯PM] szybet
what should i test


[3/6/2022 4:43â€¯PM] szybet
now


[3/6/2022 4:46â€¯PM] szybet
usb storage does not work


[3/6/2022 4:48â€¯PM] tux_linux
Did you update the bundle?


[3/6/2022 4:48â€¯PM] szybet
i replaced the file


[3/6/2022 4:49â€¯PM] szybet
so yes


[3/6/2022 4:49â€¯PM] tux_linux
And restarted the device?


[3/6/2022 4:50â€¯PM] szybet
i inserted it using u-boot and the booted


[3/6/2022 4:50â€¯PM] tux_linux
Ok


[3/6/2022 4:50â€¯PM] tux_linux
So is the dpi set to 195?


[3/6/2022 4:51â€¯PM] szybet
could i get privileges to pin messages, that i wouldn't need to scroll


[3/6/2022 4:51â€¯PM] szybet
yes it is 195


[3/6/2022 4:51â€¯PM] tux_linux
I tried to allow you but didn't find how


[3/6/2022 4:53â€¯PM] tux_linux
Ok found it


[3/6/2022 4:53â€¯PM] tux_linux
Try now


[3/6/2022 4:53â€¯PM] szybet
Pinned a message.


[3/6/2022 4:53â€¯PM] szybet
yes


[3/6/2022 4:54â€¯PM] tux_linux
Now open settings


[3/6/2022 4:54â€¯PM] tux_linux
Close settings


[3/6/2022 4:54â€¯PM] tux_linux
And check dpi again


[3/6/2022 4:54â€¯PM] szybet
the same


[3/6/2022 4:59â€¯PM] tux_linux
Ok good


[3/6/2022 5:00â€¯PM] tux_linux
Pull kernel repo


[3/6/2022 5:01â€¯PM] tux_linux
I made a symlink for g_mass_storage in modules


[3/6/2022 5:01â€¯PM] tux_linux
Recompile and flash it


[3/6/2022 5:05â€¯PM] szybet
what is the max kernel size?


[3/6/2022 5:06â€¯PM] tux_linux
~10.5M


[3/6/2022 5:07â€¯PM] szybet
adding usb audio, and alsa support could take it


[3/6/2022 5:07â€¯PM] szybet
not good


[3/6/2022 5:07â€¯PM] tux_linux
An alternative would maybe be to put the kernel in a partition and `extload` it from U-Boot


[3/6/2022 5:08â€¯PM] tux_linux
Or put the modules... somewhere else


[3/6/2022 5:08â€¯PM] szybet
this this this this


[3/6/2022 5:08â€¯PM] tux_linux
(well, alsa modules I mean)


[3/6/2022 5:08â€¯PM] szybet
well this too


[3/6/2022 5:08â€¯PM] szybet
usb storage does not work


[3/6/2022 5:08â€¯PM] tux_linux
Because the tricky part is that the modules differ for each device


[3/6/2022 5:08â€¯PM] tux_linux
not normal


[3/6/2022 5:09â€¯PM] tux_linux
`find /modules`


[3/6/2022 5:09â€¯PM] szybet
```
kobo:~# find /modules
/modules
/modules/drivers
/modules/drivers/mmc
/modules/drivers/mmc/card
/modules/drivers/mmc/card/sdio_wifi_pwr.ko
/modules/drivers/usb
/modules/drivers/usb/gadget
/modules/drivers/usb/gadget/function
/modules/drivers/usb/gadget/function/u_ether.ko
/modules/drivers/usb/gadget/function/usb_f_acm.ko
/modules/drivers/usb/gadget/function/usb_f_ecm.ko
/modules/drivers/usb/gadget/function/usb_f_ecm_subset.ko
/modules/drivers/usb/gadget/function/usb_f_eem.ko
/modules/drivers/usb/gadget/function/usb_f_fs.ko
/modules/drivers/usb/gadget/function/usb_f_mass_storage.ko
/modules/drivers/usb/gadget/function/usb_f_obex.ko
/modules/drivers/usb/gadget/function/usb_f_rndis.ko
/modules/drivers/usb/gadget/legacy
/modules/drivers/usb/gadget/legacy/g_ether.ko
/modules/drivers/usb/gadget/legacy/g_mass_storage.ko
/modules/drivers/usb/gadget/libcomposite.ko
/modules/fs
/modules/fs/configfs
/modules/fs/configfs/configfs.ko
/modules/g_mass_storage.ko
/modules/wifi
/modules/wifi/8189fs.ko
```


[3/6/2022 5:09â€¯PM] tux_linux
Oh I know


[3/6/2022 5:09â€¯PM] tux_linux
I only insmod usb_f_mass_storage in inkbox


[3/6/2022 5:09â€¯PM] tux_linux
which is not enough


[3/6/2022 5:10â€¯PM] tux_linux
hang on; I'll change that


[3/6/2022 5:10â€¯PM] tux_linux
`lsmod`?


[3/6/2022 5:10â€¯PM] szybet
```
kobo:~# 
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# lsmod
Module                  Size  Used by
kobo:~# 
```


[3/6/2022 5:10â€¯PM] szybet
HMMMMMMMMM


[3/6/2022 5:10â€¯PM] tux_linux
What


[3/6/2022 5:11â€¯PM] szybet
exactly


[3/6/2022 5:11â€¯PM] tux_linux
rc-service inkbox_gui restart


[3/6/2022 5:11â€¯PM] tux_linux
And your will see insmod output on stdout


[3/6/2022 5:12â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-7A00D.png


[3/6/2022 5:12â€¯PM] tux_linux
Strange error with gled
Anyways
Try hitting connect button


[3/6/2022 5:12â€¯PM] tux_linux
In GUI


[3/6/2022 5:13â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-C9CF3.png


[3/6/2022 5:13â€¯PM] szybet
i will reboot


[3/6/2022 5:13â€¯PM] szybet
and check one more time

{Reactions}
ğŸ‘ 

[3/6/2022 5:17â€¯PM] szybet
the same result


[3/6/2022 5:19â€¯PM] tux_linux
nothing on lsmod?


[3/6/2022 5:20â€¯PM] szybet
nothing


[3/6/2022 5:20â€¯PM] tux_linux
Please generate system report


[3/6/2022 5:20â€¯PM] tux_linux
`Settings -> Page 2 -> Generate system report`


[3/6/2022 5:20â€¯PM] szybet
can i do this throught cmd?


[3/6/2022 5:20â€¯PM] tux_linux
No


[3/6/2022 5:20â€¯PM] tux_linux
Well


[3/6/2022 5:20â€¯PM] tux_linux
maybe


[3/6/2022 5:20â€¯PM] tux_linux
`/usr/local/bin/generate_system_report.sh`


[3/6/2022 5:21â€¯PM] tux_linux
yeah you can actually


[3/6/2022 5:21â€¯PM] tux_linux
share the pdf file


[3/6/2022 5:21â€¯PM] szybet
?


[3/6/2022 5:21â€¯PM] tux_linux
it will produce a pdf in onboard storage


[3/6/2022 5:23â€¯PM] tux_linux
you will get errors but those are harmless


[3/6/2022 5:24â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/sysreport-2012-01-01_16.26.46-71761.pdf


[3/6/2022 5:25â€¯PM] tux_linux
your RTC needs to sync ;p


[3/6/2022 5:25â€¯PM] szybet
all ereaders have problems with handling rtc


[3/6/2022 5:25â€¯PM] szybet
it sucks


[3/6/2022 5:26â€¯PM] tux_linux
yeah


[3/6/2022 5:26â€¯PM] tux_linux
I see nothing wrong in the report


[3/6/2022 5:27â€¯PM] tux_linux
What if you try insmod-ing the modules yourself?


[3/6/2022 5:28â€¯PM] szybet
those?


[3/6/2022 5:29â€¯PM] tux_linux
yeah


[3/6/2022 5:30â€¯PM] szybet
usb storage works


[3/6/2022 5:31â€¯PM] tux_linux
ok


[3/6/2022 5:31â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-6BD38.png


[3/6/2022 5:31â€¯PM] tux_linux
`dmesg`?


[3/6/2022 5:32â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-174B4.txt


[3/6/2022 5:32â€¯PM] szybet
here is everything


[3/6/2022 5:33â€¯PM] tux_linux
Ok, seems good


[3/6/2022 5:35â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/inkbox-BA6B9


[3/6/2022 5:35â€¯PM] tux_linux (pinned)
On host:
```
cd ~/Downloads
busybox httpd -p 8000 -f
```
On Kobo:
```
rm /tmp/inkbox; wget your.computer.ip.there:8000/inkbox -O /tmp/inkbox; chmod +x /tmp/inkbox; umount -l -f /kobo/mnt/onboard/.adds/inkbox/inkbox-bin; mount --bind /tmp/inkbox /kobo/mnt/onboard/.adds/inkbox/inkbox-bin; killall inkbox-bin inkbox inkbox.sh; env QT_QPA_PLATFORM=kobo chroot /kobo /mnt/onboard/.adds/inkbox/inkbox.sh
```


[3/6/2022 5:36â€¯PM] tux_linux
But first, `rmmod` all modules related to usb mass storage


[3/6/2022 5:37â€¯PM] szybet
what is this binary?


[3/6/2022 5:37â€¯PM] tux_linux
This basically bind-mounts a temporary binary for testing


[3/6/2022 5:37â€¯PM] tux_linux
InkBox binary


[3/6/2022 5:37â€¯PM] tux_linux
I added this code

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-943F9.png


[3/6/2022 5:38â€¯PM] szybet
it does not have wifi, so net over usb is needed?


[3/6/2022 5:38â€¯PM] tux_linux
yeah


[3/6/2022 5:38â€¯PM] tux_linux
can't you use udhcpc?


[3/6/2022 5:39â€¯PM] tux_linux
try to connect, let dhcpcd fail and then connect with udhcpc


[3/6/2022 5:39â€¯PM] tux_linux
Anyway I changed the scripts in the rootfs
I'll push that once we fix mass storage


[3/6/2022 5:39â€¯PM] szybet
Pinned a message.


[3/6/2022 5:40â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-76E35.png


[3/6/2022 5:41â€¯PM] szybet
not funny


[3/6/2022 5:41â€¯PM] szybet
maybe i will just push the binary using u-boot?


[3/6/2022 5:41â€¯PM] tux_linux
did you `/usr/local/bin/wifi/connect_to_wifi.sh` before?


[3/6/2022 5:41â€¯PM] tux_linux
question: is your power light still flashing?


[3/6/2022 5:42â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-95B85.png


[3/6/2022 5:42â€¯PM] szybet
no


[3/6/2022 5:42â€¯PM] tux_linux
no really?
how-


[3/6/2022 5:43â€¯PM] tux_linux
`ls -shal /sys/devices/platform/leds/leds/GLED`


[3/6/2022 5:43â€¯PM] szybet
okay it is


[3/6/2022 5:43â€¯PM] szybet
im just blind


[3/6/2022 5:43â€¯PM] tux_linux
ah


[3/6/2022 5:43â€¯PM] tux_linux
okay


[3/6/2022 5:43â€¯PM] tux_linux
`echo 1 > /sys/devices/platform/leds/leds/GLED/brightness; echo 0 > /sys/devices/platform/leds/leds/GLED/brightness` turns it off right?


[3/6/2022 5:43â€¯PM] tux_linux
That isn't possible


[3/6/2022 5:43â€¯PM] szybet
yes


[3/6/2022 5:43â€¯PM] tux_linux
`find /usr/local/bin`


[3/6/2022 5:44â€¯PM] tux_linux
Ok, I forgot to put `brightness` in the path in inkbox.sh


[3/6/2022 5:44â€¯PM] szybet
```
kobo:~# find /usr/local/bin/                                                                   
/usr/local/bin/                                                                                
/usr/local/bin/htmldoc                                                                         
/usr/local/bin/ota_update.sh                                                                   
/usr/local/bin/unionfs                                                                         
/usr/local/bin/wifi                                                                            
/usr/local/bin/wifi/toggle.sh                                                                  
/usr/local/bin/wifi/connect_to_network.sh                                                      
/usr/local/bin/wifi/list_networks.sh                                                           
/usr/local/bin/unionfsctl                                                                      
/usr/local/bin/generate_system_report.sh                                                       
/usr/local/bin/gutenberg                                                                       
/usr/local/bin/gutenberg/fetch_catalog.sh                                                      
/usr/local/bin/gutenberg/get_book.sh                                                           
/usr/local/bin/gutenberg/get_latest_books.sh                                                   
/usr/local/bin/gutenberg/search_catalog.sh                                                     
/usr/local/bin/zsh-5.8.1                                                                       
/usr/local/bin/htop                                                                            
/usr/local/bin/zsh                                                                             
/usr/local/bin/appvnc_start.sh
```


[3/6/2022 5:44â€¯PM] szybet
connect to network, not wifi


[3/6/2022 5:45â€¯PM] tux_linux
/usr/local/bin/wifi/connect_to_network.sh


[3/6/2022 5:45â€¯PM] szybet
+ ssid and password


[3/6/2022 5:45â€¯PM] tux_linux
but why couldn't it launch before?


[3/6/2022 5:46â€¯PM] szybet
wrong binary name you gived?


[3/6/2022 5:46â€¯PM] szybet
```
kobo:~# /usr/local/bin/wifi/connect_to_network.sh hotspotttssss 12345678                       
ifconfig: ioctl 0x8913 failed: No such device                                                  
Successfully initialized wpa_supplicant                                                        
rfkill: Cannot get wiphy information                                                           
ioctl[SIOCSIWAP]: Operation not permitted                                                      
no such user dhcpcd                                                                            
dhcpcd-9.4.0 starting                                                                          
eth0: waiting for carrier                                                                      
timed out                                                                                      
dhcpcd exited                                                                                  
dhcpcd_fork_cb: truncated read 0 (expected 4)                                                  
DHCP request failed.                                                                           
kobo:~# ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default              
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00                                      
    inet 127.0.0.1/8 scope host lo                                                             
       valid_lft forever preferred_lft forever                                                 
kobo:~# udhcpc -i eth0
udhcpc: ioctl 0x8933 failed: No such device                                                    
kobo:~# 
```


[3/6/2022 5:47â€¯PM] szybet
i need to insmod the wifi module too


[3/6/2022 5:47â€¯PM] szybet
what was his name


[3/6/2022 5:48â€¯PM] tux_linux
`/modules/wifi/8189fs.ko`


[3/6/2022 5:48â€¯PM] tux_linux
but


[3/6/2022 5:48â€¯PM] tux_linux
it shouldn't do that


[3/6/2022 5:48â€¯PM] tux_linux (pinned)
`cat /usr/local/bin/wifi/connect_to_network.sh`


[3/6/2022 5:48â€¯PM] szybet
still no eth0


[3/6/2022 5:48â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-6A10E.txt


[3/6/2022 5:49â€¯PM] tux_linux
`dmesg` and `lsmod` please


[3/6/2022 5:49â€¯PM] tux_linux
this is scary...


[3/6/2022 5:50â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-4E278.txt


[3/6/2022 5:50â€¯PM] tux_linux
what if you do `insmod /modules/drivers/mmc/card/sdio_wifi_pwr.ko`


[3/6/2022 5:51â€¯PM] tux_linux
oh ok


[3/6/2022 5:51â€¯PM] szybet
```
\kobo:~# insmod /modules/drivers/mmc/card/sdio_wifi_pwr.ko                                      
kobo:~# lsmod                                                                                  
Module                  Size  Used by                                                          
sdio_wifi_pwr            593  0                                                                
8189fs               1294344  0                                                                
usb_f_mass_storage     38079  0                                                                
libcomposite           44430  1 usb_f_mass_storage                                             
configfs               23581  3 libcomposite,usb_f_mass_storage                                
kobo:~# ip a                                                                                   
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default              
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00                                      
    inet 127.0.0.1/8 scope host lo                                                             
       valid_lft forever preferred_lft forever                                                 
5: eth0: <BROADCAST,MULTICAST> mtu 1500 qdisc noop state DOWN group default qlen 1000          
    link/ether 58:b0:d4:9d:a6:8e brd ff:ff:ff:ff:ff:ff                                         
kobo:~# 
\```


[3/6/2022 5:51â€¯PM] szybet
bingo


[3/6/2022 5:51â€¯PM] tux_linux
Actually it auto-removes the modules upon failure to connect in the script


[3/6/2022 5:53â€¯PM] szybet
wtf

{Attachments}
/mnt/data/projects/git/conversations/media/message-12FB6.txt


[3/6/2022 5:53â€¯PM] szybet
it dissapered


[3/6/2022 5:53â€¯PM] szybet
```
kobo:~# lsmod                                                                                  
Module                  Size  Used by                                                          
usb_f_mass_storage     38079  0                                                                
libcomposite           44430  1 usb_f_mass_storage                                             
configfs               23581  3 libcomposite,usb_f_mass_storage                                
kobo:~# 
```


[3/6/2022 5:53â€¯PM] szybet
dmesg:

{Attachments}
/mnt/data/projects/git/conversations/media/message-E5AFE.txt


[3/6/2022 5:54â€¯PM] szybet
wifi 3v3 off


[3/6/2022 5:54â€¯PM] szybet
weird


[3/6/2022 5:54â€¯PM] tux_linux
Ok, I'll push a commit to the rootfs repo so you can get out of this mess with proper scripts


[3/6/2022 5:56â€¯PM] tux_linux
Done


[3/6/2022 5:57â€¯PM] szybet
pull rootfs repo, make a sqsh and sign, then put in on kobo?


[3/6/2022 5:58â€¯PM] tux_linux
yes


[3/6/2022 5:59â€¯PM] szybet
Pinned a message.


[3/6/2022 5:59â€¯PM] szybet
Pinned a message.


[3/6/2022 6:01â€¯PM] szybet
Pinned a message.


[3/6/2022 6:04â€¯PM] szybet
done, what now


[3/6/2022 6:05â€¯PM] tux_linux
Try connecting to Wi-Fi with the script again


[3/6/2022 6:07â€¯PM] szybet
so /usr/local/bin/wifi/connect_to_network.sh hotspotttssss 12345678 and then udhcpc -i eth0 ?


[3/6/2022 6:07â€¯PM] tux_linux
yep


[3/6/2022 6:09â€¯PM] szybet
```
kobo:~# ip a                                                                                   
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN group default              
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00                                      
    inet 127.0.0.1/8 scope host lo                                                             
       valid_lft forever preferred_lft forever                                                 
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000  
    link/ether 58:b0:d4:9d:a6:8e brd ff:ff:ff:ff:ff:ff                                         
    inet 10.42.0.28/24 brd 10.42.0.255 scope global eth0                                       
       valid_lft forever preferred_lft forever
```


[3/6/2022 6:09â€¯PM] szybet
yep, now what


[3/6/2022 6:10â€¯PM] tux_linux
very good, it works


[3/6/2022 6:10â€¯PM] tux_linux
try with the inkbox binary above


[3/6/2022 6:10â€¯PM] tux_linux
this


[3/6/2022 6:11â€¯PM] tux_linux
Are you using a Wi-Fi hotspot with Gnome?


[3/6/2022 6:11â€¯PM] tux_linux
Mine has the same subnet than yours ;p


[3/6/2022 6:11â€¯PM] szybet
its kde


[3/6/2022 6:11â€¯PM] szybet
they use the same thing for this propably


[3/6/2022 6:11â€¯PM] tux_linux
ah


[3/6/2022 6:11â€¯PM] tux_linux
Well, networkmanager, so makes sense, yeah


[3/6/2022 6:12â€¯PM] szybet
its actually something else


[3/6/2022 6:12â€¯PM] szybet
i looked at it once


[3/6/2022 6:12â€¯PM] tux_linux
oh?


[3/6/2022 6:13â€¯PM] szybet
its called dnsmasq


[3/6/2022 6:14â€¯PM] szybet
in htop you can see the command arguments for it


[3/6/2022 6:14â€¯PM] szybet
```
% ps aux | grep dnsmasq                                                      
nobody    307584  0.0  0.0  21688  6808 ?        S    15:23   0:00 /usr/bin/dnsmasq --conf-file=/dev/null --no-hosts --keep-in-foreground --bind-interfaces --except-interface=lo --clear-on-reload --strict-order --listen-address=10.42.0.1 --dhcp-range=10.42.0.10,10.42.0.254,60m --dhcp-lease-max=50 --dhcp-leasefile=/var/lib/NetworkManager/dnsmasq-wlp3s0.leases --pid-file=/var/run/nm-dnsmasq-wlp3s0.pid --conf-dir=/etc/NetworkManager/dnsmasq-shared.d
szybet    482350  0.0  0.0   9548  2560 pts/7    S+   18:14   0:00 grep --color=auto --exclude-dir=.bzr --exclude-dir=CVS --exclude-dir=.git --exclude-dir=.hg --exclude-dir=.svn --exclude-dir=.idea --exclude-dir=.tox dnsmasq
18:14 szybet@ArchSzybet /home/szybet

```


[3/6/2022 6:14â€¯PM] szybet
i have the inkbox test binary


[3/6/2022 6:14â€¯PM] szybet
launched


[3/6/2022 6:15â€¯PM] szybet
what now, usb storage?


[3/6/2022 6:15â€¯PM] tux_linux
oh cool


[3/6/2022 6:15â€¯PM] tux_linux
yes


[3/6/2022 6:15â€¯PM] tux_linux
try hitting "connect"


[3/6/2022 6:15â€¯PM] tux_linux
then `dmesg` and `lsmod`


[3/6/2022 6:16â€¯PM] szybet
does not work

{Attachments}
/mnt/data/projects/git/conversations/media/message-1185C.txt


[3/6/2022 6:17â€¯PM] tux_linux
Well, it actually does something, great


[3/6/2022 6:17â€¯PM] szybet
something


[3/6/2022 6:17â€¯PM] tux_linux
```
[  651.464636] g_mass_storage: Unknown symbol fsg_common_set_ops (err 0)
[  651.464680] g_mass_storage: Unknown symbol fsg_common_set_sysfs (err 0)
[  651.464704] g_mass_storage: Unknown symbol usb_get_function_instance (err 0)
[  651.464716] g_mass_storage: Unknown symbol fsg_common_run_thread (err 0)
[  651.464734] g_mass_storage: Unknown symbol usb_string_ids_tab (err 0)
[  651.464751] g_mass_storage: Unknown symbol fsg_common_free_luns (err 0)
[  651.464763] g_mass_storage: Unknown symbol usb_get_function (err 0)
[  651.464776] g_mass_storage: Unknown symbol usb_composite_unregister (err 0)
[  651.464788] g_mass_storage: Unknown symbol usb_put_function (err 0)
[  651.464800] g_mass_storage: Unknown symbol fsg_common_create_luns (err 0)
[  651.464813] g_mass_storage: Unknown symbol usb_add_function (err 0)
[  651.464826] g_mass_storage: Unknown symbol usb_composite_probe (err 0)
[  651.464842] g_mass_storage: Unknown symbol usb_composite_overwrite_options (err 0)
[  651.464854] g_mass_storage: Unknown symbol usb_otg_descriptor_alloc (err 0)
[  651.464867] g_mass_storage: Unknown symbol usb_put_function_instance (err 0)
[  651.464878] g_mass_storage: Unknown symbol fsg_common_set_cdev (err 0)
[  651.464892] g_mass_storage: Unknown symbol fsg_common_free_buffers (err 0)
[  651.464905] g_mass_storage: Unknown symbol usb_otg_descriptor_init (err 0)
[  651.464921] g_mass_storage: Unknown symbol fsg_common_set_nluns (err 0)
[  651.464934] g_mass_storage: Unknown symbol fsg_common_remove_luns (err 0)
[  651.464945] g_mass_storage: Unknown symbol usb_add_config (err 0)
[  651.464958] g_mass_storage: Unknown symbol fsg_common_set_inquiry_string (err 0)
[  651.464970] g_mass_storage: Unknown symbol fsg_common_set_num_buffers (err 0)
[  651.464982] g_mass_storage: Unknown symbol fsg_config_from_params (err 0)
```


[3/6/2022 6:18â€¯PM] szybet
something


[3/6/2022 6:18â€¯PM] tux_linux
So you're sure there's nothing in `lsmod` right?


[3/6/2022 6:18â€¯PM] szybet
```
kobo:~# lsmod
Module                  Size  Used by
8189fs               1294344  0
sdio_wifi_pwr            593  0
kobo:~# 

```


[3/6/2022 6:18â€¯PM] tux_linux
`cat /kobo/opt/inkbox_device`


[3/6/2022 6:18â€¯PM] tux_linux
ok


[3/6/2022 6:18â€¯PM] szybet
emu


[3/6/2022 6:18â€¯PM] szybet
why emu


[3/6/2022 6:18â€¯PM] szybet
D:


[3/6/2022 6:18â€¯PM] tux_linux
aaahaah


[3/6/2022 6:18â€¯PM] szybet
XD


[3/6/2022 6:19â€¯PM] tux_linux
`echo n306 > /kobo/opt/inkbox_device`


[3/6/2022 6:19â€¯PM] szybet
and?


[3/6/2022 6:19â€¯PM] tux_linux
relaunch inkbox and things will probably be better


[3/6/2022 6:19â€¯PM] szybet
hm, how. i have the custom binary launched.... just /tmp/inkbox?


[3/6/2022 6:20â€¯PM] szybet
and kill it before launching


[3/6/2022 6:20â€¯PM] tux_linux
just re-launch the big command


[3/6/2022 6:20â€¯PM] tux_linux
it will do everything for you


[3/6/2022 6:20â€¯PM] tux_linux
it's the one I use for quick testing


[3/6/2022 6:20â€¯PM] tux_linux
Pinned a message.


[3/6/2022 6:22â€¯PM] szybet
```
kobo:~# rm /tmp/inkbox; wget 10.42.0.1:8000/inkbox -O /tmp/inkbox; chmod +x /tmp               
/inkbox; umount -l -f /kobo/mnt/onboard/.adds/inkbox/inkbox-bin; mount --bind /t               
^[[A^[[B^[[A^[[B^C
kobo:~# ^C
insmod: can't insert '/external_root/modules/fs/configfs/configfs.ko': File exists
insmod: can't insert '/external_root/modules/drivers/usb/gadget/libcomposite.ko': File exists
insmod: can't insert '/external_root/modules/drivers/usb/function/usb_f_mass_storage.ko': No such file or directory
```


[3/6/2022 6:22â€¯PM] szybet
and it does not work


[3/6/2022 6:22â€¯PM] tux_linux
```
ls /kobo/external_root/modules/drivers/usb/function/usb_f_mass_storage.ko
```


[3/6/2022 6:22â€¯PM] tux_linux
well, it's progress!


[3/6/2022 6:22â€¯PM] tux_linux
File exists mean the module is already loaded


[3/6/2022 6:23â€¯PM] szybet
```

kobo:~# lsmod
Module                  Size  Used by
libcomposite           44430  0
configfs               23581  2 libcomposite
8189fs               1294344  0
sdio_wifi_pwr            593  0
kobo:~# 

```


[3/6/2022 6:23â€¯PM] tux_linux
yep they are


[3/6/2022 6:23â€¯PM] tux_linux
oh my bad I know the problem


[3/6/2022 6:23â€¯PM] szybet
```
kobo:~# ls /kobo/external_root/modules/drivers/usb/function/usb_f_mass_storage.ko
ls: /kobo/external_root/modules/drivers/usb/function/usb_f_mass_storage.ko: No such file or directory
kobo:~# ls /kobo/external_root/modules/drivers/usb/gadget/
function/        legacy/          libcomposite.ko
kobo:~# ls /kobo/external_root/modules/drivers/usb/gadget/
function/        legacy/          libcomposite.ko
kobo:~# ls /kobo/external_root/modules/drivers/usb/gadget/function/u
u_ether.ko             usb_f_ecm_subset.ko    usb_f_mass_storage.ko
usb_f_acm.ko           usb_f_eem.ko           usb_f_obex.ko
usb_f_ecm.ko           usb_f_fs.ko            usb_f_rndis.ko
kobo:~# ls /kobo/external_root/modules/drivers/usb/gadget/function/usb_f_mass_storage.ko 
/kobo/external_root/modules/drivers/usb/gadget/function/usb_f_mass_storage.ko
kobo:~# 

```


[3/6/2022 6:23â€¯PM] szybet
yes you know


[3/6/2022 6:23â€¯PM] szybet
wrong path


[3/6/2022 6:25â€¯PM] tux_linux
try this one

{Attachments}
/mnt/data/projects/git/conversations/media/inkbox-E6450


[3/6/2022 6:27â€¯PM] szybet
usb storage works


[3/6/2022 6:27â€¯PM] tux_linux
yay!


[3/6/2022 6:27â€¯PM] szybet
still some errors:
```
cat: can't open '/mnt/onboard/.kobo/Kobo/Kobo eReader.conf': No such file or directory
insmod: can't insert '/external_root/modules/fs/configfs/configfs.ko': File exists                             
insmod: can't insert '/external_root/modules/drivers/usb/gadget/libcomposite.ko': File exists
```


[3/6/2022 6:28â€¯PM] tux_linux
it's normal, since the configfs and libcomposite modules were already loaded


[3/6/2022 6:29â€¯PM] szybet
okay


[3/6/2022 6:29â€¯PM] tux_linux
I'll make you a GUI bundle with this binary


[3/6/2022 6:29â€¯PM] szybet
don't forget to update the device from emu to n306


[3/6/2022 6:30â€¯PM] tux_linux
yes


[3/6/2022 6:31â€¯PM] szybet
when wifi will work?


[3/6/2022 6:31â€¯PM] tux_linux
https://inkbox.ddns.net/git/tux-linux/rootfs/-/commit/5cba773fdbdf36637195be0488cae34383159670

{Embed}
https://inkbox.ddns.net/git/tux-linux/rootfs/-/commit/5cba773fdbdf36637195be0488cae34383159670
inkbox_gui: Bind-mount 'device' file to GUI chroot (5cba773f) Â· Com...
InkBox OS root filesystem
/mnt/data/projects/git/conversations/media/gitlab_logo-7ae504fe4f68fdebb3c2034e366219-FA8F1.png


[3/6/2022 6:32â€¯PM] tux_linux
it doesn't?


[3/6/2022 6:32â€¯PM] szybet
without using cmd


[3/6/2022 6:32â€¯PM] szybet
only GUI


[3/6/2022 6:32â€¯PM] tux_linux
try it


[3/6/2022 6:33â€¯PM] tux_linux
it uses the same script as if you were in cmd


[3/6/2022 6:35â€¯PM] tux_linux
You can use `htop` to see what it's doing


[3/6/2022 6:35â€¯PM] tux_linux
maybe `top` if you're in a serial console


[3/6/2022 6:35â€¯PM] szybet
usb storage doesn't disconnect after i unmount it :(


[3/6/2022 6:36â€¯PM] szybet
bruh
sdd      8:48   1     0B  0 disk


[3/6/2022 6:36â€¯PM] tux_linux
You need to unplug the cable


[3/6/2022 6:36â€¯PM] szybet
why? nickel doesn't needed


[3/6/2022 6:37â€¯PM] tux_linux
because I haven't found a way to detect if it was ejected or not


[3/6/2022 6:37â€¯PM] szybet
hmm, interesting


[3/6/2022 6:40â€¯PM] szybet
it works


[3/6/2022 6:40â€¯PM] szybet
how inkbox manages turning off the wifi?


[3/6/2022 6:40â€¯PM] szybet
how do i get the IP of the device...


[3/6/2022 6:41â€¯PM] szybet
:|


[3/6/2022 6:43â€¯PM] tux_linux
Settings -> page 2 -> system info


[3/6/2022 6:43â€¯PM] tux_linux
Get to the bottom


[3/6/2022 6:43â€¯PM] szybet
WHY


[3/6/2022 6:43â€¯PM] tux_linux
It will be there


[3/6/2022 6:43â€¯PM] szybet
to get the ip i need to generate a whole system report


[3/6/2022 6:43â€¯PM] tux_linux
No


[3/6/2022 6:43â€¯PM] tux_linux
Just system info


[3/6/2022 6:44â€¯PM] tux_linux
Not the same thing


[3/6/2022 6:44â€¯PM] szybet
still... no


[3/6/2022 6:44â€¯PM] tux_linux
It's a dialog


[3/6/2022 6:44â€¯PM] szybet
show a window after connecting to wifi


[3/6/2022 6:44â€¯PM] szybet
with the ip


[3/6/2022 6:44â€¯PM] tux_linux
you can do `nmap -sP 10.42.0.0/24` on your host otherwise


[3/6/2022 6:45â€¯PM] szybet
i can even check it with cmd on serial connection


[3/6/2022 6:45â€¯PM] szybet
but thats not the case


[3/6/2022 6:45â€¯PM] szybet
and this?


[3/6/2022 6:45â€¯PM] tux_linux
it doesn't


[3/6/2022 6:45â€¯PM] tux_linux
maybe this could be something to add in settings


[3/6/2022 6:46â€¯PM] szybet
so it just disconnects randomly?


[3/6/2022 6:46â€¯PM] tux_linux
no


[3/6/2022 6:46â€¯PM] tux_linux
it stays connected


[3/6/2022 6:46â€¯PM] szybet
it disconnected


[3/6/2022 6:46â€¯PM] tux_linux
huh?


[3/6/2022 6:47â€¯PM] tux_linux
`dmesg`?


[3/6/2022 6:47â€¯PM] szybet
let me check this one more time


[3/6/2022 6:47â€¯PM] szybet
do i need to enter the password every time?


[3/6/2022 6:47â€¯PM] tux_linux
normally, no


[3/6/2022 6:47â€¯PM] szybet
but?


[3/6/2022 6:47â€¯PM] tux_linux
it auto-connects on boot


[3/6/2022 6:48â€¯PM] tux_linux
it's complicated, but it will only do so when we have the recoveryfs


[3/6/2022 6:48â€¯PM] tux_linux
i.e. in release


[3/6/2022 6:48â€¯PM] szybet
i see here room for improvement, its a basic feature to remember wifi passwords


[3/6/2022 6:49â€¯PM] tux_linux
it does remember them


[3/6/2022 6:49â€¯PM] szybet
i need to enter it one more time now


[3/6/2022 6:49â€¯PM] szybet
so how does it remember


[3/6/2022 6:49â€¯PM] tux_linux
`cat /data/config/17-wifi_connection_information/*`


[3/6/2022 6:50â€¯PM] szybet
yes, there are stored password and essid


[3/6/2022 6:50â€¯PM] szybet
but i needed to enter it one more time


[3/6/2022 6:51â€¯PM] tux_linux
The main problem with auto-connecting to a network would be if you changed the password of the ssid or had the same ssid but not the same password


[3/6/2022 6:51â€¯PM] tux_linux
Once the recoveryfs is in place, the initrd will do that on boot:
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/setup-wifi


[3/6/2022 6:52â€¯PM] szybet
a button to reset the password and essid


[3/6/2022 6:53â€¯PM] tux_linux
But then it has to see if the ssid is the same as the one saved, open another dialog
i.e. pain ;p


[3/6/2022 6:53â€¯PM] tux_linux
but it could be doable


[3/6/2022 6:53â€¯PM] tux_linux
Though it would not have much purpose unless you decided to disable Wi-Fi and re-enable it after


[3/6/2022 6:54â€¯PM] tux_linux
since it would already be auto-connected on boot


[3/6/2022 6:54â€¯PM] szybet
and a button to enable, disable the wifi


[3/6/2022 6:54â€¯PM] tux_linux
that is even more complicated


[3/6/2022 6:54â€¯PM] szybet
its more pain to enter the password every time


[3/6/2022 6:54â€¯PM] tux_linux
the Wi-Fi connection framework was one of the hardest and most confusing things I have done in Qt


[3/6/2022 6:56â€¯PM] tux_linux
but you are connected now, it works, right?


[3/6/2022 6:57â€¯PM] szybet
yes it works, and it does not dissconnect


[3/6/2022 6:57â€¯PM] szybet
but still pain to enter the password every time


[3/6/2022 6:57â€¯PM] szybet
or maybe a dialog "would you like to enter a new password or use this: "xyz""


[3/6/2022 6:57â€¯PM] tux_linux
Hmm yeah maybe


[3/6/2022 6:58â€¯PM] szybet
and a list of saved networks + password to show


[3/6/2022 6:58â€¯PM] szybet
I really will have to learn cpp and qt


[3/6/2022 6:58â€¯PM] tux_linux
Can you send me a video of how InkBox behaves on the Nia? Basic things, like reading a book, searching something, online library?


[3/6/2022 6:59â€¯PM] tux_linux
So I can ensure everything seems fine on that model?


[3/6/2022 6:59â€¯PM] tux_linux
Wowow, one network at a time ğŸ˜‚
InkBox only saves one for the moment


[3/6/2022 7:01â€¯PM] szybet
online library? what?


[3/6/2022 7:01â€¯PM] szybet
you mean gutenberg, libraru button?


[3/6/2022 7:01â€¯PM] tux_linux
Yes


[3/6/2022 7:01â€¯PM] szybet
um error


[3/6/2022 7:01â€¯PM] tux_linux
Whoops


[3/6/2022 7:01â€¯PM] szybet
```
This plugin does not support setParent!                                                                        
Gutenberg sync encountered an error
```


[3/6/2022 7:02â€¯PM] tux_linux
First one is unrelated


[3/6/2022 7:02â€¯PM] tux_linux
Is there any other output?


[3/6/2022 7:02â€¯PM] szybet
nope


[3/6/2022 7:02â€¯PM] tux_linux
ls /data/storage/gutenberg -shal


[3/6/2022 7:03â€¯PM] szybet
kobo:~# ls /data/storage/gutenberg -shal                                                                       
total 12K                                                                                                      
     4 drwxr-xr-x    2 root     root        4.0K Jan  1 18:08 .                                                
     4 drwxr-xr-x   10 root     root        4.0K Jan  1 00:54 ..                                               
     0 -rw-r--r--    1 root     root           0 Jan  1 18:08 catalog.csv                                      
     4 -rw-r--r--    1 root     root          11 Jan  1 18:08 last_sync                                        
kobo:~#


[3/6/2022 7:03â€¯PM] tux_linux
Can you ping Google?


[3/6/2022 7:03â€¯PM] szybet
yes


[3/6/2022 7:04â€¯PM] tux_linux
`sh -x /usr/local/bin/gutenberg/fetch_catalog.sh`


[3/6/2022 7:05â€¯PM] szybet
```
kobo:~# sh -x /usr/local/bin/gutenberg/fetch_catalog.sh                                                        
+ mkdir -p /data/storage/gutenberg                                                                             
+ cd /data/storage/gutenberg                                                                                   
+ date '+%s'                                                                                                   
+ rm -f catalog.csv                                                                                            
+ wget -O catalog.csv http://www.gutenberg.org/cache/epub/feeds/pg_catalog.csv                                 
--2012-01-01 18:11:41--  http://www.gutenberg.org/cache/epub/feeds/pg_catalog.csv                              
Resolving www.gutenberg.org... 152.19.134.47, 2610:28:3090:3000:0:bad:cafe:47                                  
Connecting to www.gutenberg.org|152.19.134.47|:80... connected.                                                
HTTP request sent, awaiting response... 302 Found                                                              
Location: https://www.gutenberg.org/cache/epub/feeds/pg_catalog.csv [following]                                
--2012-01-01 18:11:42--  https://www.gutenberg.org/cache/epub/feeds/pg_catalog.csv                             
Connecting to www.gutenberg.org|152.19.134.47|:443... connected.                                               
ERROR: cannot verify www.gutenberg.org's certificate, issued by 'CN=Network Solutions OV Server CA 2,O=Network:
  Issued certificate not yet valid.                                                                            
To connect to www.gutenberg.org insecurely, use `--no-check-certificate'.                                      
+ exit 1                                                                                                       
kobo:~# 
```


[3/6/2022 7:05â€¯PM] szybet
o h n o c e r t i f i c a t e


[3/6/2022 7:08â€¯PM] the.mightydill
i feel that pain


[3/6/2022 7:11â€¯PM] tux_linux
Sync your rtc


[3/6/2022 7:12â€¯PM] szybet
with?


[3/6/2022 7:12â€¯PM] szybet
in alpine there are like 5 diffrent


[3/6/2022 7:12â€¯PM] szybet
the stock one was not working


[3/6/2022 7:12â€¯PM] szybet
so idk which you used


[3/6/2022 7:17â€¯PM] tux_linux
`date -s "2022-03-06 19:17`


[3/6/2022 7:17â€¯PM] tux_linux
`hwclock --systohc`


[3/6/2022 7:17â€¯PM] tux_linux
and you're done


[3/6/2022 7:18â€¯PM] tux_linux
it's not a real sync, but the simplest method I have


[3/6/2022 7:18â€¯PM] szybet
maybe a NTP would be better


[3/6/2022 7:18â€¯PM] tux_linux
Or this


[3/6/2022 7:18â€¯PM] tux_linux (pinned)
`sudo date -s "$(wget --method=HEAD -qSO- --max-redirect=0 google.com 2>&1 | grep Date: | cut -d' ' -f2-7)"`


[3/6/2022 7:18â€¯PM] tux_linux
From that question https://unix.stackexchange.com/questions/79112/how-do-i-set-time-and-date-from-the-internet

{Embed}
https://unix.stackexchange.com/questions/79112/how-do-i-set-time-and-date-from-the-internet
How do I set time and date from the Internet?
How do I retrieve the date from the Internet and set my computer's clock, from the command line?
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-317B7.png


[3/6/2022 7:18â€¯PM] szybet
oh thats cool


[3/6/2022 7:21â€¯PM] tux_linux
don't forget to `hwclock --systohc` after that


[3/6/2022 7:21â€¯PM] szybet
it takes long


[3/6/2022 7:21â€¯PM] szybet
but no error soo fat


[3/6/2022 7:21â€¯PM] szybet
kobo:~# Gutenberg sync successfully completed


[3/6/2022 7:22â€¯PM] tux_linux
nice


[3/6/2022 7:23â€¯PM] tux_linux
Does something show up when you click on "Library"?


[3/6/2022 7:24â€¯PM] szybet
books


[3/6/2022 7:24â€¯PM] tux_linux
nice


[3/6/2022 7:24â€¯PM] szybet
boooooks


[3/6/2022 7:24â€¯PM] tux_linux
booooooooooks


[3/6/2022 7:24â€¯PM] tux_linux
have a screenshot?


[3/6/2022 7:24â€¯PM] szybet
i will make the video

{Reactions}
ğŸ‘ 

[3/6/2022 7:24â€¯PM] szybet
what do you mean by search


[3/6/2022 7:25â€¯PM] tux_linux
Well, the search button


[3/6/2022 7:25â€¯PM] tux_linux
Another thing to try after that would be X11


[3/6/2022 7:25â€¯PM] tux_linux
It should be ok but just to be sure


[3/6/2022 7:25â€¯PM] szybet
lightmaps are flickering


[3/6/2022 7:25â€¯PM] szybet
not usable at all


[3/6/2022 7:26â€¯PM] tux_linux
well it's usually not the main reason why someone installs inkbox


[3/6/2022 7:26â€¯PM] szybet
but i clicked it accidentally


[3/6/2022 7:26â€¯PM] szybet
ğŸ˜†


[3/6/2022 7:26â€¯PM] tux_linux
ahh


[3/6/2022 7:26â€¯PM] tux_linux (pinned)
you can `rc-service inkbox_gui restart`


[3/6/2022 7:27â€¯PM] tux_linux
oh; you will need to run again the command with wget that fetches inkbox binary


[3/6/2022 7:28â€¯PM] szybet
you mean search a word?


[3/6/2022 7:28â€¯PM] tux_linux
yeah, or a book in online library


[3/6/2022 7:28â€¯PM] tux_linux
or in your onboard storage


[3/6/2022 7:28â€¯PM] szybet
does this search a book local?


[3/6/2022 7:28â€¯PM] tux_linux
to see how the keyboard behaves


[3/6/2022 7:28â€¯PM] tux_linux
both


[3/6/2022 7:28â€¯PM] szybet
yes it does


[3/6/2022 7:28â€¯PM] szybet
okay


[3/6/2022 7:33â€¯PM] szybet
why for every book it shows end page and no previous page


[3/6/2022 7:33â€¯PM] tux_linux
?


[3/6/2022 7:33â€¯PM] szybet
wait, i will upload the video


[3/6/2022 7:33â€¯PM] szybet
weird


[3/6/2022 7:34â€¯PM] tux_linux
are you able to read though?


[3/6/2022 7:34â€¯PM] szybet
blank page


[3/6/2022 7:34â€¯PM] tux_linux
if you click next


[3/6/2022 7:35â€¯PM] szybet
"end of document"


[3/6/2022 7:35â€¯PM] szybet
the gui propably crashed, i cant click anything


[3/6/2022 7:35â€¯PM] szybet
i will restart


[3/6/2022 7:35â€¯PM] tux_linux
problems


[3/6/2022 7:37â€¯PM] tux_linux
i'll make you an ui bundle


[3/6/2022 7:37â€¯PM] szybet
hm


[3/6/2022 7:37â€¯PM] szybet
i rebooted


[3/6/2022 7:37â€¯PM] szybet
the inkbox file was in /tmp


[3/6/2022 7:38â€¯PM] szybet
here is a old inkbox binary


[3/6/2022 7:38â€¯PM] szybet
hmmm.... thats why?


[3/6/2022 7:39â€¯PM] tux_linux
idk


[3/6/2022 7:39â€¯PM] szybet
now reading works


[3/6/2022 7:39â€¯PM] tux_linux
currently making a new one


[3/6/2022 7:39â€¯PM] tux_linux
nice


[3/6/2022 7:39â€¯PM] szybet
make a ui bundle, i will test it and then send a video

{Reactions}
ğŸ‘ 

[3/6/2022 7:39â€¯PM] szybet
everything works great exept the file chooser, it takes ages sometimes to load


[3/6/2022 7:40â€¯PM] szybet
changing brightness in the book does not work, i cant do antyhing


[3/6/2022 7:40â€¯PM] tux_linux
hmm hmm


[3/6/2022 7:41â€¯PM] szybet
i can click the + - but its really hard, and the slider does not work


[3/6/2022 7:42â€¯PM] szybet
now i see


[3/6/2022 7:42â€¯PM] tux_linux
ok, so it works actually


[3/6/2022 7:42â€¯PM] tux_linux
it's not a slider, it's a progress bar
sorry


[3/6/2022 7:43â€¯PM] szybet
1 opened a pdf, works
2 opened a epub, blank page cant go back, forward and options doesn't work


[3/6/2022 7:43â€¯PM] szybet
no info on serial


[3/6/2022 7:43â€¯PM] szybet
:|


[3/6/2022 7:43â€¯PM] tux_linux
yeah I had this bug at some point too


[3/6/2022 7:43â€¯PM] szybet
and?


[3/6/2022 7:43â€¯PM] tux_linux
don't know what's causing it


[3/6/2022 7:43â€¯PM] tux_linux
probably some tmpfs mount/umount quirk


[3/6/2022 7:44â€¯PM] szybet
only with epubs?


[3/6/2022 7:44â€¯PM] tux_linux
no, when opening a pdf then an epub


[3/6/2022 7:44â€¯PM] tux_linux
uploaded the bundle


[3/6/2022 7:44â€¯PM] tux_linux
http://23.163.0.39/bundles/private/update-n306.isa


[3/6/2022 7:44â€¯PM] szybet
its not usable that way


[3/6/2022 7:57â€¯PM] szybet
reading books doesn't work


[3/6/2022 7:57â€¯PM] szybet
any


[3/6/2022 7:57â€¯PM] szybet
rebooted, opened epub, and nothing is there


[3/6/2022 7:57â€¯PM] tux_linux
wow


[3/6/2022 7:57â€¯PM] tux_linux
huh


[3/6/2022 7:58â€¯PM] tux_linux
when you open an epub, do you see `mutool` in the process list with `top` or `ps`?


[3/6/2022 7:58â€¯PM] szybet
wait


[3/6/2022 8:00â€¯PM] szybet
it boots really slow btw


[3/6/2022 8:00â€¯PM] tux_linux
what do you mean?


[3/6/2022 8:00â€¯PM] szybet
1 minute?


[3/6/2022 8:00â€¯PM] tux_linux
that's not slow


[3/6/2022 8:01â€¯PM] tux_linux
Kindles boot in 1m40s


[3/6/2022 8:01â€¯PM] szybet
nickel in 30?


[3/6/2022 8:01â€¯PM] tux_linux
yeah, well, different infrastructure, less secure and more crash-prone


[3/6/2022 8:01â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-CF8E6.txt


[3/6/2022 8:01â€¯PM] szybet
nothing


[3/6/2022 8:02â€¯PM] tux_linux
Does the book actually exist?


[3/6/2022 8:03â€¯PM] szybet
yes


[3/6/2022 8:03â€¯PM] szybet
none of my books work


[3/6/2022 8:03â€¯PM] tux_linux
hang on; let me try this latest commit on the aura 2


[3/6/2022 8:03â€¯PM] tux_linux
if it doesn't work we have a serious problem


[3/6/2022 8:04â€¯PM] szybet
yes


[3/6/2022 8:09â€¯PM] tux_linux
ok, will boot it now


[3/6/2022 8:11â€¯PM] tux_linux
well, mine works alright


[3/6/2022 8:12â€¯PM] tux_linux
What's the "Git" part of the system info in Settings?


[3/6/2022 8:13â€¯PM] tux_linux
Mine is `1.8-86-g56db7ea`


[3/6/2022 8:15â€¯PM] szybet
wtf
1 reboot
2 opened a pdf 3 times
3 opened another pdf, blank page


[3/6/2022 8:15â€¯PM] tux_linux
Do you have the "Global reading settings" option disabled?


[3/6/2022 8:16â€¯PM] szybet
Pinned a message.


[3/6/2022 8:16â€¯PM] tux_linux
There's also a tiny shell script around this command, so you can just as well do `restart inkbox_gui`


[3/6/2022 8:17â€¯PM] tux_linux
(or any other service)


[3/6/2022 8:17â€¯PM] szybet
no?


[3/6/2022 8:17â€¯PM] szybet
disabled now


[3/6/2022 8:17â€¯PM] tux_linux
try again; I'm curious


[3/6/2022 8:18â€¯PM] tux_linux
this option, when disabled, permits you to save the last page you read in the book and go back to it automatically


[3/6/2022 8:19â€¯PM] szybet
some pdfs work, some not


[3/6/2022 8:20â€¯PM] szybet
only one pdf is working


[3/6/2022 8:20â€¯PM] szybet
only one book is working


[3/6/2022 8:20â€¯PM] szybet
thats the one i used in the past to test things


[3/6/2022 8:21â€¯PM] tux_linux
try one from gutenberg


[3/6/2022 8:21â€¯PM] tux_linux
they have a very high success rate


[3/6/2022 8:21â€¯PM] tux_linux
or you can get one from online library


[3/6/2022 8:21â€¯PM] tux_linux
btw, you can also display images along pdf and epubs


[3/6/2022 8:21â€¯PM] tux_linux
pngs, jpgs, etc.


[3/6/2022 8:22â€¯PM] szybet
i don't have any


[3/6/2022 8:23â€¯PM] tux_linux
heh, discovered that if you open an image, then an epub, then the image again, it segfaults


[3/6/2022 8:23â€¯PM] tux_linux
awesome


[3/6/2022 8:24â€¯PM] tux_linux
Some bugs may have appeared like that but since my userbase is currently very tiny I don't know much about them


[3/6/2022 8:24â€¯PM] tux_linux
I should really implement something like sickel


[3/6/2022 8:24â€¯PM] szybet
from gutenberg it works


[3/6/2022 8:24â€¯PM] tux_linux
Which restarts Nickel when it segfaults/closes unexpectedly


[3/6/2022 8:26â€¯PM] tux_linux
ok nice


[3/6/2022 8:26â€¯PM] tux_linux
I tried with other books, even one with 1500+ pages and it worked


[3/6/2022 8:26â€¯PM] tux_linux
(not from gutenberg)


[3/6/2022 8:26â€¯PM] tux_linux
Maybe it's specific to your epub


[3/6/2022 8:26â€¯PM] szybet
all of my books?


[3/6/2022 8:27â€¯PM] szybet
only one is working, that is some images pasted into pdf using libreoffice


[3/6/2022 8:27â€¯PM] szybet
._ .


[3/6/2022 8:27â€¯PM] tux_linux
can you send one so I can try on my side?


[3/6/2022 8:28â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/WS2811-CBACC.pdf


[3/6/2022 8:28â€¯PM] szybet
This for example


[3/6/2022 8:28â€¯PM] szybet
its a datasheet of a diode...


[3/6/2022 8:28â€¯PM] tux_linux
Let me see


[3/6/2022 8:30â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20220306_192927689-161FC.jpg


[3/6/2022 8:30â€¯PM] tux_linux
works here


[3/6/2022 8:30â€¯PM] tux_linux
can you try to open the system report pdf you generated before?


[3/6/2022 8:31â€¯PM] szybet
no, i cant


[3/6/2022 8:31â€¯PM] szybet
xD


[3/6/2022 8:31â€¯PM] tux_linux
btw, thanks for contributing so much


[3/6/2022 8:31â€¯PM] tux_linux
?
it doesn't work?


[3/6/2022 8:32â€¯PM] szybet
thanks for making this project, it will make it easier to achieve my goal too

{Reactions}
ğŸ‘ 

[3/6/2022 8:32â€¯PM] szybet
it doesn't


[3/6/2022 8:33â€¯PM] szybet
thats a interesting error when Option button doesnt work:
***Segmentation fault***


[3/6/2022 8:33â€¯PM] tux_linux
ah ah


[3/6/2022 8:34â€¯PM] tux_linux
what have you done since the reboot?


[3/6/2022 8:34â€¯PM] szybet
tryied to open some books you know


[3/6/2022 8:34â€¯PM] tux_linux
hmm


[3/6/2022 8:34â€¯PM] tux_linux
if you `restart inkbox_gui` and try to open the system report pdf, does it work?


[3/6/2022 8:35â€¯PM] szybet
btw, 
```
kobo:~# ps aux | grep mutool                                                                                   
 3541 root      0:00 grep mutool                                                                               
kobo:~# 
```
its while in the opened pdf that works


[3/6/2022 8:35â€¯PM] tux_linux
no


[3/6/2022 8:35â€¯PM] tux_linux
it just shows the grep process that greps mutool


[3/6/2022 8:35â€¯PM] tux_linux
so there is nothing


[3/6/2022 8:35â€¯PM] tux_linux
strange


[3/6/2022 8:36â€¯PM] szybet
yes i know


[3/6/2022 8:36â€¯PM] szybet
but now the system report works?????


[3/6/2022 8:36â€¯PM] tux_linux
magic


[3/6/2022 8:36â€¯PM] szybet
let my try the diode


[3/6/2022 8:37â€¯PM] szybet
nope


[3/6/2022 8:37â€¯PM] tux_linux
what-


[3/6/2022 8:37â€¯PM] szybet
but after it the systemreport works


[3/6/2022 8:37â€¯PM] tux_linux
but it works here


[3/6/2022 8:37â€¯PM] tux_linux
nonsense


[3/6/2022 8:37â€¯PM] szybet
._.


[3/6/2022 8:37â€¯PM] tux_linux
I opened an EPUB->System Report->Diode->System Report and it works


[3/6/2022 8:38â€¯PM] szybet
let me try


[3/6/2022 8:38â€¯PM] tux_linux
like, it should already have failed three times here lol


[3/6/2022 8:38â€¯PM] tux_linux
restart gui before


[3/6/2022 8:39â€¯PM] szybet
after epub the systemreport doesn't open


[3/6/2022 8:39â€¯PM] szybet
but i will restart


[3/6/2022 8:41â€¯PM] szybet
it doesn't work after the reset too


[3/6/2022 8:41â€¯PM] tux_linux
even more nonsense


[3/6/2022 8:41â€¯PM] szybet
gutenberg doesn't work


[3/6/2022 8:42â€¯PM] szybet
will reset and try the diode

{Reactions}
ğŸ‘ 

[3/6/2022 8:43â€¯PM] szybet
```
kobo:~# umount: can't unmount /inkbox: Invalid argument                                                        
iniparser: cannot open /mnt/onboard/.kobo/nightmode.ini                                                        
cat: can't open '/mnt/onboard/.kobo/Kobo/Kobo eReader.conf': No such file or directory                         
QCoreApplication::postEvent: Unexpected null receiver                                                          
sha256sum: /kobo/mnt/onboard/onboard/WS2811.pdf: No such file or directory                                     
mount: mounting /opt/config/07-words_number on /kobo/mnt/onboard/.adds/inkbox/.config/07-words_number failed: y
mount: mounting /opt/config/08-recent_books on /kobo/mnt/onboard/.adds/inkbox/.config/08-recent_books failed: y
mount: mounting /opt/config/11-menubar on /kobo/mnt/onboard/.adds/inkbox/.config/11-menubar failed: No such fiy
mount: mounting /opt/config/13-epub_page_size on /kobo/mnt/onboard/.adds/inkbox/.config/13-epub_page_size faily
mount: mounting /opt/config/14-reader_scrollbar on /kobo/mnt/onboard/.adds/inkbox/.config/14-reader_scrollbar y
QIODevice::read (QFile, "/inkbox/book/split/."): device not open                                               
QIODevice::read (QFile, "/inkbox/book/split/.."): device not open                                              

```


[3/6/2022 8:43â€¯PM] szybet
idk, doesn't work


[3/6/2022 8:44â€¯PM] tux_linux
`mount`


[3/6/2022 8:44â€¯PM] tux_linux
Please post output of this command


[3/6/2022 8:45â€¯PM] szybet
serial doesn't format properly the output


[3/6/2022 8:45â€¯PM] szybet
wait


[3/6/2022 8:45â€¯PM] tux_linux
well, it's serial, what do you want ;p


[3/6/2022 8:45â€¯PM] szybet
this could be host controller


[3/6/2022 8:45â€¯PM] tux_linux
idk


[3/6/2022 8:47â€¯PM] szybet
```
kobo:~# umount: can't unmount /inkbox: Invalid argument
iniparser: cannot open /mnt/onboard/.kobo/nightmode.ini
cat: can't open '/mnt/onboard/.kobo/Kobo/Kobo eReader.conf': No such file or directory
QCoreApplication::postEvent: Unexpected null receiver
QCoreApplication::postEvent: Unexpected null receiver
sha256sum: /kobo/mnt/onboard/onboard/WS2811.pdf: No such file or directory
mount: mounting /opt/config/07-words_number on /kobo/mnt/onboard/.adds/inkbox/.config/07-words_number failed: No such file or directory
mount: mounting /opt/config/08-recent_books on /kobo/mnt/onboard/.adds/inkbox/.config/08-recent_books failed: No such file or directory
mount: mounting /opt/config/11-menubar on /kobo/mnt/onboard/.adds/inkbox/.config/11-menubar failed: No such file or directory
mount: mounting /opt/config/13-epub_page_size on /kobo/mnt/onboard/.adds/inkbox/.config/13-epub_page_size failed: No such file or directory
mount: mounting /opt/config/14-reader_scrollbar on /kobo/mnt/onboard/.adds/inkbox/.config/14-reader_scrollbar failed: No such file or directory
QIODevice::read (QFile, "/inkbox/book/split/."): device not open
QIODevice::read (QFile, "/inkbox/book/split/.."): device not open




```


[3/6/2022 8:48â€¯PM] tux_linux
ok, and `mount`?


[3/6/2022 8:48â€¯PM] szybet
?


[3/6/2022 8:48â€¯PM] tux_linux
Well, just enter `mount`, then post the output


[3/6/2022 8:49â€¯PM] tux_linux
no arguments


[3/6/2022 8:49â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-80C96.txt


[3/6/2022 8:50â€¯PM] tux_linux
```
CSUM=$(sha256sum /data/onboard/WS2811.pdf | awk '{ print $1 }')
ls -shalR "/data/onboard/.${CSUM}"
```


[3/6/2022 8:52â€¯PM] szybet
can i have directories?


[3/6/2022 8:52â€¯PM] szybet
/data/onboard/elektronics/WS2811.pdf


[3/6/2022 8:52â€¯PM] szybet
?


[3/6/2022 8:52â€¯PM] tux_linux
yeah


[3/6/2022 8:53â€¯PM] szybet
```
kobo:~# CSUM=$(sha256sum /data/onboard/elektronics/WS2811.pdf  | awk '{ print $1                                         
 }')
ls: /data/onboard/elektronics/.b679e125ca8793e9c2fc5dbe19897c2ca92226409459f2e590b38634a832f59e: No such file or directoy
kobo:~#
```


[3/6/2022 8:54â€¯PM] tux_linux
interesting


[3/6/2022 8:54â€¯PM] tux_linux
oh


[3/6/2022 8:54â€¯PM] tux_linux
no actually, it should be in the root of onboard


[3/6/2022 8:54â€¯PM] szybet
n bjfhdnsajk


[3/6/2022 8:54â€¯PM] szybet
fmdakjm


[3/6/2022 8:54â€¯PM] szybet
thats why the one pdf works


[3/6/2022 8:54â€¯PM] tux_linux
you can put books in subdirectories, but the config settings will be on the root of the onboard storage


[3/6/2022 8:55â€¯PM] tux_linux
or... it should work?


[3/6/2022 8:55â€¯PM] tux_linux
normally they do


[3/6/2022 8:55â€¯PM] szybet
its the only one that works, the pdf is in the main directory


[3/6/2022 8:55â€¯PM] szybet
wait, i will copy the diode


[3/6/2022 8:55â€¯PM] tux_linux
yeah, try that


[3/6/2022 8:56â€¯PM] szybet
it works


[3/6/2022 8:57â€¯PM] tux_linux
that's not good news for me


[3/6/2022 8:57â€¯PM] tux_linux
what if you try the pdf in subdirectory without global reading settings?


[3/6/2022 8:58â€¯PM] szybet
they are disabled


[3/6/2022 8:58â€¯PM] szybet
oh, a pdf


[3/6/2022 8:58â€¯PM] szybet
wait


[3/6/2022 8:58â€¯PM] szybet
it works?


[3/6/2022 8:59â€¯PM] szybet
but it doesn't respond now, the screen


[3/6/2022 8:59â€¯PM] szybet
```
QIODevice::read (QFile, "/inkbox/book/split/."): device not open
QIODevice::read (QFile, "/inkbox/book/split/.."): device not open
QPixmap::scaled: Pixmap is a null pixmap
```


[3/6/2022 8:59â€¯PM] szybet
i cant do anything


[3/6/2022 9:00â€¯PM] tux_linux
*with global reading settings


[3/6/2022 9:00â€¯PM] tux_linux
sorry


[3/6/2022 9:00â€¯PM] szybet
oh


[3/6/2022 9:00â€¯PM] tux_linux
my fault


[3/6/2022 9:01â€¯PM] szybet
its still not good that it crashed


[3/6/2022 9:01â€¯PM] tux_linux
yeah


[3/6/2022 9:02â€¯PM] szybet
it works now


[3/6/2022 9:02â€¯PM] tux_linux
ok


[3/6/2022 9:02â€¯PM] tux_linux
and that also explains why the gutenberg book worked


[3/6/2022 9:02â€¯PM] tux_linux
now you can make the video ;p


[3/6/2022 9:03â€¯PM] szybet
what with epubs?


[3/6/2022 9:03â€¯PM] tux_linux
try if you want


[3/6/2022 9:03â€¯PM] tux_linux
but inkbox saved the gutenberg book in onboard storage root


[3/6/2022 9:03â€¯PM] szybet
they work


[3/6/2022 9:03â€¯PM] szybet
i dont understand anything now


[3/6/2022 9:03â€¯PM] tux_linux
me neither


[3/6/2022 9:04â€¯PM] szybet
https://tenor.com/view/oh-my-god-scream-happy-yell-omg-gif-17318501

{Embed}
https://tenor.com/view/oh-my-god-scream-happy-yell-omg-gif-17318501
/mnt/data/projects/git/conversations/media/oh-my-god-scream-C8F41.png


[3/6/2022 9:06â€¯PM] tux_linux
When the option is disabled, per-book settings are handled as follows: https://github.com/Kobo-InkBox/rootfs/blob/5cba773fdbdf36637195be0488cae34383159670/etc/init.d/ibxd#L86-L103


[3/6/2022 9:06â€¯PM] tux_linux
(with the `bookconfig_mount` function at the top of the file too)


[3/6/2022 9:10â€¯PM] szybet
some epubs work, some not, i tryied to launch a pdf, and the previous book was launched, then it crashed


[3/6/2022 9:10â€¯PM] szybet
you will se it on the video


[3/6/2022 9:12â€¯PM] szybet
https://anonfiles.com/ddPex6M4x1/VID_20220306_210545_mp4


[3/6/2022 9:13â€¯PM] szybet
dont ask me why the video is rotated


[3/6/2022 9:15â€¯PM] tux_linux
ok, will look at it, thanks!


[3/6/2022 9:15â€¯PM] szybet
when will you figure out why are some books not working?


[3/6/2022 9:15â€¯PM] tux_linux
once it... finishes downloading


[3/6/2022 9:15â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-66E1A.png


[3/6/2022 9:16â€¯PM] szybet
i would like to use the ereader finally


[3/6/2022 9:16â€¯PM] tux_linux
with the global reading settings thing?


[3/6/2022 9:16â€¯PM] szybet
you dont need to download it, you can watch it in the browser


[3/6/2022 9:16â€¯PM] tux_linux
no it downloaded it directly


[3/6/2022 9:16â€¯PM] tux_linux
and it's the same at the end


[3/6/2022 9:16â€¯PM] szybet
idk, generally


[3/6/2022 9:17â€¯PM] tux_linux
well, your books work now with that option enabled, right?


[3/6/2022 9:17â€¯PM] szybet
some yes, some not. the video shows it


[3/6/2022 9:17â€¯PM] tux_linux
ok


[3/6/2022 9:39â€¯PM] tux_linux
ok finally downloaded


[3/6/2022 9:40â€¯PM] tux_linux
little tip: you can click on the area where you want the slider to go to get there easily


[3/6/2022 9:43â€¯PM] szybet
it takes more time


[3/6/2022 9:43â€¯PM] tux_linux
well, that's a depressive video ğŸ˜‚


[3/6/2022 9:43â€¯PM] szybet
everything works


[3/6/2022 9:43â€¯PM] szybet
and then nothing


[3/6/2022 9:43â€¯PM] tux_linux
did you experience UI freeze sometimes? I think so, right?


[3/6/2022 9:44â€¯PM] szybet
sometimes


[3/6/2022 9:44â€¯PM] szybet
the file chooser, maybe changing pages


[3/6/2022 9:44â€¯PM] tux_linux
though the video shows you stressed the UI to its maximum so it should have crashed already


[3/6/2022 9:44â€¯PM] szybet
??? stressed ui?


[3/6/2022 9:44â€¯PM] tux_linux
by freeze, I mean completely freezing, you're not able to do anything, you have to `restart inkbox_gui`?


[3/6/2022 9:45â€¯PM] tux_linux
well, rapidly clicking next page button for example


[3/6/2022 9:45â€¯PM] tux_linux
Most devices handle that well but on my Libra for example this can lead to an UI freeze


[3/6/2022 9:45â€¯PM] tux_linux
Since the Libra has the same kernel version that of the Nia, I wanted to check


[3/6/2022 9:45â€¯PM] szybet
through the video, only at the end


[3/6/2022 9:46â€¯PM] szybet
i cant click fast? common...


[3/6/2022 9:46â€¯PM] tux_linux
yes, you can, normally


[3/6/2022 9:46â€¯PM] tux_linux
I think that UI freeze is due to the fact that it expects to have a PDF displayed but it's actually an epub and it panics, so unrelated


[3/6/2022 9:47â€¯PM] szybet
maybe


[3/6/2022 9:47â€¯PM] tux_linux
I was talking about UI freezes by the platform plugin


[3/6/2022 9:47â€¯PM] tux_linux
it works on touch, mini, glo, glo hd, aura 2, but is unstable on the Libra


[3/6/2022 9:47â€¯PM] tux_linux
so I wanted to see if yours was unstable or not


[3/6/2022 9:47â€¯PM] tux_linux
it seems stable


[3/6/2022 9:48â€¯PM] szybet
yea, it seems


[3/6/2022 9:48â€¯PM] szybet
i will test it more when opening epubs and pdf will be not faulty

{Reactions}
ğŸ‘ 

[3/6/2022 9:48â€¯PM] tux_linux
Actually, it segfaults there, right?


[3/6/2022 9:48â€¯PM] szybet
maybe, i didn't have serial connection then


[3/6/2022 9:49â€¯PM] tux_linux
can you try to reproduce the error? that way we'll be sure


[3/6/2022 9:50â€¯PM] szybet
one minute

{Reactions}
ğŸ‘ 

[3/6/2022 9:54â€¯PM] szybet
1 boot up
2 open the epub last time it errored, nothing shows up, last page, no previous page but i can go into options
3 launch a epub that worked before, it works
4 launch the pdf that worked all the time, it freezes exactly like the last book on the video, no information on serial


[3/6/2022 9:58â€¯PM] tux_linux
ok, well first do `rc-service inkbox_gui restart` to see inkbox stdout


[3/6/2022 9:58â€¯PM] tux_linux
it is silenced by default otherwise


[3/6/2022 9:58â€¯PM] szybet
oh


[3/6/2022 9:58â€¯PM] tux_linux
do you have global reading settings enabled or disabled?


[3/6/2022 9:58â€¯PM] szybet
i will check, i hope it saved

{Reactions}
ğŸ‘ 

[3/6/2022 10:01â€¯PM] szybet
enabled


[3/6/2022 10:01â€¯PM] szybet
is it good?


[3/6/2022 10:06â€¯PM] szybet
@tux-linux


[3/6/2022 10:44â€¯PM] tux_linux
Yes


[3/6/2022 10:44â€¯PM] tux_linux
It is


[3/6/2022 10:44â€¯PM] tux_linux
Sorry for the delay


[3/6/2022 10:50â€¯PM] tux_linux
Can you try X11?


[3/6/2022 10:50â€¯PM] tux_linux
I will hopefully have the courage to debug that book opening issue


[3/6/2022 10:50â€¯PM] tux_linux
soonâ„¢ï¸


[3/6/2022 10:51â€¯PM] szybet
1 opened a epub, it doesn't work
2 home
3 opened a pdf, the screen flickered for 2 minutes
4 book menu, nothing works, and: ***Segmentation fault***


[3/6/2022 10:52â€¯PM] tux_linux
ok yeah so it is not related to the QPA, as expected


[3/6/2022 10:53â€¯PM] szybet
its rebooting

{Reactions}
ğŸ‘ 

[3/6/2022 10:54â€¯PM] tux_linux
yay, can reproduce here


[3/6/2022 10:54â€¯PM] szybet
but why the first epub didn't worked?


[3/6/2022 10:54â€¯PM] tux_linux
that I don't know


[3/6/2022 10:54â€¯PM] szybet
thats not good


[3/6/2022 10:55â€¯PM] tux_linux
was it just after a reboot?


[3/6/2022 10:55â€¯PM] szybet
yes


[3/6/2022 10:55â€¯PM] tux_linux
can you share the epub?


[3/6/2022 10:56â€¯PM] szybet
sended on pw

{Reactions}
ğŸ‘ 

[3/6/2022 10:57â€¯PM] szybet
xorg works


[3/6/2022 10:57â€¯PM] szybet
and its maybe faster?


[3/6/2022 10:58â€¯PM] tux_linux
what do you mean?


[3/6/2022 10:58â€¯PM] szybet
idk, maybe just the menu


[3/6/2022 10:58â€¯PM] szybet
im trying to launch geany


[3/6/2022 10:58â€¯PM] tux_linux
ok


[3/6/2022 10:58â€¯PM] tux_linux
can take ~1m


[3/6/2022 10:59â€¯PM] tux_linux
on newer devices it's usually faster


[3/6/2022 10:59â€¯PM] tux_linux
kterm can launch in 45s on the libra


[3/6/2022 10:59â€¯PM] szybet
black screen


[3/6/2022 10:59â€¯PM] szybet
and


[3/6/2022 10:59â€¯PM] szybet
`Server terminated successfully (0). Closing log file`


[3/6/2022 11:00â€¯PM] tux_linux
yes


[3/6/2022 11:00â€¯PM] tux_linux
normal


[3/6/2022 11:00â€¯PM] tux_linux
wait a bit


[3/6/2022 11:00â€¯PM] tux_linux
you can see in `ps` if geany is running


[3/6/2022 11:00â€¯PM] szybet
serial cmd is lagging


[3/6/2022 11:01â€¯PM] szybet
```
kobo:~# free                                                                                   
              total        used        free      shared  buff/cache   available                
Mem:         250128       90136        2712        1696      157280      137400                
Swap:             0           0           0
```


[3/6/2022 11:01â€¯PM] tux_linux
137M is quite a lot


[3/6/2022 11:01â€¯PM] szybet
hm, it will run out of memory


[3/6/2022 11:01â€¯PM] tux_linux
no?


[3/6/2022 11:01â€¯PM] szybet
but free


[3/6/2022 11:01â€¯PM] szybet
but ok


[3/6/2022 11:01â€¯PM] tux_linux
No, check the `available` part


[3/6/2022 11:01â€¯PM] tux_linux
the others are not relevant


[3/6/2022 11:02â€¯PM] szybet
it works, its horrible and no thanks


[3/6/2022 11:02â€¯PM] tux_linux
it's that horrible?


[3/6/2022 11:02â€¯PM] szybet
for me, yes


[3/6/2022 11:02â€¯PM] szybet
for you, no


[3/6/2022 11:02â€¯PM] tux_linux
maybe you mean the size of the keyboard


[3/6/2022 11:02â€¯PM] tux_linux
that is horrible


[3/6/2022 11:03â€¯PM] szybet
it flickers too much for me


[3/6/2022 11:03â€¯PM] tux_linux
well, what do you expect, it's an eink screen


[3/6/2022 11:03â€¯PM] szybet
a native fbink editor would work better


[3/6/2022 11:03â€¯PM] tux_linux
try kterm


[3/6/2022 11:04â€¯PM] szybet
i will write one in the future *i hope*


[3/6/2022 11:04â€¯PM] tux_linux
maybe it will be better


[3/6/2022 11:04â€¯PM] tux_linux
check out inkvt


[3/6/2022 11:04â€¯PM] tux_linux
`echo true > /boot/flags/DISPLAY_DEBUG`


[3/6/2022 11:04â€¯PM] tux_linux
that will throw serial console output on the screen instead of the serial port


[3/6/2022 11:04â€¯PM] tux_linux
with inkvt


[3/6/2022 11:05â€¯PM] tux_linux
you can quit geany with file->quit


[3/6/2022 11:05â€¯PM] tux_linux
gui will launch automatically after that


[3/6/2022 11:06â€¯PM] szybet
well, tommorow i will check it

{Reactions}
ğŸ‘ 

[3/7/2022 6:32â€¯AM] tux_linux
ePUB/PDF opening issue was fixed with those two commits:
https://github.com/Kobo-InkBox/inkbox/commit/8501b42124a8c44c79dfa455d3dfac577395bb99
https://github.com/Kobo-InkBox/gui-bundle/commit/9fc6551f054dc97be82b9cc316fad32b7e50fb7c

{Embed}
https://github.com/Kobo-InkBox/inkbox/commit/8501b42124a8c44c79dfa455d3dfac577395bb99
Reader framework: fix file opening bug Â· Kobo-InkBox/inkbox@8501b42
When an user first opened an ePUB, then a PDF, it didn't work. This was
due to an issue with the two tmpfs at '/kobo/inkbox' and '/kobo/run'.
This commit fixes that issue.
/mnt/data/projects/git/conversations/media/8501b42124a8c44c79dfa455d3dfac577395bb99-7A619

{Embed}
https://github.com/Kobo-InkBox/gui-bundle/commit/9fc6551f054dc97be82b9cc316fad32b7e50fb7c
Add remount_tmpfs_launch.sh script; improve inkbox.sh Â· Kobo-InkBox...
/mnt/data/projects/git/conversations/media/9fc6551f054dc97be82b9cc316fad32b7e50fb7c-0F1C9


[3/7/2022 6:40â€¯AM] szybet
You can prepare a GUI bundle


[3/7/2022 6:41â€¯AM] szybet
And i think in the future i will make a docker image with Qt and everything to compile inkbox


[3/7/2022 6:46â€¯AM] tux_linux
Nice


[3/7/2022 6:46â€¯AM] tux_linux
12:40AM here so


[3/7/2022 6:47â€¯AM] tux_linux
Probably will be tomorrow


[3/7/2022 6:49â€¯AM] tux_linux
Or you can try that
https://github.com/Rain92/kobo-qt-setup-scripts
But I didn't test it so I don't know what it does really

{Embed}
https://github.com/Rain92/kobo-qt-setup-scripts
GitHub - Rain92/kobo-qt-setup-scripts
Contribute to Rain92/kobo-qt-setup-scripts development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-qt-setup-scripts-2F94D


[3/7/2022 6:50â€¯AM] tux_linux
And then compile InkBox yourself
`qmake .`
`make`


[3/7/2022 7:23â€¯AM] szybet
Diffrent time zones, a 5 hour shift


[3/7/2022 3:30â€¯PM] tux_linux
I'm in Canada ;p


[3/7/2022 3:31â€¯PM] tux_linux
I'll make the GUI bundle now


[3/7/2022 3:40â€¯PM] tux_linux
Bundle done!


[3/7/2022 3:41â€¯PM] tux_linux (pinned)
http://23.163.0.39/bundles/private/update-n306.isa


[3/7/2022 4:10â€¯PM] szybet
Pinned a message.


[3/7/2022 4:11â€¯PM] szybet
Pinned a message.


[3/7/2022 4:11â€¯PM] szybet
i will try it

{Reactions}
ğŸ‘ 

[3/7/2022 4:20â€¯PM] szybet
the linus book doesn't work


[3/7/2022 4:20â€¯PM] tux_linux
not again


[3/7/2022 4:21â€¯PM] tux_linux
have you global reading settings enabled?


[3/7/2022 4:21â€¯PM] szybet
yes


[3/7/2022 4:21â€¯PM] tux_linux
hang on
let me try here


[3/7/2022 4:22â€¯PM] tux_linux
maybe it's an issue with the book itself


[3/7/2022 4:22â€¯PM] tux_linux
do other ones work?


[3/7/2022 4:23â€¯PM] szybet
no, epubs dont work


[3/7/2022 4:24â€¯PM] tux_linux
linus book works perfectly here


[3/7/2022 4:24â€¯PM] tux_linux
did you reboot?


[3/7/2022 4:25â€¯PM] szybet
yes, i can reboot one more time


[3/7/2022 4:25â€¯PM] szybet
for me none epubs work


[3/7/2022 4:25â€¯PM] tux_linux
do reboot


[3/7/2022 4:25â€¯PM] tux_linux
this is weird


[3/7/2022 4:25â€¯PM] szybet
oh, one works


[3/7/2022 4:25â€¯PM] tux_linux
is it the one not in a subdir for some reason?


[3/7/2022 4:26â€¯PM] szybet
all of them are in a subdir


[3/7/2022 4:26â€¯PM] tux_linux
do you open them with the recent books buttons or the file manager?


[3/7/2022 4:26â€¯PM] szybet
both


[3/7/2022 4:26â€¯PM] szybet
even with search


[3/7/2022 4:27â€¯PM] tux_linux
does search work with subdirs?


[3/7/2022 4:27â€¯PM] szybet
yes


[3/7/2022 4:27â€¯PM] tux_linux
nice


[3/7/2022 4:27â€¯PM] tux_linux
I can't see what's causing the issue


[3/7/2022 4:28â€¯PM] tux_linux
`while true; do ls -shal /kobo/run /kobo/inkbox; sleep 1; done`


[3/7/2022 4:28â€¯PM] szybet
?


[3/7/2022 4:28â€¯PM] tux_linux
please run this on the kobo


[3/7/2022 4:28â€¯PM] tux_linux
open an ePUB, then a PDF, then an ePUB


[3/7/2022 4:28â€¯PM] szybet
with what, search, file, recent?


[3/7/2022 4:29â€¯PM] tux_linux
file manager


[3/7/2022 4:29â€¯PM] szybet
does that make a diffrence when i use something else?


[3/7/2022 4:29â€¯PM] tux_linux
something else what?


[3/7/2022 4:29â€¯PM] tux_linux
well, it should not


[3/7/2022 4:29â€¯PM] tux_linux
(if you're talking about opening methods)


[3/7/2022 4:30â€¯PM] szybet
also, the file manager is slow, its hard to use so i avoid it as much i can


[3/7/2022 4:30â€¯PM] szybet
yes


[3/7/2022 4:30â€¯PM] tux_linux
then Search is probably your best friend


[3/7/2022 4:30â€¯PM] tux_linux
maybe I should just put a search-like file manager instead


[3/7/2022 4:31â€¯PM] szybet
no, a list is needed to


[3/7/2022 4:31â€¯PM] tux_linux
?


[3/7/2022 4:31â€¯PM] szybet
i dont remember names of all my books


[3/7/2022 4:31â€¯PM] tux_linux
No I mean, display a file list like if you searched for pdf, epub, png at once


[3/7/2022 4:32â€¯PM] tux_linux
So it displays a list of all compatible books found


[3/7/2022 4:32â€¯PM] szybet
yes


[3/7/2022 4:32â€¯PM] szybet
thats better


[3/7/2022 4:32â€¯PM] tux_linux
also, try to reboot


[3/7/2022 4:33â€¯PM] szybet
everything works now, i will reboot and use the last books menu


[3/7/2022 4:34â€¯PM] tux_linux
what?


[3/7/2022 4:34â€¯PM] tux_linux
nonsense


[3/7/2022 4:34â€¯PM] tux_linux
what did you do


[3/7/2022 4:34â€¯PM] szybet
yes it is


[3/7/2022 4:34â€¯PM] szybet
the only thing i did in a other way, that i used the file manager not the search menu


[3/7/2022 4:34â€¯PM] tux_linux
wait; i'll try with the file manager on my side


[3/7/2022 4:34â€¯PM] tux_linux
*search I mean


[3/7/2022 4:36â€¯PM] tux_linux
oh; maybe the search function doesn't understand relative paths


[3/7/2022 4:36â€¯PM] tux_linux
it doesn't work here too


[3/7/2022 4:36â€¯PM] tux_linux
try putting linus book in onboard root and open it with search again


[3/7/2022 4:37â€¯PM] szybet
search doesn't work for me


[3/7/2022 4:38â€¯PM] szybet
maybe add a check function that checks if a file exists


[3/7/2022 4:38â€¯PM] szybet
or smth...


[3/7/2022 4:38â€¯PM] tux_linux
even if the file is in onboard root?


[3/7/2022 4:39â€¯PM] szybet
wait


[3/7/2022 4:39â€¯PM] szybet
onboard works


[3/7/2022 4:40â€¯PM] tux_linux
ok, i see the problem


[3/7/2022 4:41â€¯PM] tux_linux
https://github.com/Kobo-InkBox/inkbox/blob/8501b42124a8c44c79dfa455d3dfac577395bb99/generaldialog.cpp#L336-L357


[3/7/2022 4:41â€¯PM] tux_linux
I only save `dirIt.fileName()` while I should also save `dirIt.filePath()` to allow opening files in subdirs


[3/7/2022 4:42â€¯PM] szybet
why does opening books take long, and next pages too? couldn't you save next pages into ram while reading current page?


[3/7/2022 4:43â€¯PM] tux_linux
I actually had an idea two days ago about this
I'm going to implement it soon


[3/7/2022 4:43â€¯PM] szybet
good, then inkbox will be usable


[3/7/2022 4:43â€¯PM] tux_linux
Won't change the speed of opening a book much, but page will load in less than a second


[3/7/2022 4:44â€¯PM] tux_linux
Did you try with smaller ebooks? It's faster there


[3/7/2022 4:44â€¯PM] tux_linux
Search "jekyll" in online library and download the second book in the list


[3/7/2022 4:45â€¯PM] szybet
I opened a random book from recent list, it didn't worker ( last page, no  previous page ), then the book dissapered from the list


[3/7/2022 4:46â€¯PM] szybet
a book with only text works great


[3/7/2022 4:46â€¯PM] szybet
but thats about it, some images and its dying


[3/7/2022 4:47â€¯PM] tux_linux
images will be something to implement too


[3/7/2022 4:47â€¯PM] szybet
why did the gui


[3/7/2022 4:47â€¯PM] szybet
died


[3/7/2022 4:47â€¯PM] tux_linux
hmm hmm


[3/7/2022 4:47â€¯PM] szybet
and brightness to 0


[3/7/2022 4:47â€¯PM] tux_linux
ui freeze?


[3/7/2022 4:47â€¯PM] szybet
yes


[3/7/2022 4:47â€¯PM] szybet
randomly


[3/7/2022 4:47â€¯PM] szybet
i didn't do anything


[3/7/2022 4:47â€¯PM] tux_linux
Did you click "Cancel" in the file dialog?


[3/7/2022 4:48â€¯PM] tux_linux
If you do `ps | grep inkbox-bin`, does that give anything?


[3/7/2022 4:48â€¯PM] szybet
im in the book that is fast


[3/7/2022 4:48â€¯PM] szybet
yes  2203 root      0:09 /mnt/onboard/.adds/inkbox/inkbox-bin


[3/7/2022 4:49â€¯PM] tux_linux
can you try to click somewhere where it would normally do something?


[3/7/2022 4:49â€¯PM] szybet
nothing


[3/7/2022 4:49â€¯PM] tux_linux
then, put it to sleep; click the power button


[3/7/2022 4:49â€¯PM] szybet
and brighntess is 0


[3/7/2022 4:49â€¯PM] tux_linux
wait 15s
click it again


[3/7/2022 4:49â€¯PM] tux_linux
if you have access to the cli it is not dead


[3/7/2022 4:49â€¯PM] szybet
the brightness went to 100%, then slowly to 0 and now its sleeping


[3/7/2022 4:50â€¯PM] tux_linux
After that, is it the same or can you click and it reacts?


[3/7/2022 4:50â€¯PM] szybet
but with no sleeping text


[3/7/2022 4:50â€¯PM] tux_linux
that's what I was fearing


[3/7/2022 4:50â€¯PM] tux_linux
The Nia is now on the unstable devices list


[3/7/2022 4:50â€¯PM] tux_linux
Try to wake it up


[3/7/2022 4:50â€¯PM] szybet
how did it launch a word seafrch list


[3/7/2022 4:50â€¯PM] szybet
it waked up by his own, i didn't clicked anything


[3/7/2022 4:51â€¯PM] tux_linux
is your kobo plugged in via usb?


[3/7/2022 4:51â€¯PM] szybet
no


[3/7/2022 4:51â€¯PM] szybet
i disconeccted it becouse everytime i go to home it asks me about usb


[3/7/2022 4:51â€¯PM] tux_linux
hmm


[3/7/2022 4:51â€¯PM] tux_linux
can you try to put it to sleep one more time? try not to touch anything except the power button


[3/7/2022 4:52â€¯PM] szybet
its sleeps


[3/7/2022 4:52â€¯PM] tux_linux
well, yeah, but for how long


[3/7/2022 4:52â€¯PM] tux_linux
the real moment when it sleeps is 15s after you pressed the power button


[3/7/2022 4:52â€¯PM] tux_linux
otherwise it wakes up again because the kernel says "Resource busy"


[3/7/2022 4:53â€¯PM] szybet
it sleeps


[3/7/2022 4:53â€¯PM] tux_linux
ok oof


[3/7/2022 4:53â€¯PM] tux_linux
now wake it up


[3/7/2022 4:53â€¯PM] tux_linux
We will try something


[3/7/2022 4:53â€¯PM] szybet
and


[3/7/2022 4:54â€¯PM] szybet
i cant click anything, the brightness button for example


[3/7/2022 4:54â€¯PM] szybet
it went to a book


[3/7/2022 4:54â€¯PM] szybet
why


[3/7/2022 4:54â€¯PM] szybet
another freeze


[3/7/2022 4:54â€¯PM] tux_linux
```
cp /etc/init.d/inkbox_gui /tmp
vi /tmp/inkbox_gui
```


[3/7/2022 4:55â€¯PM] tux_linux
Edit the file so that line 47 looks like this


[3/7/2022 4:55â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-C09D7.png


[3/7/2022 4:55â€¯PM] tux_linux
Then
```
mount --bind /tmp/inkbox_gui /etc/init.d/inkbox_gui
rc-service inkbox_gui restart
```


[3/7/2022 4:55â€¯PM] tux_linux
This will launch InkBox GUI with the newer platform plugin I was talking about yesterday


[3/7/2022 4:57â€¯PM] tux_linux
Also, when you run `chroot /kobo /bin/kobo_config.sh` it should output `luna`, right?


[3/7/2022 4:59â€¯PM] szybet
yes


[3/7/2022 4:59â€¯PM] tux_linux
ok, so try the steps above


[3/7/2022 4:59â€¯PM] tux_linux
I'm trying them on my Libra too which has the same problem


[3/7/2022 4:59â€¯PM] szybet
i need wifi but i dont have any gui


[3/7/2022 5:00â€¯PM] tux_linux
don't you have serial?


[3/7/2022 5:00â€¯PM] szybet
do i need to try these 2 commands from yeastarday?


[3/7/2022 5:00â€¯PM] tux_linux
no


[3/7/2022 5:00â€¯PM] szybet
nano sucks on serial


[3/7/2022 5:00â€¯PM] tux_linux
use `vi`


[3/7/2022 5:00â€¯PM] tux_linux
also, tip: `reset` so that your terminal isn't messed up anymore


[3/7/2022 5:01â€¯PM] tux_linux
or maybe you can usbnet?


[3/7/2022 5:01â€¯PM] szybet
i will just do it with vim


[3/7/2022 5:01â€¯PM] szybet
i will try


[3/7/2022 5:01â€¯PM] tux_linux
noooooo


[3/7/2022 5:01â€¯PM] tux_linux
serial doesn't like vim


[3/7/2022 5:01â€¯PM] tux_linux
only likes vi


[3/7/2022 5:01â€¯PM] szybet
yes vi vi

{Reactions}
ğŸ‘ 

[3/7/2022 5:04â€¯PM] tux_linux
well, it messes up rotation on my libra


[3/7/2022 5:05â€¯PM] tux_linux
hope it won't be the case for the Nia


[3/7/2022 5:09â€¯PM] szybet
```
[FBInk] Unidentified Kobo device code (40)!                                                    
kobofb: Finished initialization.                                                               
[FBInk] [refresh_kobo] MXCFB_SEND_UPDATE_V1_NTX: Operation not permitted!                      
[FBInk] [fbink_refresh] Failed to refresh the screen!                                          
[FBInk] [refresh_kobo] MXCFB_SEND_UPDATE_V1_NTX: Operation not permitted!                      
[FBInk] [fbink_refresh] Failed to refresh the screen!                                          
[FBInk] [refresh_kobo] MXCFB_SEND_UPDATE_V1_NTX: Operation not permitted!                      
[FBInk] [fbink_refresh] Failed to refresh the screen!
```


[3/7/2022 5:09â€¯PM] szybet
mhm


[3/7/2022 5:09â€¯PM] tux_linux
so you can never see the gui?


[3/7/2022 5:09â€¯PM] szybet
the screen doesn't changed


[3/7/2022 5:10â€¯PM] tux_linux
`cat /sys/class/graphics/fb0/rotate`


[3/7/2022 5:11â€¯PM] szybet
3


[3/7/2022 5:11â€¯PM] tux_linux
`fbink -k -f` does something?


[3/7/2022 5:13â€¯PM] szybet
```
[FBInk] Couldn't find a Kobo version tag (onboard unmounted or not running on a Kobo?)!        
[FBInk] Detected a Kobo Nia (382 => Luna @ Mark 7)                                             
[FBInk] Enabled Kobo Mark 7 quirks                                                             
[FBInk] Clock tick frequency appears to be 100 Hz                                              
[FBInk] Screen density set to 212 dpi                                                          
[FBInk] Variable fb info: 758x1024, 8bpp @ rotation: 3 (Counter Clockwise, 270Â°)               
[FBInk] Fixed fb info: ID is "mxc_epdc_fb", length of fb mem: 3145728 bytes & line length: 768s
[FBInk] Canonical rotation: 0 (Upright, 0Â°)                                                    
[FBInk] Fontsize set to 16x16 (IBM base glyph size: 8x8)                                       
[FBInk] Line length: 47 cols, Page size: 64 rows                                               
[FBInk] Pen colors set to #000000 for the foreground and #FFFFFF for the background            
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!                      
[FBInk] [fbink_cls] Failed to refresh the screen!
```


[3/7/2022 5:13â€¯PM] tux_linux
ok, now try to put it to sleep, then wake it up
maybe we can be lucky


[3/7/2022 5:14â€¯PM] tux_linux
After that, try `rc-service inkbox_gui restart`


[3/7/2022 5:15â€¯PM] szybet
only the minutes showed up


[3/7/2022 5:15â€¯PM] szybet
after returning from sleep


[3/7/2022 5:15â€¯PM] tux_linux
ok, yeah, good thing


[3/7/2022 5:15â€¯PM] tux_linux
try service restart now


[3/7/2022 5:16â€¯PM] szybet
yes, its working


[3/7/2022 5:16â€¯PM] szybet
whot now


[3/7/2022 5:16â€¯PM] tux_linux
well, what is working? the UI?


[3/7/2022 5:17â€¯PM] tux_linux
touch input, graphics, all?


[3/7/2022 5:17â€¯PM] szybet
i managed to change the brightness, so yes


[3/7/2022 5:17â€¯PM] tux_linux
ok, rotation is good?


[3/7/2022 5:17â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220307_171533-2F384.jpg


[3/7/2022 5:17â€¯PM] szybet
for a minute it looked like this


[3/7/2022 5:17â€¯PM] szybet
how to i rotate?


[3/7/2022 5:17â€¯PM] tux_linux
`ls -shal /kobo/mnt/onboard/.adds/qt-linux-5.15.2-kobo/lib/plugins/platforms/libkobo.so`


[3/7/2022 5:18â€¯PM] tux_linux
The Glo HD does this too when getting out of sleep, idk why


[3/7/2022 5:18â€¯PM] szybet
no such file


[3/7/2022 5:19â€¯PM] tux_linux
it is fixed by restarting inkbox binary


[3/7/2022 5:19â€¯PM] tux_linux
`ls -shal /kobo/mnt/onboard/.adds/qt-linux-5.15.2-kobo/plugins/platforms/libkobo.so` sorry


[3/7/2022 5:22â€¯PM] szybet
411 -rwxr-xr-x    1 root     root      411.6K Feb 19 17:24 /kobo/mnt/onboard/.adds/qt-linux-5.15.2-kobo/plugins/platforms/libkobo.so


[3/7/2022 5:22â€¯PM] tux_linux
good!


[3/7/2022 5:22â€¯PM] tux_linux
Can you play around the UI a bit?
Stress it maybe too?


[3/7/2022 5:23â€¯PM] szybet
yes


[3/7/2022 5:23â€¯PM] tux_linux
If it doesn't crash, wheehee


[3/7/2022 5:23â€¯PM] szybet
last books doesn't work


[3/7/2022 5:24â€¯PM] szybet
already crashed


[3/7/2022 5:24â€¯PM] szybet
and is refreshing


[3/7/2022 5:24â€¯PM] tux_linux
awesome


[3/7/2022 5:24â€¯PM] szybet
```[FBInk] Unidentified Kobo device code (40)!
kobofb: Finished initialization.```


[3/7/2022 5:24â€¯PM] szybet
why


[3/7/2022 5:24â€¯PM] tux_linux
yeah that's normal, it says that even when it's working


[3/7/2022 5:24â€¯PM] tux_linux
sarcasm


[3/7/2022 5:24â€¯PM] tux_linux
well, if that platform plugin doesn't work, we're screwed


[3/7/2022 5:25â€¯PM] szybet
hm


[3/7/2022 5:25â€¯PM] tux_linux
At least it's fixable by going to sleep, then waking up


[3/7/2022 5:25â€¯PM] tux_linux
not requiring an entire reboot


[3/7/2022 5:26â€¯PM] szybet
still not good


[3/7/2022 5:26â€¯PM] tux_linux
i know


[3/7/2022 5:26â€¯PM] tux_linux
but this is out of my knowledge


[3/7/2022 5:26â€¯PM] tux_linux
it should not even happen


[3/7/2022 5:26â€¯PM] tux_linux
also that's wonderful news for clara hd porting (same kernel, or maybe andi1's 5.16 tree will save us)
delivering an image that is half-working at best


[3/7/2022 5:29â€¯PM] tux_linux
at what rate did it crash before we tried with the newer platform plugin?


[3/7/2022 5:29â€¯PM] tux_linux
like, 5 mins average, 10 min average, what?


[3/7/2022 5:32â€¯PM] tux_linux
I see one possible, hypothetic, crazy solution:
You implement a VNC viewer with FBInk in Rust and we run that one instead of the native platform plugin. In Qt libs I put on the Kobo, there's `libvnc.so`, which allows creating a VNC server to which you can connect with a client. It is used in InkBox OS emulator to interact with the UI because implementing a touch screen in QEMU would be difficult. Assuming that your VNC viewer maps touch input correctly and does not trigger the same kernel bug that the platform plugin did, this would provide a complete, stable and painless UI hardware abstraction layer.


[3/7/2022 5:34â€¯PM] tux_linux
Maybe you can look at this project https://github.com/whitequark/rust-vnc


[3/7/2022 5:36â€¯PM] szybet
this will be not efficient, inkbox is now not super fast


[3/7/2022 5:36â€¯PM] tux_linux
then what do you suggest?


[3/7/2022 5:36â€¯PM] szybet
idk


[3/7/2022 5:36â€¯PM] szybet
idk


[3/7/2022 5:38â€¯PM] szybet
i dont know if it was that bad before


[3/7/2022 5:39â€¯PM] tux_linux
or we can just go ahead with what we have now


[3/7/2022 5:40â€¯PM] szybet
it wasn't that bad, you mean all crashes?


[3/7/2022 5:40â€¯PM] tux_linux
yeah


[3/7/2022 5:40â€¯PM] tux_linux
ui freeze


[3/7/2022 5:40â€¯PM] szybet
some of them were becouse of the pdf - ebup thing


[3/7/2022 5:40â€¯PM] tux_linux
on my libra it *is* that bad


[3/7/2022 5:40â€¯PM] tux_linux
maybe with some luck the Nia isn't as much as affected


[3/7/2022 5:43â€¯PM] szybet
maybe


[3/7/2022 5:44â€¯PM] szybet
can you describe the issue more?


[3/7/2022 5:45â€¯PM] tux_linux
i can't, it's just as you said, it freezes randomly for no reason


[3/7/2022 5:45â€¯PM] tux_linux
Qt still reacts to input events and button presses, it just doesn't show up on the screen


[3/7/2022 5:45â€¯PM] tux_linux
```
killall inkbox-bin; env QT_QPA_PLATFORM=vnc:size=768x1024 chroot /kobo /mnt/onboard/.adds/inkbox/inkbox.sh
```
You can try the VNC server this way


[3/7/2022 5:46â€¯PM] tux_linux
Just access your Kobo's IP via Wi-Fi or USBNet with a VNC viewer


[3/7/2022 5:46â€¯PM] szybet
only qt?


[3/7/2022 5:46â€¯PM] szybet
maybe its qt related


[3/7/2022 5:46â€¯PM] tux_linux
No, it happens when you do too much refreshes with FBInk too


[3/7/2022 5:48â€¯PM] szybet
why this problem doesn't occurs on the stock firmware?


[3/7/2022 5:49â€¯PM] tux_linux
no idea


[3/7/2022 5:50â€¯PM] szybet
maybe do a bug report to the linux kernel or smth?


[3/7/2022 5:51â€¯PM] tux_linux
what would that change?


[3/7/2022 5:51â€¯PM] tux_linux
Check the average reply rate here: https://github.com/kobolabs/Kobo-Reader/issues

{Embed}
https://github.com/kobolabs/Kobo-Reader/issues
Issues Â· kobolabs/Kobo-Reader
Contribute to kobolabs/Kobo-Reader development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/Kobo-Reader-3775F


[3/7/2022 5:52â€¯PM] szybet
or to the people that developed open source fbink?


[3/7/2022 5:52â€¯PM] tux_linux
Already asked; NiLuJe has no idea either


[3/7/2022 5:52â€¯PM] szybet
so hardware related?


[3/7/2022 5:53â€¯PM] tux_linux
maybe?


[3/7/2022 5:53â€¯PM] tux_linux
probably


[3/7/2022 5:55â€¯PM] szybet
how to restore the changes?


[3/7/2022 5:56â€¯PM] szybet
now nothing is working


[3/7/2022 5:57â€¯PM] tux_linux
Reboot


[3/7/2022 5:57â€¯PM] szybet
nope, i rebooted twice


[3/7/2022 5:59â€¯PM] tux_linux
Huh


[3/7/2022 5:59â€¯PM] tux_linux
It should have unmounted the things


[3/7/2022 5:59â€¯PM] szybet
it is proprably software related? if hardware it would occur on stock firmware too


[3/7/2022 6:00â€¯PM] tux_linux
What's /etc/init.d/inkbox_gui contents?


[3/7/2022 6:01â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-121A9.png


[3/7/2022 6:01â€¯PM] szybet
the changes are gone


[3/7/2022 6:01â€¯PM] szybet
maybe i will dissconnect the battery?


[3/7/2022 6:04â€¯PM] tux_linux
It should work


[3/7/2022 6:04â€¯PM] tux_linux
Not the battery


[3/7/2022 6:04â€¯PM] tux_linux
I don't know why it doesn't


[3/7/2022 6:04â€¯PM] tux_linux
It crashes or what?


[3/7/2022 6:04â€¯PM] szybet
flickers


[3/7/2022 6:04â€¯PM] szybet
and nothing works


[3/7/2022 6:05â€¯PM] tux_linux
What do you mean "flickers"? How


[3/7/2022 6:05â€¯PM] szybet
the screen


[3/7/2022 6:05â€¯PM] tux_linux
Did you try service restart?


[3/7/2022 6:05â€¯PM] szybet
i rebooted twice...


[3/7/2022 6:07â€¯PM] tux_linux
Boot Nickel and come back


[3/7/2022 6:07â€¯PM] szybet
restore the sd card?


[3/7/2022 6:07â€¯PM] tux_linux
Don't you have another one?


[3/7/2022 6:07â€¯PM] szybet
no


[3/7/2022 6:08â€¯PM] tux_linux
Well


[3/7/2022 6:08â€¯PM] tux_linux
Idk


[3/7/2022 6:08â€¯PM] tux_linux
Do you have a video of what's happening?


[3/7/2022 6:09â€¯PM] szybet
dissconecting the battery worked


[3/7/2022 6:10â€¯PM] szybet
its working like before


[3/7/2022 6:13â€¯PM] tux_linux
WHAT


[3/7/2022 6:13â€¯PM] tux_linux
HOW


[3/7/2022 6:13â€¯PM] tux_linux
huh ok


[3/7/2022 6:14â€¯PM] szybet
if you could repair the search menu / last books menu i will take it to school / use the ereader with inkbox regularly and check how much the problem occurs

{Reactions}
ğŸ‘ 

[3/7/2022 6:14â€¯PM] tux_linux
Your Kobo is weird


[3/7/2022 6:14â€¯PM] szybet
https://tenor.com/view/idk-gif-7626108

{Embed}
https://tenor.com/view/idk-gif-7626108
/mnt/data/projects/git/conversations/media/idk-DD759.png


[3/7/2022 6:14â€¯PM] tux_linux
I'll start with search


[3/7/2022 6:15â€¯PM] szybet
it would be awesome if you managed to do this today


[3/7/2022 6:15â€¯PM] szybet
today in my time zone*


[3/7/2022 6:16â€¯PM] tux_linux
Maybe you can expect it by about 10pm in your timezone?


[3/7/2022 6:17â€¯PM] tux_linux
Or maybe earlier


[3/7/2022 6:20â€¯PM] szybet
sure, till 11 pm i can apply the patches


[3/7/2022 8:08â€¯PM] tux_linux
ok, fixed the search issue


[3/7/2022 8:09â€¯PM] szybet
good, thats the most important now


[3/7/2022 8:09â€¯PM] szybet
the last books menu is broken in many other ways, so well


[3/7/2022 8:09â€¯PM] szybet
search the best


[3/7/2022 8:10â€¯PM] tux_linux
yeah, i know, I'm planning to remove that
or replace it with something else


[3/7/2022 8:11â€¯PM] szybet
just a list with a slide, and maybe show directories with and then the books with a tab


[3/7/2022 8:17â€¯PM] tux_linux
https://github.com/Kobo-InkBox/inkbox/commit/847aa0051ee7a623fd3fcdc5d6848fe44c019a58

{Embed}
https://github.com/Kobo-InkBox/inkbox/commit/847aa0051ee7a623fd3fcdc5d6848fe44c019a58
Search dialog: Allow opening books from subdirectories Â· Kobo-InkBo...
/mnt/data/projects/git/conversations/media/847aa0051ee7a623fd3fcdc5d6848fe44c019a58-92489


[3/7/2022 8:17â€¯PM] tux_linux
I'll make you a GUI bundle


[3/7/2022 8:18â€¯PM] szybet
maybe replace the file explorer + last books into one?


[3/7/2022 8:20â€¯PM] tux_linux
maybe


[3/7/2022 8:20â€¯PM] tux_linux
could be a nice thing for 2.0 release


[3/7/2022 8:23â€¯PM] tux_linux
Done, uploaded the bundle


[3/7/2022 8:23â€¯PM] tux_linux
same url


[3/7/2022 8:24â€¯PM] tux_linux
Pinned a message.


[3/7/2022 8:26â€¯PM] szybet
is there a easier way to update it than going into u-boot?


[3/7/2022 8:26â€¯PM] tux_linux
scp it to the Kobo via usbnet


[3/7/2022 8:26â€¯PM] tux_linux
or make your own update package, but that's more complicated than going into u-boot


[3/7/2022 8:27â€¯PM] szybet
thats too


[3/7/2022 8:27â€¯PM] tux_linux
that much?


[3/7/2022 8:27â€¯PM] tux_linux (pinned)
`scp update-n306.isa root@192.168.2.2:/data/firmware/update.isa` and you're done


[3/7/2022 8:27â€¯PM] tux_linux
(well, service restart needed after that, but it's basically it)


[3/7/2022 8:28â€¯PM] szybet
maybe


[3/7/2022 8:30â€¯PM] tux_linux
that's what I do all the time TBH


[3/7/2022 8:37â€¯PM] szybet
Search works


[3/7/2022 8:38â€¯PM] tux_linux
nice


[3/7/2022 8:38â€¯PM] tux_linux
and you can open books from a subdir?


[3/7/2022 8:38â€¯PM] szybet
yes


[3/7/2022 8:38â€¯PM] szybet
even the linus epub with it


[3/7/2022 8:38â€¯PM] tux_linux
nice


[3/7/2022 8:39â€¯PM] tux_linux
and you're able to switch between pdf<->epub no problem?


[3/7/2022 8:42â€¯PM] szybet
yes


[3/7/2022 8:42â€¯PM] tux_linux
Ok awesome!


[3/7/2022 8:45â€¯PM] szybet
i think battery life on inkbox will be better?


[3/7/2022 8:45â€¯PM] szybet
with suspend?


[3/7/2022 8:46â€¯PM] tux_linux
yes


[3/7/2022 8:46â€¯PM] tux_linux
Well, it should be


[3/7/2022 9:07â€¯PM] szybet
the diode is not on when charging?


[3/7/2022 9:08â€¯PM] szybet
+ its sleeping


[3/7/2022 9:10â€¯PM] tux_linux
No


[3/7/2022 9:10â€¯PM] tux_linux
In what way is this a problem?


[3/7/2022 9:10â€¯PM] tux_linux
It is just handled by software and Nickel normally


[3/7/2022 9:25â€¯PM] szybet
i want to know if its charging


[3/7/2022 9:25â€¯PM] szybet
thats another option to add


[3/7/2022 9:29â€¯PM] tux_linux
there's the ~ battery icon ~


[3/7/2022 9:31â€¯PM] szybet
its sleeping


[3/7/2022 9:31â€¯PM] szybet
hmm


[3/7/2022 9:34â€¯PM] tux_linux
ah


[3/7/2022 9:35â€¯PM] tux_linux
well, none of my kobos do that and I survive


[3/7/2022 9:36â€¯PM] szybet
i dont want to trust the usb charger if its charging

{Reactions}
ğŸ‘ 

[3/7/2022 9:36â€¯PM] szybet
ğŸ˜†


[3/7/2022 9:44â€¯PM] szybet
it went out of sleep after hitting 100%


[3/7/2022 9:44â€¯PM] szybet
bug or feature?


[3/7/2022 9:45â€¯PM] tux_linux
bug?


[3/7/2022 9:45â€¯PM] tux_linux
idk why


[3/7/2022 9:45â€¯PM] tux_linux
kernel-related


[3/7/2022 10:08â€¯PM] szybet
i forgot about one thing


[3/7/2022 10:08â€¯PM] szybet
suspend when a magnet is near the hall sensor


[3/7/2022 10:09â€¯PM] szybet
now its only getting it out of suspend, but not in


[3/7/2022 10:10â€¯PM] tux_linux
hmm, yeah, that's an input event code I forgot to add


[3/7/2022 10:11â€¯PM] tux_linux
1. Reboot the Kobo.
2. When it says "(initrd) Press any key to stop auto-boot", press a key and login as root.
3. Launch `evtest /dev/input/event0`
4. Put the cover on the device as if you were putting it to sleep
5. Remove the cover from the screen
6. Post output of command in step 3.


[3/7/2022 10:13â€¯PM] szybet
can i do this using ssh?


[3/7/2022 10:13â€¯PM] tux_linux
you'll need to `killall evtest` before to ungrab the device
i'd do it directly in the initrd


[3/7/2022 10:13â€¯PM] szybet
hm, okay


[3/7/2022 10:14â€¯PM] szybet
but tommorow

{Reactions}
ğŸ‘ 

[3/8/2022 7:38â€¯AM] szybet
A PDF opens, there is the first page but there are no othet pages to switch


[3/8/2022 7:57â€¯AM] szybet
The scale when changing  pages is not applied, but the slider is still on its position


[3/8/2022 11:21â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220308_112000-9184D.jpg


[3/8/2022 11:21â€¯AM] szybet
Hm, ITS only in this specific pdf


[3/8/2022 11:24â€¯AM] szybet
Also a random thought: why dont you use the library wiev for the last book section?


[3/8/2022 11:26â€¯AM] szybet
When the PDF opens, its okay but aftet clicking options its doing this


[3/8/2022 11:45â€¯AM] szybet
The GUI freezes randomly, but not often. When i click power button its going to sleep, and the sleeping text appears. ( returning from sleep does not fix this ) Why? Its the most important problem @tux-linux


[3/8/2022 11:46â€¯AM] szybet
It only flickers ( and freezes ) when i click some od the last books, its random


[3/8/2022 12:45â€¯PM] tux_linux
Oh, that's not what it does on my Libra
Maybe it's a different problem
On my Libra, if it freezes, you put it to sleep then wake it up and everything is fine


[3/8/2022 12:46â€¯PM] tux_linux
Try with another PDF with a super long name


[3/8/2022 1:19â€¯PM] szybet
HMMMMM okay


[3/8/2022 1:19â€¯PM] szybet
The screen works, but Qt maybe not


[3/8/2022 1:19â€¯PM] szybet
It always freezes in a book in that problem


[3/8/2022 1:25â€¯PM] szybet
Its not the case, the Linus one has a similar lenght


[3/8/2022 3:06â€¯PM] tux_linux
But it's an Epub


[3/8/2022 3:37â€¯PM] szybet
i dont have a long epub


[3/8/2022 3:37â€¯PM] szybet
i will later change the name of one


[3/8/2022 3:37â€¯PM] szybet
how to debug this?


[3/8/2022 3:48â€¯PM] tux_linux
You can't


[3/8/2022 3:48â€¯PM] tux_linux
It's fixed, will commit shortly


[3/8/2022 3:49â€¯PM] szybet
what


[3/8/2022 3:49â€¯PM] tux_linux
Maybe check dmesg but don't be too hopeful


[3/8/2022 4:18â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/Transistor_Basics-1C7F5.pdf


[3/8/2022 4:18â€¯PM] szybet
does this pdf work for you?


[3/8/2022 4:27â€¯PM] tux_linux
https://inkbox.ddns.net/git/tux-linux/inkbox/-/commit/139aa787389fba9fbd2072f3609cc6ec39199d69

{Embed}
https://inkbox.ddns.net/git/tux-linux/inkbox/-/commit/139aa787389fba9fbd2072f3609cc6ec39199d69
Reader: Set wordWrap on bookInfoLabel when book isn't an ePUB (139a...
Open-source eBook reader
/mnt/data/projects/git/conversations/media/inkbox-CF12D.png


[3/8/2022 4:28â€¯PM] tux_linux
I'll see


[3/8/2022 6:34â€¯PM] szybet
im testing it for 4 hours now, changing pages, books, zooming etc


[3/8/2022 6:34â€¯PM] szybet
everything works


[3/8/2022 6:34â€¯PM] szybet
im confused


[3/8/2022 6:57â€¯PM] szybet
there are some problems with suspend


[3/8/2022 8:36â€¯PM] tux_linux
Me too


[3/8/2022 8:36â€¯PM] tux_linux
What exactly?


[3/8/2022 8:37â€¯PM] szybet
I will just test it till the weekend and then say

{Reactions}
ğŸ‘ 

[3/8/2022 8:40â€¯PM] szybet
when it goes to suspend, after some seconds it goes back, but the screen is freezed, brightness on. To unfreeze it i need to put it to sleep once again. and this bug wasn't before, im confused. And wifi search after suspend doesn't work, it goes to a loop and i cant do nothing


[3/8/2022 8:40â€¯PM] szybet
i will just test more

{Reactions}
ğŸ‘ 

[3/8/2022 8:40â€¯PM] tux_linux
Wi-Fi in Kobos in general is not great from the start


[3/8/2022 8:42â€¯PM] szybet
the wifi chip in kobos is horrible. I have a similar one in a tablet and it works on linux without many problems from 4 months ( kernel 5.x )


[3/8/2022 8:42â€¯PM] szybet
but it can be fixed, like a error message, not a loop


[3/8/2022 8:42â€¯PM] tux_linux
Wc121/cybertan is the worst ever.


[3/8/2022 8:42â€¯PM] szybet
also, here is the hal sensor

{Attachments}
/mnt/data/projects/git/conversations/media/message-537C8.txt


[3/8/2022 8:43â€¯PM] tux_linux
Oh thanks


[3/8/2022 8:43â€¯PM] szybet
1 is when the magnet is near, and 0 when it goes away


[3/8/2022 8:45â€¯PM] tux_linux
Ok yeah, so `KEY_F1`


[3/8/2022 8:46â€¯PM] tux_linux
The interesting thing is when you run Nickel in an emulator pressing F1 on your keyboard triggers sleep mode


[3/8/2022 8:48â€¯PM] szybet
thats just like linux works


[3/8/2022 8:48â€¯PM] szybet
windows key is alt + f1 for example


[3/8/2022 8:50â€¯PM] tux_linux
I honestly never use keybinds to put my computer to sleep mode ğŸ˜‚


[3/8/2022 8:50â€¯PM] tux_linux
So I learnt something new today


[3/8/2022 8:54â€¯PM] tux_linux
I'm wondering if it would be possible to boot into the BDK on the Nia and other devices by taking the sleep cover or a magnet as the second button
https://inkbox.ddns.net/wiki/index.php?title=Basic_diagnostics_kernel
That would be nice

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Basic_diagnostics_kernel
Basic diagnostics kernel


[3/8/2022 8:55â€¯PM] szybet
2 buttons


[3/8/2022 8:55â€¯PM] tux_linux
The Nia's U-Boot supports if/else statements, so maybe we could play around with that


[3/8/2022 8:55â€¯PM] szybet
Magnet + power button?


[3/8/2022 8:55â€¯PM] tux_linux
Yeah


[3/8/2022 8:56â€¯PM] tux_linux
Or just the magnet
Idk


[3/8/2022 8:56â€¯PM] szybet
Which what would that help, this kernel


[3/8/2022 8:56â€¯PM] tux_linux
Not much
But it might be helpful for future similar devices which have an eMMC


[3/8/2022 8:57â€¯PM] szybet
I dont think anyone would want to risk bricking their ereader


[3/8/2022 8:58â€¯PM] tux_linux
Some did
See Libra H2O porting thread


[3/8/2022 8:59â€¯PM] szybet
Nice


[3/8/2022 9:01â€¯PM] tux_linux
I have one, so maybe I'll try some things


[3/9/2022 1:03â€¯PM] szybet
Pinned a message.


[3/9/2022 1:03â€¯PM] szybet
Is this usbnet static? Or do i nead to apply it every boot


[3/9/2022 3:17â€¯PM] tux_linux
It's static
```
echo true > /boot/flags/USBNET_ENABLE
echo 192.168.x.x > /boot/flags/USBNET_IP
``` and it will stay like that


[3/9/2022 3:18â€¯PM] tux_linux
https://inkbox.ddns.net/wiki/index.php?title=Boot_flags
Check docs if you want more info on boot flags

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Boot_flags
Boot flags


[3/9/2022 3:22â€¯PM] tux_linux
There's something like ums in U-Boot you could do without using serial to launch it


[3/9/2022 3:22â€¯PM] tux_linux
Direct firmware loader mode


[3/9/2022 3:23â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/rcS-root#L47-L64

{Embed}
https://github.com/Kobo-InkBox/kernel/blob/master/initrd/common/rcS-root
kernel/rcS-root at master Â· Kobo-InkBox/kernel
Kernel sources for InkBox OS. Contribute to Kobo-InkBox/kernel development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kernel-8A7AF


[3/9/2022 3:24â€¯PM] tux_linux
And we could use `KEY_F1` as the second key


[3/9/2022 3:27â€¯PM] tux_linux
DFL basically exports the whole MMC over USB like U-Boot does but in Linux kernel


[3/9/2022 3:50â€¯PM] szybet
USBNET is everything i need


[3/9/2022 4:13â€¯PM] tux_linux
then there you go


[3/9/2022 6:52â€¯PM] szybet
changing a page boosts the cpu usage to 100%


[3/9/2022 6:52â€¯PM] szybet
ğŸ‘€


[3/9/2022 7:32â€¯PM] szybet
it goes to sleep, and then returns from it for no reason


[3/9/2022 7:32â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-3CF57.txt


[3/9/2022 7:33â€¯PM] szybet
here is part of dmesg


[3/9/2022 7:33â€¯PM] szybet
maybe becouse of usbnet now?


[3/9/2022 7:53â€¯PM] szybet
it works after 5 times of trying, here is the dmesg for it. ,aybe there is some diffrence

{Attachments}
/mnt/data/projects/git/conversations/media/message-A82B0.txt


[3/9/2022 8:26â€¯PM] szybet
1 Reboot
2 Try to suspend x times
3 after x times it works, and doesn't go back

its random


[3/9/2022 8:26â€¯PM] szybet
also, it doesn't go to sleep when wifi is connected, it goes back, always


[3/9/2022 8:27â€¯PM] szybet
where is the script / command / code responsible for suspend? @tux-linux, i could propably debug this by myself


[3/9/2022 8:34â€¯PM] szybet
1 connect wifi
2 try to suspend
3 click wifi button
4 its freezed at searching for networks
5 press power button for sleep
6 it goes to sleep
7 go back
8 networks show up
HMMM


[3/9/2022 8:53â€¯PM] szybet
when i turn on wifi, suspend doesn't work at all


[3/9/2022 8:57â€¯PM] szybet
***now i get it***, The freezes in the GUI are propably always late suspend attempts


[3/10/2022 12:40â€¯AM] tux_linux
What's `ls /dev/input`?


[3/10/2022 12:40â€¯AM] tux_linux
There should be event1 which should be the touchscreen


[3/10/2022 12:40â€¯AM] tux_linux
Right?


[3/10/2022 8:51â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220310_084920-F684A.jpg


[3/10/2022 8:51â€¯AM] szybet
Yes, and?


[3/10/2022 8:54â€¯AM] szybet
It is the touch screen, checked with cat


[3/10/2022 1:02â€¯PM] szybet
I leaved it on the home screen for -+ 1.5 hours, it eated up 3% od battery


[3/10/2022 1:02â€¯PM] szybet
ğŸ¤”


[3/10/2022 1:58â€¯PM] tux_linux
Still not bad


[3/10/2022 1:58â€¯PM] tux_linux
Well, that's what I get there too


[3/10/2022 2:00â€¯PM] tux_linux
`evtest /dev/input/event1`
Please post event codes list


[3/10/2022 3:38â€¯PM] tux_linux
but not for very long


[3/10/2022 3:40â€¯PM] tux_linux
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/sleep_standby.sh

{Embed}
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/sleep_standby.sh
rootfs/sleep_standby.sh at master Â· Kobo-InkBox/rootfs
InkBox OS root filesystem. Contribute to Kobo-InkBox/rootfs development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/rootfs-50853


[3/10/2022 3:43â€¯PM] szybet
Okay, later


[3/10/2022 3:43â€¯PM] szybet
Why do you need it?


[3/10/2022 3:43â€¯PM] szybet
A patch is going?


[3/10/2022 3:43â€¯PM] tux_linux
oh ok


[3/10/2022 3:44â€¯PM] tux_linux
will work on it this week-end probably


[3/10/2022 3:44â€¯PM] tux_linux
But "not for very long" meant it returns to idle after finished


[3/10/2022 3:44â€¯PM] tux_linux
I lost 2% in 1h reading a book on the Glo HD, so it's not too bad


[3/10/2022 3:45â€¯PM] tux_linux
I don't anymore
But I'd like to see what `mouse0` is up to
`evtest /dev/input/mouse0`


[3/10/2022 3:46â€¯PM] szybet
Yes, but its still not good


[3/10/2022 3:47â€¯PM] tux_linux
Well, I've been the only one programming this for an entire year... there are not-so-good things in InkBox, but people have to accept it
I'll try to fix that issue this week-end


[3/10/2022 3:49â€¯PM] szybet
I will not accept it, i will patch it in the long future IF you dontğŸ˜†


[3/10/2022 6:59â€¯PM] szybet
```
[FBInk] [refresh_kobo_mk7] MXCFB_SEND_UPDATE_V2: Operation not permitted!
[FBInk] [fbink_cls] Failed to refresh the screen!
```
now it started doing something like this EDIT: it happens only when KOBOX ( xorg ) is enabled
***interesting, right?*** do you know why?


[3/10/2022 7:45â€¯PM] szybet
what are those lines doing? https://github.com/Kobo-InkBox/rootfs/blob/5815843d6209188b8d07994bc47b3a1c3b85ca0b/etc/init.d/sleep_standby.sh#L15


[3/10/2022 8:22â€¯PM] szybet
im confused
where is the part from going to sleep, that it returns to normal? i cant find it


[3/10/2022 8:24â€¯PM] szybet
reacts to touchscreen

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-C07FF.png


[3/10/2022 8:34â€¯PM] szybet
what is this doing, why is nowhere something that returns this to a normal state

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-837F9.png


[3/10/2022 8:34â€¯PM] szybet
if you would describe in short what does what it would be helpfull


[3/10/2022 8:49â€¯PM] szybet
```
[ 4673.449265] RTL871X: mmc1:0001:1: cannot remain alive while host is suspended
[ 4673.449290] dpm_run_callback(): pm_generic_suspend+0x0/0x30 returns -38
[ 4673.455921] PM: Device mmc1:0001:1 failed to suspend: error -38
```
hmm...


[3/10/2022 8:50â€¯PM] szybet
```
kobo:/dev/input# echo "mem" > /sys/power/state
ash: write error: Function not implemented
```


[3/10/2022 8:51â€¯PM] szybet
interesting too


[3/10/2022 9:10â€¯PM] szybet
Pinned a message.


[3/10/2022 9:24â€¯PM] szybet
how to monitor the power button? / the signals that linux to sleep?


[3/10/2022 9:31â€¯PM] szybet
the git file: https://github.com/Kobo-InkBox/rootfs/blob/1129acbd9ae3018e4e93d0085512f89d342030bb/usr/local/bin/wifi/connect_to_network.sh
and file on my device are diffrent, why is git not up to date?

{Embed}
https://github.com/Kobo-InkBox/rootfs/blob/1129acbd9ae3018e4e93d0085512f89d342030bb/usr/local/bin/wifi/connect_to_network.sh
rootfs/connect_to_network.sh at 1129acbd9ae3018e4e93d0085512f89d342...
InkBox OS root filesystem. Contribute to Kobo-InkBox/rootfs development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/rootfs-50853


[3/10/2022 9:37â€¯PM] szybet
**After rmmod modules from wifi, suspend works**


[3/10/2022 11:11â€¯PM] szybet
I added this to /etc/init.d/sleep_standby.sh
```
if [ "$DEVICE" == "n306" ]; then
        killall -q dhcpcd wpa_supplicant
        ifconfig eth0 down
        rmmod 8189fs.ko 2> /dev/null
        rmmod sdio_wifi_pwr.ko 2> /dev/null
fi
```
and now suspend works without issues. I will test it more tommorow


[3/10/2022 11:29â€¯PM] szybet
only files associated with suspend?
https://github.com/Kobo-InkBox/rootfs/blob/1129acbd9ae3018e4e93d0085512f89d342030bb/etc/init.d/idle_sleep
https://github.com/Kobo-InkBox/rootfs/blob/1129acbd9ae3018e4e93d0085512f89d342030bb/etc/init.d/sleep_standby.sh#L18
https://github.com/Kobo-InkBox/rootfs/blob/1129acbd9ae3018e4e93d0085512f89d342030bb/etc/init.d/wake_standby.sh


[3/11/2022 2:23â€¯AM] tux_linux
But then we have to handle to mess of reconnecting to the network after waking up ;p


[3/11/2022 2:23â€¯AM] tux_linux
`evtest /dev/input/event0`


[3/11/2022 2:24â€¯AM] tux_linux
Basically, when it `echo mem > /sys/power/state`, the scripts hangs while the device sleeps, then when it wakes up, it executes the rest of the commands in it.


[3/11/2022 2:25â€¯AM] tux_linux
yes, very interesting, and no, I don't know why, although I'm sure X has something to do with it


[3/11/2022 2:25â€¯AM] tux_linux
Emptying the `/tmp/power` file which contains event0 events to avoid memory leak


[3/11/2022 2:27â€¯AM] tux_linux (pinned)
Maybe your rootfs' fuse-overlayfs write cache has something in it. Try:
```
mount /dev/mmcblk0p3 /mnt
rm -rf /mnt/rootfs/write
sync
umount /mnt
reboot
```


[3/11/2022 2:27â€¯AM] tux_linux
Yeah, pretty much that (there are system services, like `/etc/init.d/sleep_standby` but they actually just launch the `sleep_standby.sh` script).


[3/11/2022 7:24â€¯AM] szybet
The network works after that, it doesnt hang or freeze


[3/11/2022 7:25â€¯AM] szybet
And what file is reading  from this? I want to debug why connecting or dosconnecting the cable gets the device from sleep


[3/11/2022 7:25â€¯AM] szybet
Maybe ask the guy that developed it?


[3/11/2022 7:26â€¯AM] szybet
Hmm


[3/11/2022 7:29â€¯AM] szybet
Why it doesnt work in a test script on my PC? Diffrent sh versions?


[3/11/2022 7:34â€¯AM] szybet
The GUI freezes and after 2 minutes this appears, closing it makes it work back


[3/11/2022 7:35â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220311_073355-496C7.jpg


[3/11/2022 7:37â€¯AM] szybet
Also, the GUI freezed, and after a while ot jumped from page 2 to 44. Propably touch issues? Limit the page change or smth?


[3/11/2022 7:39â€¯AM] szybet
It happens often


[3/11/2022 7:45â€¯AM] szybet
This too


[3/11/2022 7:45â€¯AM] szybet
Its nearly not usable like that


[3/11/2022 12:50â€¯PM] szybet
Do you know already that the epub viewer sometimes cuts off text when scalling? Even koreader has this problem, so i dont mind that much, but do you know or is it new


[3/11/2022 12:57â€¯PM] szybet
Its horrible... Enable the next page button only  the current site is loaded or something...


[3/11/2022 12:57â€¯PM] szybet
â˜¹ï¸


[3/11/2022 1:06â€¯PM] tux_linux
Because. No explanation to give. Things like that happen to me too and at that point I'm just like "fine"


[3/11/2022 1:08â€¯PM] szybet
Okay...


[3/11/2022 1:08â€¯PM] tux_linux
Yeah, I don't have a fix, but you can use the scrollbars


[3/11/2022 1:09â€¯PM] tux_linux
So two days ago it worked no problem 4hrs and now it's nearly not usable? This thing is a nightmare to debug


[3/11/2022 1:09â€¯PM] tux_linux
Very good idea


[3/11/2022 1:14â€¯PM] szybet
It worked no problem becouse it was laying on a table, and i was clicking it carefully and slowly, but in real reading the problems accours


[3/11/2022 1:15â€¯PM] szybet
If there was a option to put the scrollballs even if the menu is off, it would make it the best PDF reader ( for pdfs that are images )


[3/11/2022 1:15â€¯PM] tux_linux
There is


[3/11/2022 1:16â€¯PM] tux_linux
Always show scrollbar

In Settings


[3/11/2022 1:16â€¯PM] szybet
Whete


[3/11/2022 1:16â€¯PM] szybet
Really? Okay i will test it

{Reactions}
ğŸ‘ 

[3/11/2022 1:17â€¯PM] szybet
Suspend is working now, no problems  after my fix, and the battery is holding great on suspend

{Reactions}
ğŸ‘ 

[3/11/2022 1:18â€¯PM] tux_linux
Well, it's an English dictionary, so sorry


[3/11/2022 1:18â€¯PM] tux_linux
It can't, you removed the Wi-Fi modules ! It's impossible !


[3/11/2022 1:20â€¯PM] szybet
I mean, it freezes rabdomly and then the word search appears


[3/11/2022 1:20â€¯PM] tux_linux
Oh ok


[3/11/2022 1:20â€¯PM] szybet
The script is restoring them? Or is this sarcasm


[3/11/2022 1:21â€¯PM] tux_linux
No, it isn't, correct me if I'm wrong


[3/11/2022 1:21â€¯PM] szybet
I think it is


[3/11/2022 1:21â€¯PM] szybet
There was insmod?


[3/11/2022 1:21â€¯PM] tux_linux
Can you check lsmod after waking up?


[3/11/2022 1:21â€¯PM] szybet
Not now, later

{Reactions}
ğŸ‘ 

[3/11/2022 1:23â€¯PM] tux_linux
There doesn't seem to be anything like insmod there https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/wake_standby.sh

{Embed}
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/wake_standby.sh
rootfs/wake_standby.sh at master Â· Kobo-InkBox/rootfs
InkBox OS root filesystem. Contribute to Kobo-InkBox/rootfs development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/rootfs-50853


[3/11/2022 1:23â€¯PM] szybet
Not this script


[3/11/2022 1:23â€¯PM] szybet
This /usr/local/bin/wifi/connect_to_network.sh


[3/11/2022 1:24â€¯PM] tux_linux
Yeah but this isn't run when you get out of sleep


[3/11/2022 1:24â€¯PM] szybet
It is when i connect to wifi


[3/11/2022 1:24â€¯PM] tux_linux
Yes


[3/11/2022 1:25â€¯PM] tux_linux
But if you rmmod Wi-Fi modules before going to sleep, it makes no sense that it works on wake up


[3/11/2022 1:25â€¯PM] szybet
OH, i need to recconect


[3/11/2022 1:25â€¯PM] szybet
But thats normal?


[3/11/2022 1:26â€¯PM] tux_linux
Yes


[3/11/2022 1:26â€¯PM] tux_linux
At least


[3/11/2022 1:26â€¯PM] tux_linux
;p


[3/11/2022 1:27â€¯PM] szybet
For me it is, every device does that?


[3/11/2022 1:28â€¯PM] tux_linux
Since I don't unload the modules they stay connected


[3/11/2022 1:29â€¯PM] szybet
But the network dissconnects anyway?


[3/11/2022 1:29â€¯PM] tux_linux
I don't think so


[3/11/2022 1:31â€¯PM] szybet
Idk. Nia when goes to sleep dissconnects the usbnet, so Wi-Fi maybe too

Wouldn't it better to unload modules for all devices? It saves battery


[3/11/2022 1:31â€¯PM] tux_linux
Yeah will do that


[3/11/2022 1:32â€¯PM] tux_linux
And then reconnect with the script automatically


[3/11/2022 1:32â€¯PM] szybet
Okay, good


[3/11/2022 1:45â€¯PM] szybet
The scrollbar option fixes this


[3/11/2022 1:48â€¯PM] szybet
The scrollbar if needed option is the best. Reading pdfs containing only images is a much better experience than in plato, koreader and stock nickel


[3/11/2022 1:48â€¯PM] szybet
Fast, easy to use and clear. I would add it do the features od inkbox

{Reactions}
ğŸ‘ 

[3/11/2022 1:49â€¯PM] szybet
Maybe also add updating the date and time from internet when connecting to a Wi-Fi. The rtc worka horrible

{Reactions}
ğŸ‘ 

[3/11/2022 1:49â€¯PM] szybet
I could add this too


[3/11/2022 1:58â€¯PM] szybet
Pinned a message.


[3/11/2022 1:58â€¯PM] szybet
Well, not google.com but yea


[3/11/2022 7:46â€¯PM] tux_linux
Done


[3/11/2022 7:47â€¯PM] tux_linux
Mainly here https://github.com/Kobo-InkBox/gui-bundle/commit/3e046379264009e83bfdab5a68f4862b821db91b

{Embed}
https://github.com/Kobo-InkBox/gui-bundle/commit/3e046379264009e83bfdab5a68f4862b821db91b
Greatly improve page turning speed Â· Kobo-InkBox/gui-bundle@3e04637
/mnt/data/projects/git/conversations/media/3e046379264009e83bfdab5a68f4862b821db91b-32D62


[3/11/2022 7:48â€¯PM] szybet
i can test it, if you create the gui bundle


[3/11/2022 7:48â€¯PM] tux_linux
in progress


[3/11/2022 7:49â€¯PM] tux_linux
done


[3/11/2022 7:49â€¯PM] tux_linux
same url


[3/11/2022 7:51â€¯PM] szybet
can i dirrectly update it from the kobo? i mean wget on the kobo to /opt/storage/update


[3/11/2022 7:51â€¯PM] tux_linux
yes


[3/11/2022 7:51â€¯PM] tux_linux
but you need to specify `-O`


[3/11/2022 7:51â€¯PM] tux_linux
Also, you need to rename `update-n306.isa` to `update.isa`


[3/11/2022 7:52â€¯PM] tux_linux
So `wget http://23.163.0.39/bundles/private/update-n306.isa -O /data/firmware/update.isa`


[3/11/2022 7:52â€¯PM] szybet
data firmware?


[3/11/2022 7:52â€¯PM] tux_linux
Then `sync` and `restart inkbox_gui`


[3/11/2022 7:52â€¯PM] tux_linux
It's a symlink that makes more sense than `/opt/storage/update`


[3/11/2022 7:52â€¯PM] szybet
well okay


[3/11/2022 7:59â€¯PM] szybet
thats fast and much better


[3/11/2022 8:00â€¯PM] tux_linux
Cool


[3/11/2022 8:00â€¯PM] tux_linux
Now try to load a heavy ePUB, initial opening time will be longer but turning pages should be as fast


[3/11/2022 8:01â€¯PM] szybet
im trying to implement time sync on kobo, i figured out there is the ntpd command, but why `ntpd -n -q -N -p time.cloudflare.com` gives me a hour back than my real time?


[3/11/2022 8:01â€¯PM] szybet
only epub?


[3/11/2022 8:02â€¯PM] tux_linux
Yes


[3/11/2022 8:02â€¯PM] szybet
yea its faster

{Reactions}
ğŸ‘ 

[3/11/2022 8:02â€¯PM] tux_linux
Maybe because you're syncing on UTC?


[3/11/2022 8:03â€¯PM] szybet
weird


[3/11/2022 8:06â€¯PM] szybet
maybe wrong timezone?


[3/11/2022 8:06â€¯PM] tux_linux
Well I haven't implemented timezones in InkBox yet


[3/11/2022 8:06â€¯PM] tux_linux
So it's on UTC


[3/11/2022 8:06â€¯PM] tux_linux
It probably synced correctly


[3/11/2022 8:07â€¯PM] szybet
hm i see that https://time.is/pl/UTC

{Embed}
https://time.is/pl/UTC
UTC - exact time now
DokÅ‚adny czas teraz, strefa czasowa, rÃ³Å¼nica czasu, czas wschodu/zachodu sÅ‚oÅ„ca i kluczowe fakty dla UTC.
/mnt/data/projects/git/conversations/media/time_is_110011-17237.png


[3/11/2022 8:07â€¯PM] szybet
its 20:00 for me

{Reactions}
ğŸ‘ 

[3/11/2022 8:11â€¯PM] szybet
do you plan to add it?


[3/11/2022 8:13â€¯PM] szybet
I would like to add to /etc/ a file that says how much to add to UTC ( -1, +2 etc ) and a script in /opt/bin/ ( propably this patch, you can choose another ) that is runned when wifi connects, it uses /etc/ntp.conf for servers and sets the correct time.


[3/11/2022 8:14â€¯PM] szybet
if you plan to add it in the future, you can build the timezones in gui and then change the file in /etc/


[3/11/2022 8:16â€¯PM] tux_linux
Yes, that's about the way I was planning to do it


[3/11/2022 8:16â€¯PM] tux_linux
ntpd never worked out for me for some reason but if you've got a command that works I'll take it


[3/11/2022 8:17â€¯PM] szybet
i can make an entire script, you just need to decide the syntax for /etc/utc_time.conf ( for example )


[3/11/2022 8:17â€¯PM] tux_linux
Oh; I can do it, this was the second part of my goals for today


[3/11/2022 8:17â€¯PM] tux_linux
But if you want to contribute you can do it


[3/11/2022 8:17â€¯PM] szybet
sure


[3/11/2022 8:18â€¯PM] tux_linux
But I was more thinking of something like /etc/localtime and symlinks


[3/11/2022 8:18â€¯PM] tux_linux
But since the rootfs is r/o by default, it will be difficult


[3/11/2022 8:18â€¯PM] szybet
well, for this you need write privileges


[3/11/2022 8:19â€¯PM] tux_linux
And we can mount the rootfs r/w, but it is usually never done
So I'd prefer not do it


[3/11/2022 8:19â€¯PM] tux_linux
Maybe it could be possible to use bind mounts


[3/11/2022 8:19â€¯PM] szybet
maybe do tihs the same way you handle the config for the gui?


[3/11/2022 8:19â€¯PM] tux_linux
there is `/usr/share/zoneinfo` already there


[3/11/2022 8:20â€¯PM] tux_linux
```
inkbox:/# ln -s /usr/share/zoneinfo/America/New_York /etc/localtime
inkbox:/# date
Fri Mar 11 14:20:25 EST 2022
inkbox:/#
```
Awesome


[3/11/2022 8:20â€¯PM] tux_linux
It's the correct time here


[3/11/2022 8:20â€¯PM] szybet
i will try it for me


[3/11/2022 8:21â€¯PM] szybet
yea. this is working


[3/11/2022 8:21â€¯PM] tux_linux
So maybe create `/run/localtime` or `/tmp/localtime` which is a symlink to `/usr/share/zoneinfo/your/timezone` and bind-mount that file to an empty file named localtime in /etc


[3/11/2022 8:21â€¯PM] szybet
does this need rw filesystem?


[3/11/2022 8:21â€¯PM] tux_linux
No


[3/11/2022 8:22â€¯PM] szybet
um what


[3/11/2022 8:22â€¯PM] tux_linux
```
inkbox:/# ln -s /usr/share/zoneinfo/America/New_York /tmp/localtime
inkbox:/# date
Fri Mar 11 19:22:13 UTC 2022
inkbox:/# mount --bind /tmp/localtime /etc/localtime
inkbox:/# date
Fri Mar 11 14:22:26 EST 2022
inkbox:/# 
```
This works


[3/11/2022 8:23â€¯PM] szybet
using this changed the time to the correct one, no need to move UTC hours


[3/11/2022 8:23â€¯PM] tux_linux
Yeah, so there's only ntp sync to implement really


[3/11/2022 8:23â€¯PM] szybet
give me 15 minutes


[3/11/2022 8:24â€¯PM] szybet
is `/usr/local/bin/wifi/connect_to_network.sh` the main script when connecting to wifi?


[3/11/2022 8:24â€¯PM] tux_linux
Maybe a script that reads conf info from `/data/config/19-timezone/config` which contains timezone config, then syncs ntp and sets timezone in /etc/localtime


[3/11/2022 8:24â€¯PM] tux_linux
I'd rather do that from the Qt code


[3/11/2022 8:25â€¯PM] tux_linux
But one or the other works I guess


[3/11/2022 8:26â€¯PM] tux_linux
Doing it from shell might be a better idea actually


[3/11/2022 8:26â€¯PM] tux_linux
yeah, it is


[3/11/2022 8:26â€¯PM] szybet
when its connected, i just need to add one line of code


[3/11/2022 8:26â€¯PM] tux_linux
Maybe launch `/usr/local/bin/ntpsync.sh` after udhcpc/dhcpcd complete


[3/11/2022 8:26â€¯PM] szybet
and one file to /etc


[3/11/2022 8:26â€¯PM] tux_linux
Yeah


[3/11/2022 8:26â€¯PM] tux_linux
`touch etc/localtime`


[3/11/2022 8:26â€¯PM] szybet
isin't needed


[3/11/2022 8:27â€¯PM] tux_linux
Will be more portable


[3/11/2022 8:27â€¯PM] tux_linux
If you want to run it from shell for example


[3/11/2022 8:27â€¯PM] tux_linux
Maybe name it `timesync.sh` actually since it also changes the timezone


[3/11/2022 8:28â€¯PM] tux_linux
Oh, never mind


[3/11/2022 8:28â€¯PM] szybet
look


[3/11/2022 8:28â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-0308F.png


[3/11/2022 8:28â€¯PM] szybet
thats everything whots needed


[3/11/2022 8:28â€¯PM] tux_linux
There should be a system service that would change the timezone based on the config


[3/11/2022 8:29â€¯PM] szybet
why is the time in the GUI and cmd date diffrent...


[3/11/2022 8:29â€¯PM] tux_linux
Check `/etc/init.d/hostname` for example and create `/etc/init.d/timezone` which would change the timezone


[3/11/2022 8:31â€¯PM] szybet
first i woul need the config


[3/11/2022 8:31â€¯PM] tux_linux
Then chmod +x and symlink `/etc/init.d/timezone` to `/etc/runlevels/boot/timezone` to make it run at boot


[3/11/2022 8:31â€¯PM] tux_linux
At `/data/config`?


[3/11/2022 8:31â€¯PM] tux_linux
Yeah, I don't know how to handle that
Also, the timezones list will be massive


[3/11/2022 8:32â€¯PM] tux_linux
I'd suggest that `/data/config/19-timezone/config` would point to a path in the rootfs, for example `/usr/share/zoneinfo/America/New_York`


[3/11/2022 8:32â€¯PM] tux_linux
Then the timezone service would symlink /tmp/localtime to the file specified in the config


[3/11/2022 8:33â€¯PM] szybet
make a search bar


[3/11/2022 8:33â€¯PM] tux_linux
you implement this, not me.......


[3/11/2022 8:33â€¯PM] tux_linux
this would probably be the most complicated thing ever


[3/11/2022 8:33â€¯PM] tux_linux
well, idk


[3/11/2022 8:33â€¯PM] tux_linux
depends on what we are talking about


[3/11/2022 8:34â€¯PM] tux_linux
Maybe something similar to book search


[3/11/2022 8:34â€¯PM] szybet
does this ln -s dissapear after reboot?


[3/11/2022 8:34â€¯PM] tux_linux
yes


[3/11/2022 8:34â€¯PM] szybet
oh thats the problem


[3/11/2022 8:34â€¯PM] tux_linux
that's why we need to put it in a system service


[3/11/2022 8:34â€¯PM] tux_linux
so it runs at each boot


[3/11/2022 8:34â€¯PM] tux_linux
Actually, it might even be better if it was in the initrd


[3/11/2022 8:35â€¯PM] szybet
hm?


[3/11/2022 8:35â€¯PM] tux_linux
Well, some things like the ENCRYPT_LOCK flag which locks down the device for a day if the user enters too much wrong passphrases to unlock their encrypted storage would be affected


[3/11/2022 8:36â€¯PM] tux_linux
But that's based on the epoch UNIX time


[3/11/2022 8:36â€¯PM] tux_linux
So it might not be affected actually


[3/11/2022 8:36â€¯PM] tux_linux
Ok, it won't be affected, I just checked


[3/11/2022 8:36â€¯PM] tux_linux
So we can do this in the rootfs


[3/11/2022 8:38â€¯PM] szybet
if the file ends normarly without exit, then its connected? 
https://github.com/Kobo-InkBox/rootfs/blob/master/usr/local/bin/wifi/connect_to_network.sh#L78


[3/11/2022 8:38â€¯PM] tux_linux
yeah, otherwise the script calls `exit 1` if there is an error


[3/11/2022 8:38â€¯PM] tux_linux
like here https://github.com/Kobo-InkBox/rootfs/blob/5815843d6209188b8d07994bc47b3a1c3b85ca0b/usr/local/bin/wifi/connect_to_network.sh#L65


[3/11/2022 8:39â€¯PM] szybet
okay, so just add `ntpd -n -q &` at the end


[3/11/2022 8:39â€¯PM] szybet
or without &


[3/11/2022 8:39â€¯PM] tux_linux
Not the &


[3/11/2022 8:39â€¯PM] tux_linux
not at the end


[3/11/2022 8:39â€¯PM] szybet
yea, if the parrent exits it will kill him


[3/11/2022 8:40â€¯PM] szybet
why?


[3/11/2022 8:40â€¯PM] tux_linux
maybe you can


[3/11/2022 8:40â€¯PM] szybet
why why not


[3/11/2022 8:41â€¯PM] tux_linux
i'm dumb https://github.com/Kobo-InkBox/rootfs/blob/5815843d6209188b8d07994bc47b3a1c3b85ca0b/usr/local/bin/wifi/connect_to_network.sh#L74


[3/11/2022 8:41â€¯PM] tux_linux
$? is exit status of fi


[3/11/2022 8:41â€¯PM] tux_linux
wow.....


[3/11/2022 8:41â€¯PM] szybet
O.o?


[3/11/2022 8:42â€¯PM] tux_linux
it will always quit on success if the dhcp request fails


[3/11/2022 8:42â€¯PM] szybet
well, then repair it


[3/11/2022 8:42â€¯PM] tux_linux
i'll make this a var real quick


[3/11/2022 8:42â€¯PM] szybet
you can add  `ntpd -n -q` too


[3/11/2022 8:43â€¯PM] tux_linux
```
inkbox:/usr/share/openrc/support# test=1
inkbox:/usr/share/openrc/support# if test=1; then false; fi
inkbox:/usr/share/openrc/support# $?
-ash: 1: not found
inkbox:/usr/share/openrc/support# 

inkbox:/usr/share/openrc/support# if test=1; then true; fi
inkbox:/usr/share/openrc/support# $?
-ash: 0: not found
inkbox:/usr/share/openrc/support# 
```
Actually, it seems I'm wrong


[3/11/2022 8:43â€¯PM] szybet
and /etc/ntp.conf

server 0.pool.ntp.org
server 1.pool.ntp.org
server 2.pool.ntp.org
server 3.pool.ntp.org


[3/11/2022 8:44â€¯PM] szybet
i dont understand at all


[3/11/2022 8:44â€¯PM] tux_linux
Based on my logic, $? should always be 0 since the fi command is successful


[3/11/2022 8:45â€¯PM] tux_linux
But it seems that ash is smart enough not to give fi an exit status


[3/11/2022 8:48â€¯PM] tux_linux
You can add it at the end it's fine


[3/11/2022 8:49â€¯PM] szybet
wait


[3/11/2022 8:50â€¯PM] szybet
couldn't we just symlink /etc/timezone to /data/config/19-timezone/config?


[3/11/2022 8:50â€¯PM] tux_linux
what?


[3/11/2022 8:50â€¯PM] szybet
or do you want in this config to write the path in text


[3/11/2022 8:50â€¯PM] tux_linux
`/etc/localtime` to `/data/config/19-timezone/config`?


[3/11/2022 8:51â€¯PM] szybet
yes, or this?


[3/11/2022 8:51â€¯PM] tux_linux
`/data/config/19-timezone/config` would need to contain the contents of the corresponding file in /usr/share/zoneinfo


[3/11/2022 8:51â€¯PM] tux_linux
or maybe make it a double symlink


[3/11/2022 8:52â€¯PM] szybet
so a symlink could be good


[3/11/2022 8:52â€¯PM] tux_linux
i'm trying it now


[3/11/2022 8:52â€¯PM] szybet
and a system service wouldn't be needed


[3/11/2022 8:54â€¯PM] tux_linux
```
inkbox:/# ls -shal /etc/localtime
     0 lrwxrwxrwx    1 root     root          31 Mar 11 14:53 /etc/localtime -> /data/config/19-timezone/config
inkbox:/# ls -shal /data/config/19-timezone/config 
     0 lrwxrwxrwx    1 root     root          36 Mar 11 14:52 /data/config/19-timezone/config -> /usr/share/zoneinfo/America/New_York
inkbox:/# date
Fri Mar 11 14:53:59 EST 2022
inkbox:/# 
```
It seems to work


[3/11/2022 8:54â€¯PM] tux_linux
Go ahead


[3/11/2022 8:54â€¯PM] szybet
so a system service isin't needed


[3/11/2022 8:54â€¯PM] szybet
great


[3/11/2022 8:55â€¯PM] tux_linux
ouch
```
inkbox:/# date
Fri Mar 11 14:53:30 EST 2022
inkbox:/# chroot /kobo
inkbox:/# date
Fri Mar 11 19:54:37 UTC 2022
inkbox:/# 
```


[3/11/2022 8:55â€¯PM] tux_linux
It seems it isn't working across chroots
and /kobo is the GUI chroot


[3/11/2022 8:56â€¯PM] szybet
this explains why the date isin't correctly showing on the gui


[3/11/2022 8:56â€¯PM] szybet
maybe a reboot is needed?


[3/11/2022 8:56â€¯PM] tux_linux
Which, of course, doesn't contain zoneinfo (and the squashfs containing that filesystem isn't upgradable)
```
inkbox:/# ls usr/share/zoneinfo
ls: usr/share/zoneinfo: No such file or directory
inkbox:/# 
```


[3/11/2022 8:56â€¯PM] tux_linux
i would doubt that


[3/11/2022 8:57â€¯PM] szybet
maybe copy the file to /kobo


[3/11/2022 8:57â€¯PM] szybet
its only 3 KB


[3/11/2022 8:58â€¯PM] tux_linux
Maybe something similar to this
`[ ! -e "/kobo/opt/version" ] && touch /kobo/opt/version`


[3/11/2022 8:59â€¯PM] tux_linux
In that file https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/inkbox_gui


[3/11/2022 8:59â€¯PM] szybet
maybe a mount bind?


[3/11/2022 8:59â€¯PM] tux_linux
```
[ ! -e "/kobo/usr/share/zoneinfo" ] && mkdir -p /kobo/usr/share/zoneinfo
[ ! -e "/kobo/etc/localtime" ] && touch /kobo/etc/localtime
mount --bind /usr/share/zoneinfo /kobo/usr/share/zoneinfo
mount --bind /etc/localtime /kobo/etc/localtime
```


[3/11/2022 9:00â€¯PM] szybet
exactly


[3/11/2022 9:00â€¯PM] tux_linux
I'll add that to the inkbox_gui, unless you want to do it


[3/11/2022 9:00â€¯PM] tux_linux
Insert the above code under that line
`[ ! -e "/kobo/bin/kobo_config.sh" ] && touch /kobo/bin/kobo_config.sh`


[3/11/2022 9:01â€¯PM] szybet
you mean?


[3/11/2022 9:01â€¯PM] tux_linux
`/etc/init.d/inkbox_gui`


[3/11/2022 9:01â€¯PM] szybet
?


[3/11/2022 9:01â€¯PM] tux_linux
Since you are already working on other files, maybe it's good to have that in one commit only


[3/11/2022 9:02â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-67396.txt


[3/11/2022 9:02â€¯PM] szybet
i edited the sleep_standby.sh to shut down wifi for all devices


[3/11/2022 9:02â€¯PM] szybet
can you verify?


[3/11/2022 9:03â€¯PM] szybet
on which files?


[3/11/2022 9:03â€¯PM] tux_linux
sleep_standby.sh for example
Well, to avoid a merge by pulling my commits


[3/11/2022 9:04â€¯PM] szybet
Its propaply the only one
maybe connect_to_network.sh with the ntpd one line


[3/11/2022 9:04â€¯PM] tux_linux
It seems fine
Now we need to tell it to auto-reconnect


[3/11/2022 9:04â€¯PM] szybet
and /etc/ntp.conf


[3/11/2022 9:04â€¯PM] szybet
wake standby script


[3/11/2022 9:04â€¯PM] tux_linux
yes


[3/11/2022 9:05â€¯PM] szybet
turning on the modules and interphace isin't enough?


[3/11/2022 9:05â€¯PM] tux_linux
is it enough on your kobo?


[3/11/2022 9:05â€¯PM] szybet
i can check that, but my kobo never recconects to a wifi


[3/11/2022 9:07â€¯PM] tux_linux
ok, I think I will do the modifications here and mention you in the commit


[3/11/2022 9:08â€¯PM] szybet
so you will push them all?


[3/11/2022 9:08â€¯PM] tux_linux
yeah


[3/11/2022 9:08â€¯PM] szybet
sure, it will be cleaner


[3/11/2022 9:08â€¯PM] tux_linux
send me the modified files (not just their contents, the file itself) and I'll put them in my tree


[3/11/2022 9:09â€¯PM] szybet
so:
connect_to_network.sh
/etc/ntp.conf
wake standby sh
sleep standby sh


[3/11/2022 9:10â€¯PM] szybet
and there is the symlink of /etc/timezone to /data/config


[3/11/2022 9:10â€¯PM] tux_linux
/etc/localtime you mean?


[3/11/2022 9:10â€¯PM] szybet
yes

{Reactions}
ğŸ‘ 

[3/11/2022 9:10â€¯PM] szybet
wait, i will check it it recconects

{Reactions}
ğŸ‘ 

[3/11/2022 9:11â€¯PM] szybet
i cant send it, so you need to symlink it on your own


[3/11/2022 9:11â€¯PM] tux_linux
sure


[3/11/2022 9:11â€¯PM] szybet
Pinned a message.


[3/11/2022 9:12â€¯PM] szybet
```
% sshfs root@192.168.0.1:/ /mnt/Partition
root@192.168.0.1's password: 
read: Connection reset by peer
```
why sshfs is not working?


[3/11/2022 9:13â€¯PM] tux_linux
what are you trying to do?


[3/11/2022 9:13â€¯PM] tux_linux
i think it needs a helper on the client


[3/11/2022 9:14â€¯PM] tux_linux
did you modify the files directly on the kobo?


[3/11/2022 9:14â€¯PM] szybet
sshfs is cool


[3/11/2022 9:14â€¯PM] tux_linux
i know


[3/11/2022 9:14â€¯PM] szybet
no, it workes on nickel


[3/11/2022 9:14â€¯PM] szybet
i will scp


[3/11/2022 9:14â€¯PM] tux_linux
then no idea


[3/11/2022 9:15â€¯PM] tux_linux (pinned)
```
mount /dev/mmcblk0p3 /mnt
mksquashfs /mnt/rootfs/write /tmp/rootfs-write.sqsh
umount /mnt
```


[3/11/2022 9:15â€¯PM] tux_linux
That will take all the files you modified


[3/11/2022 9:16â€¯PM] szybet
why not simply `ifsctl mnt rootfs rw`


[3/11/2022 9:16â€¯PM] tux_linux
that mounts the rootfs rw


[3/11/2022 9:16â€¯PM] tux_linux
what I wrote above takes all the write cache and compresses it into a squashfs


[3/11/2022 9:17â€¯PM] tux_linux
so if you modified `/usr/local/bin/wifi/connect_to_wifi.sh`, `/mnt/rootfs/write` will contain a copy of this file that is modified
it's why it's called overlayfs


[3/11/2022 9:17â€¯PM] szybet
oh okay


[3/11/2022 9:17â€¯PM] tux_linux
it overlays a writeable part over a read-only filesystem (squashfs)


[3/11/2022 9:17â€¯PM] szybet
Pinned a message.


[3/11/2022 9:17â€¯PM] szybet
cool, but i already did ifsctl


[3/11/2022 9:17â€¯PM] tux_linux
it has nothing to do with that


[3/11/2022 9:18â€¯PM] tux_linux
when you issue `ifsctl mnt rootfs rw`, it remounts the rootfs rw and all the writes are redirected to `[p3]/rootfs/write`


[3/11/2022 9:18â€¯PM] tux_linux
so if you do `touch /test`, a file named `test` will be at `[p3]/rootfs/write/test`


[3/11/2022 9:18â€¯PM] tux_linux
and the rootfs squashfs will stay the same


[3/11/2022 9:19â€¯PM] szybet
okay


[3/11/2022 9:19â€¯PM] tux_linux
that's why earlier you were wondering why your connect_to_wifi script didn't have the contents of the latest commits; because you had modified it before


[3/11/2022 9:19â€¯PM] tux_linux
the modified version takes precedence on the existing version


[3/11/2022 9:21â€¯PM] szybet
oh...


[3/11/2022 9:21â€¯PM] szybet
i forgot about a line in connect_to_network.sh, good that im testing that

{Reactions}
ğŸ‘ 

[3/11/2022 9:22â€¯PM] tux_linux
have you tested if it reconnects automatically on wake up?


[3/11/2022 9:22â€¯PM] szybet
it does not even go to sleep, i need to add `killall -q dhcpcd wpa_supplicant`


[3/11/2022 9:23â€¯PM] tux_linux
ok


[3/11/2022 9:23â€¯PM] szybet
well, if i kill them and then launch there is no way they will reconect


[3/11/2022 9:23â€¯PM] tux_linux
before ifconfig wifi_dev down i guess?


[3/11/2022 9:23â€¯PM] szybet
yes


[3/11/2022 9:23â€¯PM] tux_linux
Yeah, so then we can work with the available info at `/data/config/17-wifi_connection_information`


[3/11/2022 9:24â€¯PM] tux_linux
And re-launch `/usr/local/bin/wifi/connect_to_network.sh` with those strings


[3/11/2022 9:25â€¯PM] szybet
oh i can do this


[3/11/2022 9:25â€¯PM] tux_linux
it will mess up the tree


[3/11/2022 9:25â€¯PM] szybet
in a seperate file? like recconect.sh?


[3/11/2022 9:25â€¯PM] szybet
you mean git? i can send you the file


[3/11/2022 9:25â€¯PM] tux_linux
yeah ok


[3/11/2022 9:25â€¯PM] tux_linux
Well, I'll send you my sleep_standby.sh script before


[3/11/2022 9:26â€¯PM] szybet
thats mine

{Attachments}
/mnt/data/projects/git/conversations/media/message-34DD6.txt


[3/11/2022 9:27â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/sleep_standby-B8236.sh


[3/11/2022 9:27â€¯PM] szybet
they are the same, i used the one from git


[3/11/2022 9:27â€¯PM] tux_linux
I added a check to see if the interface is up or not before removing modules, etc.


[3/11/2022 9:28â€¯PM] szybet
oh okay


[3/11/2022 9:28â€¯PM] tux_linux
no, it's the one with my additions + the wifi down part you added earlier


[3/11/2022 9:28â€¯PM] szybet
what about 
```
if [ "${DEVICE}" == "n705" ] || [ "${DEVICE}" == "n905b" ] || [ "${DEVICE}" == "n905c" ] || [ "${DEVICE}" == "n613" ] || [ "${DEVICE}" == "n437" ]; then
    wlarm_le down
fi
```


[3/11/2022 9:28â€¯PM] tux_linux
oh yes


[3/11/2022 9:29â€¯PM] tux_linux
added

{Attachments}
/mnt/data/projects/git/conversations/media/sleep_standby-99748.sh


[3/11/2022 9:32â€¯PM] szybet
how to check if to restore wifi, when going from sleep?


[3/11/2022 9:33â€¯PM] tux_linux
```
if [ "$(cat /sys/class/net/${WIFI_DEV}/operstate)" == "up" ]; then
  echo "true" > /tmp/was_connected_to_wifi
fi
```


[3/11/2022 9:33â€¯PM] tux_linux
And deal with that file on wake up
Don't forget to `rm -f` it once you've read its contents


[3/11/2022 9:36â€¯PM] tux_linux
It's actually `/sys/class/net/${WIFI_DEV}/operstate)`; added it above


[3/11/2022 9:38â€¯PM] szybet
```
if [ "$(cat /tmp/was_connected_to_wifi)" == "true" ]; then
    ifconfig "${WIFI_DEV}" up
    insmod "${WIFI_MODULE}" 2> /dev/null
    insmod "${SDIO_WIFI_PWR_MODULE}" 2> /dev/null
    ESSID=`cat /data/config/17-wifi_connection_information/essid`
    PASSPHRASE=`cat /data/config/17-wifi_connection_information/passphrase`
    /usr/local/bin/wifi/connect_to_network.sh "${ESSID}"  "${PASSPHRASE}" 
    rm -f /tmp/was_connected_to_wifi
fi
```


[3/11/2022 9:38â€¯PM] szybet
i will test it now


[3/11/2022 9:39â€¯PM] tux_linux
better to use `$(command)` in place of backticks
and `if grep -q "true" /tmp/was_connected_to_wifi`


[3/11/2022 9:39â€¯PM] tux_linux
also, it's in the wrong order


[3/11/2022 9:40â€¯PM] szybet
:/...


[3/11/2022 9:40â€¯PM] szybet
okay


[3/11/2022 9:40â€¯PM] tux_linux
insmod sdio_wifi_pwr, then wifi module, then wlarm_le up for devices that need it, then interface up, then connect


[3/11/2022 9:40â€¯PM] szybet
oh right


[3/11/2022 9:41â€¯PM] szybet
do i need it to change it to the grep?


[3/11/2022 9:41â€¯PM] tux_linux
if you want I can do it here after


[3/11/2022 9:41â€¯PM] tux_linux
the important thing would be to get the snippet of code working


[3/11/2022 9:44â€¯PM] szybet
can you look at the "word search" and "pages are switching like crazy" problems i described before?


[3/11/2022 9:44â€¯PM] tux_linux
currently doing timezone stuff


[3/11/2022 9:44â€¯PM] szybet
okay


[3/11/2022 9:45â€¯PM] tux_linux
did it happen with the latest gui bundle? maybe the speed of the page turning has improved it


[3/11/2022 9:45â€¯PM] szybet
hmm, i will check it


[3/11/2022 9:45â€¯PM] szybet
but a limiter for the page change is needed anyway


[3/11/2022 9:45â€¯PM] tux_linux
hmm


[3/11/2022 9:51â€¯PM] szybet
it works


[3/11/2022 9:52â€¯PM] tux_linux
nice


[3/11/2022 9:52â€¯PM] szybet
but it takes a while


[3/11/2022 9:52â€¯PM] tux_linux
how much time does it take?


[3/11/2022 9:52â€¯PM] tux_linux
ah


[3/11/2022 9:52â€¯PM] szybet
idk, 90 s?


[3/11/2022 9:52â€¯PM] tux_linux
we can probably run it in the background


[3/11/2022 9:52â€¯PM] szybet
you mean


[3/11/2022 9:52â€¯PM] szybet
?


[3/11/2022 9:52â€¯PM] tux_linux
if the user tries to connect to wifi in the gui during that period, we can show a message like "connection already in progress" or something


[3/11/2022 9:53â€¯PM] szybet
yes you can, a simple ps | grep connect_to_network could make it work


[3/11/2022 9:53â€¯PM] tux_linux
i was thinking of something more reliable than that ;p


[3/11/2022 9:54â€¯PM] tux_linux
but yeah, it's the idea


[3/11/2022 9:55â€¯PM] tux_linux
FWIW, since the GUI is running in a chroot, it needs to send commands to a fifo to get them executed in the rootfs
That's how Wi-Fi connection is handled: https://github.com/Kobo-InkBox/rootfs/blob/5815843d6209188b8d07994bc47b3a1c3b85ca0b/etc/init.d/ibxd#L67-L77


[3/11/2022 9:55â€¯PM] szybet
complicated


[3/11/2022 9:56â€¯PM] tux_linux
yeah, but otherwise it's really a mess


[3/11/2022 9:56â€¯PM] tux_linux
so the GUI has a while true loop which checks the contents of the wifi_connected_successfully file and stops when there is something like 'false' or 'true' in it


[3/11/2022 9:58â€¯PM] tux_linux
yay
```
inkbox:~# date
Fri Mar 11 20:58:26 UTC 2022
inkbox:~# chroot /kobo
inkbox:/# date
Fri Mar 11 15:58:29 EST 2022
inkbox:/#
```


[3/11/2022 9:58â€¯PM] tux_linux
(well, not the first part, but at least it works in the chroot)


[3/11/2022 9:59â€¯PM] szybet
syncing time also works


[3/11/2022 9:59â€¯PM] tux_linux
cool


[3/11/2022 10:00â€¯PM] szybet
so i will send the files

{Reactions}
ğŸ‘ 

[3/11/2022 10:02â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/ntp-94AAA.conf
/mnt/data/projects/git/conversations/media/wake_standby-C8DD6.sh
/mnt/data/projects/git/conversations/media/sleep_standby-7098C.sh
/mnt/data/projects/git/conversations/media/connect_to_network-75F08.sh


[3/11/2022 10:02â€¯PM] tux_linux
ok thanks


[3/11/2022 10:04â€¯PM] szybet
so the gui will show the right time?


[3/11/2022 10:04â€¯PM] tux_linux
yes


[3/11/2022 10:04â€¯PM] szybet
nice


[3/11/2022 10:06â€¯PM] tux_linux
I wonder if it should be `/tmp/was_connected_to_wifi` or `/run/was_connected_to_wifi`


[3/11/2022 10:06â€¯PM] szybet
idk, you decide


[3/11/2022 10:07â€¯PM] tux_linux
well, ibxd puts wifi_connected_successfully in run
so I guess it'll be run


[3/11/2022 10:08â€¯PM] szybet
can i disable global readings settings for remembering when i last readed the book?


[3/11/2022 10:08â€¯PM] tux_linux
yes


[3/11/2022 10:08â€¯PM] tux_linux
i worked on that this morning too
it should be more reliable


[3/11/2022 10:09â€¯PM] tux_linux
my reader framework is really a mess
it took me 15 mins to understand what my own program is actually doing ;p


[3/11/2022 10:10â€¯PM] szybet
i think its normal


[3/11/2022 10:10â€¯PM] tux_linux
have you read reader.cpp ?


[3/11/2022 10:10â€¯PM] tux_linux
https://github.com/Kobo-InkBox/inkbox/blob/master/reader.cpp


[3/11/2022 10:10â€¯PM] tux_linux
good luck


[3/11/2022 10:10â€¯PM] tux_linux
not everything is a mess in the file, but more the setup_book function and relatives


[3/11/2022 10:12â€¯PM] szybet
the change page button still does change too many pages when i click on it too much, but it does not freeze.  ( so it will propably change to many pages when i will be using the ereader serious, in school or smth )

{Reactions}
ğŸ‘ 

[3/11/2022 10:12â€¯PM] szybet
so this needs to improve, and maybe thats it?


[3/11/2022 10:12â€¯PM] tux_linux
ok, so I'll try to implement some sort of 'blocker' while it's turning the pages


[3/11/2022 10:13â€¯PM] tux_linux
this is fine, but that means it won't be able to go to sleep until it has reconnected to wi-fi


[3/11/2022 10:13â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-521E9.png


[3/11/2022 10:14â€¯PM] tux_linux
Since it's `sleep_standby`'s job


[3/11/2022 10:14â€¯PM] szybet
maybe a button in settings to choose if it would recconect?


[3/11/2022 10:15â€¯PM] tux_linux
yeah, but if you move around and don't have access to the network anymore


[3/11/2022 10:15â€¯PM] tux_linux
maybe a 'cancel reconnect' or something


[3/11/2022 10:16â€¯PM] szybet
is it normal that connecting the usb cable gets the device back from sleep?


[3/11/2022 10:16â€¯PM] tux_linux
Maybe the user would click one time to connect to Wi-Fi after waking up, it would say "Click again to cancel reconnect" and on the second click on the Wi-Fi icon it would cancel


[3/11/2022 10:16â€¯PM] tux_linux
yes


[3/11/2022 10:16â€¯PM] tux_linux
does that even in Nickel


[3/11/2022 10:17â€¯PM] szybet
and when battery hits 100%?


[3/11/2022 10:17â€¯PM] tux_linux
no


[3/11/2022 10:17â€¯PM] szybet
maybe

{Reactions}
ğŸ‘ 

[3/11/2022 10:17â€¯PM] tux_linux
but i don't really know what to tell you about this


[3/11/2022 10:17â€¯PM] szybet
its not a big issue


[3/11/2022 10:22â€¯PM] szybet
did you implement the magnes thing?


[3/11/2022 10:22â€¯PM] tux_linux
Those are all my changes currently

{Attachments}
/mnt/data/projects/git/conversations/media/rootfs-D9595.diff


[3/11/2022 10:22â€¯PM] tux_linux
sleep cover? no


[3/11/2022 10:22â€¯PM] tux_linux
I'll push a commit and you can try on your device


[3/11/2022 10:23â€¯PM] szybet
oh yes, i forgot about `hwclock --systohc`


[3/11/2022 10:23â€¯PM] tux_linux
done


[3/11/2022 10:23â€¯PM] szybet
could you? or is it a big issue to make


[3/11/2022 10:24â€¯PM] tux_linux
I guess it's easy


[3/11/2022 10:24â€¯PM] szybet
thats the last thing thats missing on nia


[3/11/2022 10:24â€¯PM] tux_linux
I forgot to mention you in the commit; I'll do it in the next one when we fix things I guess


[3/11/2022 10:24â€¯PM] szybet
maybe xorg, but xorg isin't important


[3/11/2022 10:27â€¯PM] szybet
did you asked the maintainer?


[3/11/2022 10:27â€¯PM] tux_linux
no


[3/11/2022 10:27â€¯PM] tux_linux
I highly doubt he has an idea


[3/11/2022 10:27â€¯PM] tux_linux
The problem was that you couldn't suspend while in X, right?


[3/11/2022 10:28â€¯PM] szybet
this


[3/11/2022 10:28â€¯PM] szybet
i think suspend is fixed for good, becouse of wifi


[3/11/2022 10:28â€¯PM] tux_linux
you mean, in Qt gui too?


[3/11/2022 10:29â€¯PM] szybet
well, in qt gui only?


[3/11/2022 10:29â€¯PM] tux_linux
so that means you have the problem I have on my Libra
but I never disable X on my Libra
so I think it is permanent


[3/11/2022 10:29â€¯PM] tux_linux
oh; awesome


[3/11/2022 10:30â€¯PM] szybet
propably


[3/11/2022 10:30â€¯PM] tux_linux
well, not awesome, but it's nice to know that it can probably be circumvented on the libra by disabling x11


[3/11/2022 10:30â€¯PM] tux_linux
and it does that randomly, right?


[3/11/2022 10:30â€¯PM] szybet
yes


[3/11/2022 10:30â€¯PM] szybet
xorg isin't that important, those are ereaders


[3/11/2022 10:31â€¯PM] tux_linux
hmm


[3/11/2022 10:31â€¯PM] szybet
idle sleep is working too btw


[3/11/2022 10:31â€¯PM] szybet
so everything, exept the magnet


[3/11/2022 10:31â€¯PM] tux_linux
nice


[3/11/2022 10:32â€¯PM] szybet
when will you implement the magnet?


[3/11/2022 10:33â€¯PM] tux_linux
this week-end?


[3/11/2022 10:33â€¯PM] szybet
you mean tommorow, sunday?


[3/11/2022 10:33â€¯PM] tux_linux
might be there


[3/11/2022 10:33â€¯PM] szybet
okay


[3/11/2022 10:33â€¯PM] szybet
i will test more until then


[3/11/2022 10:34â€¯PM] tux_linux
actually it might just be as easy as that

{Attachments}
/mnt/data/projects/git/conversations/media/rootfs-42510.diff


[3/11/2022 10:34â€¯PM] tux_linux
try it


[3/11/2022 10:43â€¯PM] szybet
its working


[3/11/2022 10:43â€¯PM] szybet
its not a ideal and clear solution


[3/11/2022 10:44â€¯PM] szybet
but it is


[3/11/2022 10:44â€¯PM] tux_linux
?


[3/11/2022 10:44â€¯PM] szybet
/tmp/power looks like this most of the time:
```
Event: time 1647034909.855898, type 1 (EV_KEY), code 59 (KEY_F1), value 0
Event: time 1647034909.855898, -------------- SYN_REPORT ------------

```


[3/11/2022 10:44â€¯PM] tux_linux
yeah


[3/11/2022 10:45â€¯PM] tux_linux
and?


[3/11/2022 10:45â€¯PM] szybet
its writing to it all the time


[3/11/2022 10:45â€¯PM] szybet
is it good? performance eating?


[3/11/2022 10:45â€¯PM] tux_linux
no


[3/11/2022 10:45â€¯PM] tux_linux
usually, CPU is at 2-3% at idle


[3/11/2022 10:47â€¯PM] szybet
its jumping 3-6-8-12% all the time


[3/11/2022 10:47â€¯PM] szybet
not stable


[3/11/2022 10:47â€¯PM] szybet
its not bad

{Reactions}
ğŸ‘ 

[3/11/2022 10:47â€¯PM] szybet
and the cpu is propably weakier


[3/11/2022 10:50â€¯PM] szybet
is the time in the gui fixed, all commits pushed? i would like to update the rootfs


[3/11/2022 10:51â€¯PM] tux_linux
not fixed yet


[3/11/2022 10:51â€¯PM] tux_linux
but you can update the rootfs


[3/11/2022 10:51â€¯PM] szybet
okay


[3/11/2022 10:51â€¯PM] tux_linux
well, you can't set the timezone in the gui


[3/11/2022 10:51â€¯PM] tux_linux
if you set via cli, it works


[3/11/2022 10:51â€¯PM] szybet
thats what i asked for


[3/11/2022 10:52â€¯PM] tux_linux
erase your overlayfs cache


[3/11/2022 10:52â€¯PM] tux_linux
Pinned a message.


[3/11/2022 10:52â€¯PM] tux_linux
I pinned the commands


[3/11/2022 11:08â€¯PM] szybet
hmm
```
scp rootfs.squashfs root@192.168.0.1:/mnt/
```
***now i know this isin't a good idea***


[3/11/2022 11:10â€¯PM] szybet
so how do i update the rootfs without u-boot?


[3/11/2022 11:16â€¯PM] tux_linux
you technically can but load busybox binary into ram before (just run `busybox`) without any arguments
then
`busybox sync`
`busybox reboot`


[3/11/2022 11:16â€¯PM] tux_linux
it's not clean, it's an horrible idea, but I guess it does the job


[3/11/2022 11:17â€¯PM] szybet
nope, nothing worked


[3/11/2022 11:17â€¯PM] szybet
i will tommorow open in and do it properly


[3/11/2022 11:17â€¯PM] szybet
what is the best way to do this ( without opening )?


[3/11/2022 11:17â€¯PM] tux_linux
did it transfer?


[3/11/2022 11:17â€¯PM] tux_linux
via u-boot/DFL or an update package


[3/11/2022 11:18â€¯PM] szybet
it did ( i think ) , then everything stopped working and i couldn't  the openssl file


[3/11/2022 11:19â€¯PM] tux_linux
you should have scp'ed them at the same time


[3/11/2022 11:20â€¯PM] szybet
true


[3/11/2022 11:20â€¯PM] szybet
after error code 3, does it reboot or go shutdown?


[3/11/2022 11:20â€¯PM] tux_linux
shutdown


[3/11/2022 11:20â€¯PM] szybet
nice


[3/11/2022 11:20â€¯PM] tux_linux
https://github.com/Kobo-InkBox/kernel/blob/439f7b42a06371d473995eab3fa43d88f7779498/initrd/common/overlay-mount#L41-L49


[3/11/2022 11:37â€¯PM] tux_linux
https://github.com/Kobo-InkBox/rootfs/commit/b20aaad03c2b44ccca276512fa1fed039a8dcd27

{Embed}
https://github.com/Kobo-InkBox/rootfs/commit/b20aaad03c2b44ccca276512fa1fed039a8dcd27
Include sleep cover in sleep mode triggers Â· Kobo-InkBox/rootfs@b20...
Thanks to @Szybet for the contributions in this commit and in 3fb505c19b03bb8f164c185b86b86304c4ff7d75
/mnt/data/projects/git/conversations/media/b20aaad03c2b44ccca276512fa1fed039a8dcd27-F826A


[3/12/2022 2:44â€¯AM] tux_linux
Done!
https://github.com/Kobo-InkBox/rootfs/commit/0024535e5ce23b3ad6a97669ce90e009dd0fc6fb
https://github.com/Kobo-InkBox/inkbox/commit/1aca2ba6156035b540c529dea0cd8930f2c68c2a

{Embed}
https://github.com/Kobo-InkBox/rootfs/commit/0024535e5ce23b3ad6a97669ce90e009dd0fc6fb
Wi-Fi: Disable when going to sleep and auto-connect on wake-up Â· Ko...
/mnt/data/projects/git/conversations/media/0024535e5ce23b3ad6a97669ce90e009dd0fc6fb-B7476

{Embed}
https://github.com/Kobo-InkBox/inkbox/commit/1aca2ba6156035b540c529dea0cd8930f2c68c2a
Wi-Fi: Auto-connect on wake-up things Â· Kobo-InkBox/inkbox@1aca2ba
/mnt/data/projects/git/conversations/media/1aca2ba6156035b540c529dea0cd8930f2c68c2a-21E1A


[3/12/2022 4:46â€¯AM] tux_linux
https://github.com/Kobo-InkBox/inkbox/commit/f0c02a37d6cfcd6cdc8426ce78f69bd0f359289f

{Embed}
https://github.com/Kobo-InkBox/inkbox/commit/f0c02a37d6cfcd6cdc8426ce78f69bd0f359289f
Prevent massive page turning hang Â· Kobo-InkBox/inkbox@f0c02a3
/mnt/data/projects/git/conversations/media/f0c02a37d6cfcd6cdc8426ce78f69bd0f359289f-8256F


[3/12/2022 6:38â€¯AM] tux_linux
You can try encrypted storage if you want btw


[3/12/2022 6:56â€¯AM] tux_linux
I updated the GUI bundle at the usual URL


[3/12/2022 6:57â€¯AM] tux_linux
So you need to update the rootfs and the GUI bundle


[3/12/2022 1:56â€¯PM] szybet
with what do you open your kobos?  im using this below but it damages a bit the plastic. maybe there is a better way

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-37E1B.png


[3/12/2022 1:56â€¯PM] tux_linux
credit card


[3/12/2022 1:57â€¯PM] szybet
no way ot will work


[3/12/2022 1:57â€¯PM] szybet
maybe the nia is tightener


[3/12/2022 1:57â€¯PM] tux_linux
usually I start if a knife, and once some place in the back has enough damage I can fit a credit card to open the entire device


[3/12/2022 1:57â€¯PM] tux_linux
well, it isn't ideal, but that's what happened with my Libra


[3/12/2022 1:57â€¯PM] szybet
a knife will damage it too


[3/12/2022 1:58â€¯PM] tux_linux
there's something called a spudger


[3/12/2022 1:58â€¯PM] tux_linux
i don't have that


[3/12/2022 1:58â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-EE3A2.png


[3/12/2022 1:58â€¯PM] szybet
this one?


[3/12/2022 1:59â€¯PM] tux_linux
more like that

{Attachments}
/mnt/data/projects/git/conversations/media/OWCTOOLIPOD_hero-A873A.jpg


[3/12/2022 2:00â€¯PM] szybet
tryied with it, no chance


[3/12/2022 2:00â€¯PM] szybet
( for the nia )


[3/12/2022 2:01â€¯PM] tux_linux
well, then I don't know


[3/12/2022 2:11â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220312_141108-2F6FD.jpg


[3/12/2022 2:12â€¯PM] szybet
this ***e***   ğŸ˜†


[3/12/2022 2:17â€¯PM] tux_linux
Whoa


[3/12/2022 2:17â€¯PM] tux_linux
It should not be like that


[3/12/2022 2:17â€¯PM] tux_linux
Do you have x enabled?


[3/12/2022 2:19â€¯PM] szybet
i dont really know if this patched the issue


[3/12/2022 2:19â€¯PM] szybet
disabled


[3/12/2022 2:20â€¯PM] tux_linux
Well, it disables the button when you click it and enables it back when the page is loaded


[3/12/2022 2:21â€¯PM] tux_linux
If that doesn't fix your issue then nothing can


[3/12/2022 2:21â€¯PM] szybet
so in theory if i spam click the button it shouldn't switch more than 1 page?


[3/12/2022 2:22â€¯PM] tux_linux
No
It will switch one, two, three pages once the page before has been correctly loaded, although might be not fully printed on the screen yet


[3/12/2022 2:22â€¯PM] tux_linux
So it ensures each page is properly loaded before loading a new one


[3/12/2022 2:24â€¯PM] szybet
so it doesn't work


[3/12/2022 2:25â€¯PM] tux_linux
Well, use the go to function if you want to spam page turns


[3/12/2022 2:25â€¯PM] szybet
i mean that propably when using the reader some times it will jump 2 pages


[3/12/2022 2:26â€¯PM] tux_linux
It never does that on my devices


[3/12/2022 2:26â€¯PM] szybet
maybe i click not exact


[3/12/2022 2:26â€¯PM] szybet
its not a big issue


[3/12/2022 2:26â€¯PM] tux_linux
Ok, what about Wi-Fi reconnection on wake up?


[3/12/2022 2:27â€¯PM] szybet
i will check it, first how do i set the timezone now


[3/12/2022 2:27â€¯PM] szybet
from cli


[3/12/2022 2:28â€¯PM] tux_linux
You need to symlink a zoneinfo file to `/data/config/19-timezone/config`
Use ln -sf


[3/12/2022 2:29â€¯PM] szybet
ln -sf /data/config/19-timezone/config /usr/share/zoneinfo/Poland    ?


[3/12/2022 2:29â€¯PM] tux_linux
The opposite


[3/12/2022 2:29â€¯PM] tux_linux
But yeah


[3/12/2022 2:30â€¯PM] szybet
`ln -sf /usr/share/zoneinfo/Poland /data/config/19-timezone/config`


[3/12/2022 2:30â€¯PM] szybet
okay


[3/12/2022 2:30â€¯PM] tux_linux
Yes


[3/12/2022 2:36â€¯PM] szybet
recconecting works


[3/12/2022 2:42â€¯PM] szybet
time works too


[3/12/2022 2:42â€¯PM] szybet
perfect


[3/12/2022 2:47â€¯PM] tux_linux
Awesome


[3/12/2022 2:48â€¯PM] szybet
um, when did you fixed this


[3/12/2022 2:48â€¯PM] szybet
it works


[3/12/2022 2:49â€¯PM] szybet
where is the list of supported devices?


[3/12/2022 2:51â€¯PM] szybet
here i see it:
https://inkbox.ddns.net/wiki/index.php?title=Main_Page

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Main_Page
Main Page


[3/12/2022 2:52â€¯PM] szybet
i really think you can add to them the kobo nia


[3/12/2022 2:52â€¯PM] szybet
and the kobo libra, with a note that xorg doesn't work correctly


[3/12/2022 2:56â€¯PM] tux_linux
I'll add them once I release 1.9


[3/12/2022 2:56â€¯PM] szybet
sure


[3/12/2022 3:03â€¯PM] szybet
I have closed the issue on github


[3/12/2022 3:15â€¯PM] szybet
i cant go to sleep until it recconects, but yea


[3/12/2022 3:16â€¯PM] szybet
oh, i need to click 2 times


[3/12/2022 3:16â€¯PM] szybet
okay


[3/12/2022 3:17â€¯PM] szybet
and it went back from sleep and asks me to choose the network


[3/12/2022 4:52â€¯PM] tux_linux
Yeah, because you clicked two times


[3/12/2022 6:53â€¯PM] szybet
i have updated the guide, some parts need more clarification
https://github.com/Szybet/kobo-nia-audio/blob/main/inkbox.md

{Embed}
https://github.com/Szybet/kobo-nia-audio/blob/main/inkbox.md
kobo-nia-audio/inkbox.md at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE

{Reactions}
ğŸ‘ 

[3/13/2022 12:25â€¯AM] szybet
idk why, here is the fix:
https://github.com/Kobo-InkBox/rootfs/pull/1

{Embed}
https://github.com/Kobo-InkBox/rootfs/pull/1
fix sometimes appearing sleeping issues on the kobo nia by Szybet Â·...
The device will sometimes not go to sleep when the modules are loaded, even if the interface is down
/mnt/data/projects/git/conversations/media/1-FC70C


[3/13/2022 12:29â€¯AM] tux_linux
No, it's because the operstate file in sysfs shows down even if the modules are loaded and the interface is up, it shows "up" only when the interface has got an IP


[3/13/2022 12:29â€¯AM] szybet
its still if its down


[3/13/2022 12:30â€¯AM] tux_linux
?


[3/13/2022 12:31â€¯AM] szybet
yes, and?


[3/13/2022 12:32â€¯AM] tux_linux
Well, if you searched for networks but didn't connect, it will fail to sleep


[3/13/2022 12:33â€¯AM] szybet
look
1 interface is down
2 modules are loaded
3 sleep doesn't work


[3/13/2022 12:33â€¯AM] tux_linux
Yes


[3/13/2022 12:33â€¯AM] tux_linux
Idk


[3/13/2022 12:34â€¯AM] szybet
"tap again" where to tap? at the wifi button?


[3/13/2022 12:34â€¯AM] tux_linux
Maybe get out the block of code removing the WiFi modules from the if statement and put it before


[3/13/2022 12:34â€¯AM] tux_linux
Yes? Isn't that intuitive?


[3/13/2022 12:35â€¯AM] szybet
i ask becouse it doesn't work. when i click again it shows the "searching for network" label


[3/13/2022 12:35â€¯AM] tux_linux
Yes, that's what it's supposed to do ...?


[3/13/2022 12:36â€¯AM] szybet
then it will rm them 2 times sometimes. But it doesn't matter, do as you would like, its just code preferency look


[3/13/2022 12:36â€¯AM] tux_linux
I'll do that later tonight


[3/13/2022 12:37â€¯AM] szybet
Tap again to cancel, not to search for networks?


[3/13/2022 12:37â€¯AM] tux_linux
To cancel the reconnection


[3/13/2022 12:37â€¯AM] tux_linux
And connect to another network


[3/13/2022 12:38â€¯AM] tux_linux
That's how I see it ?...


[3/13/2022 12:38â€¯AM] szybet
A


[3/13/2022 12:38â€¯AM] szybet
o thought it will shut down the wifi

{Reactions}
ğŸ‘ 

[3/13/2022 12:44â€¯AM] szybet
could i add a service that will check the power button, and if it will clicked it will stop wake_standby and start sleep_standby? it would remove the problem that after going from sleep it cant go to sleep again?


[3/13/2022 2:03â€¯AM] tux_linux
That would cause some unwanted problems


[3/13/2022 2:49â€¯AM] tux_linux
Maybe I could add something related to what Qt does when it cancels reconnect


[3/13/2022 7:00â€¯AM] tux_linux
https://github.com/Kobo-InkBox/rootfs/commit/6eb0ad2f626556c0322c178fbadd47b5aac0632c
This was a nightmare.

{Embed}
https://github.com/Kobo-InkBox/rootfs/commit/6eb0ad2f626556c0322c178fbadd47b5aac0632c
Wi-Fi auto-connect on wake-up: lot of bugfixes Â· Kobo-InkBox/rootfs...
/mnt/data/projects/git/conversations/media/6eb0ad2f626556c0322c178fbadd47b5aac0632c-CB2BC


[3/13/2022 7:01â€¯AM] tux_linux
But at least it's done and it works (hopefully)
Edit: don't expect it to work. I tested on my Touch and it's still not acting properly. Will try to fix soon


[3/13/2022 7:27â€¯AM] tux_linux
But if you can, please look and tell me if you see something in the commit that should not be there or if it is missing.
The modules removal part is 100% fixed now, but going to sleep while reconnecting still gives problems.


[3/13/2022 7:28â€¯AM] tux_linux
I'm going to sleep now. Enough of this shit for tonight ğŸ˜‚


[3/13/2022 2:14â€¯PM] tux_linux
https://github.com/Kobo-InkBox/rootfs/commit/a3e96f2a0bf6a964967a98acb7f0280c29d67849
It seems to be better now

{Embed}
https://github.com/Kobo-InkBox/rootfs/commit/a3e96f2a0bf6a964967a98acb7f0280c29d67849
Even more bugfixes for Wi-Fi reconnection on wake-up Â· Kobo-InkBox/...
/mnt/data/projects/git/conversations/media/a3e96f2a0bf6a964967a98acb7f0280c29d67849-0917F


[3/13/2022 2:18â€¯PM] szybet
Its even more complicated


[3/13/2022 2:29â€¯PM] tux_linux
i know


[3/13/2022 2:30â€¯PM] tux_linux
but it works on my Kobo, so I guess it might on yours too


[3/13/2022 2:31â€¯PM] szybet
i will test later
could you show me a place where i can ask question about qt? i have some questions and i cant find answers


[3/13/2022 2:35â€¯PM] tux_linux
Qt discord


[3/13/2022 2:36â€¯PM] tux_linux
But it might be too specific if you want to setup a cross compile environment; maybe ask pgaskin, NiLuJe or sherm_p on this server


[3/13/2022 2:37â€¯PM] szybet
i will try


[3/13/2022 2:37â€¯PM] szybet
first I want to learn qt, then use it on the kobo

{Reactions}
ğŸ‘ 

[3/13/2022 7:11â€¯PM] tux_linux
https://github.com/Kobo-InkBox/inkbox/commit/62b09f40624ac94ecdc9f2b36b94d90844915792

{Embed}
https://github.com/Kobo-InkBox/inkbox/commit/62b09f40624ac94ecdc9f2b36b94d90844915792
Settings: Add an option to change timezone Â· Kobo-InkBox/inkbox@62b...
/mnt/data/projects/git/conversations/media/62b09f40624ac94ecdc9f2b36b94d90844915792-1F422

{Reactions}
ğŸ‘ 

[3/13/2022 7:21â€¯PM] szybet
what should i test?


[3/13/2022 7:22â€¯PM] szybet
also, how bad is porting a qt cpp app to kobo?


[3/13/2022 7:23â€¯PM] tux_linux
once you have the setup, it's easy


[3/13/2022 7:26â€¯PM] tux_linux
1. Put it to sleep and wake it up, not connected to any Wi-Fi network. Should work as usual.
2. Connect to a Wi-Fi network. Then, put it to sleep and wake it up.
3. Wait until the Wi-Fi has reconnected (the Wi-Fi icon updates each 10s) and then put it to sleep.
4. Wake it up and put it back to sleep again **while** it's reconnecting. Then wake it up. It should not attempt to connect to any network at this point.


[3/13/2022 7:37â€¯PM] szybet
4 doesn't work


[3/13/2022 7:37â€¯PM] tux_linux
which part?


[3/13/2022 7:37â€¯PM] szybet
4.


[3/13/2022 7:37â€¯PM] tux_linux
Well, it fails at which sub-step?


[3/13/2022 7:38â€¯PM] szybet
you know that nia will not go to sleep if modules are loaded?


[3/13/2022 7:38â€¯PM] tux_linux
yes


[3/13/2022 7:38â€¯PM] tux_linux
They are removed


[3/13/2022 7:39â€¯PM] tux_linux
https://github.com/Kobo-InkBox/rootfs/blob/a3e96f2a0bf6a964967a98acb7f0280c29d67849/etc/init.d/sleep_standby.sh#L60-L91
Even if the interface is down, they will be removed


[3/13/2022 7:40â€¯PM] szybet
it simply doesn't respond for the power button


[3/13/2022 7:40â€¯PM] szybet
no sleeping splash screen


[3/13/2022 7:41â€¯PM] tux_linux
can you still interact with the ui?


[3/13/2022 7:41â€¯PM] tux_linux
how much time did you wait after it woke up and started reconnecting?


[3/13/2022 7:41â€¯PM] szybet
30s


[3/13/2022 7:42â€¯PM] tux_linux
Maybe it had already reconnected


[3/13/2022 7:42â€¯PM] szybet
i mean


[3/13/2022 7:42â€¯PM] szybet
after going back from sleep i clicked the power button instantly


[3/13/2022 7:42â€¯PM] szybet
but no reaction


[3/13/2022 7:43â€¯PM] tux_linux
I think it's at least 3-4 secs before it can react, it has to go through other steps in the scripts before


[3/13/2022 7:47â€¯PM] tux_linux
I'll try on other models


[3/13/2022 7:48â€¯PM] szybet
nope, still doesn't react


[3/13/2022 7:52â€¯PM] tux_linux
Ok. Please **reboot**, then do the following:
```
cp /etc/init.d/sleep_standby.sh /etc/init.d/wake_standby.sh /tmp
vi /tmp/sleep_standby.sh # Replace first line with '#!/bin/bash -x'
vi /tmp/wake_standby.sh # Replace first line with '#!/bin/bash -x'
mount --bind /tmp/sleep_standby.sh /etc/init.d/sleep_standby.sh
mount --bind /tmp/wake_standby.sh /etc/init.d/wake_standby.sh
killall sleep_standby.sh wake_standby.sh # If nothing found, try to find processes with `ps' and kill the PID related to those scripts
rc-service sleep_standby stop
rc-service wake_standby stop
rc-service sleep_standby start -d
```
Then redo the steps above and post terminal output. It's a truckload of info, so it will probably be useful for debugging.


[3/13/2022 7:53â€¯PM] tux_linux
Actually, only do step 3 and 4.


[3/13/2022 7:57â€¯PM] tux_linux
have you tried pressing it more than one time?


[3/13/2022 7:57â€¯PM] szybet
yes, and then after 2 minutes it gos to sleep and doesn't want to go back


[3/13/2022 7:57â€¯PM] tux_linux
well, that is a kernel issue
no idea


[3/13/2022 7:58â€¯PM] tux_linux
The early wake-up part is handled by the kernel
If the screen didn't refresh when you clicked the power button, it's a kernel issue


[3/13/2022 8:33â€¯PM] szybet
it works, i needed to clear the write cache something


[3/13/2022 8:33â€¯PM] szybet
https://tenor.com/view/facepalm-picard-star-trek-the-next-generation-disappointed-gif-23456183

{Embed}
https://tenor.com/view/facepalm-picard-star-trek-the-next-generation-disappointed-gif-23456183
/mnt/data/projects/git/conversations/media/facepalm-picard-ED9D8.png


[3/13/2022 8:37â€¯PM] tux_linux
What works?


[3/13/2022 8:37â€¯PM] szybet
everything


[3/13/2022 8:37â€¯PM] szybet
from here


[3/13/2022 8:39â€¯PM] tux_linux
Nice


[3/13/2022 10:46â€¯PM] szybet
usb storage will not work with usbnet, right?


[3/13/2022 10:46â€¯PM] tux_linux
yes, but it removes usbnet modules before inserting mass storage ones


[3/13/2022 10:46â€¯PM] tux_linux
so you lose usbnet while in mass storage


[3/13/2022 10:46â€¯PM] tux_linux
it restarts it after if you have it enabled


[3/13/2022 10:47â€¯PM] szybet
so nothing works?


[3/13/2022 10:47â€¯PM] tux_linux
not while you're in mass storage


[3/13/2022 10:47â€¯PM] tux_linux
wi-fi still works though


[3/13/2022 10:47â€¯PM] tux_linux
you can ssh that way


[3/13/2022 10:48â€¯PM] szybet
sshfs would be nice to get working


[3/13/2022 10:48â€¯PM] tux_linux
you can try


[3/13/2022 11:03â€¯PM] szybet (pinned)
to enable sshfs its needed to add `Subsystem sftp internal-sftp` to `/etc/ssh/sshd_config`


[3/13/2022 11:03â€¯PM] szybet
Pinned a message.


[3/13/2022 11:04â€¯PM] tux_linux
oh cool


[3/13/2022 11:08â€¯PM] szybet
writing doesn't work


[3/13/2022 11:08â€¯PM] tux_linux
oh?


[3/13/2022 11:08â€¯PM] szybet
i will debug it later


[3/13/2022 11:08â€¯PM] szybet
using sshfs


[3/13/2022 11:08â€¯PM] tux_linux
did you mount rootfs r/w?


[3/13/2022 11:08â€¯PM] szybet
/data/onboard/


[3/13/2022 11:08â€¯PM] tux_linux
strange


[3/13/2022 11:08â€¯PM] szybet
scp works


[3/13/2022 11:08â€¯PM] szybet
then idk


[3/14/2022 3:21â€¯PM] szybet
I put yesterday my nia in the bag, now I look it was in the menu and 39%... Weird


[3/14/2022 3:22â€¯PM] szybet
I have a case that prevents the power key from being clicked, and it goes to sleep after 15 minutes


[3/14/2022 6:38â€¯PM] tux_linux
idk


[3/14/2022 6:38â€¯PM] tux_linux
Sleep timeout is a nice workaround


[3/14/2022 6:41â€¯PM] szybet
I had it enabled


[3/14/2022 6:41â€¯PM] szybet
strange


[3/14/2022 6:42â€¯PM] szybet
i will test it more, maybe a one time event ( maybe the ereader was next to a tablet, and the tablet had magnets in it )


[3/14/2022 9:28â€¯PM] szybet
i charged it up at 17:00, now at 21:30 it has 87%


[3/14/2022 9:28â€¯PM] szybet
thats concerning


[3/14/2022 9:29â€¯PM] szybet
and it was sleeping the whole time


[3/14/2022 9:29â€¯PM] szybet
maybe becouse of usbnet?


[3/14/2022 9:37â€¯PM] tux_linux
Strange


[3/14/2022 9:39â€¯PM] szybet
there is no way powertop would work there, right?


[3/14/2022 9:40â€¯PM] tux_linux
Idk


[3/14/2022 9:41â€¯PM] tux_linux
You can check cpu usage with htop maybe


[3/14/2022 9:41â€¯PM] szybet
it jumps 4-8-12% all the tim


[3/14/2022 9:42â€¯PM] tux_linux
Maybe check dmesg, there might be power info


[3/14/2022 9:43â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-6FC77.txt


[3/14/2022 9:44â€¯PM] szybet
```
[    5.614571] syscon-poweroff 20cc000.snvs:snvs-poweroff: pm_power_off already claimed 80021c08 ntx_machine_poweroff
[    5.625116] syscon-poweroff: probe of 20cc000.snvs:snvs-poweroff failed with error -16
```


[3/14/2022 9:46â€¯PM] szybet
maybe some kernel options to enable more power saving features?


[3/14/2022 9:46â€¯PM] szybet
i will need to tinker with that


[3/14/2022 10:17â€¯PM] tux_linux
I'm planning to release 1.9 soon, since we have pretty much everything ready.
Any features/fixes/something I forgot about?


[3/14/2022 10:20â€¯PM] szybet
- sliders too small
+ settings arrows to choose numbers are to small
- last book menu is simply not good
- improve wifi control maybe?
- file chooser ğŸ¤® 

those are the most important in my opinion


[3/14/2022 10:20â€¯PM] tux_linux
those will be for 2.0


[3/14/2022 10:20â€¯PM] tux_linux
Maybe the last thing to add to 1.9 would be an option to turn wi-fi off


[3/14/2022 10:21â€¯PM] szybet
yea


[3/14/2022 10:21â€¯PM] tux_linux
i don't know if something is possible for the sliders and settings arrows


[3/14/2022 10:21â€¯PM] tux_linux
it's like we'd have to scale only one part of the UI but not all of it
idk


[3/14/2022 10:22â€¯PM] szybet
settings arrows - replace with something else
for sliders it must be possible, QT is not that static?


[3/14/2022 10:22â€¯PM] tux_linux
what?
it's a qspinbox
for sliders... maybe


[3/14/2022 10:23â€¯PM] szybet
https://stackoverflow.com/questions/47691972/qslider-increase-handle-size random answer from internet

{Embed}
https://stackoverflow.com/questions/47691972/qslider-increase-handle-size
QSlider increase handle size
I need badly to increase size of handle for my slider, but no css options can do this(styleSheet()).
The default example from Qt docs didn't help me as well.

I have a slider like this:
I wish to
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[3/14/2022 10:23â€¯PM] tux_linux
oh it seems possible yeah


[3/14/2022 10:23â€¯PM] szybet
for settings arrow,  replace it with a keyboard with only numbers


[3/14/2022 10:24â€¯PM] tux_linux
Are you crazy? This will probably take more time to change and be more CPU-consuming than using the arrows


[3/14/2022 10:24â€¯PM] tux_linux
huh
only numbers


[3/14/2022 10:24â€¯PM] tux_linux
like the Go to page thing?


[3/14/2022 10:24â€¯PM] szybet
exactly


[3/14/2022 10:25â€¯PM] tux_linux
https://stackoverflow.com/questions/59939409/how-to-expand-width-of-qspinbox-buttons
oooh nice

{Embed}
https://stackoverflow.com/questions/59939409/how-to-expand-width-of-qspinbox-buttons
How to expand width of QSpinBox buttons
I created a small GUI in QtCreator and had it converted to python to execute on a Raspberry Pi. issue is the QSpinBox buttons are only scaled by QSpinBox height. how can i increase the width of the
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[3/14/2022 10:25â€¯PM] tux_linux
It's actually possible


[3/14/2022 10:25â€¯PM] szybet
but inkbox is not written in python right?


[3/14/2022 10:25â€¯PM] szybet
well its still qt


[3/14/2022 10:25â€¯PM] tux_linux
doesn't matter


[3/14/2022 10:26â€¯PM] tux_linux
pyqt and qt share stylesheets


[3/14/2022 10:26â€¯PM] tux_linux
and usually adapting the python code is not that hard


[3/14/2022 10:26â€¯PM] tux_linux
Python and C++ are quite similar in some ways


[3/14/2022 10:27â€¯PM] szybet
for some things


[3/14/2022 10:54â€¯PM] szybet
how do i unload usb modules? they are busy


[3/14/2022 10:54â€¯PM] szybet
resource busy


[3/14/2022 10:55â€¯PM] tux_linux
are you in usbnet?


[3/14/2022 10:56â€¯PM] tux_linux
rmmod -f ?


[3/14/2022 10:56â€¯PM] szybet
ssh


[3/14/2022 10:56â€¯PM] tux_linux
well, ssh with wifi?


[3/14/2022 10:56â€¯PM] szybet
```
kobo:~# rmmod -f configfs libcomposite u_ether usb_f_ecm usb_f_ecm_subset usb_f_rndis g_ether
rmmod: ERROR: could not remove 'configfs': Resource temporarily unavailable
rmmod: ERROR: could not remove module configfs: Resource temporarily unavailable
rmmod: ERROR: could not remove 'libcomposite': Resource temporarily unavailable
rmmod: ERROR: could not remove module libcomposite: Resource temporarily unavailable
rmmod: ERROR: could not remove 'u_ether': Resource temporarily unavailable
rmmod: ERROR: could not remove module u_ether: Resource temporarily unavailable
rmmod: ERROR: could not remove 'usb_f_ecm': No such file or directory
rmmod: ERROR: could not remove module usb_f_ecm: No such file or directory
rmmod: ERROR: could not remove 'usb_f_ecm_subset': No such file or directory
rmmod: ERROR: could not remove module usb_f_ecm_subset: No such file or directory
rmmod: ERROR: could not remove 'usb_f_rndis': Resource temporarily unavailable
rmmod: ERROR: could not remove module usb_f_rndis: Resource temporarily unavailable
rmmod: ERROR: could not remove 'g_ether': Resource busy
rmmod: ERROR: could not remove module g_ether: Resource busy
kobo:~# 

```


[3/14/2022 10:56â€¯PM] szybet
i already unloaded usbnet modules


[3/14/2022 10:56â€¯PM] szybet
but those are still there


[3/14/2022 10:56â€¯PM] szybet
im using wifi


[3/14/2022 10:57â€¯PM] tux_linux
i really don't know


[3/14/2022 10:57â€¯PM] tux_linux
`lsmod`?


[3/14/2022 10:57â€¯PM] szybet
```
kobo:~# lsmod
Module                  Size  Used by
8189fs               1294344  0
sdio_wifi_pwr            593  0
g_ether                 5247  -1
usb_f_rndis            16183  1 g_ether
u_ether                12152  2 usb_f_rndis,g_ether
libcomposite           44430  2 usb_f_rndis,g_ether
configfs               23581  3 usb_f_rndis,libcomposite
kobo:~# 

```


[3/14/2022 10:58â€¯PM] szybet
some modules i could unloaded, those persist


[3/14/2022 10:58â€¯PM] tux_linux
kernel bug


[3/14/2022 10:58â€¯PM] szybet
-f doesn't work


[3/14/2022 10:58â€¯PM] tux_linux
if you want you can disable usbnet


[3/14/2022 10:58â€¯PM] tux_linux
`echo false > /boot/flags/USBNET_ENABLE`


[3/14/2022 10:58â€¯PM] tux_linux
and reboot


[3/14/2022 10:58â€¯PM] tux_linux
it won't load the modules


[3/14/2022 11:04â€¯PM] szybet
yea those were usbnet modules


[3/14/2022 11:04â€¯PM] szybet
they dissapered

{Reactions}
ğŸ‘ 

[3/15/2022 4:49â€¯PM] szybet
yestarday i leaved it at 97% after removing usbnet, it was sleeping till now and i see 90%


[3/15/2022 4:49â€¯PM] szybet
its acceptable + usbnet is eating battery like crazy


[3/15/2022 4:49â€¯PM] tux_linux
Good to know


[3/15/2022 4:50â€¯PM] tux_linux
You don't have display debug flag enabled right?


[3/15/2022 4:50â€¯PM] szybet
you mean?


[3/15/2022 4:50â€¯PM] tux_linux
Look at wiki page


[3/15/2022 4:50â€¯PM] tux_linux
Boot flags


[3/15/2022 4:51â€¯PM] tux_linux
It prints serial output to screen rather than serial


[3/15/2022 4:51â€¯PM] szybet
disabled


[3/15/2022 4:51â€¯PM] tux_linux
Ok
Because that eats a lot of battery


[3/15/2022 4:51â€¯PM] szybet
but the kernel has the quiet option removed, maybe this


[3/15/2022 4:51â€¯PM] szybet
the wiki doesn't load for me


[3/15/2022 4:54â€¯PM] tux_linux
Which url?


[3/15/2022 4:54â€¯PM] tux_linux
https://inkbox.ddns.net/wiki/index.php?title=Main_Page
That doesn't work?

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=Main_Page
Main Page


[3/15/2022 4:55â€¯PM] szybet
oh, on ddg was this result: 
https://inkbox.ddns.net:40/wiki/index.php?title=Main_Page


[3/15/2022 4:55â€¯PM] szybet
this works


[3/15/2022 4:56â€¯PM] tux_linux
That's the new URL I changed some time ago
I informed people in #chat


[3/15/2022 5:23â€¯PM] tux_linux
https://photos.app.goo.gl/nuwvQYKwfA1hQ1TL8
Also, a video I made a while ago

{Embed}
https://photos.app.goo.gl/nuwvQYKwfA1hQ1TL8
New video by Nicolas Mailloux
/mnt/data/projects/git/conversations/media/jUYPDgRiNEGBkIa33izvP1sZ14RRNDBf80F9kDrCbI-1E5F7


[3/15/2022 5:25â€¯PM] szybet
I want this boot animation


[3/15/2022 5:25â€¯PM] szybet
does this consume energy all the time?


[3/15/2022 5:26â€¯PM] tux_linux
Yes


[3/15/2022 5:26â€¯PM] tux_linux
I don't know why


[3/15/2022 5:27â€¯PM] tux_linux
It takes 100% of the CPU when it's supposed to be idle for some reason


[3/15/2022 5:27â€¯PM] tux_linux
But it's useful for debugging


[3/15/2022 5:43â€¯PM] szybet
sad


[3/16/2022 7:48â€¯PM] szybet
should `echo "1" > /sys/power/state-extended` disable the touch screen?


[3/17/2022 8:34â€¯AM] szybet
But today it didn't dropped even one percentage


[3/17/2022 8:34â€¯AM] szybet
I think there is a bug somewhere


[3/17/2022 8:35â€¯AM] szybet
How do i gather all stdout / stderr  from services to a file?


[3/17/2022 12:12â€¯PM] tux_linux
Maybe you can check /var/log/rc.log
But I don't think it will be very helpful


[3/17/2022 1:22â€¯PM] szybet
I will need to edit the service files :\


[3/17/2022 1:23â€¯PM] szybet
And this?


[3/17/2022 1:29â€¯PM] tux_linux
That's to disable waking up the device with the touchscreen


[3/17/2022 1:29â€¯PM] tux_linux
It only allows the power button/Hall sensor to wake it up


[3/17/2022 1:31â€¯PM] szybet
Oh okay


[3/22/2022 12:37â€¯PM] szybet
Now its confirmed

When sleeping the touch screen is still on, and can awake the device


[3/22/2022 12:37â€¯PM] szybet
Any fix for that? I think that /SYS/power/xxx should disable it


[3/22/2022 12:41â€¯PM] szybet
I should create my own kernel


[3/22/2022 12:43â€¯PM] tux_linux
You need to echo 1 to power-extended


[3/22/2022 1:20â€¯PM] szybet
I think that the sleep service does that


[3/22/2022 1:20â€¯PM] szybet
But its still is working


[3/22/2022 1:21â€¯PM] szybet
The touch screen is very sensitive, even with a 1mm layer of PETG plastic


[3/22/2022 1:31â€¯PM] tux_linux
I don't know


[3/22/2022 1:47â€¯PM] tux_linux
Gutenberg hangs when Wi-Fi is off?
On my devices it says Error as it should


[3/22/2022 1:48â€¯PM] tux_linux
The reason I don't want to put a sync button is to limit the times/day one downloads the index from Gutenberg to prevent overloading the server


[3/22/2022 1:48â€¯PM] tux_linux
The sync counter resets after one day


[3/22/2022 1:56â€¯PM] szybet
It tryies to sync and hangs


[3/22/2022 2:05â€¯PM] szybet
Maybe a button that only shows up after a day?


[3/22/2022 2:05â€¯PM] szybet
I dont want accidentally sync the library


[3/24/2022 12:33â€¯PM] szybet
It didn't disabled the touch


[3/24/2022 12:33â€¯PM] szybet
I did state-extended because power extended doesn't exist


[3/24/2022 1:45â€¯PM] tux_linux
yeah sorry my mistake


[3/24/2022 1:46â€¯PM] tux_linux
@NiLuJe , do you know what's going on here?
(touch waking up the device even if state-extended is set to 1)


[3/24/2022 1:47â€¯PM] szybet
I will check the kernel, maybe your config is missing something


[3/24/2022 1:47â€¯PM] tux_linux
maybe


[3/24/2022 1:50â€¯PM] tux_linux
I uploaded the GUI bundle


[3/24/2022 5:21â€¯PM] szybet
kobo:/bin# busybox sync
-ash: busybox: not found


[3/24/2022 5:21â€¯PM] szybet
nope


[3/24/2022 5:35â€¯PM] tux_linux
Well idk


[3/24/2022 5:35â€¯PM] tux_linux
Telnet into initrd


[3/24/2022 5:35â€¯PM] tux_linux
Check INITRD_DEBUG boot flag


[3/24/2022 5:36â€¯PM] szybet
yes i know


[3/24/2022 5:53â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-E2B46.png


[3/24/2022 5:53â€¯PM] szybet
why powerpc etc


[3/24/2022 5:56â€¯PM] szybet
and what is this: CONFIG_ATAGS_PROC


[3/24/2022 6:35â€¯PM] tux_linux
Well I didn't specifically enable these


[3/24/2022 6:35â€¯PM] tux_linux
Something for kexec to work (which I might do something with in the future)


[3/24/2022 6:38â€¯PM] szybet
before:
```
kobo:~# cat /sys/kernel/debug/suspend_stats 
success: 2
fail: 6
failed_freeze: 1
failed_prepare: 0
failed_suspend: 5
failed_suspend_late: 0
failed_suspend_noirq: 0
failed_resume: 0
failed_resume_early: 0
failed_resume_noirq: 0
failures:
  last_failed_dev:      228c000.epdc
                        228c000.epdc
  last_failed_errno:    -2
                        -2
  last_failed_step:     suspend
                        suspend
```
those fails are becouse i tryied to do something, but still hmm


[3/24/2022 6:38â€¯PM] szybet
what is `228c000.epdc`


[3/24/2022 6:40â€¯PM] szybet
i2c to control the regulator for screen brightness and fbink


[3/24/2022 6:40â€¯PM] szybet
interesting?


[3/24/2022 6:50â€¯PM] szybet
rebooted, now i get error -16 so "device and resource busy"


[3/24/2022 7:12â€¯PM] szybet
even with success the touchscreen wakes it up


[3/24/2022 8:14â€¯PM] szybet
i have disabled every wakeup file on the device:
```
kobo:/sys# find . -name "wakeup"
./devices/platform/soc/2000000.aips-bus/20cc000.snvs/20cc000.snvs:snvs-rtc-lp/power/wakeup
./devices/platform/soc/2000000.aips-bus/20c9000.usbphy/power/wakeup
./devices/platform/soc/2000000.aips-bus/2000000.spba-bus/2020000.serial/tty/ttymxc0/power/wakeup
./devices/platform/soc/2000000.aips-bus/20ca000.usbphy/power/wakeup
./devices/platform/soc/2100000.aips-bus/2184000.usb/power/wakeup
./devices/platform/soc/2100000.aips-bus/2184000.usb/ci_hdrc.0/power/wakeup
./devices/platform/soc/2100000.aips-bus/2194000.usdhc/power/wakeup
./devices/platform/soc/2100000.aips-bus/2190000.usdhc/power/wakeup
./devices/platform/soc/2100000.aips-bus/21ec000.serial/tty/ttymxc2/power/wakeup
./devices/platform/soc/2100000.aips-bus/21f8000.i2c/i2c-3/3-0032/rtc_ricoh619/power/wakeup
./devices/platform/soc/2100000.aips-bus/21f8000.i2c/i2c-3/3-0032/ricoh619-battery/power_supply/acpwr/power/wakeup
./devices/platform/soc/2100000.aips-bus/21f8000.i2c/i2c-3/3-0032/ricoh619-battery/power_supply/mc13892_charger/power/wakeup
./devices/platform/soc/2100000.aips-bus/21f8000.i2c/i2c-3/3-0032/ricoh619-battery/power_supply/mc13892_bat/power/wakeup
./devices/platform/soc/2100000.aips-bus/21f8000.i2c/i2c-3/3-0032/ricoh619-battery/power_supply/usbpwr/power/wakeup
./devices/platform/gpio-keys/power/wakeup
```
its still waking up


[3/24/2022 8:24â€¯PM] szybet
i have no idea, here is some documentation that isin't working: https://www.kernel.org/doc/html/v4.14/driver-api/pm/devices.html


[3/24/2022 8:35â€¯PM] szybet
this is disabled:

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-8C8F2.png


[3/24/2022 8:35â€¯PM] szybet
:(


[3/25/2022 12:12â€¯AM] szybet
why i cant boot now any kernel

{Attachments}
/mnt/data/projects/git/conversations/media/message-DFF7B.txt


[3/25/2022 12:13â€¯AM] szybet
here is nickel kernel:
Starting kernel ...
```
/cpus/cpu@0 missing clock-frequency property
sy7636-pmic sy7636-pmic: request vcom gpio failed (-16)!
sy7636-pmic sy7636-pmic: request powerup gpio failed (-16)!
syscon-poweroff 20cc000.snvs:snvs-poweroff: pm_power_off already claimed 80021934 ntx_machine_poweroff
PMU: ricoh61x_battery_probe : version is RICOH61x_BATTERY_VERSION: 2014.02.21 V3.1.0.0-Solution1 2015/02/09
==== calc_soc_by_voltageMethod E60U22 ====
imx6ul-pinctrl 2290000.iomuxc-snvs: pin MX6ULL_PAD_SNVS_TAMPER3 already requested by 21f8000.i2c; cannot claim for gpio-keys
imx6ul-pinctrl 2290000.iomuxc-snvs: pin-5 (gpio-keys) status -22
imx6ul-pinctrl 2290000.iomuxc-snvs: could not request pin 5 (MX6ULL_PAD_SNVS_TAMPER3) from group gpio_snvs_keys_grp  on device 22900s
gpio-keys gpio-keys: Error applying setting, reverse things back
Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/init.txt for guidanc.
---[ end Kernel panic - not syncing: No working init found.  Try passing init= option to kernel. See Linux Documentation/init.txt fo.
imx_epdc_v2_fb 228c000.epdc: Cleared LUT complete for init update
```


[3/25/2022 12:57â€¯AM] szybet
nickel image works *god i was scared that i damaged the cpu*


[3/25/2022 12:57â€¯AM] szybet
now i have a ***important*** question


[3/25/2022 12:57â€¯AM] szybet
what is `/dev/sdcard` in inkbox?


[3/25/2022 12:57â€¯AM] szybet
@tux-linux


[3/25/2022 5:28â€¯PM] tux_linux
no idea?


[3/25/2022 5:28â€¯PM] tux_linux
`sudo env GITDIR="${PWD}" scripts/make_devicenodes.sh`


[3/25/2022 5:29â€¯PM] tux_linux
this will solve your problem


[3/25/2022 7:01â€¯PM] szybet
100%?


[3/25/2022 11:15â€¯PM] tux_linux
Well yeah?


[3/25/2022 11:36â€¯PM] szybet
i will test it


[3/26/2022 12:12â€¯AM] szybet
no, not really


[3/26/2022 12:12â€¯AM] szybet
its the same


[3/26/2022 12:16â€¯AM] tux_linux
Did you recompile?


[3/26/2022 12:17â€¯AM] szybet
yes


[3/26/2022 12:17â€¯AM] tux_linux
Boot log?


[3/26/2022 12:20â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-A3D92.txt


[3/26/2022 12:21â€¯AM] szybet
this is the default config kernel


[3/26/2022 12:25â€¯AM] szybet
something is compiling wrong in my opinion


[3/26/2022 12:39â€¯AM] szybet
kernel build log:

{Attachments}
/mnt/data/projects/git/conversations/media/message-55443.txt


[3/26/2022 12:42â€¯AM] szybet
u-boot is saying something interesting: or maybe not
```eBR-1A # boot
switch to partitions #0, OK
mmc0 is current device
mmc read 0x80800000 0x14000 0x5000

MMC read: dev # 0, block # 81920, count 20480 ... 20480 blocks read: OK
Booting from mmc ...
mmc read 0x83000000 0x505 0x1

MMC read: dev # 0, block # 1285, count 1 ... 1 blocks read: OK
dtb size = 41589@83000000
mmc read 0x83000000 0x506 0x57

MMC read: dev # 0, block # 1286, count 87 ... 87 blocks read: OK

 hwcfgp=8ffffe00,pcb=81,customer=9

ntx_gpio_get_value(404) : error parameter ! null ptr !
ESDin=0,UPGKey=-1,PWRKey=0,USBin=0x1,BootESD=0,MenuKey=0
mmc read 0x8ffffc00 0x37ff 0x1

MMC read: dev # 0, block # 14335, count 1 ... 1 blocks read: OK
mmc read 0x8ff71a00 0x3800 0x472

MMC read: dev # 0, block # 14336, count 1138 ... 1138 blocks read: OK
mmc read 0x8ff71800 0x405 0x1

MMC read: dev # 0, block # 1029, count 1 ... 1 blocks read: OK
[WARNING] Binaries load sequence should Lo->Hi !
mmc read 0x8ff71400 0x406 0x3

MMC read: dev # 0, block # 1030, count 3 ... 3 blocks read: OK
Kernel RAM visiable size=255M->255M
ntx_gpio_init():R [ERROR] GPIO group number error (0)!!
ntx_gpio_init():B [ERROR] GPIO group number error (0)!!
hwcfg rootfstype : 2
hwcfg partition type : 2,bootmode=0
ntx_prebootm : cmd=setenv bootargs ${bootargs}  hwcfg_p=0x8ffffe00 hwcfg_sz=110 waveform_p=0x8ff71a00 waveform_sz=582529 ntxfw_p=0x8t
Kernel image @ 0x80800000 [ 0x000000 - 0x9b88d0 ]
## Flattened Device Tree blob at 83000000
   Booting using the fdt blob at 0x83000000
   Using Device Tree in place at 83000000, end 8300d274

Starting kernel ...
```


[3/26/2022 12:54â€¯AM] szybet
i have no idea


[3/26/2022 1:08â€¯AM] szybet
it cant go to the point of `Linux inkbox 4.1.15 #1 SMP PREEMPT Sat Feb 19 21:21:19 CET 2022 armv7l GNU/Linux`


[3/26/2022 1:11â€¯AM] szybet
idk, any suggestions @tux-linux


[3/26/2022 1:36â€¯AM] szybet
i have tryied removing some files from initrd/n306/opt/ becouse the previous problems were avoided in this way, but nothing


[3/26/2022 1:36â€¯AM] szybet
and the kernel binary is still 9,8 Mb after all


[3/26/2022 1:36â€¯AM] szybet
ğŸ‘€


[3/26/2022 3:44â€¯AM] tux_linux
Can you try completely deleting the repo and cloning it again?


[3/26/2022 3:45â€¯AM] tux_linux
Don't forget to do this again before you compile it


[3/26/2022 11:23â€¯AM] szybet
I did this already, and nothing


[3/26/2022 11:50â€¯AM] tux_linux
`ls initrd/n306/dev`


[3/26/2022 11:51â€¯AM] szybet
The 3 nodes are there, i checked it


[3/26/2022 11:51â€¯AM] tux_linux
`cat kernel/config/config-n306 | grep CMD`


[3/26/2022 11:52â€¯AM] szybet
```
% ls -l initrd/n306/dev
razem 0
crw-r--r-- 1 root root   5,  1 03-26 11:51 console
crw-r--r-- 1 root root   1,  3 03-26 11:51 null
crw-r--r-- 1 root root 207, 16 03-26 11:51 ttymxc
```


[3/26/2022 11:52â€¯AM] szybet
i recloned the repo...
```
% cat kernel/config/config-n306| grep CMD
# CONFIG_BLK_CMDLINE_PARSER is not set
CONFIG_CMDLINE="console=ttymxc0,115200 rootwait rw no_console_suspend hwcfg_p=0x8ffffe00 hwcfg_sz=110 waveform_p=0x8ff71a00 waveform_sz=582529 ntxfw_p=0x8ff71400 ntxfw_sz=1034 mem=255M boot_port=1 rootfstype=ramfs root=/dev/ram0 rdinit=/sbin/init printk.time quiet"
# CONFIG_CMDLINE_FROM_BOOTLOADER is not set
# CONFIG_CMDLINE_EXTEND is not set
CONFIG_CMDLINE_FORCE=y
# CONFIG_BCMDHD is not set
CONFIG_FB_CMDLINE=y
11:52 szybet@ArchSzybet /mnt/HDD/Project/Public/kobo-nia-audio/inkbox/kernel
% 

```


[3/26/2022 11:53â€¯AM] tux_linux
There is ttymxc0, right?


[3/26/2022 11:53â€¯AM] tux_linux
Not just ttymxc


[3/26/2022 11:53â€¯AM] szybet
the command to compile:
```
env GITDIR="${PWD}" TOOLCHAINDIR="${PWD}/toolchain/arm-nickel-linux-gnueabihf/" THREADS=$(($(nproc)*2)) TARGET=arm-nickel-linux-gnueabihf scripts/build_kernel.sh n306 root
```
the command to write:
```
sudo dd if=zImage-root of=/dev/sdd bs=512 seek=81920
```


[3/26/2022 11:54â€¯AM] szybet
yes

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-EA0FD.png


[3/26/2022 11:55â€¯AM] tux_linux
Did you change the location of the initrd folder in the kernel config?
Is `/home/build/inkbox` a working symlink?


[3/26/2022 11:56â€¯AM] szybet
yes, otherwise it doesn't compile at all


[3/26/2022 11:57â€¯AM] szybet
initrd? where to change it?


[3/26/2022 11:57â€¯AM] szybet
its in the kernel repo


[3/26/2022 11:58â€¯AM] tux_linux
It's fine
Since you have a symlink, it works


[3/26/2022 11:58â€¯AM] szybet
the kernel size is always 9,8 M


[3/26/2022 12:22â€¯PM] szybet
is the dd kernel command good?


[3/26/2022 12:22â€¯PM] szybet
i first did
```
dd if=inkbox_maybe_working.img of=kernel_inkbox_working count=10000000 skip=81920 iflag=skip_bytes,count_bytes
```
to get the working kernel from a working inkbox image


[3/26/2022 12:23â€¯PM] szybet
then 
```
sudo dd if=kernel_inkbox_working of=/dev/sdd bs=512 seek=81920
```


[3/26/2022 12:23â€¯PM] szybet
but nothing


[3/26/2022 12:23â€¯PM] szybet
no change


[3/26/2022 12:57â€¯PM] szybet
Maybe you could compile the kernel... there is maybe something wrong with my linux on pc


[3/26/2022 1:14â€¯PM] szybet
its ```83000000``` booting from but we are writing to ```81920```


[3/26/2022 2:08â€¯PM] szybet
Why root at the end od the command and not std, it is like on your github


[3/26/2022 2:34â€¯PM] tux_linux
83000000 is the memory address


[3/26/2022 2:35â€¯PM] tux_linux
Yes, I can try


[3/26/2022 2:53â€¯PM] szybet
So?


[3/26/2022 3:14â€¯PM] szybet
what the fuck is going on


[3/26/2022 3:14â€¯PM] szybet
i compiled the kernel on my brothers laptop


[3/26/2022 3:15â€¯PM] szybet
same device, same os but its a bit older and with less packages installed


[3/26/2022 3:15â€¯PM] szybet
and the kernel booted

{Reactions}
ğŸ˜‚ 

[3/26/2022 3:15â€¯PM] szybet
***its time to use docker for kernel build***


[3/26/2022 3:16â€¯PM] szybet
https://tenor.com/view/face-palm-shake-my-head-smdh-smh-muppets-gif-21657764

{Embed}
https://tenor.com/view/face-palm-shake-my-head-smdh-smh-muppets-gif-21657764
/mnt/data/projects/git/conversations/media/face-palm-shake-my-head-64455.png


[3/26/2022 3:50â€¯PM] tux_linux
Maybe lxc could be better


[3/26/2022 3:50â€¯PM] szybet
maybe


[3/26/2022 3:50â€¯PM] szybet
but still, i want my wasted time back


[3/26/2022 3:50â€¯PM] tux_linux
How much time since you rebooted your laptop


[3/26/2022 3:51â€¯PM] tux_linux
I had no way of knowing this


[3/26/2022 3:54â€¯PM] szybet
i know i know, its just computer problems


[3/26/2022 3:54â€¯PM] szybet
i have tryied yestarday, rebooted today, rebooted, and again


[3/26/2022 3:54â€¯PM] szybet
so no, no reboot has to do with it


[3/26/2022 5:24â€¯PM] tux_linux
I think I will start making the update packages/images for 1.9 now, unless there's something absolutely critical to solve?...

{Reactions}
ğŸ‘ 

[3/26/2022 5:34â€¯PM] tux_linux
As for the sleep/touchscreen issues, I don't know what to do, even KOReader seems to do it all the time: https://github.com/koreader/koreader/blob/fb45576429b4302cd7dd7f09999206a5d60e9960/frontend/device/kobo/device.lua#L762-L775


[3/26/2022 5:35â€¯PM] szybet
i think i can figure it out adding one kernel option with the touchscreen


[3/26/2022 5:37â€¯PM] tux_linux
this?


[3/26/2022 5:37â€¯PM] szybet
yes


[3/26/2022 5:37â€¯PM] szybet
then I echo disable > wakeup to the touchscreen device


[3/26/2022 5:40â€¯PM] tux_linux
it works?


[3/26/2022 5:42â€¯PM] tux_linux
https://inkbox.ddns.net/wiki/index.php?title=General_information#Standard_and_Rooted
Default is std

{Embed}
https://inkbox.ddns.net/wiki/index.php?title=General_information
General information


[3/26/2022 5:48â€¯PM] szybet
oh thats it


[3/26/2022 5:48â€¯PM] tux_linux
what?


[3/26/2022 5:49â€¯PM] szybet
std and root option


[3/26/2022 5:49â€¯PM] tux_linux
oh ok


[3/26/2022 5:54â€¯PM] tux_linux
can you try it?


[3/26/2022 5:54â€¯PM] szybet
i will, first i tinker with lxc to get the kernel to even boot


[3/26/2022 5:55â€¯PM] tux_linux
hmm


[3/26/2022 5:55â€¯PM] tux_linux
do you need a kernel? i can compile one, just give me the config file


[3/26/2022 6:07â€¯PM] szybet
i will compile it on my own

{Reactions}
ğŸ‘ 

[3/26/2022 6:07â€¯PM] szybet
lxc is horrible


[3/26/2022 6:07â€¯PM] tux_linux
then maybe try a vm?


[3/26/2022 6:07â€¯PM] szybet
documentation is for old commands, outdated


[3/26/2022 6:07â€¯PM] szybet
forums too


[3/26/2022 6:07â€¯PM] szybet
just npo


[3/26/2022 6:48â€¯PM] szybet
i will add this to the guide later: 
install distrobox:  https://github.com/89luca89/distrobox
create a image:
```
distrobox-create --image debian:latest
distrobox-enter debian-latest
```
install some packages:
``` 
sudo apt update
sudo apt upgrade
sudo apt install bc git build-essential u-boot-tools libncurses5-dev libncursesw5-dev
```
create the symlink:
```
sudo mkdir -p /home/build/inkbox/
sudo ln -s path_to_kernel_repo /home/build/inkbox/kernel
```

thats it, now cpp magic won't waste your time


[3/26/2022 6:59â€¯PM] tux_linux
So it boots fine?


[3/26/2022 7:00â€¯PM] szybet
now, yes


[3/26/2022 7:00â€¯PM] tux_linux
Ok nice


[3/26/2022 7:37â€¯PM] szybet
look:
```
kobo:~# cat /sys/kernel/debug/wakeup_sources
name            active_count    event_count     wakeup_count    expire_count    active_since    total_time      max_time        last_change     prevent_suspend_time
gpio-keys       0               0               0               0               0               0               0               5957            0
mc13892_charger 1               1               0               0               0               8               8               5701            0
usbpwr          1               1               0               0               0               7               7               5700            0
acpwr           1               1               0               0               0               5               5               5698            0
mc13892_bat     14              14              0               0               0               500             188             561099          0
20cc000.snvs:snvs-rtc-lp        0               0               0               0               0               0               0               5603       0
alarmtimer      0               0               0               0               0               0               0               4996            0
rtc_ricoh619    0
```
i disabled them all:
```
kobo:~# cat /sys/kernel/debug/wakeup_sources
name            active_count    event_count     wakeup_count    expire_count    active_since    total_time      max_time        last_change     prevent_suspend_time
alarmtimer      0               0               0               0               0               0               0               4996     
```
but its still waking up


[3/26/2022 7:39â€¯PM] szybet
well, this did nothing


[3/26/2022 7:40â€¯PM] tux_linux
strange


[3/26/2022 7:40â€¯PM] tux_linux
kobo kernels are, by definition, strange and unusual in all sorts of not-so-nice ways


[3/26/2022 7:40â€¯PM] tux_linux
I don't know what to tell you


[3/26/2022 7:41â€¯PM] szybet
there are some new files:


[3/26/2022 7:41â€¯PM] szybet
```
kobo:~# ls /sys/power/
pm_async           pm_print_times     state              wake_lock          wakeup_count
pm_freeze_timeout  pm_test            state-extended     wake_unlock
kobo:~# `
```


[3/26/2022 7:42â€¯PM] szybet
but i cant find documentation for wake* files


[3/26/2022 7:45â€¯PM] szybet
i checked on nickel, it does not happen


[3/26/2022 7:45â€¯PM] szybet
wakeup becouse of touchscreen


[3/26/2022 7:46â€¯PM] tux_linux
maybe it puts it to sleep automatically if it somehow detects that the wakeup source was the touchscreen?


[3/26/2022 7:46â€¯PM] tux_linux
but that's soo dirty


[3/26/2022 7:46â€¯PM] szybet
i think kobo developers are not dumb


[3/26/2022 7:46â€¯PM] tux_linux
but, sometimes, they seem to be in a big hurry


[3/26/2022 7:47â€¯PM] szybet
well


[3/26/2022 7:48â€¯PM] szybet
what manages sleep on nickel, i would want to know


[3/26/2022 7:58â€¯PM] szybet
Is there a way to know which device has awaken the device?


[3/26/2022 7:58â€¯PM] tux_linux
i don't know a lot about the wakeup system honestly


[3/26/2022 8:24â€¯PM] szybet
maybe udev has something with it?


[3/26/2022 8:24â€¯PM] szybet
and this, on a kobo ereader:

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-6B6E2.png


[3/26/2022 8:24â€¯PM] szybet
nice


[3/26/2022 8:26â€¯PM] tux_linux
where do you see that?


[3/26/2022 8:26â€¯PM] szybet
nickel filesystem


[3/26/2022 8:26â€¯PM] szybet
i have a image


[3/26/2022 8:26â€¯PM] tux_linux
which file


[3/26/2022 8:27â€¯PM] tux_linux
probably


[3/26/2022 8:27â€¯PM] szybet
a udev rule

{Reactions}
ğŸ‘ 

[3/26/2022 8:32â€¯PM] szybet
is there a way to disable the touchscreen?... anything...

{Reactions}
ğŸ¤·â€â™‚ï¸ 

[3/26/2022 8:43â€¯PM] szybet
GPIO's seem to be "written in hurry" too


[3/26/2022 8:44â€¯PM] szybet
gpio_keys dont show up in ./bus/platform/devices/gpio-keys


[3/26/2022 8:54â€¯PM] szybet
my last idea: unbind the touchscreen driver

{Attachments}
/mnt/data/projects/git/conversations/media/message-432E7.txt


[3/26/2022 8:54â€¯PM] szybet
but which device is it ._ .


[3/26/2022 8:54â€¯PM] szybet
ntx_event0 not


[3/26/2022 8:54â€¯PM] tux_linux
have a look at the kernel source maybe?


[3/26/2022 8:54â€¯PM] szybet
how do i know which files are actually used while building?


[3/26/2022 8:55â€¯PM] szybet
if i could seperate them, then maybe


[3/26/2022 8:55â€¯PM] tux_linux
lemme find a pcb picture


[3/26/2022 8:55â€¯PM] szybet
????????????...


[3/26/2022 8:55â€¯PM] tux_linux
to find the touchscreen microcontroller


[3/26/2022 8:56â€¯PM] szybet
for the driver unbind? i think it will not help


[3/26/2022 8:57â€¯PM] tux_linux
it will help to find the touchscreen driver name, probably


[3/26/2022 8:57â€¯PM] tux_linux
do you have one?


[3/26/2022 8:58â€¯PM] szybet
there are like 5 main chips on the device, and 3 small, one smaller than a diode


[3/26/2022 8:58â€¯PM] szybet
i have the kobo physically


[3/26/2022 8:58â€¯PM] szybet
but yea, wait

{Reactions}
ğŸ‘ 

[3/26/2022 8:58â€¯PM] szybet
only on one side*


[3/26/2022 8:58â€¯PM] szybet
https://github.com/Szybet/kobo-nia-audio/tree/main/images/nia

{Embed}
https://github.com/Szybet/kobo-nia-audio/tree/main/images/nia
kobo-nia-audio/images/nia at main Â· Szybet/kobo-nia-audio
Kobo nia ereader with audio added. Contribute to Szybet/kobo-nia-audio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/kobo-nia-audio-4BDFE


[3/26/2022 9:01â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-D63AD.png


[3/26/2022 9:01â€¯PM] szybet
okay discord, cool


[3/26/2022 9:01â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-8EF4F.png


[3/26/2022 9:01â€¯PM] szybet
cool...


[3/26/2022 9:02â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/img4-AC414.jpg


[3/26/2022 9:02â€¯PM] szybet
now


[3/26/2022 9:02â€¯PM] szybet
those are all IC on the device


[3/26/2022 9:03â€¯PM] szybet
oh, and the big one on ribbon up right


[3/26/2022 9:04â€¯PM] tux_linux
try to see if some controller name matches something in `/sys/devices/platform`, here's it's too small to read


[3/26/2022 9:30â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/Kobo_nia-31FD2.pdf


[3/26/2022 9:31â€¯PM] szybet
this won't help much


[3/26/2022 9:31â€¯PM] szybet
but its pretty cool


[3/26/2022 9:31â€¯PM] szybet
why is there a rainbow in those codes


[3/26/2022 9:32â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/Kobo_nia-A5560.pdf


[3/26/2022 9:32â€¯PM] szybet
here is a better one


[3/26/2022 9:44â€¯PM] szybet
FOUND IT


[3/26/2022 9:44â€¯PM] szybet
pure luck


[3/26/2022 9:44â€¯PM] szybet
`/sys/bus/i2c/drivers/elan-touch`


[3/26/2022 9:45â€¯PM] szybet
its `/sys/devices/platform/soc/2100000.aips-bus/21a0000.i2c/i2c-0/0-0015`


[3/26/2022 9:45â€¯PM] szybet
```
kobo:/sys/bus/i2c/drivers/elan-touch# echo 0-0015 > unbind 
kobo:/sys/bus/i2c/drivers/elan-touch# echo 0-0015 > bind
ash: write error: No such device
``` 
this just cant be easy :C


[3/26/2022 9:46â€¯PM] szybet
and the kernel panicked or smth


[3/26/2022 9:46â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-21554.txt


[3/26/2022 10:12â€¯PM] tux_linux
is the ereader still working?


[3/26/2022 10:12â€¯PM] szybet
it rebooted and yes


[3/26/2022 10:12â€¯PM] szybet
why do you ask :)?


[3/26/2022 10:12â€¯PM] tux_linux
no, I wanted to know if the kernel 'panic' had an effect on the working system


[3/26/2022 10:13â€¯PM] tux_linux
like, if it went by without issue or it required a reboot


[3/26/2022 10:13â€¯PM] szybet
it forced a reboot


[3/26/2022 10:13â€¯PM] tux_linux
hmm ok that is critical


[3/26/2022 10:14â€¯PM] szybet
i see a file called delete_device in the i2c parrent, i think this is the proper way to remove a device
```
kobo:/sys/devices/platform/soc/2100000.aips-bus/21a0000.i2c/i2c-0# ls
0-0015         0-0062         delete_device  name           of_node        subsystem
0-0036         0-0068         i2c-dev        new_device     power          uevent

```
but how to use it


[3/26/2022 10:14â€¯PM] szybet
where documentation


[3/26/2022 10:14â€¯PM] tux_linux
what makes you think that there is documentation available ? ;p


[3/26/2022 10:14â€¯PM] tux_linux
try it?


[3/26/2022 10:14â€¯PM] szybet
its the linux kernel...
its opensource...
:(


[3/26/2022 10:15â€¯PM] szybet
invalid argument


[3/26/2022 10:15â€¯PM] tux_linux
what did you write?


[3/26/2022 10:15â€¯PM] szybet
0-0015 or elan-touch


[3/26/2022 10:15â€¯PM] szybet
maybe the hex address of the device


[3/26/2022 10:15â€¯PM] szybet
but i need to find it


[3/26/2022 10:15â€¯PM] tux_linux
https://stackoverflow.com/questions/58843718/how-can-i-dynamically-remove-or-retrigger-the-probing-an-eeprom-via-sysfs

{Embed}
https://stackoverflow.com/questions/58843718/how-can-i-dynamically-remove-or-retrigger-the-probing-an-eeprom-via-sysfs
How can I dynamically remove or retrigger the probing an EEPROM via...
I am wondering what the proper way is to remove EEPROMs dynamically.  An alternate approach that will also work is telling the device to re-do the probe.  I tried just echoing it to delete_device, ...
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[3/26/2022 10:15â€¯PM] szybet
i was there already ;p


[3/26/2022 10:15â€¯PM] tux_linux
maybe just 0x15 ?


[3/26/2022 10:15â€¯PM] szybet
the first option doesn't work as you see


[3/26/2022 10:16â€¯PM] szybet
tryied it, nope


[3/26/2022 10:16â€¯PM] szybet
but here is another error:
```
kobo:/sys/devices/platform/soc/2100000.aips-bus/21a0000.i2c/i2c-0# echo 0x15 > delete_device 
ash: write error: No such file or directory

```


[3/26/2022 10:17â€¯PM] tux_linux
https://erlerobotics.gitbooks.io/erle-robotics-erle-brain-a-linux-brain-for-drones/content/en/tutorials/i2c.html

{Embed}
https://erlerobotics.gitbooks.io/erle-robotics-erle-brain-a-linux-brain-for-drones/content/en/tutorials/i2c.html
How to instantiate I2C from the userspace Â· Erle Robotics: Erle-bra...


[3/26/2022 10:17â€¯PM] tux_linux
hmm


[3/26/2022 10:17â€¯PM] szybet
i was there... wait there is the delete too


[3/26/2022 10:17â€¯PM] szybet
hm, good now what is the proper address


[3/26/2022 10:19â€¯PM] tux_linux
look in the dts in the kernel source


[3/26/2022 10:19â€¯PM] tux_linux
there you will probably find it


[3/26/2022 10:19â€¯PM] szybet
and dts is?


[3/26/2022 10:19â€¯PM] tux_linux
DeviceTree Source


[3/26/2022 10:21â€¯PM] tux_linux
what's the identifier written on the PCB?


[3/26/2022 10:21â€¯PM] tux_linux
ok got it


[3/26/2022 10:21â€¯PM] szybet
is it imporant?


[3/26/2022 10:22â€¯PM] tux_linux
do you have ddr3 ram?


[3/26/2022 10:22â€¯PM] szybet
i think its 2
yes: https://github.com/Szybet/kobo-nia-audio/blob/6503a0fa8c29f80764087a916ef1f8bb350310a8/logs/ntx_hwconfig#L32


[3/26/2022 10:23â€¯PM] tux_linux
ok so take `arch/arm/boot/dts/imx6ull-ntx.dtsi`


[3/26/2022 10:25â€¯PM] szybet
thats a cool file


[3/26/2022 10:25â€¯PM] tux_linux
but it seems it isn't referenced
maybe
`arch/arm/boot/dts/imx6ull-ntx-ddr3.dts`


[3/26/2022 10:25â€¯PM] tux_linux
though it still seems to be 0x15

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-149DC.png


[3/26/2022 10:26â€¯PM] szybet
yes


[3/26/2022 10:26â€¯PM] szybet
maybe removing them is disabled? lets look to kernel config


[3/26/2022 10:28â€¯PM] szybet
here is nothing


[3/26/2022 10:28â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-AE38B.png


[3/26/2022 10:28â€¯PM] szybet
wait... what are those gpio's there?


[3/26/2022 10:28â€¯PM] szybet
i2c pins?


[3/26/2022 10:33â€¯PM] tux_linux
Maybe


[3/26/2022 10:34â€¯PM] tux_linux
Be careful with that, sometimes you can physically damage the device if you do the wrong thing


[3/26/2022 10:34â€¯PM] szybet
yes but actually yes and no... most important if the regulators have good maximum voltages assing


[3/26/2022 10:42â€¯PM] szybet
hmm

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-8A9F1.png


[3/26/2022 10:42â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-79AF7.png


[3/26/2022 10:42â€¯PM] szybet
HMMMMM


[3/26/2022 10:43â€¯PM] szybet
modules


[3/26/2022 10:43â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-2081A.png


[3/26/2022 10:44â€¯PM] szybet
well, first you need to give instructions how to create modules.sqash


[3/26/2022 10:44â€¯PM] szybet
just modules_install and then the whole directory into squash?


[3/26/2022 10:48â€¯PM] tux_linux
No, why?


[3/26/2022 10:48â€¯PM] szybet
?


[3/26/2022 10:48â€¯PM] tux_linux
That will probably conflict with the current driver


[3/26/2022 10:49â€¯PM] szybet
i knwo, but still its something


[3/26/2022 10:49â€¯PM] szybet
at default this is built in


[3/26/2022 10:49â€¯PM] szybet
i want to module it


[3/26/2022 10:49â€¯PM] szybet
so how do i make modules.squash


[3/26/2022 11:13â€¯PM] tux_linux
Before, just try to insmod it without putting it into modules.sqsh


[3/26/2022 11:14â€¯PM] szybet
um, so MODULES_INSTALL, copy the files to device?


[3/26/2022 11:14â€¯PM] tux_linux
Yeah


[3/26/2022 11:14â€¯PM] tux_linux
SCP, etc


[3/26/2022 11:14â€¯PM] szybet
well, tommorow

{Reactions}
ğŸ‘ 

[3/26/2022 11:15â€¯PM] tux_linux
Can you see if it panics again now, or was it just a coincidence?


[3/26/2022 11:16â€¯PM] szybet
it panics multiple times


[3/26/2022 11:16â€¯PM] tux_linux
Ok


[3/26/2022 11:16â€¯PM] szybet
actually, if i try to access the file system then it panicks


[3/26/2022 11:16â€¯PM] tux_linux
Hopefully you'll find something that will make it work


[3/26/2022 11:16â€¯PM] tux_linux
Well, doesn't really help here lol


[3/26/2022 11:17â€¯PM] szybet
```
ls: can't open '/': Connection aborted
```

{Reactions}
ğŸ‘ 

[3/26/2022 11:17â€¯PM] szybet
and after this there is the kernel panik


[3/27/2022 1:16â€¯AM] ninuje
something something wakeup pins in the dts maybe?


[3/27/2022 1:16â€¯AM] ninuje
No experience with the elan driver, I *think* it's the one found on the Sage & Elipsa, though, and I'm pretty sure it's PM'ed properly on stock images there.

{Reactions}
ğŸ‘ 

[3/27/2022 11:37â€¯AM] szybet
```
  Building modules, stage 2.
  MODPOST 28 modules
ERROR: "gSleep_Mode_Suspend" [drivers/input/touchscreen/elan_touch_i2c.ko] undefined!
ERROR: "gIsCustomerUi" [drivers/input/touchscreen/elan_touch_i2c.ko] undefined!
ERROR: "gptHWCFG" [drivers/input/touchscreen/elan_touch_i2c.ko] undefined!
make[1]: *** [scripts/Makefile.modpost:90: __modpost] Error 1
make: *** [Makefile:1103: modules] Error 2
[szybet@debian-latest linux-4.1.15-n306]$ 

```


[3/27/2022 11:37â€¯AM] szybet
:/


[3/27/2022 11:41â€¯AM] szybet
this file does not exist at all


[3/27/2022 11:50â€¯AM] szybet
```
#include "../../../arch/arm/mach-imx/ntx_hwconfig.h"
extern volatile NTX_HWCONFIG *gptHWCFG;
``` weird


[3/27/2022 11:55â€¯AM] szybet
this can be resolved, but i dont know cpp to good for this


[3/27/2022 11:55â€¯AM] szybet
this is pure c maybe


[3/27/2022 11:58â€¯AM] szybet
so 3 problems: 3 variables are undefined in `kernel/kernel/linux-4.1.15-n306/drivers/input/touchscreen/elan_touch_i2c.c`:

line 768:
```c
extern int gSleep_Mode_Suspend;
```

line 50
```c
extern int gIsCustomerUi;
```

line 27 ( this one is the weirdiest )
```c
#include "../../../arch/arm/mach-imx/ntx_hwconfig.h"
extern volatile NTX_HWCONFIG *gptHWCFG;
```


[3/27/2022 12:05â€¯PM] szybet
here is the full file

{Attachments}
/mnt/data/projects/git/conversations/media/elan_touch_i2c-4CDBC.c


[3/27/2022 12:32â€¯PM] szybet
disabling the touchscreen would be easy with udev... https://ask.fedoraproject.org/t/disabling-device-with-udev/1975


[3/27/2022 1:29â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-8A0B2.png


[3/27/2022 2:05â€¯PM] tux_linux
Try, udev is supposedly there in the rootfs


[3/27/2022 2:06â€¯PM] szybet
yes, and it doesn't work


[3/27/2022 2:10â€¯PM] tux_linux
What specifically?


[3/27/2022 2:11â€¯PM] szybet
```udevadm test --action="remove" /devices/platform/ntx_event0/input/input```


[3/27/2022 2:11â€¯PM] szybet
well, udev isin't mean't for this


[3/27/2022 2:12â€¯PM] szybet
we need to try with the modules


[3/27/2022 2:12â€¯PM] szybet
or


[3/27/2022 2:12â€¯PM] szybet
in the files `elan*` are many thing related to wakeup, i dont really understand them


[3/27/2022 2:15â€¯PM] tux_linux
Neither do I
And neither do I have an idea about what in the world is happening with undefined variables. NTX/Kobo kernel code is a mess.


[3/27/2022 2:15â€¯PM] tux_linux
Maybe you can try with gpio pins?


[3/27/2022 2:15â€¯PM] szybet
you mean?


[3/27/2022 2:15â€¯PM] szybet
the touch screen is i2c


[3/27/2022 3:20â€¯PM] szybet
interesting bug
```
[  250.760770] Freezing of tasks failed after 20.008 seconds (1 tasks refusing to freeze, wq_busy=0):
[  250.769848] udevd           D 8056fa00     0   814      1 0x00000001
[  250.769897] [<8056fa00>] (__schedule) from [<8056fd8c>] (schedule+0x40/0x98)
[  250.769917] [<8056fd8c>] (schedule) from [<801bcfdc>] (__fuse_request_send+0x13c/0x2c8)
[  250.769938] [<801bcfdc>] (__fuse_request_send) from [<801bfe08>] (fuse_simple_request+0xc8/0x1dc)
[  250.769958] [<801bfe08>] (fuse_simple_request) from [<801c2208>] (fuse_lookup_name+0xb8/0x16c)
[  250.769975] [<801c2208>] (fuse_lookup_name) from [<801c22f4>] (fuse_lookup+0x38/0xdc)
[  250.769995] [<801c22f4>] (fuse_lookup) from [<800ef928>] (lookup_real+0x20/0x4c)
[  250.770015] [<800ef928>] (lookup_real) from [<800f082c>] (__lookup_hash+0x34/0x3c)
[  250.770033] [<800f082c>] (__lookup_hash) from [<800f086c>] (lookup_slow+0x38/0xa4)
[  250.770050] [<800f086c>] (lookup_slow) from [<800f42e0>] (path_lookupat+0x5b8/0x704)
[  250.770066] [<800f42e0>] (path_lookupat) from [<800f4448>] (filename_lookup+0x1c/0x64)
[  250.770080] [<800f4448>] (filename_lookup) from [<800f5840>] (user_path_at_empty+0x54/0x7c)
[  250.770096] [<800f5840>] (user_path_at_empty) from [<800f587c>] (user_path_at+0x14/0x1c)
[  250.770112] [<800f587c>] (user_path_at) from [<800ebb08>] (vfs_fstatat+0x44/0x98)
[  250.770131] [<800ebb08>] (vfs_fstatat) from [<800ec1e0>] (SyS_stat64+0x14/0x30)
[  250.770151] [<800ec1e0>] (SyS_stat64) from [<8000f440>] (ret_fast_syscall+0x0/0x3c)
[  250.770181] 
[  250.770190] Restarting tasks ... done.
``` and:
```
kobo:~# [  250.760770] Freezing of tasks failed after 20.008 seconds (1 tasks refusing to freeze, wq_busy=0):
```


[3/27/2022 3:23â€¯PM] szybet
I did this


[3/27/2022 3:23â€¯PM] szybet
i dont know how


[3/27/2022 3:24â€¯PM] szybet
._ .


[3/27/2022 3:25â€¯PM] szybet
it works


[3/27/2022 3:25â€¯PM] szybet
bruhhhhh


[3/27/2022 3:25â€¯PM] szybet
i will make a pull request later


[3/27/2022 5:05â€¯PM] tux_linux
What did you do??


[3/27/2022 6:46â€¯PM] szybet
Random // in elan drivers where wake enabled was


[3/27/2022 6:52â€¯PM] szybet
I got to this becouse od proc interrupts and in the irq in files


[3/27/2022 6:53â€¯PM] tux_linux
lool


[3/27/2022 7:23â€¯PM] tux_linux
make a pull request when you can


[3/27/2022 7:57â€¯PM] szybet
maybe not today, tommorow


[3/27/2022 8:48â€¯PM] tux_linux
Can you pull the kernel repo and see if the kernel still boots with the new 203K binary (qr-to-png) I added?


[3/27/2022 8:50â€¯PM] szybet
tommorow propably


[3/27/2022 8:50â€¯PM] tux_linux
if i compile it for you?


[3/27/2022 8:51â€¯PM] szybet
also the kernel size... max is 10,5M currently its 9,8M, and i want to add alsa and soundcard support


[3/27/2022 8:51â€¯PM] szybet
this doesn't look good for the future


[3/27/2022 8:51â€¯PM] szybet
then propably today


[3/27/2022 8:51â€¯PM] tux_linux
0.7M is probably already too small


[3/27/2022 8:52â€¯PM] tux_linux
Maybe you can put them in a `[p1]/modules` folder, I don't know


[3/27/2022 8:52â€¯PM] szybet
what is next to the kernel?


[3/27/2022 8:52â€¯PM] tux_linux
partition 3 iirc


[3/27/2022 8:52â€¯PM] szybet
waveform?


[3/27/2022 8:52â€¯PM] szybet
not good


[3/27/2022 8:53â€¯PM] tux_linux
yeah, well, when I set up a partition layout I didn't think the kernels would become so huge


[3/27/2022 8:53â€¯PM] tux_linux
compiling right now


[3/27/2022 8:54â€¯PM] szybet
there are 2 options:
1 we make the partition layout in a other way now
2 in the future we will do this anyway, e-readers are becoming more complicated and have more features. Even never kernels are bigger


[3/27/2022 8:55â€¯PM] tux_linux
the thing is that I don't want to re-upload a system image for existing supported models


[3/27/2022 8:56â€¯PM] szybet
now not many people use inkbox, it will not hurt many. in the future it will


[3/27/2022 8:56â€¯PM] tux_linux
i guess 10.5M is also really huge for a kernel on an embedded device


[3/27/2022 8:56â€¯PM] tux_linux
when you think about it, it eats 10M of your RAM


[3/27/2022 8:57â€¯PM] tux_linux
so it is probably not a good idea to keep it growing


[3/27/2022 8:57â€¯PM] tux_linux
we'll have to find other ways to do what we want to do


[3/27/2022 8:57â€¯PM] szybet
modules etc on a partition


[3/27/2022 8:58â€¯PM] tux_linux
the thing is that each device has different modules


[3/27/2022 8:58â€¯PM] tux_linux
painful to update


[3/27/2022 8:58â€¯PM] tux_linux
but maybe


[3/27/2022 8:58â€¯PM] szybet
just update with the rootfs


[3/27/2022 8:58â€¯PM] szybet
+ this can be done with a script


[3/27/2022 8:59â€¯PM] tux_linux
i'll see


[3/27/2022 9:00â€¯PM] tux_linux
https://drive.google.com/file/d/1cUnJFokT8qt3CcANmFAqE62FaLb2-mbh/view?usp=sharing

{Embed}
https://drive.google.com/file/d/1cUnJFokT8qt3CcANmFAqE62FaLb2-mbh/view?usp=sharing
zImage-root


[3/27/2022 9:08â€¯PM] tux_linux
did you get any success?


[3/27/2022 9:09â€¯PM] szybet
it boots


[3/27/2022 9:20â€¯PM] tux_linux
ok, nice


[3/27/2022 9:20â€¯PM] tux_linux
thanks


[3/28/2022 11:52â€¯PM] szybet
is this normal that when going to sleep, when the 10-20s process is going if i click the touchscreen it cancels the sleeping?


[3/29/2022 12:23â€¯AM] tux_linux
No


[3/29/2022 12:23â€¯AM] tux_linux
But maybe it is good


[3/29/2022 6:30â€¯AM] tux_linux
I updated the GUI bundle with latest features, including 2048 and QReversi games
http://23.163.0.39/bundles/private/update-n306.isa


[3/29/2022 6:33â€¯AM] tux_linux
I modified 2048, now it is more optimized for eReaders
https://github.com/Kobo-InkBox/2048


[3/29/2022 6:34â€¯AM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/2048-04BE1.png


[3/29/2022 6:34â€¯AM] szybet
In what way


[3/29/2022 6:34â€¯AM] tux_linux
i don't know


[3/29/2022 6:34â€¯AM] szybet
I will test it today

{Reactions}
ğŸ‘ 

[3/29/2022 6:35â€¯AM] szybet
Then not good :p


[3/29/2022 6:35â€¯AM] tux_linux
well, you fix it, i've had enough nightmares with sleep issues
(yeah, get it? o_O) ;p

{Reactions}
ğŸ˜† (2) 

[3/29/2022 6:37â€¯AM] tux_linux
and I must have played at least half an hour total on it since it is implemented
this game is really addictive lol


[3/29/2022 1:09â€¯PM] szybet
I will redesign it completly


[3/29/2022 6:27â€¯PM] the.mightydill
yes, it definitely is lol


[4/1/2022 9:05â€¯PM] szybet
```
./wake_standby.sh: line 14: echo: write error: Operation not permitted
[FBInk] Couldn't find a Kobo version tag (onboard unmounted or not running on a Kobo?)!
[FBInk] Detected a Kobo Nia (382 => Luna @ Mark 7)
[FBInk] Enabled Kobo Mark 7 quirks
[FBInk] Clock tick frequency appears to be 100 Hz
[FBInk] Screen density set to 212 dpi
[FBInk] Variable fb info: 758x1024, 16bpp @ rotation: 3 (Counter Clockwise, 270Â°)
[FBInk] Fixed fb info: ID is "mxc_epdc_fb", length of fb mem: 3145728 bytes & line length: 1536 bytes
[FBInk] Canonical rotation: 0 (Upright, 0Â°)
[FBInk] Fontsize set to 16x16 (IBM base glyph size: 8x8)
[FBInk] Line length: 47 cols, Page size: 64 rows
[FBInk] Pen colors set to #000000 for the foreground and #FFFFFF for the background
[FBInk] Couldn't find a Kobo version tag (onboard unmounted or not running on a Kobo?)!
[FBInk] Detected a Kobo Nia (382 => Luna @ Mark 7)
[FBInk] Enabled Kobo Mark 7 quirks
[FBInk] Clock tick frequency appears to be 100 Hz
[FBInk] Screen density set to 212 dpi
[FBInk] Variable fb info: 758x1024, 16bpp @ rotation: 3 (Counter Clockwise, 270Â°)
[FBInk] Fixed fb info: ID is "mxc_epdc_fb", length of fb mem: 3145728 bytes & line length: 1536 bytes
[FBInk] Canonical rotation: 0 (Upright, 0Â°)
[FBInk] Fontsize set to 16x16 (IBM base glyph size: 8x8)
[FBInk] Line length: 47 cols, Page size: 64 rows
[FBInk] Pen colors set to #000000 for the foreground and #FFFFFF for the background
Displaying image '/tmp/dump.png' @ column 0 + 0px, row 0 + 0px (scaling: 0x0, H align: 0, V align: 0, inverted: N, flattened: N, waveform: AUTO, HW dithering: PASSTHROUGH, SW dithered: N, nightmode: N, skip refresh: N)
```

and at line 14:

`echo "mem" > /sys/power/state`


[4/1/2022 9:05â€¯PM] szybet
Interesting


[4/1/2022 9:07â€¯PM] szybet
propably the FBINK is related to the script later


[4/1/2022 9:07â€¯PM] szybet
but still


[4/1/2022 9:17â€¯PM] szybet
```
[ 2341.748944] Freezing user space processes ... (elapsed 0.001 seconds) done.
[ 2341.750868] Freezing remaining freezable tasks ... (elapsed 0.001 seconds) done.
[ 2341.752192] PM: Entering mem sleep
[ 2341.755135] [evdev_check_event-1232] event1 head D4, tail 3A
[ 2341.755169] dpm_run_callback(): input_dev_suspend+0x0/0xac returns -1
[ 2341.761767] PM: Device input1 failed to suspend: error -1
[ 2341.767180] PM: Some devices failed to suspend, or early wake event detected
[ 2341.847891] PM: resume of devices complete after 73.565 msecs
[ 2341.849635] PM: resume devices took 0.080 seconds
[ 2341.849653] PM: Finishing wakeup
```


[4/1/2022 9:17â€¯PM] szybet
this touch device...


[4/1/2022 10:29â€¯PM] tux_linux
On other devices it seems to be the framebuffer


[4/1/2022 10:29â€¯PM] szybet
here its only the touch


[4/1/2022 10:30â€¯PM] szybet
well, i can get the error message and if it appears it will try one more time to go to sleep


[4/1/2022 10:31â€¯PM] szybet
how do i add services to launch at boot, and commit it? where is the openrc config fle located


[4/1/2022 10:40â€¯PM] tux_linux
/etc/runlevels/default


[4/1/2022 10:40â€¯PM] tux_linux
Symlink your service there


[4/1/2022 10:40â€¯PM] szybet
okay


[4/1/2022 10:40â€¯PM] szybet
i will redesign the sleep thing


[4/1/2022 10:41â€¯PM] tux_linux
I discovered other issues with the reader; it seems that it still doesn't work when I open a PDF then an ePUB


[4/1/2022 10:41â€¯PM] tux_linux
Good luck


[4/1/2022 10:41â€¯PM] szybet
i said that before


[4/1/2022 10:41â€¯PM] szybet
i had issues with epubs only but yes


[4/1/2022 10:41â€¯PM] tux_linux
Yeah, and I fixed it


[4/1/2022 10:41â€¯PM] tux_linux
Strange


[4/1/2022 10:42â€¯PM] tux_linux
Also I have strange scaling in PDFs when I click on next page button
Will try to investigate this tonight


[4/1/2022 10:42â€¯PM] tux_linux
Right?


[4/1/2022 10:46â€¯PM] szybet
i had scalling issues in epubs too. no images, not enough text and the "end of document" toast appeared after every page change. i think it happened in the newest gui bundle


[4/1/2022 10:46â€¯PM] szybet
yes, but im saying now about another bug


[4/1/2022 10:46â€¯PM] tux_linux
Uh, not the end of document thing. I read on InkBox today and ePUB is fine


[4/1/2022 10:47â€¯PM] tux_linux
Not enough text, you can change ePUB page size in Settings


[4/1/2022 10:47â€¯PM] szybet
i tryied, nothing


[4/1/2022 10:47â€¯PM] tux_linux
And images are simply not supported, sorry. It's a limitation of the viewing engine


[4/1/2022 10:47â€¯PM] tux_linux
Really?


[4/1/2022 10:48â€¯PM] szybet
yes


[4/1/2022 10:48â€¯PM] tux_linux
For me it works


[4/1/2022 10:48â€¯PM] szybet
??? mudpdf is used in koreader and plato and i think its working there


[4/1/2022 10:51â€¯PM] tux_linux
It's not used in the same way


[4/1/2022 10:51â€¯PM] tux_linux
The GUI uses qtextedit


[4/1/2022 10:51â€¯PM] tux_linux
It displays a generated html by mupdf


[4/1/2022 10:52â€¯PM] szybet
qtextedit
image
another qtextedit


[4/1/2022 10:52â€¯PM] szybet
this could be done?


[4/1/2022 10:53â€¯PM] szybet
i think mupdf gives a reference to the image


[4/1/2022 10:53â€¯PM] szybet
if its html, maybe just use qtbrowser or something like that?


[4/1/2022 10:54â€¯PM] tux_linux
No, qtwebengine doesn't work on kobos


[4/1/2022 10:54â€¯PM] tux_linux
Also even if it did it would consume way too much battery


[4/1/2022 10:55â€¯PM] szybet
then this?


[4/1/2022 10:55â€¯PM] tux_linux
Maybe


[4/1/2022 10:55â€¯PM] szybet
i will use something like this in sanki

{Reactions}
ğŸ‘ 

[4/1/2022 11:06â€¯PM] szybet
can i use fbink command to write many times one thing? will it damage the e-ink?


[4/1/2022 11:06â€¯PM] szybet
also about e-inks. do magnets have a effect on them?


[4/1/2022 11:07â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-7469F.png


[4/1/2022 11:07â€¯PM] szybet
what does this line do


[4/1/2022 11:08â€¯PM] szybet
`chroot /kobo /usr/bin/fbgrab "/external_root/tmp/dump.png"` this command does nothing?...


[4/1/2022 11:27â€¯PM] tux_linux
Takes a screenshot


[4/1/2022 11:27â€¯PM] tux_linux
Empties file


[4/1/2022 11:27â€¯PM] tux_linux
I haven't seen damage, but apparently it is possible


[4/1/2022 11:28â€¯PM] tux_linux
From what I've read, strong ones do have some effect


[4/1/2022 11:32â€¯PM] szybet
this makes sense


[4/1/2022 11:33â€¯PM] szybet
how strong ones?


[4/1/2022 11:33â€¯PM] szybet
i want to make a modular etui


[4/1/2022 11:34â€¯PM] tux_linux
Don't know
The magnet in cases is ok enough for sure


[4/1/2022 11:36â€¯PM] szybet
```
/opt/bin/fbink/fbink -k -f -q
/opt/bin/fbink/fbink -t regular=/etc/init.d/splash.d/fonts/resources/inter-b.ttf,size=20 "Sleeping" -m -M -q
```
can i put this just before going to sleep?


[4/1/2022 11:37â€¯PM] tux_linux
Please use this script syntax:
`"${VAR}"` for var expansion (double quote unless you know it will be an int)
`"$(command)"` for invoking command in a var


[4/1/2022 11:37â€¯PM] tux_linux
I think?
But not after sleep 10


[4/1/2022 11:38â€¯PM] szybet
sure

{Reactions}
ğŸ‘ 

[4/1/2022 11:40â€¯PM] tux_linux
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/update.sh
This is a good example of the syntax I want
Everything is there, except some places when I forgot to double quote

{Embed}
https://github.com/Kobo-InkBox/rootfs/blob/master/etc/init.d/update.sh
rootfs/update.sh at master Â· Kobo-InkBox/rootfs
InkBox OS root filesystem. Contribute to Kobo-InkBox/rootfs development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/rootfs-0E6B6


[4/1/2022 11:40â€¯PM] szybet
okay


[4/1/2022 11:40â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-C3467.png


[4/1/2022 11:41â€¯PM] szybet
where does this else happen?


[4/1/2022 11:41â€¯PM] tux_linux
Yes it is needed


[4/1/2022 11:41â€¯PM] tux_linux
When there is an event in event0 but it is not the power button or sleep cover


[4/1/2022 11:41â€¯PM] tux_linux
Sometimes it can be the gyroscope for example


[4/1/2022 11:42â€¯PM] tux_linux
Otherwise you will get a memory leak at some point


[4/1/2022 11:42â€¯PM] szybet
but after detecting something it will continue to run the code after it?


[4/1/2022 11:42â€¯PM] tux_linux
It continues/restarts the while loop


[4/1/2022 11:42â€¯PM] tux_linux
You know what inotifywait does, right?


[4/1/2022 11:43â€¯PM] szybet
`Wait for a particular event on a file or set of files.`


[4/1/2022 11:43â€¯PM] tux_linux
Yes
So it waits for an input event then executes the code


[4/1/2022 11:43â€¯PM] szybet
so only for KEY_POWER and F1, okay


[4/1/2022 11:43â€¯PM] tux_linux
Yes


[4/2/2022 12:34â€¯AM] szybet
can i write to /tmp/ some data, sync and sleep 2 and then mem > state?


[4/2/2022 2:24â€¯AM] szybet
well, one thing and i think it will be perfect


[4/2/2022 2:25â€¯AM] szybet
how do i specify `fbink -q -p -m -y 30 -S 3 -B WHITE -t regular=/etc/init.d/splash.d/fonts/resources/inter-b.ttf,size=10 "don't touch the screen"` the place where to spawn the text using those fonts? i tryied with `size=10,bottom=10` etc but nothing worked


[4/2/2022 2:27â€¯AM] szybet
ugh, brightness doesn't work


[4/2/2022 2:30â€¯AM] szybet
well, tommorow


[4/2/2022 2:31â€¯AM] szybet
but its now reacting instant for the power button


[4/2/2022 2:31â€¯AM] szybet
ğŸ˜„


[4/2/2022 3:58â€¯AM] tux_linux
do we really not have another solution?


[4/2/2022 3:58â€¯AM] tux_linux
also it only happens on your device


[4/2/2022 4:05â€¯AM] tux_linux
i guess?


[4/2/2022 6:07â€¯AM] tux_linux
If you're curious about the recoveryfs, here's the main scripts directory: https://github.com/Kobo-InkBox/recoveryfs/tree/master/opt/recovery/scripts


[4/2/2022 6:09â€¯AM] tux_linux
The `restore-*.sh` ones are probably the most interesting


[4/2/2022 6:11â€¯AM] tux_linux
btw, here's how it looks on the screen: https://youtu.be/KaBj7acHRHk?t=2129 (starts at 35:29)


[4/2/2022 6:14â€¯AM] tux_linux
good, but will it work on other devices? ğŸ˜‰


[4/2/2022 6:26â€¯AM] tux_linux
Also, I implemented this: https://github.com/Kobo-InkBox/gui-bundle/commit/d48fe45756321afdb2ea7040e606b54c7e5a328c

{Embed}
https://github.com/Kobo-InkBox/gui-bundle/commit/d48fe45756321afdb2ea7040e606b54c7e5a328c
inkbox script: Implement auto-restart failsafe on non-zero exit cod...
/mnt/data/projects/git/conversations/media/d48fe45756321afdb2ea7040e606b54c7e5a328c-334FA


[4/2/2022 9:29â€¯AM] szybet
And its working only on my device, there is a IF n306

{Reactions}
ğŸ‘ 

[4/2/2022 9:29â€¯AM] szybet
I prefer this that way


[4/2/2022 9:29â€¯AM] szybet
Why not


[4/2/2022 1:55â€¯PM] tux_linux
Well, on other devices the FB might cause problems while it works on the Nia


[4/2/2022 1:55â€¯PM] szybet
the error message is only for the nia

{Reactions}
ğŸ‘ 

[4/2/2022 1:58â€¯PM] tux_linux
Ok, please, at least, write it correctly with a capital in the beginning of the sentence


[4/2/2022 1:59â€¯PM] tux_linux
I'm curious; does Wi-Fi reconnection work when waking from sleep on your device with what you implemented?


[4/2/2022 2:07â€¯PM] szybet
for now no, but i only need to add one if in the code


[4/2/2022 2:08â€¯PM] szybet
i have anoother issue


[4/2/2022 2:08â€¯PM] tux_linux
Ok


[4/2/2022 2:08â€¯PM] tux_linux
Yes?


[4/2/2022 2:08â€¯PM] szybet
the device blocks going to sleep no matter what, only reboot helps


[4/2/2022 2:09â€¯PM] tux_linux
You can't wake up?


[4/2/2022 2:11â€¯PM] szybet
i cant suspend it


[4/2/2022 2:16â€¯PM] tux_linux
It happens everytime?


[4/2/2022 2:18â€¯PM] szybet
only if i test it heavily


[4/2/2022 2:18â€¯PM] szybet
i think


[4/2/2022 2:20â€¯PM] tux_linux
What's your code?


[4/2/2022 2:28â€¯PM] szybet
```
#!/bin/bash
# /tmp/sleep_error stores errors when going to sleep. For kobo nia, if missing permission error will show up it will try again
DEVICE=$(cat /opt/inkbox_device)

# Race condition; going to sleep
echo "false" > /tmp/sleep_standby # Idk if its needed

/opt/bin/fbink/fbink -k -f -q
/opt/bin/fbink/fbink -t regular=/etc/init.d/splash.d/fonts/resources/inter-b.ttf,size=20 "Sleeping" -m -M -q
echo "sleeping" > /tmp/sleep_status

go_sleep() {
    echo  "read file"
    cat /tmp/sleep_error
    rm -f /tmp/sleep_error 2>/dev/null
    sleep 8
    sync
    echo "going to sleep"
    echo "1" > /sys/power/state-extended
    sync
    sleep 2
    echo "mem" > /sys/power/state 2>/tmp/sleep_error 
    sleep 2
}

go_sleep

if [ "${DEVICE}" == "n306" ]; then
    # Separate if to avoid writing many times to the e-ink. idk about the syntax / look of the code here
    if grep -q "Operation not permitted" /tmp/sleep_error; then
        ### TO DO get the good position of it
        /opt/bin/fbink/fbink -m -q -B WHITE -t regular=/etc/init.d/splash.d/fonts/resources/inter-b.ttf,size=18,top=800,bottom=0,left=0,right=0 "don't touch the screen"
        /opt/bin/fbink/fbink -m -q -B WHITE -t regular=/etc/init.d/splash.d/fonts/resources/inter-b.ttf,size=14,top=870,bottom=0,left=0,right=0 "Nia can't go to sleep if it's touched"
    fi
    while grep -q "Operation not permitted" /tmp/sleep_error; do
        go_sleep
    done
fi

/etc/init.d/suspend_scripts/after_sleep.sh
```


[4/2/2022 2:28â€¯PM] szybet
the part with while is not working


[4/2/2022 2:29â€¯PM] szybet
if it gets there, it will not suspend, just loop through and there will be x fails in suspend_stats


[4/2/2022 2:29â€¯PM] szybet
and things in go_sleep like echo and cat are my debugging things


[4/2/2022 2:32â€¯PM] tux_linux
Maybe you can just store the status of echo command in a var
${?}


[4/2/2022 2:33â€¯PM] szybet
will this help with the problem?


[4/2/2022 2:33â€¯PM] tux_linux
No


[4/2/2022 2:34â€¯PM] tux_linux
But it will make more sense probably


[4/2/2022 2:34â€¯PM] szybet
okay, i will implement it after it will work


[4/2/2022 2:35â€¯PM] tux_linux
When you write to sysfs you don't need to sync
Files there are not real files, they are linked directly to the kernel


[4/2/2022 2:35â€¯PM] szybet
sync is for the filesystem


[4/2/2022 2:36â€¯PM] tux_linux
Yeah, put it only once


[4/2/2022 2:37â€¯PM] szybet
okay


[4/2/2022 2:38â€¯PM] tux_linux
Hmm
I would add something blocking that would prevent executing go_sleep if it's already running
But maybe the while loop already prevents that


[4/2/2022 2:39â€¯PM] szybet
there is no &, so its only running once


[4/2/2022 2:39â€¯PM] tux_linux
You can use sh -x to help you debug


[4/2/2022 2:39â€¯PM] tux_linux
It's really useful


[4/2/2022 2:39â€¯PM] szybet
what it does?


[4/2/2022 2:40â€¯PM] tux_linux
Try it


[4/2/2022 2:40â€¯PM] tux_linux
sh -x script.sh


[4/2/2022 2:41â€¯PM] tux_linux
Well, maybe more bash -x
Btw, if possible, always use /bin/sh as it is faster than bash
If you need arrays, etc. it's okay but ideally the faster it runs the better


[4/2/2022 2:43â€¯PM] szybet
thats helpfull


[4/2/2022 2:43â€¯PM] tux_linux
ğŸ‘


[4/2/2022 2:47â€¯PM] szybet
this is weird


[4/2/2022 2:47â€¯PM] szybet
the script if it goes to this loop, it cant suspend itself


[4/2/2022 2:47â€¯PM] szybet
but then i relaunch the whole script, it suspends normal


[4/2/2022 2:49â€¯PM] tux_linux
I don't understand


[4/2/2022 2:49â€¯PM] szybet
maybe now


[4/2/2022 2:52â€¯PM] szybet
what does `/tmp/sleep_mode`?


[4/2/2022 2:53â€¯PM] tux_linux
Tells other scripts/services that it's going/in sleep mode IIRC
It is necessary


[4/2/2022 2:56â€¯PM] szybet
and `/tmp/sleep_standby`?


[4/2/2022 2:56â€¯PM] tux_linux
Used for WiFi reconnection


[4/2/2022 3:28â€¯PM] szybet
WEIRD


[4/2/2022 3:28â€¯PM] szybet
nothing makes sense


[4/2/2022 3:28â€¯PM] szybet
i needed to add:
```
 kill -CONT $(pidof inkbox-bin 2>/dev/null) 2>/dev/null
        kill -CONT $(pidof oobe-inkbox-bin 2>/dev/null) 2>/dev/null
        kill -CONT $(pidof calculator-bin 2>/dev/null) 2>/dev/null
        kill -CONT $(pidof scribble 2>/dev/null) 2>/dev/null
        kill -CONT $(pidof lightmaps 2>/dev/null) 2>/dev/null
        kill -CONT $(pidof qreversi-bin 2>/dev/null) 2>/dev/null
        kill -CONT $(pidof 2048-bin 2>/dev/null) 2>/dev/null

        sleep 2

        kill -STOP $(pidof inkbox-bin 2>/dev/null) 2>/dev/null
        kill -STOP $(pidof oobe-inkbox-bin 2>/dev/null) 2>/dev/null
        kill -9 $(pidof lockscreen-bin 2>/dev/null) 2>/dev/null
        kill -STOP $(pidof calculator-bin 2>/dev/null) 2>/dev/null
        kill -STOP $(pidof scribble 2>/dev/null) 2>/dev/null
        kill -STOP $(pidof lightmaps 2>/dev/null) 2>/dev/null
        kill -STOP $(pidof qreversi-bin 2>/dev/null) 2>/dev/null
        kill -STOP $(pidof 2048-bin 2>/dev/null) 2>/dev/null
```
to make it go to sleep after the error with touch


[4/2/2022 3:28â€¯PM] szybet
why?


[4/2/2022 3:42â€¯PM] tux_linux
Wait, where's the sleep call in this code?


[4/2/2022 3:42â€¯PM] szybet
where?


[4/2/2022 3:43â€¯PM] szybet
i added this to `while` and now it goes to sleep, and does not loop itself


[4/2/2022 3:43â€¯PM] tux_linux
Well it makes no sense


[4/2/2022 3:43â€¯PM] szybet
but it works


[4/2/2022 3:44â€¯PM] szybet
ğŸ‘€


[4/2/2022 3:44â€¯PM] szybet
maybe some of those app tryied were awaken when the error accoured, and then tryied to get input from touch?


[4/2/2022 3:45â€¯PM] tux_linux
Without kill cont and only with kill stop, does it work?


[4/2/2022 3:49â€¯PM] szybet
nope


[4/2/2022 3:49â€¯PM] szybet
ğŸ˜†


[4/2/2022 3:49â€¯PM] tux_linux
do you have the full script?


[4/2/2022 3:49â€¯PM] szybet
nothing makes sens now


[4/2/2022 3:49â€¯PM] tux_linux
nothing in the kobo world ever makes sense, period.


[4/2/2022 3:49â€¯PM] szybet
i have. i will test some more things and then send it to you


[4/2/2022 3:49â€¯PM] tux_linux
can i see it now?


[4/2/2022 3:49â€¯PM] szybet
what part exactly?


[4/2/2022 3:50â€¯PM] tux_linux
the entire script


[4/2/2022 3:50â€¯PM] szybet
they are like 5 of them


[4/2/2022 3:50â€¯PM] tux_linux
well, those 5 then


[4/2/2022 3:50â€¯PM] tux_linux
i want to understand why the kill thing works


[4/2/2022 3:52â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/after_sleep-616A9.sh
/mnt/data/projects/git/conversations/media/go_sleep-CB075.sh
/mnt/data/projects/git/conversations/media/manage_sleep-C2C41.sh
/mnt/data/projects/git/conversations/media/prepare_sleep-A7816.sh
/mnt/data/projects/git/conversations/media/touch_issue_fix-46BF2.sh


[4/2/2022 3:53â€¯PM] szybet
i havent tested everything yet


[4/2/2022 3:53â€¯PM] szybet
how do i clear half of the e-ink?


[4/2/2022 3:53â€¯PM] tux_linux
why?


[4/2/2022 3:53â€¯PM] szybet
?


[4/2/2022 3:54â€¯PM] tux_linux
why?


[4/2/2022 3:54â€¯PM] szybet
becouse the wifi mark appears sometimes when launching the kill thing


[4/2/2022 3:55â€¯PM] tux_linux
look into fbink docs
refresh rectangle or something


[4/2/2022 3:55â€¯PM] tux_linux
`fbink` without arguments will print the full help


[4/2/2022 4:02â€¯PM] tux_linux
I am not sure I am ready to merge this
It will need a LOT of testing, and it seems it affects other devices too
It will be something to test for 2.0 release


[4/2/2022 4:03â€¯PM] szybet
it needs testing, sure


[4/2/2022 4:03â€¯PM] tux_linux
can't you put touch_issue_fix.sh into a function?


[4/2/2022 4:05â€¯PM] szybet
this will load it to ram, the code will be rarely used, the code in this file will be uglier


[4/2/2022 4:05â€¯PM] tux_linux
why uglier?


[4/2/2022 4:05â€¯PM] tux_linux
and it will load the file to ram anyway


[4/2/2022 4:05â€¯PM] szybet
really?


[4/2/2022 4:06â€¯PM] szybet
20 lines of kill


[4/2/2022 4:06â€¯PM] tux_linux
and?


[4/2/2022 4:06â€¯PM] szybet
well okay


[4/2/2022 4:06â€¯PM] tux_linux
it will load <1K to RAM, so I guess it is negligible


[4/2/2022 4:12â€¯PM] szybet
oh, and idle sleep is broken


[4/2/2022 4:12â€¯PM] szybet
i think


[4/2/2022 4:14â€¯PM] szybet
why is the wifi logo even refreshing when the state didn't changed


[4/2/2022 4:15â€¯PM] tux_linux
i know
it's set to refresh every 10 s


[4/2/2022 4:16â€¯PM] szybet
why ;_;


[4/2/2022 4:16â€¯PM] szybet
can you change it?


[4/2/2022 4:16â€¯PM] szybet
its better that if i did in my script the rectangle thing


[4/2/2022 4:18â€¯PM] tux_linux
i will try


[4/2/2022 4:18â€¯PM] szybet
good


[4/2/2022 4:18â€¯PM] szybet
thanks

{Reactions}
ğŸ‘ 

[4/2/2022 4:21â€¯PM] tux_linux
https://github.com/Kobo-InkBox/inkbox/commit/cfdace7dabef537989c56f51684343cb0da3e0bd
also that was a failure, sorry

{Embed}
https://github.com/Kobo-InkBox/inkbox/commit/cfdace7dabef537989c56f51684343cb0da3e0bd
Reader: Disable setEnabled() calls on 'Next' and 'Previous' page bu...
Otherwise, the screen would flash everytime, regardless of the setting
set by the user. I'm keeping the code
there in case I or someone else find a fix.
/mnt/data/projects/git/conversations/media/cfdace7dabef537989c56f51684343cb0da3e0bd-A9ADD


[4/2/2022 4:21â€¯PM] tux_linux
i tried everything but it didn't want to work


[4/2/2022 4:22â€¯PM] szybet
disabling buttons refreshes the screen?


[4/2/2022 4:22â€¯PM] tux_linux
yes


[4/2/2022 4:22â€¯PM] szybet
wtf qt


[4/2/2022 4:22â€¯PM] tux_linux
i know


[4/2/2022 4:24â€¯PM] szybet
i will add this rectangle anyway


[4/2/2022 4:24â€¯PM] szybet
becouse battery / time has the same problem, and they change anyways

{Reactions}
ğŸ‘ 

[4/2/2022 4:28â€¯PM] tux_linux
done


[4/2/2022 4:28â€¯PM] tux_linux
https://github.com/Kobo-InkBox/inkbox/commit/e4a21f5c85e5d1079de6f8434bf801e1cb936746

{Embed}
https://github.com/Kobo-InkBox/inkbox/commit/e4a21f5c85e5d1079de6f8434bf801e1cb936746
Wi-Fi icon improvements Â· Kobo-InkBox/inkbox@e4a21f5
Don't update it if it isn't necessary.
/mnt/data/projects/git/conversations/media/e4a21f5c85e5d1079de6f8434bf801e1cb936746-8A4A7


[4/2/2022 4:28â€¯PM] szybet
nice

{Reactions}
ğŸ‘ 

[4/2/2022 4:50â€¯PM] szybet
wifi recconection works


[4/2/2022 4:50â€¯PM] tux_linux
good


[4/2/2022 4:52â€¯PM] szybet
maybe dont disable the button, but give an if at the slot that its executing when clicked?


[4/2/2022 4:52â€¯PM] tux_linux
already tried


[4/2/2022 4:53â€¯PM] szybet
and?


[4/2/2022 4:54â€¯PM] tux_linux
But the function is blocking, so it always finishes executing before launching a new one, and it remembers at the same time how many times you clicked on the button.
It's like a queue
So it never worked


[4/2/2022 4:58â€¯PM] szybet
??? it can execute to the end, but you simply disable the code in it


[4/2/2022 4:58â€¯PM] szybet
i dont understand something propably


[4/2/2022 4:58â€¯PM] tux_linux
it's very complicated


[4/2/2022 4:58â€¯PM] tux_linux
i'm not sure I can even explain it


[4/2/2022 5:05â€¯PM] szybet
idle sleep works too


[4/2/2022 5:05â€¯PM] szybet
everything works


[4/2/2022 5:09â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/sleep_manager-E444F
/mnt/data/projects/git/conversations/media/suspend_scripts-8C1E4.zip


[4/2/2022 5:09â€¯PM] szybet
here is everything


[4/2/2022 5:10â€¯PM] tux_linux
ok; i don't really have the energy to test this right now but i'll consider it for 2.0 release
thanks!


[4/2/2022 5:20â€¯PM] szybet
i will use it for me

{Reactions}
ğŸ‘ 

[4/4/2022 4:50â€¯AM] tux_linux
I updated the GUI bundle
Scrollbars should be better
You'll also need to update the rootfs


[4/4/2022 6:43â€¯AM] szybet
Okay,i will test it today


[4/4/2022 6:44â€¯AM] szybet
Im taking tommorow the nia for a trip and i hope it will be usable, it will not break himself ğŸ˜†

{Reactions}
ğŸ‘ 

[4/4/2022 6:28â€¯PM] szybet
https://stackoverflow.com/questions/3254652/several-ways-of-placing-an-image-in-a-qtextedit

{Embed}
https://stackoverflow.com/questions/3254652/several-ways-of-placing-an-image-in-a-qtextedit
Several ways of placing an image in a QTextEdit
I think this is a very simple question, but when I copy an image I can't paste it in a QTextEdit? Paste is inactive! Also I would like to know how to drag-and-drop a picture.

BTW I use the following
/mnt/data/projects/git/conversations/media/apple-touch-icon%402-C50E4.png


[4/4/2022 6:28â€¯PM] szybet
umm?


[4/4/2022 6:31â€¯PM] tux_linux
You can??


[4/4/2022 6:32â€¯PM] tux_linux
Ok, didn't know that
The class name is misleading


[4/4/2022 6:32â€¯PM] szybet
idk, but here i see its possible


[4/4/2022 6:32â€¯PM] szybet
i will use it in sanki for sure

{Reactions}
ğŸ‘ 

[4/4/2022 10:21â€¯PM] tux_linux
Does the boot progress bar work correctly on your device?


[4/4/2022 10:21â€¯PM] szybet
um yes?

{Reactions}
ğŸ‘ 

[4/4/2022 10:22â€¯PM] tux_linux
Also, are X11 apps launching/working fine?


[4/4/2022 10:22â€¯PM] tux_linux
Good, just wanted to check


[4/4/2022 10:23â€¯PM] szybet
yes, but fbink gets errors after some time when x11 is enabled


[4/4/2022 10:23â€¯PM] tux_linux
Yeah sure


[4/4/2022 10:24â€¯PM] tux_linux
That I can't do anything about


[4/4/2022 10:24â€¯PM] tux_linux
A Qt terminal would be nice


[4/4/2022 10:24â€¯PM] szybet
yes!


[4/4/2022 10:24â€¯PM] tux_linux
Though we'd have to figure out how to get out of the GUI chroot


[4/4/2022 10:25â€¯PM] tux_linux
Maybe telnet, but that is not a really good idea


[4/4/2022 10:26â€¯PM] tux_linux
Because the GUI doesn't have a bundled SSH client


[4/4/2022 10:28â€¯PM] szybet
hmm... there must be a way to escape chroot


[4/4/2022 10:29â€¯PM] tux_linux
Yes there is
But it does not make a very good impression if it's official hehe


[4/4/2022 10:30â€¯PM] tux_linux
I think I have an idea


[4/4/2022 10:36â€¯PM] tux_linux
Throw a dropbear static binary into /kobo/external_root/, SSH to localhost (main rootfs) with it, and bingo


[4/4/2022 10:36â€¯PM] szybet
this makes sense


[4/4/2022 10:37â€¯PM] szybet
here is the whole new sleep management, i forgot to include one file

{Attachments}
/mnt/data/projects/git/conversations/media/sleep-FDF24.zip

{Reactions}
ğŸ‘ 

[4/4/2022 10:46â€¯PM] tux_linux
Seems that my Glo HD too wakes on touchscreen


[4/4/2022 10:47â€¯PM] szybet
well, the fix would now be easy


[4/4/2022 10:47â€¯PM] szybet
*i think*


[4/4/2022 10:48â€¯PM] tux_linux
Depends if it's the same file


[4/4/2022 10:49â€¯PM] tux_linux
The Glo HD has an IR touchscreen


[4/4/2022 10:50â€¯PM] szybet
IR?


[4/4/2022 11:01â€¯PM] szybet
The scroll bars are now usable, thanks


[4/4/2022 11:02â€¯PM] szybet
except the brightness dialog


[4/4/2022 11:02â€¯PM] szybet
the screen shifts even if they aren't any special characters in book names


[4/4/2022 11:17â€¯PM] tux_linux
Huh?


[4/4/2022 11:25â€¯PM] szybet
What is you question?


[4/4/2022 11:25â€¯PM] szybet
Infrared?


[4/4/2022 11:28â€¯PM] tux_linux
Question


[4/4/2022 11:28â€¯PM] tux_linux
Yes


[4/4/2022 11:48â€¯PM] szybet
Interesting one. But the call to wake the device should be the same


[4/4/2022 11:48â€¯PM] szybet
Well what can i say, thats what is happening to pe


[4/4/2022 11:49â€¯PM] szybet
The file chooser and last books section need a complete redesign anyway, so dont care about it


[4/5/2022 12:08â€¯AM] tux_linux
Screenshot?


[4/5/2022 12:14â€¯AM] tux_linux
It's going into 1.9 release at least, I care!


[4/5/2022 3:21â€¯AM] tux_linux
And it did not do anything :/


[4/5/2022 6:31â€¯AM] szybet
Are you sure? I needed to edit 3 Giles at least


[4/5/2022 6:32â€¯AM] tux_linux
well, i wiped out the whole 'wake' function, if that doesn't work then I don't know what works


[4/5/2022 6:32â€¯AM] szybet
what are other irq ( interrupt ) commands in those files?


[4/5/2022 6:33â€¯AM] tux_linux
Also, there is just one file for the zForce touchscreen


[4/5/2022 6:33â€¯AM] szybet
+ can you compile the driver as module


[4/5/2022 6:33â€¯AM] szybet
Impossible


[4/5/2022 6:33â€¯AM] szybet
+ can you unbind the driver on the device?


[4/5/2022 6:33â€¯AM] tux_linux
https://github.com/Kobo-InkBox/kernel/blob/master/kernel/linux-3.0.35-n437/drivers/input/touchscreen/zforce_i2c.c


[4/5/2022 6:33â€¯AM] tux_linux
why?


[4/5/2022 6:35â€¯AM] szybet
Im optimistic


[4/5/2022 6:37â€¯AM] szybet
I will look at it later

{Reactions}
ğŸ‘ 

[4/5/2022 6:37â€¯AM] szybet
+ you can gry the wake up interface i talked anout


[4/5/2022 11:30â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220405_112709-E87C9.jpg


[4/5/2022 11:31â€¯AM] szybet
Thats something to fix, but its sleeping anyway so thats good


[4/5/2022 11:48â€¯PM] tux_linux
Did you try USB debug mode on the Nia?


[4/5/2022 11:57â€¯PM] szybet
You mean?


[4/5/2022 11:59â€¯PM] tux_linux
`BOOT_USB_DEBUG`


[4/6/2022 12:47â€¯AM] szybet
Yes, it works

{Reactions}
ğŸ‘ 

[4/6/2022 12:47â€¯AM] tux_linux
nice


[4/6/2022 12:47â€¯AM] tux_linux
kobo kernel code is a nightmare


[4/6/2022 12:48â€¯AM] tux_linux
I still can't understand why it still resumes on touchscreen even if I tore the whole function down...


[4/6/2022 12:48â€¯AM] tux_linux
```
diff --git a/kernel/linux-3.0.35-n437/drivers/input/touchscreen/zforce_i2c.c b/kernel/linux-3.0.35-n437/drivers/input/touchscreen/zforce_i2c.c
index a562702d9f..583126728c 100755
--- a/kernel/linux-3.0.35-n437/drivers/input/touchscreen/zforce_i2c.c
+++ b/kernel/linux-3.0.35-n437/drivers/input/touchscreen/zforce_i2c.c
@@ -712,28 +712,6 @@ static int zForce_ir_touch_suspend(struct platform_device *pdev, pm_message_t st
 
 static int zForce_ir_touch_resume(struct platform_device *pdev)
 {
-       if (gSleep_Mode_Suspend) {
-               if ( !(41==gptHWCFG->m_val.bPCB && 3!=gptHWCFG->m_val.bUIConfig) ) { //auto active while power on zforce controller
-                       if(8==gptHWCFG->m_val.bTouchCtrl || 11==gptHWCFG->m_val.bTouchCtrl) {
-                               i2c_master_send(zForce_ir_touch_data.client, cmd_Active_v2, sizeof(cmd_Active_v2));
-                       }else{
-                               i2c_master_send(zForce_ir_touch_data.client, cmd_Active, sizeof(cmd_Active));
-                       }       
-               }
-               if( custom_touchSizeLimit_set ) {
-                       printk("command setTouchSizeLimits");
-                       i2c_master_send(zForce_ir_touch_data.client, cmd_SetTouchSizeLimits, sizeof(cmd_SetTouchSizeLimits));
-                       msleep(5);
-               }
-//             enable_irq_wake(zForce_ir_touch_data.client->irq);
-               request_irq(zForce_ir_touch_data.client->irq, zForce_ir_touch_ts_interrupt, IRQF_TRIGGER_FALLING, ZFORCE_TS_NAME, ZFORCE_TS_NAME);
-       }
-       else
-               disable_irq_wake(zForce_ir_touch_data.client->irq);
-       if (!zForce_ir_touch_detect_int_level ()) {
-               zForce_ir_touch_ts_triggered ();
-       }
-       
        return 0;
 }
```


[4/6/2022 12:49â€¯AM] tux_linux
I mean, if that doesn't work, I don't know what works


[4/6/2022 1:37â€¯AM] szybet
Me too, but look up to #chat


[4/7/2022 6:07â€¯PM] szybet
I will need to disable wake up for the charger too. When its 100% it wakes him up, then it goes to sleep but it wakes I'm up and it's a circle

{Reactions}
ğŸ‘ 

[4/13/2022 1:33â€¯AM] tux_linux
I updated the `build_u-boot.sh` script in the kernel repo; building U-Boot is now much easier


[4/13/2022 1:33â€¯AM] tux_linux
Example for the Nia:
```
env TOOLCHAINDIR=/home/build/inkbox/kernel/toolchain/arm-nickel-linux-gnueabihf TARGET=arm-nickel-linux-gnueabihf THREADS=16 scripts/build_u-boot.sh n306
```


[4/13/2022 6:29â€¯AM] szybet
It was easy already, but still cool

{Reactions}
ğŸ‘ 

[4/13/2022 3:21â€¯PM] tux_linux
Can you `fdisk -l` your SD card?


[4/13/2022 3:40â€¯PM] szybet
Yes, i will do it today


[4/13/2022 9:01â€¯PM] szybet
```
kobo:~# fdisk -l
Disk /dev/mmcblk0: 15 GB, 15931539456 bytes, 31116288 sectors
486192 cylinders, 4 heads, 16 sectors/track
Units: sectors of 1 * 512 = 512 bytes

Device       Boot StartCHS    EndCHS        StartLBA     EndLBA    Sectors  Size Id Type
/dev/mmcblk0p1    24,0,1      38,63,32         49152      79871      30720 15.0M 83 Linux
/dev/mmcblk0p2    51,0,1      550,63,32       104448    1128447    1024000  500M 83 Linux
/dev/mmcblk0p3    551,0,1     678,63,32      1128448    1390591     262144  128M 83 Linux
/dev/mmcblk0p4    679,0,1     857,31,32      1390592   31116287   29725696 14.1G 83 Linux
kobo:~# 

```
why do you need it


[4/13/2022 9:01â€¯PM] szybet
and: 
```
fuse-overlayfs   14G  2.7G   11G  20% /kobo

```
so i have 11G available for books, its 3 more than on nickel with the same sd card


[4/13/2022 9:05â€¯PM] szybet
the whole screen is shifting when there are recent books, with no special characters in recent books. removing files in `kobo:/opt/config/08-recent_books#` fixes the issue. Its needs a whole redesign, but i just say that its completly broken


[4/13/2022 10:40â€¯PM] tux_linux
`dd if=/dev/mmcblk0 bs=512 count=49151 of=n306.bin`


[4/13/2022 10:41â€¯PM] tux_linux
Send me the file


[4/13/2022 10:46â€¯PM] szybet
what is this...

( EDIT: i deleted those files )


[4/13/2022 10:46â€¯PM] szybet
there is some interesting... text?


[4/13/2022 11:12â€¯PM] tux_linux
It's not supposed to weigh like 20M?


[4/13/2022 11:13â€¯PM] szybet
i coppied your command?


[4/13/2022 11:13â€¯PM] tux_linux
What's the output?


[4/13/2022 11:17â€¯PM] szybet
i have no idea why it was 8mb


[4/13/2022 11:17â€¯PM] szybet
now its 25


[4/13/2022 11:21â€¯PM] tux_linux
Ok thanks


[4/13/2022 11:21â€¯PM] tux_linux
It's for imgtool


[4/13/2022 11:22â€¯PM] szybet
?


[4/13/2022 11:22â€¯PM] szybet
so?


[4/13/2022 11:22â€¯PM] szybet
there is some text


[4/13/2022 11:22â€¯PM] szybet
maybe a serial number


[4/13/2022 11:23â€¯PM] tux_linux
Unpartitioned space
Contains waveform
Yeah, I'll blank out the serial number


[4/13/2022 11:23â€¯PM] szybet
i hope you do it


[4/13/2022 11:23â€¯PM] tux_linux
InkBox UID?
Does it match the one in Settings?


[4/13/2022 11:23â€¯PM] szybet
?


[4/13/2022 11:24â€¯PM] tux_linux
InkBox UID is pretty much worthless regarding warranty or anything


[4/13/2022 11:24â€¯PM] tux_linux
Open settings, show system info


[4/13/2022 11:24â€¯PM] tux_linux
It's a random string of 256 bytes


[4/13/2022 11:26â€¯PM] szybet
its something not from nickel?


[4/13/2022 11:26â€¯PM] szybet
yes its the same

{Reactions}
ğŸ‘ 

[4/13/2022 11:26â€¯PM] tux_linux
Yeah, it overwrites the serial number


[4/13/2022 11:26â€¯PM] szybet
good


[4/13/2022 11:27â€¯PM] szybet
and the settings menu is broken


[4/13/2022 11:27â€¯PM] szybet
there is a horizontal slider


[4/13/2022 11:27â€¯PM] tux_linux
Picture?


[4/13/2022 11:28â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220413_232746-AF6A7.jpg


[4/13/2022 11:29â€¯PM] tux_linux
In what way is it broken?


[4/13/2022 11:29â€¯PM] tux_linux
It's normal
There's not enough space for some element


[4/13/2022 11:29â€¯PM] tux_linux
(I suspect the timezone thing)


[4/13/2022 11:30â€¯PM] szybet
its bad


[4/13/2022 11:30â€¯PM] tux_linux
What do you want that I do


[4/13/2022 11:30â€¯PM] tux_linux
It just doesn't fit the screen


[4/13/2022 11:30â€¯PM] szybet
timezone could cut out the text or move the box to the left, if its really it


[4/13/2022 11:31â€¯PM] szybet
its a horibble design and it can be fixed


[4/13/2022 11:31â€¯PM] tux_linux
I would need to remove the reboot req. text


[4/13/2022 11:31â€¯PM] tux_linux
Which I'm sure you would say would be worse


[4/13/2022 11:32â€¯PM] szybet
no


[4/13/2022 11:32â€¯PM] tux_linux
Or reduce the qcombobox font size
But I already did that and it's getting really small


[4/13/2022 11:34â€¯PM] tux_linux
Maybe I can do it


[4/13/2022 11:34â€¯PM] szybet
where is the ui file for the seconf page


[4/13/2022 11:34â€¯PM] tux_linux
In the second page of settings.ui


[4/13/2022 11:34â€¯PM] tux_linux
Don't reduce the font size of timezone label, it will break the design language


[4/13/2022 11:35â€¯PM] tux_linux
The combo box already breaks it in a quiet way and I don't really like it


[4/13/2022 11:35â€¯PM] szybet
what


[4/13/2022 11:35â€¯PM] tux_linux
Or maybe you have a better abbreviation for reboot required


[4/13/2022 11:36â€¯PM] szybet
a toast after setting timezone


[4/13/2022 11:36â€¯PM] tux_linux
There are two arrows on the top right of the qstackedwidget


[4/13/2022 11:36â€¯PM] szybet
but its not a good fix


[4/13/2022 11:36â€¯PM] tux_linux
Which would say what?


[4/13/2022 11:36â€¯PM] tux_linux
Oooh


[4/13/2022 11:36â€¯PM] szybet
what


[4/13/2022 11:37â€¯PM] tux_linux
But if then you mess up one time with the combo box and want to set it again, you have to wait


[4/13/2022 11:37â€¯PM] tux_linux
That's why I put it in the label


[4/13/2022 11:37â€¯PM] tux_linux
I can't figure out why it needs a reboot but it is needed


[4/13/2022 11:38â€¯PM] szybet
a toast that dissapears after a click?


[4/13/2022 11:38â€¯PM] tux_linux
Maybe


[4/13/2022 11:38â€¯PM] szybet
wait... on arch linux you need to source a file or smth to apply timezone


[4/13/2022 11:39â€¯PM] tux_linux
No, here it's a bind mount and symlink problem
Nonsense, I didn't try to understand more


[4/13/2022 11:39â€¯PM] szybet
umount / mount? meh


[4/13/2022 11:39â€¯PM] tux_linux
That could be something


[4/13/2022 11:40â€¯PM] szybet
where...


[4/13/2022 11:40â€¯PM] tux_linux
Maybe adding that to ibxd and calling it when the combo box value changed could fix the problem


[4/13/2022 11:40â€¯PM] szybet
https://unix.stackexchange.com/questions/17051/how-to-change-timezone-to-utc-without-rebooting-aix

maybe this:
https://askubuntu.com/questions/1145565/should-i-reboot-after-set-new-timezone-using-timedatectl


[4/13/2022 11:40â€¯PM] tux_linux
Don't have access to that now
Otherwise you can click the page_* elements in the right bar


[4/13/2022 11:41â€¯PM] tux_linux
It already works in the rootfs live


[4/13/2022 11:41â€¯PM] szybet
maybe you need to do this in chroot


[4/13/2022 11:41â€¯PM] tux_linux
It's just the bind mount in the Kobo chroot that doesn't point to the right thing


[4/13/2022 11:41â€¯PM] szybet
or restart inkbox_gui


[4/13/2022 11:42â€¯PM] tux_linux
You really think an user would like that?


[4/13/2022 11:42â€¯PM] szybet
after clicking ok `applying settings` and 10s wait for the gui


[4/13/2022 11:42â€¯PM] tux_linux
It's like the bind mount records the content of the symlink and never updates it afterwards


[4/13/2022 11:42â€¯PM] szybet
its better than reboot


[4/13/2022 11:42â€¯PM] tux_linux
No, I think a simple unmount/mount in ibxd can work


[4/13/2022 11:43â€¯PM] szybet
thats some serious magic


[4/13/2022 11:44â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-34FFD.png


[4/13/2022 11:44â€¯PM] szybet
hm?


[4/13/2022 11:44â€¯PM] tux_linux
Also you need to get back to page 1 before saving the file or it will display the last page you were in in the compiled version


[4/13/2022 11:44â€¯PM] tux_linux
No, the text just takes up too much space in the first place


[4/13/2022 11:44â€¯PM] tux_linux
I think that fixing the reboot required problem will be better


[4/13/2022 11:47â€¯PM] szybet
cut it off


[4/13/2022 11:47â€¯PM] szybet
use a combo widget that will use the entire screen


[4/13/2022 11:47â€¯PM] szybet
really, anything


[4/13/2022 11:57â€¯PM] tux_linux
I will do that


[4/14/2022 6:11â€¯PM] szybet
is this actually a good idea? in never devices, some other revisions the chips / parts could be diffrent, so a diffrent config is there. it could damage or brick the device?


[4/14/2022 8:13â€¯PM] tux_linux
We'll find out when it happens


[4/14/2022 8:13â€¯PM] tux_linux
InkBox is not providing any warranty


[4/14/2022 8:14â€¯PM] tux_linux
So, not our fault if it breaks the device


[4/14/2022 8:14â€¯PM] szybet
it will be to late


[4/14/2022 8:14â€¯PM] szybet
put a big warning, or make a check status


[4/14/2022 8:14â€¯PM] szybet
dd this and that and compare it


[4/14/2022 8:14â€¯PM] tux_linux
Also, we don't have a choice
If we don't include that unpartitioned space the device won't boot


[4/14/2022 8:15â€¯PM] szybet
a guide, maybe i will write it


[4/14/2022 8:15â€¯PM] tux_linux
We need devices to compare


[4/14/2022 8:16â€¯PM] tux_linux
But it is also a nightmare for Kobo to put a different unpartitioned space in each device
So when they change hardware we will probably know


[4/14/2022 8:19â€¯PM] szybet
well okay


[4/14/2022 8:21â€¯PM] tux_linux
Besides, it's not like unpartitioned space from another device will brick it
I have a touch B and put the Touch C image on it
It didn't work well, but no problems and when using a correct U-Boot and kernel there was no permanent damage


[4/14/2022 8:23â€¯PM] szybet
well okay but its still risk


[4/15/2022 12:02â€¯AM] ninuje
Waveform data is not portable


[4/15/2022 12:02â€¯AM] ninuje
the rest should be


[4/15/2022 12:03â€¯AM] szybet
you mean?


[4/15/2022 12:03â€¯AM] ninuje
(IIRC, I don't remember most of the crap in there ;p).


[4/15/2022 12:04â€¯AM] ninuje
waveform data is tied to a specific production series of screens


[4/15/2022 12:04â€¯AM] szybet
@tux-linux so we have a problem


[4/15/2022 12:04â€¯AM] ninuje
There used to be a QR code or some shit on the flex cable to ID 'em


[4/15/2022 12:05â€¯AM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-7F5A0.png


[4/15/2022 12:05â€¯AM] szybet
its next to it


[4/15/2022 12:05â€¯AM] szybet
in the nia


[4/15/2022 12:05â€¯AM] szybet
propably


[4/15/2022 12:06â€¯AM] ninuje
(This may or may not be less of an issue on NTX boards, but it was fatal (as in, broken refreshes) on Kindles


[4/15/2022 12:54â€¯AM] tux_linux
No, shit
But how do you explain the people that got InkBox up and running without issues on their devices? How often does the production line change?


[4/15/2022 12:54â€¯AM] tux_linux
Reversible?


[4/15/2022 12:54â€¯AM] tux_linux
The wrong waveform on the Touch B did no harm at all after a clean SD flash


[4/15/2022 12:57â€¯AM] tux_linux
And how do you explain the success people have in replacing their screens without actually scanning the QR code and just going with the generic model number?


[4/15/2022 1:01â€¯AM] ninuje
Which is why I said something something NTX ;p.


[4/15/2022 1:01â€¯AM] ninuje
It's an issue for sure on lab126 boards


[4/15/2022 1:01â€¯AM] tux_linux
Ok
I'm just kind of freaking out right now...


[4/15/2022 1:01â€¯AM] ninuje
And theoretically, every waveform is tied to a specific vcom


[4/15/2022 1:02â€¯AM] tux_linux
I discussed about that with @andi and came to the conclusion that it didn't matter, but apparently not


[4/15/2022 1:03â€¯AM] tux_linux
vcom?


[4/15/2022 1:03â€¯AM] ninuje
I don't remember, brain is mush. it broke screen replacements on Kindles for sure ğŸ˜‰

{Reactions}
ğŸ‘ 

[4/15/2022 1:04â€¯AM] tux_linux
I had people on GH that tested the stock images with their device and they apparently didn't encounter problems either
@dill also has it working on his Mini


[4/15/2022 1:05â€¯AM] ninuje
Keep in mind NTX is probably outputting less boards than lab126 by a significant order of magnitude

{Reactions}
ğŸ‘ 

[4/15/2022 1:05â€¯AM] ninuje
Making these kind of changes much harder to catch in the wild

{Reactions}
ğŸ‘ 

[4/15/2022 1:06â€¯AM] the.mightydill
yep! working great

{Reactions}
ğŸ‘ 

[4/15/2022 8:19â€¯AM] szybet
So @tux-linux maybe a script?


[4/15/2022 2:01â€¯PM] tux_linux
Why? How? It will make the installing experience crap
Imagine running it on Windows


[4/15/2022 2:06â€¯PM] szybet
imagine using windows


[4/15/2022 2:07â€¯PM] szybet
a script that will write the first half of the image and the other one, without overwriting waveform


[4/15/2022 2:07â€¯PM] tux_linux
How do you do that on Windows?


[4/15/2022 2:08â€¯PM] szybet
run wsl2 for it


[4/15/2022 2:08â€¯PM] tux_linux
There is no dd, I think you have to write in cpp or something an entire app


[4/15/2022 2:08â€¯PM] szybet
do you have a better - safe idea?


[4/15/2022 2:09â€¯PM] tux_linux
You really think everyone will be willing to install wsl2 on their PC just for that?
Also you can access device nodes in wsl2? Didn't know that


[4/15/2022 2:12â€¯PM] szybet
i-dont-know


[4/15/2022 2:12â€¯PM] szybet
thats just my idea


[4/15/2022 2:12â€¯PM] tux_linux
Maybe we should create a cross platform Qt app, InkBox image flasher, like the rpi one


[4/15/2022 2:12â€¯PM] tux_linux
That would be my best guess


[4/15/2022 2:13â€¯PM] szybet
then how do you use it on windows? you said there is no dd


[4/15/2022 2:15â€¯PM] szybet
also, script, app, whatever


[4/15/2022 2:16â€¯PM] tux_linux
You need to invent dd


[4/15/2022 2:16â€¯PM] tux_linux
I guess


[4/15/2022 2:16â€¯PM] tux_linux
Write raw bytes to the MMC


[4/15/2022 2:16â€¯PM] tux_linux
Yeah, this will not be fun


[4/15/2022 2:17â€¯PM] szybet
nope nope nope nope xD


[4/15/2022 2:17â€¯PM] tux_linux
I think that's what etcher does


[4/15/2022 2:18â€¯PM] szybet
http://www.chrysocome.net/dd


[4/15/2022 2:18â€¯PM] szybet
there are some dd for windows


[4/15/2022 2:18â€¯PM] tux_linux
Yes, but no sane user of Windows will be willing to open a terminal and enter commands and do something they haven't ever done before


[4/15/2022 2:20â€¯PM] tux_linux
For now, I will put a warning, also the good thing is that the wrong waveform doesn't seem to brick the device, but the warning will be there


[4/15/2022 2:22â€¯PM] szybet
sadly


[4/15/2022 2:23â€¯PM] szybet
they should make a copy of the image


[4/15/2022 2:23â€¯PM] szybet
everyone


[4/15/2022 2:24â€¯PM] tux_linux
Yeah, but again it requires cli


[4/15/2022 2:26â€¯PM] tux_linux
And imgtool is probably not that suited for Windows or any end user, it uses qemu-nbd and asks for root access every minute


[4/15/2022 2:52â€¯PM] tux_linux


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-82F21.png


[4/15/2022 2:53â€¯PM] tux_linux
Fine?


[4/15/2022 3:37â€¯PM] szybet
describe the issue maybe more?


[4/15/2022 3:37â€¯PM] szybet
waveform etc


[4/15/2022 3:37â€¯PM] szybet
and backup


[4/20/2022 6:02â€¯AM] tux_linux
http://23.163.0.39/bundles/inkbox/native/n306/inkbox-1.9-n306.xz
Please test if recoveryfs boots and gets to main GUI interface


[4/20/2022 7:43â€¯AM] szybet
Doesn't recovery was made by the update?


[4/20/2022 8:58â€¯AM] tux_linux
...no?


[4/20/2022 8:59â€¯AM] tux_linux
Have you seen the actual size of the recoveryfs?


[4/20/2022 9:57â€¯AM] szybet
500 Mb


[4/20/2022 9:58â€¯AM] szybet
can i just copy files from the image recovery partition and put then on the kobo?


[4/20/2022 10:29â€¯AM] szybet
And why recovery is bigger than rootfs


[4/20/2022 10:29â€¯AM] szybet
Are there libraries for p4?


[4/20/2022 1:44â€¯PM] tux_linux
yeah you could do that


[4/20/2022 1:44â€¯PM] tux_linux
because it contains user data + rootfs + kernel + u-boot


[4/20/2022 2:14â€¯PM] szybet
User data?


[4/20/2022 2:29â€¯PM] tux_linux
contents of p4


[4/20/2022 3:10â€¯PM] szybet
This makes more sense


[4/22/2022 6:41â€¯AM] tux_linux
Does it boot to recoveryfs?


[4/22/2022 7:08â€¯AM] szybet
I will check it today


[4/24/2022 2:45â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-9E1EA.png


[4/24/2022 2:45â€¯PM] szybet
ğŸ˜


[4/24/2022 2:46â€¯PM] szybet
7h~


[4/24/2022 2:48â€¯PM] szybet
okay, now its better

{Attachments}
/mnt/data/projects/git/conversations/media/unknown-ABF51.png


[4/24/2022 2:48â€¯PM] szybet
but still, it jumps like crazy between those speeds


[4/24/2022 3:35â€¯PM] szybet
It works


[4/24/2022 3:35â€¯PM] szybet
thats a pretty cool setup

{Reactions}
ğŸ‘ 

[4/24/2022 3:35â€¯PM] szybet
maybe give a note for the nia + the other ereader that kobox can cause crashes

{Reactions}
ğŸ‘ 

[4/24/2022 3:43â€¯PM] szybet
passcode code doesn't work


[4/24/2022 3:44â€¯PM] szybet
i mean, while going to sleep


[4/24/2022 3:44â€¯PM] szybet
when it boots its fine, im asked for it


[4/24/2022 3:45â€¯PM] tux_linux
Yeah, that's sometimes to fix up for 2.0


[4/24/2022 3:45â€¯PM] szybet
this horrible sleep manager is back D:


[4/24/2022 3:45â€¯PM] szybet
do i need to create a github issue or not for this?


[4/24/2022 3:46â€¯PM] tux_linux
No
I won't forget to fix it


[4/24/2022 3:47â€¯PM] szybet
sleep doesn't work even when disabling passcode


[4/24/2022 3:47â€¯PM] szybet
not cool


[4/24/2022 3:47â€¯PM] tux_linux
In what way?


[4/24/2022 3:48â€¯PM] szybet
oh, look:
1. disabled passcode
2. sleep button clicked
3. error 255
4. it goes back to inkbox
5. it goes to sleep, but in the inkbox menu so it seems like it freezes


[4/24/2022 3:48â€¯PM] tux_linux
Maybe try to reboot


[4/24/2022 3:49â€¯PM] tux_linux
At least it goes to sleep


[4/24/2022 3:52â€¯PM] szybet
now it works

{Reactions}
ğŸ‘ 

[4/29/2022 9:50â€¯PM] szybet
oh i forgot to test the think with plato


[5/2/2022 11:12â€¯PM] szybet
hmm


[5/2/2022 11:13â€¯PM] szybet
in `kobo:/kobo/sys/devices/platform/soc/2100000.aips-bus/21f8000.i2c/i2c-3/3-0032/ricoh619-battery/power_supply/mc13892_bat`


[5/2/2022 11:13â€¯PM] szybet
```
capacity            status              type
current_now         subsystem           uevent
device              technology          voltage_min_design
health              temp                voltage_now
power               time_to_empty_now
present             time_to_full_now

```


[5/2/2022 11:13â€¯PM] szybet
time_to_empty_now seems to say something but full no


[5/2/2022 11:14â€¯PM] szybet
technology says li-io, but in the device is a li po -_-


[5/2/2022 11:14â€¯PM] szybet
stupid kobo


[5/2/2022 11:14â€¯PM] szybet
temp says 35~ while charging?


[5/2/2022 11:15â€¯PM] szybet
i should feel that heat


[5/2/2022 11:15â€¯PM] szybet
`health` says good


[5/2/2022 11:16â€¯PM] szybet
current doesn't change ;/


[5/2/2022 11:17â€¯PM] szybet
are these informations available in other devices?


[5/2/2022 11:17â€¯PM] szybet
uevent:
```
POWER_SUPPLY_NAME=mc13892_bat
POWER_SUPPLY_STATUS=Discharging
POWER_SUPPLY_PRESENT=1
POWER_SUPPLY_VOLTAGE_NOW=4136700
POWER_SUPPLY_CURRENT_NOW=895
POWER_SUPPLY_CAPACITY=93
POWER_SUPPLY_TEMP=340
POWER_SUPPLY_TIME_TO_EMPTY_NOW=30420
POWER_SUPPLY_TIME_TO_FULL_NOW=3932100
POWER_SUPPLY_TECHNOLOGY=Li-ion
POWER_SUPPLY_HEALTH=Good
POWER_SUPPLY_VOLTAGE_MIN_DESIGN=3350
```


[5/2/2022 11:18â€¯PM] szybet
thats all interesting


[5/2/2022 11:18â€¯PM] szybet
i will check in the future if its the same in nickel, becouse this is weird


[5/2/2022 11:33â€¯PM] ninuje
The ttfull and ttempty do fluctuate almost sensibly, yeah


[5/2/2022 11:33â€¯PM] ninuje
(they're pretty fucking jittery, though, the simple act of sending a read that way will skew the results)


[5/2/2022 11:34â€¯PM] szybet
does li-ion matter? or should there be li-po


[5/2/2022 11:34â€¯PM] szybet
^for battery life


[5/2/2022 11:34â€¯PM] ninuje
Doesn't matter, but I don't recall it saying Li-Po anywhere


[5/2/2022 11:35â€¯PM] szybet
well in nickel battery life is better, so im searching the issue


[5/2/2022 11:35â€¯PM] szybet
@tux-linux  how do you launched plato? it has some lib problems


[5/2/2022 11:36â€¯PM] ninuje
It's available as early as in Mk. 5, at least: https://svn.ak-team.com/svn/Configs/trunk/Kindle/Kobo_Hacks/Scripts/bat_ttl.sh


[5/2/2022 11:36â€¯PM] ninuje
Nickel aggressively puts the device into standby after ~5s of inactivity


[5/2/2022 11:36â€¯PM] ninuje
(actual suspend to ram w/ wakeup pins untouched)


[5/2/2022 11:37â€¯PM] ninuje
Shouldn't be overly noticeable on i.MX SoCs, though, but makes a huge difference on sunxi


[5/2/2022 11:37â€¯PM] szybet
maybe thats why it was made that the touchscreen puts the device from sleep?


[5/2/2022 11:37â€¯PM] ninuje
Que?


[5/2/2022 11:37â€¯PM] szybet
edited it, my fault


[5/2/2022 11:37â€¯PM] ninuje
Wakes up, you mean?


[5/2/2022 11:37â€¯PM] szybet
yes


[5/2/2022 11:37â€¯PM] szybet
interrupts


[5/2/2022 11:38â€¯PM] ninuje
Yep


[5/2/2022 11:38â€¯PM] ninuje
buttons & touch


[5/2/2022 11:38â€¯PM] szybet
this makes sense


[5/2/2022 11:38â€¯PM] ninuje
and hall sensor and gyro, for that matter


[5/2/2022 11:38â€¯PM] szybet
but how they did that when i put it properly to sleep, it doesn't wake up when i touch the screen?


[5/2/2022 11:38â€¯PM] ninuje
We've just finished implementing that in KOReader


[5/2/2022 11:38â€¯PM] ninuje
state-extended to 1 disables the wakeup pins


[5/2/2022 11:39â€¯PM] szybet
but this didn't worked for the nia?...


[5/2/2022 11:39â€¯PM] ninuje
*shrug*


[5/2/2022 11:39â€¯PM] ninuje
Don't have a Nia, but if it's the same kernel as the Libra 2, it's probably hilariously borked


[5/2/2022 11:39â€¯PM] szybet
its propably similar


[5/3/2022 12:29â€¯AM] szybet
i have tryied to get this error about e-ink for an hour, no success -_-


[5/3/2022 12:31â€¯AM] szybet
im giving up for today


[5/3/2022 12:31â€¯AM] szybet
i have no idea why, how


[5/3/2022 12:31â€¯AM] szybet
i will try tommorow to get it


[5/3/2022 12:49â€¯AM] tux_linux
Did you enable x11?


[5/3/2022 1:09â€¯AM] szybet
Yes, of course


[5/3/2022 1:09â€¯AM] szybet
I have masÄ™ various thing in various apps


[5/3/2022 1:09â€¯AM] szybet
Nothing


[5/3/2022 1:09â€¯AM] tux_linux
Well, nice then
Click the next button a thousand times when reading a book


[5/3/2022 1:09â€¯AM] tux_linux
Toggle options menu several times a second
Etc


[5/3/2022 1:12â€¯AM] szybet
I tryied


[5/3/2022 1:12â€¯AM] szybet
I will tommorow too


[5/3/2022 1:12â€¯AM] szybet
No, not nice


[5/3/2022 1:13â€¯AM] szybet
We still dont know the issue


[5/3/2022 1:17â€¯AM] tux_linux
In the sense that you can probably use KoBox extensions


[5/3/2022 1:18â€¯AM] szybet
Propably


[5/4/2022 12:14â€¯AM] szybet
I was trying some more, nothing


[5/4/2022 12:14â€¯AM] szybet
No error, kobox works

{Reactions}
ğŸ˜‚ 

[5/4/2022 12:15â€¯AM] szybet
Now we need to know why


[5/4/2022 12:15â€¯AM] tux_linux
There is no explanation
When you want to show that sometime doesn't work, it suddenly works


[5/4/2022 12:16â€¯AM] tux_linux
Suggestion: spam epdc with multiple fbink writes


[5/4/2022 12:19â€¯AM] szybet
I was having kobox errors on the self made inkbox 2 month ago, the differences between now and then were:
- my self compiled kernel ( wakeups from the screen were still there 
- no recovery partition
- USB ip, was on, but I turned it on tonight and it works
- files were put be myself on the partition, maybe I missed something, maybe they were damaged because of network
- what more... idk, maybe you know?


[5/4/2022 12:20â€¯AM] tux_linux
the only thing I would see would be the kernel
but even there, it isn't related even in a remote way


[5/4/2022 12:20â€¯AM] szybet
Time on the device was not working properly


[5/4/2022 12:20â€¯AM] tux_linux
again, it's irqwake stuff
...maybe?


[5/4/2022 12:21â€¯AM] szybet
Maybe I could try an old kernel


[5/4/2022 12:21â€¯AM] tux_linux
maybe it is the fix for the libra


[5/4/2022 12:21â€¯AM] tux_linux
you could
don't expect everything to work in GUI/system though


[5/4/2022 12:22â€¯AM] szybet
Yeah, flash the image on it, there is probably your self made inkbox


[5/4/2022 12:23â€¯AM] szybet
You could try plato when the error is still there


[5/4/2022 12:23â€¯AM] tux_linux
libra has an emmc
so, not doable that easily


[5/4/2022 12:23â€¯AM] szybet
Idk, install in some way the system build from image script


[5/4/2022 2:43â€¯AM] ninuje
Wi-Fi being enabled or the device being plugged to a power source are somewhat proven way to avoid the epdc issues on the Libra 2, FWIW


[5/4/2022 2:43â€¯AM] tux_linux
Nonsense
How can that work


[5/4/2022 2:43â€¯AM] ninuje
I would wager switching to the performance governor and/or raising the minimum cpu freq would, too


[5/4/2022 2:43â€¯AM] tux_linux
Ok, thanks for the insight


[5/4/2022 2:43â€¯AM] ninuje
bus frequency and weird arm crap

{Reactions}
ğŸ‘ 

[5/4/2022 2:44â€¯AM] tux_linux
LIbra 2 is imx6sll right?


[5/4/2022 2:44â€¯AM] ninuje
yup: https://github.com/kobolabs/Kobo-Reader/commit/fb6846604f975420f6d621b132d104181b2b2f8f

{Embed}
https://github.com/kobolabs/Kobo-Reader/commit/fb6846604f975420f6d621b132d104181b2b2f8f
libra2 Â· kobolabs/Kobo-Reader@fb68466
/mnt/data/projects/git/conversations/media/fb6846604f975420f6d621b132d104181b2b2f8f-2748B


[5/4/2022 2:45â€¯AM] tux_linux
Nia is imx6**u**ll
maybe it can work too
Libra original is imx6sll


[5/4/2022 2:45â€¯AM] ninuje
Oh, the Nia runs an ULL, never mind me


[5/4/2022 2:45â€¯AM] tux_linux
You never know...


[5/4/2022 2:45â€¯AM] ninuje
There's like, three of 'em in the wild, hard to tell ğŸ˜„

{Reactions}
ğŸ‘ ğŸ˜„ 

[5/4/2022 2:46â€¯AM] tux_linux
Still, thanks for the suggestion, it might work to "fix" this problem for the Libra original


[5/4/2022 2:46â€¯AM] tux_linux
and maybe in the Nia with some luck


[5/4/2022 8:41â€¯AM] szybet
i was looking for the issue with wifi enabled and plugged into power source...


[5/4/2022 8:42â€¯AM] szybet
well more testing is needed


[5/4/2022 11:36â€¯PM] szybet
i tested it, its true


[5/4/2022 11:36â€¯PM] szybet
+ the wifi interface dissapears after that


[5/4/2022 11:36â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-6E206.txt


[5/4/2022 11:44â€¯PM] szybet
maybe just the modules were unloaded?


[5/4/2022 11:44â€¯PM] szybet
idk


[5/4/2022 11:50â€¯PM] szybet
it cant be reversed sadly


[5/4/2022 11:53â€¯PM] szybet
**setting performance governor avoids the issue**


[5/4/2022 11:53â€¯PM] szybet
but it was tested shortly


[5/4/2022 11:53â€¯PM] szybet
and kobox apps are faster


[5/4/2022 11:54â€¯PM] szybet
and i dont know if unsetting it after would change something


[5/4/2022 11:54â€¯PM] szybet
hmm


[5/4/2022 11:54â€¯PM] szybet
@tux-linux  what launches kobox apps, what is called when they are closed? i want to add some code for testing, described a bit above


[5/4/2022 11:59â€¯PM] tux_linux
Hmmm
Interesting
/etc/init.d/xorg.sh


[5/5/2022 12:04â€¯AM] szybet
You should test it on the libra tok


[5/7/2022 7:02â€¯PM] szybet
update screen permission denied happened to me now while connected to usb + wifi


[5/7/2022 7:02â€¯PM] szybet
i was developing sanki


[5/7/2022 7:02â€¯PM] szybet
not good


[5/7/2022 7:02â€¯PM] szybet
i will try one more time but with everything this + performance governor


[5/7/2022 8:28â€¯PM] szybet
Happened again, with performance governor


[5/7/2022 8:28â€¯PM] szybet
I assume its random


[5/7/2022 10:11â€¯PM] tux_linux
Sad


[5/7/2022 10:16â€¯PM] szybet
we would only need to know what causes the error in the kernel


[5/7/2022 10:16â€¯PM] szybet
:/


[5/8/2022 1:05â€¯AM] ninuje
Needs verbose epdc logging enabled


[5/8/2022 1:07â€¯AM] szybet
how?


[5/8/2022 2:28â€¯AM] ninuje
I don't do kernels, check what actually enables the gallen_log stuff (or whatever it's actually using)


[5/8/2022 2:28â€¯AM] ninuje
Might be a mix of actually sane upstream stuff and crazy ntx hacks


[5/16/2022 12:18â€¯PM] szybet
this here


[5/16/2022 12:18â€¯PM] szybet
to compile and write


[5/16/2022 12:18â€¯PM] szybet
i hope


[5/16/2022 12:33â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/sleep-518C1.zip


[5/17/2022 9:30â€¯PM] szybet
so continuing the thread from #dev


[5/17/2022 9:30â€¯PM] szybet
the kernel compiled from my arch machine, not debian container


[5/17/2022 9:30â€¯PM] szybet
what the f*ck is wrong with all of this


[5/17/2022 9:37â€¯PM] tux_linux
Arch


[5/17/2022 9:37â€¯PM] tux_linux
Couldn't find the error in the log from my phone


[5/17/2022 9:38â€¯PM] szybet
did you even understand what im talking?


[5/17/2022 9:38â€¯PM] tux_linux
Yes


[5/17/2022 9:39â€¯PM] tux_linux
I didn't have success with Gentoo


[5/17/2022 9:39â€¯PM] tux_linux
IIRC not Arch either


[5/17/2022 9:39â€¯PM] szybet
you have problems too?


[5/17/2022 9:40â€¯PM] tux_linux
I build it on Debian


[5/17/2022 9:41â€¯PM] szybet
there is something messed up with permissions


[5/17/2022 9:41â€¯PM] szybet
i created a user with sudo access, cloned the repo clean and it compiled on debian


[5/17/2022 9:41â€¯PM] szybet
it didn't worked with root ( user )


[5/17/2022 9:42â€¯PM] szybet
also, can i test the kernel with emu?


[5/17/2022 9:42â€¯PM] szybet
if it will work


[5/17/2022 9:52â€¯PM] tux_linux
No


[5/17/2022 9:52â€¯PM] tux_linux
It needs the emu kernel


[5/17/2022 9:52â€¯PM] szybet
meh


[5/17/2022 9:59â€¯PM] szybet
I updated the kernel


[5/17/2022 9:59â€¯PM] szybet
and error code 5 appered


[5/17/2022 9:59â€¯PM] szybet
wtf


[5/17/2022 10:00â€¯PM] szybet
can i access anything? do i need to open the device? ;_;


[5/17/2022 10:02â€¯PM] szybet
well help @tux-linux


[5/17/2022 10:22â€¯PM] tux_linux
Probably


[5/17/2022 10:22â€¯PM] szybet
ok, why did this happen


[5/17/2022 10:22â€¯PM] szybet
?


[5/17/2022 10:22â€¯PM] tux_linux
I don't know


[5/17/2022 10:22â€¯PM] szybet
what


[5/17/2022 10:22â€¯PM] tux_linux
It would say that because your rootfs signature is invalid


[5/17/2022 10:22â€¯PM] tux_linux
OH


[5/17/2022 10:23â€¯PM] tux_linux
You forgot to make device nodes


[5/17/2022 10:23â€¯PM] tux_linux
Am I right?


[5/17/2022 10:23â€¯PM] szybet
?...


[5/17/2022 10:23â€¯PM] szybet
why isint it in the script


[5/17/2022 10:23â€¯PM] szybet
WHY?


[5/17/2022 10:23â€¯PM] tux_linux
there is a script


[5/17/2022 10:23â€¯PM] szybet
why isin't it launched from the main script


[5/17/2022 10:23â€¯PM] tux_linux
For some reason
I don't remember
It could be included


[5/17/2022 10:23â€¯PM] tux_linux
It is also written in the readme


[5/17/2022 10:24â€¯PM] szybet
oh it is in the readme


[5/17/2022 10:24â€¯PM] szybet
so the dumb person here is me


[5/17/2022 10:24â€¯PM] szybet
nice...


[5/17/2022 10:24â€¯PM] tux_linux
Well, you know the fix


[5/17/2022 10:24â€¯PM] szybet
Where is my ifixit kit


[5/17/2022 10:24â€¯PM] szybet
ğŸ¥´


[5/17/2022 10:28â€¯PM] tux_linux
Maybe a credit card can do


[5/17/2022 10:29â€¯PM] szybet
why isin't debug mode launched?


[5/17/2022 10:29â€¯PM] szybet
its a rooted kernel


[5/17/2022 10:29â€¯PM] tux_linux
Because it can't launch


[5/17/2022 10:29â€¯PM] szybet
becouse


[5/17/2022 10:29â€¯PM] tux_linux
No devices nodes


[5/17/2022 10:30â€¯PM] szybet
this makes sense


[5/17/2022 10:35â€¯PM] szybet
can't you simple check if files exist ( device nodes ) ?


[5/17/2022 10:39â€¯PM] tux_linux
I will add it to the main script


[5/17/2022 10:39â€¯PM] szybet
do i need to do it myself / create a github issie?


[5/17/2022 10:40â€¯PM] szybet
for 100%?


[5/17/2022 10:44â€¯PM] szybet
with what key do i need to sign the gui bundle?


[5/17/2022 10:45â€¯PM] szybet
the nia one?


[5/17/2022 10:47â€¯PM] szybet
its an update.isa


[5/17/2022 10:47â€¯PM] szybet
weird


[5/17/2022 10:47â€¯PM] szybet
what


[5/17/2022 11:05â€¯PM] szybet
so basically how do i update the gui bundle


[5/17/2022 11:05â€¯PM] szybet
replace in update/update.isa


[5/17/2022 11:05â€¯PM] szybet
now i remember


[5/17/2022 11:14â€¯PM] szybet
we reallty need this guide


[5/17/2022 11:23â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/IMG_20220517_232327-1F814.jpg


[5/17/2022 11:23â€¯PM] szybet
Szybet_bundle is propably outdated


[5/17/2022 11:23â€¯PM] szybet
ğŸ¥´


[5/17/2022 11:26â€¯PM] tux_linux
What's the problem?


[5/17/2022 11:26â€¯PM] szybet
its asking me to update


[5/17/2022 11:26â€¯PM] szybet
propably becouse i set gui_bundle version to szybet_bundle


[5/17/2022 11:26â€¯PM] szybet
Â¯\_(ãƒ„)_/Â¯


[5/17/2022 11:26â€¯PM] szybet
is there a way to disable this message?


[5/17/2022 11:27â€¯PM] tux_linux
What's in .inkbox?


[5/17/2022 11:27â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-38303.png


[5/17/2022 11:27â€¯PM] szybet
huh


[5/17/2022 11:28â€¯PM] tux_linux
Really strange


[5/17/2022 11:28â€¯PM] tux_linux
What rootfs commit are you on?


[5/17/2022 11:29â€¯PM] tux_linux
Try `restart update_inkbox`


[5/17/2022 11:29â€¯PM] tux_linux
Then relaunch GUI


[5/17/2022 11:30â€¯PM] szybet
i cloned it a hour ago


[5/17/2022 11:30â€¯PM] szybet
```
cp: cannot create regular file '/kobo/mnt/onboard/.adds/qt-linux-5.15.2-kobo/lib/libzip.so': Read-only file system
0 files (152.0 KiB) copied in 0.1 seconds (  0.0 KiB/s).

```


[5/17/2022 11:30â€¯PM] szybet
well


[5/17/2022 11:31â€¯PM] szybet
so now how do i add single libraries


[5/17/2022 11:32â€¯PM] tux_linux
Repackage bundle


[5/17/2022 11:32â€¯PM] szybet
i mean for user apps


[5/17/2022 11:33â€¯PM] szybet
they cant do that


[5/17/2022 11:33â€¯PM] szybet
```
kobo:(unknown)# service update_inkbox restart
 * Checking for available updates ...
Update skipped or no update available, aborting ...                                                           [ ok ]
ash: getcwd: No such file or directory
kobo:(unknown)# 

```


[5/18/2022 12:26â€¯AM] tux_linux
Add them in a lib/ folder for each app, we can tweak ld library path to look there too


[5/18/2022 7:16â€¯AM] szybet
How


[5/18/2022 12:47â€¯PM] tux_linux
Well, for each app that needs a particular lib, we can put it in a folder where the app is /mnt/onboard/.apps/[app-isa-root]/lib


[5/18/2022 12:48â€¯PM] tux_linux
I think that doing it with squashfs in .isa is simpler for signing


[5/18/2022 12:51â€¯PM] tux_linux
The idea:
1. Put .isa app bundle in .apps
2. On next reboot a shell script detects if there are apps there. If yes it verifies the bundle and if successful creates a folder and mounts the app to it. If signature is invalid it might display an alert splash or a dialog (generalDialog) to tell the user.


[5/18/2022 12:52â€¯PM] tux_linux
It will need to be run each time inkbox_gui starts, and maybe it can be an ibxd FIFO function to allow live updating


[5/18/2022 12:53â€¯PM] tux_linux
Why did I write this here


[5/18/2022 12:54â€¯PM] szybet
stop doing the boot longer


[5/18/2022 12:54â€¯PM] szybet
i don't accept this


[5/18/2022 12:54â€¯PM] tux_linux
When do you want to verify apps then


[5/18/2022 12:56â€¯PM] szybet
we cant verify them once?


[5/18/2022 12:56â€¯PM] tux_linux
This is the biggest security risk


[5/18/2022 12:57â€¯PM] szybet
and this overcomplicates things


[5/18/2022 12:57â€¯PM] tux_linux
You keep asking me for security risks, there's one now


[5/18/2022 12:57â€¯PM] szybet
like how will you manage storage for apps? i want to store decks with sanki


[5/18/2022 12:58â€¯PM] szybet
i see


[5/18/2022 12:58â€¯PM] tux_linux
For that you can create a folder in apps called `[app-name_data]`


[5/18/2022 12:58â€¯PM] tux_linux
Please go to #dev


[5/24/2022 11:41â€¯PM] szybet
sometimes i put my nia to sleep for one day, i come back and its 50%

sometimes i come back, its 99%


[5/24/2022 11:43â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-5521B.png


[8/27/2022 5:17â€¯PM] andi15701
is TP3(?)8  (the 4 pads next to the console) a uart?


[8/27/2022 5:17â€¯PM] andi15701
the bluetooth one? or the disabled one?


[8/27/2022 5:18â€¯PM] szybet
you mean?


[8/27/2022 5:18â€¯PM] szybet
the big pads that are THT are uart, i use them


[8/27/2022 5:18â€¯PM] szybet
but the small ones on the left, idk


[8/27/2022 5:21â€¯PM] andi15701
yes, the non-THT


[8/27/2022 5:21â€¯PM] andi15701
https://github.com/Szybet/niAudio/blob/main/images/nia/img8.jpg -> what is the chip besides C137?

{Embed}
https://github.com/Szybet/niAudio/blob/main/images/nia/img8.jpg
niAudio/img8.jpg at main Â· Szybet/niAudio
Kobo nia ereader with audio added. Contribute to Szybet/niAudio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/niAudio-7924C


[8/27/2022 5:22â€¯PM] szybet
well i didnt tryied

tht ones are connected to the cpu, so i can see uboot messages


[8/27/2022 5:23â€¯PM] szybet
wait


[8/27/2022 5:23â€¯PM] andi15701
https://github.com/Szybet/niAudio/blob/main/images/nia/img10.jpg the chip on the flex pcb?

{Embed}
https://github.com/Szybet/niAudio/blob/main/images/nia/img10.jpg
niAudio/img10.jpg at main Â· Szybet/niAudio
Kobo nia ereader with audio added. Contribute to Szybet/niAudio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/niAudio-7924C


[8/27/2022 5:26â€¯PM] szybet
i wonder why i didn't uploaded it earlier to github

{Attachments}
/mnt/data/projects/git/conversations/media/chips-C20E4.pdf


[8/27/2022 5:26â€¯PM] szybet
here is everything you want to know


[8/27/2022 5:26â€¯PM] szybet
clear pictures with names that i readed using a magnifying glass


[8/27/2022 5:27â€¯PM] andi15701
one typo: Ricoh RC5... and not AC5


[8/27/2022 5:28â€¯PM] szybet
oh okay


[8/27/2022 5:34â€¯PM] andi15701
BWNCSA : very interesting: I guess it is Sy7636A but on the Kobo Libra H2O, it has a different marking


[8/27/2022 5:45â€¯PM] szybet
well i uploaded everything on github


[8/27/2022 5:45â€¯PM] szybet
this pdf


[8/27/2022 7:31â€¯PM] andi15701
LAN eKTF2232ALW: LAN is part of the logo of elan, so it is probably eLAN


[8/27/2022 7:32â€¯PM] andi15701
we have


[8/27/2022 7:32â€¯PM] andi15701
andi@aktux:~/kernel/drivers/input/touchscreen$ grep 'compatible.*ektf' *.c
ektf2127.c:    { .compatible = "elan,ektf2127" },
ektf2127.c:    { .compatible = "elan,ektf2132" },
elants_i2c.c:    { .compatible = "elan,ektf3624", .data = (void *)EKTF3624 },


[8/27/2022 7:33â€¯PM] andi15701
hopefully it is compatible


[8/27/2022 7:33â€¯PM] szybet
it does look like it


[8/27/2022 7:33â€¯PM] ninuje
That's the controller in the Sage & Elipsa, fwiw


[8/27/2022 7:33â€¯PM] ninuje
(It sucks hairy balls)


[8/27/2022 7:34â€¯PM] szybet
btw... isint it a risk running an untested kernel?


[8/27/2022 7:34â€¯PM] ninuje
Very prone to throwing events into the void when it's in low power state


[8/27/2022 7:34â€¯PM] szybet
hardware level damage?


[8/27/2022 7:40â€¯PM] andi15701
the risk is not totally zero, but I think the risk of damaging something while fiddling with serial cable is also there. But I think the most important parts are tested (cpu frequency handling for example). Next risk is mixing up pins. There are some chances to mix something important up


[8/27/2022 7:40â€¯PM] andi15701
But I have blew up hardware because of bad kernels


[8/27/2022 7:41â€¯PM] szybet
too much voltage on regulators for example?


[8/27/2022 7:41â€¯PM] andi15701
yes


[8/27/2022 7:41â€¯PM] szybet
thats bad


[8/27/2022 7:42â€¯PM] szybet
i dont really can afford blowing my only ereader


[8/27/2022 7:42â€¯PM] andi15701
do you have shell access?


[8/27/2022 7:42â€¯PM] andi15701
to the nia


[8/27/2022 7:42â€¯PM] szybet
i have access to everything


[8/27/2022 7:43â€¯PM] andi15701
so you can dump regulator states


[8/27/2022 7:43â€¯PM] szybet
its possible, not like i knew how


[8/27/2022 7:47â€¯PM] andi15701
```for name in /sys/class/regulator/regulator.* ; do echo `cat $name/name` `cat $name/microvolts`  `cat $name/state` ; done```


[8/27/2022 7:47â€¯PM] andi15701
no


[8/27/2022 7:47â€¯PM] andi15701
messed up


[8/27/2022 7:48â€¯PM] tux_linux
`for name in /sys/class/regulator/regulator.* ; do echo $(cat $name/name) $(cat $name/microvolts) $(cat $name/state) ; done `


[8/27/2022 7:48â€¯PM] szybet
use \`\`\`


[8/27/2022 7:48â€¯PM] szybet
nope


[8/27/2022 7:48â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/message-2D0C1.txt


[8/27/2022 7:49â€¯PM] tux_linux
changed it


[8/27/2022 7:49â€¯PM] szybet
```
obo:~# for name in /sys/class/regulator/regulator.* ; do echo `cat $name/name` `cat $n
ame/microvolts`  `cat $name/state` ; done
cat: /sys/class/regulator/regulator.0/microvolts: No such file or directory
cat: /sys/class/regulator/regulator.0/state: No such file or directory
regulator-dummy
vdd3p0 3200000 enabled
RICOH619_DC5 1800000 enabled
RICOH619_LDO1 900000 disabled
RICOH619_LDO2 900000 enabled
RICOH619_LDO3 900000 disabled
RICOH619_LDO4 900000 disabled
RICOH619_LDO5 600000 enabled
RICOH619_LDO6 600000 enabled
RICOH619_LDO7 900000 enabled
RICOH619_LDO8 1800000 enabled
RICOH619_LDO9 900000 disabled
cpu 1250000 enabled
RICOH619_LDO10 900000 disabled
RICOH619_LDORTC1 1700000 enabled
RICOH619_LDORTC2 900000 disabled
cat: /sys/class/regulator/regulator.23/microvolts: No such file or directory
DISPLAY_SY7636 disabled
cat: /sys/class/regulator/regulator.24/microvolts: No such file or directory
VCOM_SY7636 disabled
cat: /sys/class/regulator/regulator.25/microvolts: No such file or directory
V3P3_SY7636 disabled
cat: /sys/class/regulator/regulator.26/state: No such file or directory
TMST_SY7636 0
vddsoc 1250000 enabled
cat: /sys/class/regulator/regulator.4/state: No such file or directory
vref-3v3 3300000
cat: /sys/class/regulator/regulator.5/state: No such file or directory
SD1_SPWR 3000000
RICOH619_DC1 1400000 enabled
RICOH619_DC2 600000 enabled
RICOH619_DC3 600000 enabled
RICOH619_DC4 1200000 enabled
kobo:~# 


```


[8/27/2022 7:50â€¯PM] szybet
well i can help you prepare the kernel, but i wont test it


[8/27/2022 7:50â€¯PM] szybet
tux-linux would be sad if he lost a contributor


[8/27/2022 7:50â€¯PM] szybet
then we can wait for others to test it


[8/27/2022 7:51â€¯PM] tux_linux
happens all the time hehe


[8/27/2022 7:51â€¯PM] tux_linux
but you two seem to be hanging tight


[8/27/2022 7:51â€¯PM] szybet
here were some people that had the nia... but we cant ping them because we still didnt created roles for devices


[8/27/2022 7:51â€¯PM] szybet
but its not a reason to do it intentionally knowing the risk


[8/27/2022 7:51â€¯PM] szybet
ğŸ¥´


[8/27/2022 7:52â€¯PM] ninuje
It's been an incredibly unpopular device in my experience, FWIW


[8/27/2022 7:52â€¯PM] ninuje
So good luck finding actual users? ;o)


[8/27/2022 7:52â€¯PM] szybet
here were 5 people using it


[8/27/2022 7:52â€¯PM] szybet
for sure


[8/27/2022 7:52â€¯PM] tux_linux
yeah


[8/27/2022 7:52â€¯PM] szybet
there were also like 3 people in xcsoar project


[8/27/2022 7:53â€¯PM] szybet
maybe they would want to do this? they have problems with the existing kernel


[8/27/2022 7:53â€¯PM] ninuje
(Which... makes sense, actually, it's a failed Clara 2)


[8/27/2022 7:53â€¯PM] ninuje
Hence the actual Clara 2 that's in the works ;p


[8/27/2022 7:53â€¯PM] ninuje
Possibly not an NTX board (here's hoping)


[8/27/2022 7:53â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/unknown-4DB40.png


[8/27/2022 7:55â€¯PM] tux_linux
it could be worse...


[8/27/2022 7:55â€¯PM] tux_linux
*thinks about B300*


[8/27/2022 7:55â€¯PM] szybet
what are the options?


[8/27/2022 7:55â€¯PM] szybet
i hope they wont lock it down


[8/27/2022 7:56â€¯PM] ninuje
Well, from where I'm standing the latest round of i.MX devices are *more* of a failure than the sunxi ones


[8/27/2022 7:56â€¯PM] ninuje
We knew going in that the sunxi would be awful at power efficiency


[8/27/2022 7:56â€¯PM] ninuje
Because we're used to that on PB devices


[8/27/2022 7:56â€¯PM] ninuje
But at least they don't randomly crash  every 5 seconds (lookin' at you, Libra 2)


[8/27/2022 7:57â€¯PM] szybet
they need to put a bigger as for capacity battery in them... they are really small


[8/27/2022 7:57â€¯PM] ninuje
That's the Elipsa. It goes by purely by having two gigantic cells.


[8/27/2022 7:57â€¯PM] ninuje
The Sage... not so much ;o)


[8/27/2022 7:57â€¯PM] andi15701
well, I like the imx6 ones


[8/27/2022 7:58â€¯PM] ninuje
And the hastily designed workaround (a.k.a., the PowerCover) behaves *infinitely* worse than a dumb usb power brick, it's hilarious


[8/27/2022 7:58â€¯PM] andi15701
quite well pm in mainline kernel


[8/27/2022 7:58â€¯PM] ninuje
Oh, definitely, I'd have been happy w/ an i.MX7D


[8/27/2022 7:58â€¯PM] andi15701
that one has afaik bad pm in mainline kernel


[8/27/2022 7:59â€¯PM] andi15701
hmm, looking at ebay, the nia is at >100 euros...


[8/27/2022 7:59â€¯PM] andi15701
ouch


[8/27/2022 7:59â€¯PM] ninuje
I'll believe it, AFAIK, rM had trouble with it, and lab126 too, it took them *ages* to polish it for the Oasis 2


[8/27/2022 8:00â€¯PM] ninuje
Possibly longer than it took them to deal with a new platform for the PW5 (mtk), although they had extensive experience with that one with the Fires


[8/27/2022 8:00â€¯PM] ninuje
And it *trounces* the Sage, it's hilarious


[8/27/2022 8:01â€¯PM] ninuje
Probably helps that the kernel & hardware team doesn't feel like a lone guy working in his garage (hi, ntx ;p) ğŸ˜„


[8/27/2022 8:02â€¯PM] tux_linux
yeah


[8/27/2022 8:02â€¯PM] andi15701
I think if someone makes good pm for imx7, then everyone will have fun with it


[8/27/2022 8:02â€¯PM] andi15701
it is imho more a task of NXP to mainline it


[8/27/2022 8:02â€¯PM] ninuje
Yup


[8/27/2022 8:03â€¯PM] ninuje
Putting one out on aarch64 would be neat, too.


[8/27/2022 8:03â€¯PM] andi15701
About the nia price, I expected something well below 100 euros


[8/27/2022 8:03â€¯PM] tux_linux
**yes**


[8/27/2022 8:03â€¯PM] tux_linux
with 8G of RAM


[8/27/2022 8:03â€¯PM] tux_linux
ok no I'm just dreaming


[8/27/2022 8:04â€¯PM] ninuje
Although admittedly I have no idea how the power efficiency compares to our old cortex cores, so I don't really know if that would even make sense ğŸ˜‰

{Reactions}
ğŸ‘ 

[8/27/2022 8:04â€¯PM] szybet
it was 500 zÅ‚ ( 110 Euros ) when i buyed it almost a year ago


[8/27/2022 8:05â€¯PM] tux_linux
here in Canada we sometimes have very good deals about Kobos


[8/27/2022 8:05â€¯PM] szybet
in poland only one online shop selled one kobo, it was the nia...


[8/27/2022 8:07â€¯PM] andi15701
do they sell tolinos?


[8/27/2022 8:07â€¯PM] tux_linux
no, Kobos only (AFAIK, eBay is not impossible though)


[8/27/2022 8:07â€¯PM] tux_linux
Kobo's home country is Canada


[8/27/2022 8:07â€¯PM] tux_linux
so, there you go


[8/27/2022 8:08â€¯PM] andi15701
well, they question was more for @Szybet


[8/27/2022 8:08â€¯PM] tux_linux
oh


[8/27/2022 8:08â€¯PM] tux_linux
it's probably possible to order them from Germany


[8/27/2022 8:09â€¯PM] szybet
nope, i havent seen any

but in germany they are everywhere, even in random bool libraries to buy


[8/27/2022 8:10â€¯PM] andi15701
yes, a friend of mine bought one when there was a good deal. We thought it would be compatible with my Kobo Clara HD, everyone says they are identical


[8/27/2022 8:10â€¯PM] andi15701
looked at the chips, and board it seems to be


[8/27/2022 8:10â€¯PM] andi15701
but


[8/27/2022 8:11â€¯PM] andi15701
*really* looking at the SoC reveals that the shine3 has a imx6sl and not a 6sll


[8/27/2022 8:11â€¯PM] andi15701
the kobo bootloader managed to spit something out on serial/


[8/27/2022 8:12â€¯PM] tux_linux
that's not identical at all...


[8/27/2022 8:12â€¯PM] andi15701
but did not find the sdcard


[8/27/2022 8:12â€¯PM] tux_linux
probably PCB issue


[8/27/2022 8:12â€¯PM] tux_linux
wrong memory addresses


[8/27/2022 8:12â€¯PM] andi15701
but if pictures are bad  you are too lazy to compare


[8/27/2022 8:12â€¯PM] andi15701
yes


[8/27/2022 8:12â€¯PM] andi15701
PCB seems same


[8/27/2022 8:12â€¯PM] andi15701
same markings


[8/27/2022 8:13â€¯PM] andi15701
too lazy compare exactly


[8/28/2022 1:11â€¯PM] andi15701
yes, these voltages in the nia look quite different


[8/28/2022 1:52â€¯PM] andi15701
about the battery connectors in the nia and elsewhere: do you know where to order them or part numbers? The reason I am asking: I would like to do things like current measurement (especially during suspend, e.g. without the need so acces /sys/class/power_supply/*battery/current_now) with a stable setup without testing the protection circuit of the battery every day


[8/28/2022 1:53â€¯PM] szybet
just solder cables

or ask on reddit


[8/28/2022 1:57â€¯PM] szybet
on the nia i dont think it works
```
kobo:/sys/class/power_supply# cat /sys/class/power_supply/*/current_now
845
kobo:/sys/class/power_supply# 
```
its always 845, even if i turn wifi on


[8/28/2022 1:58â€¯PM] andi15701
Every device running my kernel has shown sane values so far


[8/28/2022 1:58â€¯PM] szybet
well it also shows, just doesnt change


[8/28/2022 1:59â€¯PM] andi15701
because the driver there is a mess


[8/28/2022 1:59â€¯PM] szybet
Â¯\_(ãƒ„)_/Â¯


[8/28/2022 1:59â€¯PM] szybet
as everything


[8/28/2022 1:59â€¯PM] szybet
maybe disconnect the battery / supply power over usb?


[8/28/2022 1:59â€¯PM] szybet
as what niluje talked, it should work


[8/28/2022 2:00â€¯PM] andi15701
yes, it works


[8/28/2022 2:03â€¯PM] andi15701
but for example that messy code turns off the fuel gauge in some situations, I would like to understand the effects, especially on power consumption, and there I have no other chance.


[8/28/2022 2:04â€¯PM] andi15701
if those connectors are not found, probably the easiest is to hack the libra


[8/28/2022 2:04â€¯PM] andi15701
as the battery has no connectors there anyways


[8/28/2022 2:07â€¯PM] andi15701
well, after adding some more kapton tape around the solderig points...


[8/28/2022 2:49â€¯PM] szybet
well maybe just use the connector from the battery


[8/28/2022 2:49â€¯PM] szybet
cut the wires


[8/28/2022 2:49â€¯PM] szybet
if you really want


[8/28/2022 11:33â€¯PM] ninuje
I've been doing power draw measurements with a cheap USB meter (because my devices are closed), and it's accurate enough to at least confirm that sunxi is terrible at PM ;o)


[8/28/2022 11:33â€¯PM] ninuje
Because, yeah, the sysfs stuff reports wonky shit on NTX kernels, can confirm ğŸ˜‰


[8/28/2022 11:35â€¯PM] ninuje
It's... less helpful on devices that refuse to enter suspend while connected to a power source, though ;o) (Mk < 6, IIRC?)


[8/30/2022 9:11â€¯PM] andi15701
yes, and I want to be able to close my devices also, so I would rather use that plug solution. But for my Libra I would insert something permanently because I do not need to close it because of broken display. Power from battery or from usb is a different situation, so you will have limitied results. Interesting would be the analysis of this: https://github.com/jwrdegoede/rtl8189ES_linux/issues/82 but hopefully the better values of near-mainline kernels will already help here

{Embed}
https://github.com/jwrdegoede/rtl8189ES_linux/issues/82
card regulator is not turned off if iface is down Â· Issue #82 Â· jwr...
The sdio card is not properly unpowered when device is down. Expectation would be that regulator is powered down when iface isis down. Removing the module helps. pmos-shine3:/sys/bus/platform/devic...


[8/30/2022 11:37â€¯PM] ninuje
Re: that issue; there's an sdio_wifi_power kernel module on most NTX boards that does just that


[8/30/2022 11:37â€¯PM] ninuje
It's... fairly hilarious actually, because it's just


[8/30/2022 11:38â€¯PM] ninuje
```
#include <linux/module.h>
#include <linux/init.h>
#include <linux/slab.h>

extern void ntx_wifi_power_ctrl (int isWifiEnable);
static int __init sdio_wifi_pwr_init(void)
{
        ntx_wifi_power_ctrl(1);
        return 0;
}
module_init(sdio_wifi_pwr_init);

static void __exit sdio_wifi_pwr_exit(void)
{
        ntx_wifi_power_ctrl(0);
}
module_exit(sdio_wifi_pwr_exit);

MODULE_DESCRIPTION("sdio wifi power control driver");
MODULE_AUTHOR("Netronix");
MODULE_LICENSE("GPL");
```


[8/30/2022 11:38â€¯PM] ninuje
That happens to be an ntx_io ioctl


[8/30/2022 11:38â€¯PM] ninuje
Someone finally realized that it was dumb as hell, and they stopped shipping that and started actually using the ioctl ğŸ˜„


[8/30/2022 11:39â€¯PM] szybet
is this a way to shut off the wifi chip completly?


[8/30/2022 11:40â€¯PM] ninuje
https://github.com/koreader/koreader/blob/615072c7771ca801bbc1d70154956fac1d1b4b61/platform/kobo/disable-wifi.sh#L62-L66

{Embed}
https://github.com/koreader/koreader/blob/615072c7771ca801bbc1d70154956fac1d1b4b61/platform/kobo/disable-wifi.sh
koreader/disable-wifi.sh at 615072c7771ca801bbc1d70154956fac1d1b4b6...
An ebook reader application supporting PDF, DjVu, EPUB, FB2 and many more formats, running on Cervantes, Kindle, Kobo, PocketBook and Android devices - koreader/disable-wifi.sh at 615072c7771ca801b...
/mnt/data/projects/git/conversations/media/koreader-BAE7F


[8/30/2022 11:40â€¯PM] szybet
sooo yes?


[8/30/2022 11:40â€¯PM] ninuje
`#define CM_WIFI_CTRL                    208`


[8/30/2022 11:40â€¯PM] ninuje
(ntx_io)


[8/30/2022 11:41â€¯PM] szybet
i speak english, not c
unfortunately


[8/30/2022 11:41â€¯PM] ninuje
Also `#define CM_BLUETOOTH_PWR                126` because same chip


[8/30/2022 11:42â€¯PM] szybet
i assume it as a yes


[8/30/2022 11:42â€¯PM] szybet
same chip has bluetooth?...


[8/30/2022 11:43â€¯PM] ninuje
IIRC, Cervantes had some comment in their HAL about it on some of their boards, where they purposefully chose to *NOT* power it off because they didn't like the latency trade-off


[8/30/2022 11:43â€¯PM] ninuje
That was paired with the usual "we sleep here because ntx told us to" comment around module loading/unloading that anyone that's ever dealt with wifi on ntx should be familiar with ğŸ˜‰


[8/31/2022 12:01â€¯AM] tux_linux
ioctl on `/dev/ntx_io`


[8/31/2022 12:01â€¯AM] szybet
yea and


[8/31/2022 12:01â€¯AM] tux_linux
to explain what you seemed not to understand


[8/31/2022 12:02â€¯AM] szybet
???


[8/31/2022 12:03â€¯AM] tux_linux
well, probably, according to KOReader


[8/31/2022 12:03â€¯AM] szybet
are we implementing it?


[8/31/2022 12:04â€¯AM] tux_linux
no


[8/31/2022 12:04â€¯AM] tux_linux
it works now


[8/31/2022 12:04â€¯AM] tux_linux
so


[8/31/2022 12:04â€¯AM] tux_linux
fine


[8/31/2022 12:04â€¯AM] tux_linux
i just need to fix the Glo HD


[8/31/2022 12:04â€¯AM] tux_linux
but that's probably unrelated


[8/31/2022 12:05â€¯AM] szybet
"battery problems on the nia"


[8/31/2022 12:05â€¯AM] szybet
did you heard that?


[8/31/2022 12:05â€¯AM] tux_linux
oh, didn't see


[8/31/2022 12:05â€¯AM] tux_linux
well
try it


[8/31/2022 12:22â€¯AM] szybet
https://github.com/Kobo-InkBox/inkbox/discussions/38

{Embed}
https://github.com/Kobo-InkBox/inkbox/discussions/38
Future To-Do's and possible feature requests Â· Discussion #38 Â· Kob...
Turning off the interface using ioctl on the nia and other devices: in toggle.sh and ipd
/mnt/data/projects/git/conversations/media/38-6D63B


[8/31/2022 12:22â€¯AM] szybet
there is already too much to do...


[8/31/2022 8:30â€¯AM] andi15701
well, that all is silly, userspace should have one way for all devices. That is rfkill block wifi


[8/31/2022 8:30â€¯AM] andi15701
and a good kernel should hide most platform-specific stuff


[8/31/2022 8:31â€¯AM] andi15701
if you accept removing modules as a solution, rmmod 8189fs


[8/31/2022 8:31â€¯AM] szybet
kobo

good kernel

those things dont combine


[8/31/2022 8:31â€¯AM] andi15701
does the thing on mainline


[8/31/2022 8:31â€¯AM] szybet
so removing modules actually shuts the chip off? no need for this ioctl?


[8/31/2022 8:31â€¯AM] andi15701
that is why I am trying to mainline things as much as possible


[8/31/2022 8:31â€¯AM] andi15701
on mainline kernels, yes


[8/31/2022 8:32â€¯AM] andi15701
the ioctl is simply not there


[8/31/2022 8:32â€¯AM] andi15701
on ntx kernels, you can rmmod sdio_wifi_power


[8/31/2022 8:33â€¯AM] szybet
oh okay


[8/31/2022 8:33â€¯AM] szybet
goos that we already do that


[8/31/2022 8:33â€¯AM] szybet
so why koreader has this?


[8/31/2022 8:33â€¯AM] andi15701
perhaps some older ntx kernels need that


[8/31/2022 8:34â€¯AM] szybet
ğŸ˜¦


[8/31/2022 8:34â€¯AM] andi15701
no idea, as said I prefer using newer stuff


[8/31/2022 8:34â€¯AM] szybet
@tux-linux maybe not thr nia, but older devices need that?


[8/31/2022 8:36â€¯AM] andi15701
root@akepd:/sys/bus/sdio/drivers/rtl8189fs# ls -l
total 0
--w------- 1 root root 4096 Aug 31 08:35 bind
lrwxrwxrwx 1 root root    0 Aug 31 08:35 mmc1:0001:1 -> ../../../../devices/platform/soc/2100000.bus/2198000.mmc/mmc_host/mmc1/mmc1:0001/mmc1:0001:1
--w------- 1 root root 4096 Aug 31 08:34 uevent
--w------- 1 root root 4096 Aug 31 08:35 unbind
root@akepd:/sys/bus/sdio/drivers/rtl8189fs# echo mmc1\:0001\:1 >unbind 
root@akepd:/sys/bus/sdio/drivers/rtl8189fs# echo mmc1\:0001\:1 >bind 
root@akepd:/sys/bus/sdio/drivers/rtl8189fs# 
root@akepd:/sys/bus/sdio/drivers/rtl8189fs#


[8/31/2022 8:36â€¯AM] andi15701
that also works on mainline


[8/31/2022 8:36â€¯AM] szybet
it doesnt crash? cool


[8/31/2022 8:36â€¯AM] szybet
is it maybe possible to turn off voltage regulators for maximum power efficency?


[8/31/2022 8:37â€¯AM] andi15701
the regulator for the wifi is turned off


[8/31/2022 8:37â€¯AM] andi15701
in that case


[8/31/2022 8:37â€¯AM] szybet
the rest


[8/31/2022 8:37â€¯AM] szybet
they are many


[8/31/2022 8:38â€¯AM] andi15701
that is to be researched, and regulators have to be tied to the devices using them


[8/31/2022 8:38â€¯AM] szybet
too complicated

why arm isint using chipsets that handle that?


[8/31/2022 8:39â€¯AM] andi15701
also complicated


[8/31/2022 8:39â€¯AM] andi15701
giving a schematic


[8/31/2022 8:39â€¯AM] andi15701
and then we know what the regulators are doing


[8/31/2022 8:40â€¯AM] andi15701
what they are for


[8/31/2022 8:53â€¯AM] andi15701
and I can properly add that information to the devicetree


[8/31/2022 9:00â€¯AM] andi15701
```&usdhc3 {
        pinctrl-names = "default", "state_100mhz", "state_200mhz", "sleep";
        pinctrl-0 = <&pinctrl_usdhc3>;
        pinctrl-1 = <&pinctrl_usdhc3_100mhz>;
        pinctrl-2 = <&pinctrl_usdhc3_200mhz>;
        pinctrl-3 = <&pinctrl_usdhc3_sleep>;
        vmmc-supply = <&reg_wifi>;
        mmc-pwrseq = <&wifi_pwrseq>;
        cap-power-off-card;
        non-removable;
        status = "okay"; ```
Here i am specifying the power supply for the wifi card. Then the host controller driver will turn off regulator when the card is not used. If no driver for the card is loaded, it is considered not used. A well behaved driver (!= rtl8189fs out-of-mainline-tree driver) will also tell when the card is not used, so the host controller will know what to do


[8/31/2022 9:03â€¯AM] andi15701
so here are the information which are in that sdio_wifi_power module or some other dirty ntx stuff on many ntx kernels


[4/1/2023 12:09â€¯AM] andi15701
what's up with tp36?


[4/1/2023 12:09â€¯AM] andi15701
secondary serial port?


[4/1/2023 12:09â€¯AM] szybet
you mean?


[4/1/2023 12:10â€¯AM] andi15701
that group of 4 pads next to the console


[4/1/2023 12:11â€¯AM] szybet
never tested really


[4/1/2023 12:15â€¯AM] andi15701
TP3-TP6: They are connected with the cable to the touchscreen, so probably some i2c around there


[4/1/2023 12:15â€¯AM] andi15701
can be detected by running i2cdetect on the corresponding bus


[4/1/2023 12:16â€¯AM] andi15701
and just looking at them with a multimeter


[4/1/2023 12:16â€¯AM] andi15701
i2cdetect in a loop


[4/1/2023 1:01â€¯AM] andi15701
On the clara there is another i2c bus which is more difficult to access on pullups (without zeros on it)   near the lm3630a, the situation might be the same on the nia. Hot candidates are R139, R143, TP26/25, less hot R146, TP84


[4/1/2023 1:01â€¯AM] andi15701
but turn off the backlight during any experiments here


[4/1/2023 1:01â€¯AM] andi15701
or measurements


[4/1/2023 1:01â€¯AM] andi15701
since the backlight has a comparatively high voltage


[4/1/2023 1:03â€¯AM] andi15701
lm3630a = U11


[4/1/2023 1:56â€¯PM] andi15701
TP182-TP285: UART with HW-handshake hof non-soldered BT chip?


[4/1/2023 1:59â€¯PM] szybet
yep


[4/1/2023 2:15â€¯PM] andi15701
TP36 really begs for attaching something to it


[4/1/2023 2:16â€¯PM] andi15701
using some spring contacts, so without soldering so things keep modular


[4/1/2023 2:18â€¯PM] andi15701
lots of distance to any other victim


[4/1/2023 2:19â€¯PM] andi15701
so just some backcover with holes in that place is needed


[4/1/2023 2:20â€¯PM] andi15701
My guess would be that UART4 is there


[4/1/2023 2:31â€¯PM] andi15701
how to find out: 1. check whether there are signs that pins are used by something else


[4/1/2023 2:32â€¯PM] andi15701
can be checked via devicetree


[4/1/2023 2:32â€¯PM] andi15701
then check that they are configured as gpio


[4/1/2023 2:33â€¯PM] andi15701
and then play around with enabling  pullup/-down  ressistors


[4/1/2023 2:33â€¯PM] andi15701
via pad configuration in the SoC


[4/1/2023 2:33â€¯PM] andi15701
and check if a) gpio input moves, b) voltage on the pins is affected


[4/1/2023 2:34â€¯PM] andi15701
that in coarse


[4/1/2023 2:34â€¯PM] szybet
could be done


[4/1/2023 3:00â€¯PM] andi15701
so uart4 would be gpio64/65 (LCD_ENABLE/LCD_CLK)


[4/1/2023 3:02â€¯PM] andi15701
in devicetree if used as gpio: &gpio3 0  &gpio3 1


[4/1/2023 3:02â€¯PM] andi15701
no signs of that


[4/1/2023 3:09â€¯PM] andi15701
uart2 is &gpio4 6/7, aka gpio102/103 aka NAND_DATA0[45]


[4/12/2023 11:10â€¯PM] andi15701
do you have the devicetree?


[4/12/2023 11:11â€¯PM] andi15701
of it


[4/12/2023 11:11â€¯PM] andi15701
extracted?


[4/12/2023 11:11â€¯PM] szybet
?


[4/12/2023 11:11â€¯PM] szybet
its in the kernel source?


[4/12/2023 11:11â€¯PM] andi15701
no, hidden space


[4/12/2023 11:11â€¯PM] andi15701
before 1. partition


[4/12/2023 11:12â€¯PM] andi15701
extract-kobohidden clara-bkup.img 1286 out.dtb


[4/12/2023 11:14â€¯PM] szybet
you mean this? https://github.com/Szybet/niAudio/blob/main/old/logs/ntx_hwconfig-more

{Embed}
https://github.com/Szybet/niAudio/blob/main/old/logs/ntx_hwconfig-more
niAudio/ntx_hwconfig-more at main Â· Szybet/niAudio
Kobo nia ereader with audio added. Contribute to Szybet/niAudio development by creating an account on GitHub.
/mnt/data/projects/git/conversations/media/niAudio-613C3


[4/12/2023 11:15â€¯PM] andi15701
https://github.com/akemnade/kobo-firmware-extractor

{Embed}
https://github.com/akemnade/kobo-firmware-extractor
GitHub - akemnade/kobo-firmware-extractor: extracts firmware from h...
extracts firmware from hidden partitions on Kobo/Tolino ebook readers - GitHub - akemnade/kobo-firmware-extractor: extracts firmware from hidden partitions on Kobo/Tolino ebook readers
/mnt/data/projects/git/conversations/media/kobo-firmware-extractor-61521


[4/12/2023 11:17â€¯PM] szybet
oh, cool


[4/12/2023 11:18â€¯PM] szybet
well if you dont want to wait, there is the nia image for inkbox


[4/12/2023 11:18â€¯PM] szybet
i can tommorow / in the weekend extract it


[4/12/2023 11:18â€¯PM] tux_linux
http://23.163.0.39/bundles/inkbox/native/n306/inkbox-1.9-n306.xz


[4/12/2023 11:18â€¯PM] andi15701
if it contains *your* dtb, then I can extract it


[4/12/2023 11:19â€¯PM] tux_linux
Yes it's Szybet's unpartitioned space


[4/12/2023 11:19â€¯PM] tux_linux
I don't have a Nia


[4/12/2023 11:19â€¯PM] andi15701
reason: Kuratius' Nia has U67 soldered and that makes me extremely excited


[4/12/2023 11:20â€¯PM] szybet
???


[4/12/2023 11:20â€¯PM] andi15701
the qfn thing which is not soldered on your board


[4/12/2023 11:20â€¯PM] tux_linux
What does it do


[4/12/2023 11:20â€¯PM] szybet
WHAAAT


[4/12/2023 11:20â€¯PM] szybet
D:


[4/12/2023 11:21â€¯PM] szybet


{Attachments}
/mnt/data/projects/git/conversations/media/PXL_20230326_111333253-DE9CB.png


[4/12/2023 11:21â€¯PM] szybet
which chip is it


[4/12/2023 11:25â€¯PM] andi15701


{Attachments}
/mnt/data/projects/git/conversations/media/u67-F826F.jpg


[4/12/2023 11:26â€¯PM] szybet
and its not soldered to his too?


[4/12/2023 11:26â€¯PM] andi15701
it *is* soldered


[4/12/2023 11:27â€¯PM] szybet
i dont see a chip in this red square???


[4/12/2023 11:27â€¯PM] andi15701
it is an excerpt from your image


[4/12/2023 11:28â€¯PM] szybet
but thats kuratios image


[4/12/2023 11:30â€¯PM] andi15701
or just an optic illusion


[4/12/2023 11:30â€¯PM] szybet
what???...


[4/12/2023 11:31â€¯PM] andi15701
so, no not soldered there too


[4/12/2023 11:31â€¯PM] andi15701
the pcb looks darker


[4/12/2023 11:32â€¯PM] andi15701
and so I got the impression that the chip might be there


[4/12/2023 11:32â€¯PM] andi15701
would be too nice


[4/12/2023 11:32â€¯PM] tux_linux
What does it do


[4/12/2023 11:33â€¯PM] szybet
in the device tree is something about bluetooth


[4/17/2023 6:06â€¯PM] andi15701
has anyone ever compiled a kernel on this device?


[4/17/2023 6:13â€¯PM] szybet
on the nia, not for the nia?


[4/17/2023 6:13â€¯PM] andi15701
yes


[4/17/2023 6:14â€¯PM] andi15701
on the nia


[4/17/2023 6:14â€¯PM] szybet
why


[4/17/2023 6:14â€¯PM] szybet
no


[4/17/2023 6:14â€¯PM] szybet
sounds as a horrible idea


[4/17/2023 6:15â€¯PM] andi15701
I sometimes to such things for stability tests


[4/17/2023 6:17â€¯PM] andi15701
/*
         * on i.MX6ULL, no seperated VDD_ARM_IN and VDD_SOC_IN,
         * to align with other platform and use the same cpufreq
         * driver, still use the seperated OPP define for arm
         * and soc.
         */
        operating-points = <
                /* kHz  uV */
                900000  1250000
                792000  1200000
                528000  1175000
                396000  1175000
                198000  1175000
        >;


[4/17/2023 6:17â€¯PM] andi15701
I found that comment and that makes no sense


[4/17/2023 6:29â€¯PM] andi15701
yes, there are no separate inputs but there are two separate internal regulators, so you have separate voltages


[4/17/2023 6:30â€¯PM] andi15701
and the datasheet says for 900Mhz, typ. 1.275 V and not 1.250V, so again dear NTX what are you doing here?!


[4/17/2023 6:35â€¯PM] szybet
shouldnt a compiler / crosscompiler always give the same results, without looking what cpu its running on?


[4/17/2023 6:35â€¯PM] andi15701
yes, it should but it is often a good stability test


[4/17/2023 6:36â€¯PM] andi15701
there are several reports where some "internal gcc errors" were caused by hw stability issues


[4/17/2023 6:36â€¯PM] andi15701
I have also seen random error messages


[4/17/2023 6:36â€¯PM] szybet
stability as in hardware / software load test?


[4/17/2023 6:36â€¯PM] andi15701
yes


[4/17/2023 6:36â€¯PM] szybet
oh, okay


[4/17/2023 6:36â€¯PM] szybet
well those are ereaders, not regular pc


[4/17/2023 6:37â€¯PM] szybet
its not designed with this in mind


[4/17/2023 6:37â€¯PM] szybet
maybe even, depending on time something could burn off


[4/17/2023 6:37â€¯PM] szybet
so i have concerns


[4/17/2023 6:56â€¯PM] andi15701
well, maybe I am a bit more aggressive here, but you could also have some unintentional load test by opening a too big book, or some web page hogging the cpu when using the internal browser, so I would expect that a device would sustain that.


[4/17/2023 6:56â€¯PM] szybet
my point is time


[4/17/2023 6:56â€¯PM] szybet
no one tested if an ereader can sustain 30h of full load on everything


[4/17/2023 6:57â€¯PM] szybet
maybe temperature of one of the components is slowly going up


[4/17/2023 6:58â€¯PM] andi15701
well, I do not urge you to try that thing, and I would not do in the hot sun


[4/17/2023 6:58â€¯PM] szybet
i had this problem on an asus tablet, luckly it was the cpu so it just shutted down


[4/17/2023 7:32â€¯PM] tux_linux
No


[4/17/2023 7:33â€¯PM] tux_linux
My Kobo hardware has sustained heavy loads more times than it would ever have wanted to and it's still working


[4/17/2023 7:34â€¯PM] szybet
for how many h


[4/17/2023 7:39â€¯PM] tux_linux
Days?


[4/17/2023 7:40â€¯PM] tux_linux
It can throttle itself if needed


[4/17/2023 7:40â€¯PM] tux_linux
Didn't catch on fire


[4/17/2023 7:40â€¯PM] szybet
cpu, yes, other components, not really


[4/18/2023 4:01â€¯AM] ninuje
I remember poeple building a lot of stuff on-device back in the Kindle Touch days, too, FWIW


[4/28/2023 8:30â€¯AM] andi15701
well the regulator driver takes the voltages from a cache, which is never initialized if regulator is probed via devicetree (which is the case with the nia), so we are seeing the lowest end of the possible voltage range. The cache is in that case only set if the voltage is explicitely set by the kernel and not kept at boot state.


[4/28/2023 8:31â€¯AM] andi15701
Nasty surprises with ntx kernels everywhere... I hate that


[5/16/2023 6:57â€¯PM] andi15701
extract-kobohidden nia2-bkup.img 1286 nia2-factory.dtb


[7/13/2023 9:47â€¯PM] tux_linux
Changed the channel name: Kobo Nia model A (N306A)


==============================================================
Exported 5,133 message(s)
==============================================================
